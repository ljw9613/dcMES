(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-b7e7a29c"],{2212:function(e,t,r){"use strict";r.r(t);var a=r("c7eb"),i=(r("96cf"),r("1da1")),o=(r("f576"),r("6b54"),r("5530")),l=r("7e1e"),n={name:"EditDialog",components:{ZrSelect:r("6ace").a},props:{visible:{type:Boolean,default:!1},dialogStatus:{type:String,default:"create"},rowData:{type:Object,default:function(){return{}}}},data:function(){return{form:{workOrderNo:"",status:"PENDING",saleOrderId:"",saleOrderNo:"",productionOrderId:"",productionOrderNo:"",materialId:"",productModel:"",productName:"",productionLineId:"",lineName:"",businessType:"NORMAL",planQuantity:0,inputQuantity:0,outputQuantity:0,planStartTime:"",planEndTime:"",remark:""},rules:{workOrderNo:[{required:!0,message:"请输入工单号",trigger:"blur"}],status:[{required:!0,message:"请选择工单状态",trigger:"change"}],saleOrderId:[{required:!0,message:"请选择销售单号",trigger:"change"}],productionOrderId:[{required:!0,message:"请选择生产单号",trigger:"change"}],materialId:[{required:!0,message:"请选择产品",trigger:"change"}],productionLineId:[{required:!0,message:"请选择产线",trigger:"change"}],businessType:[{required:!0,message:"请选择业务类型",trigger:"change"}],planQuantity:[{required:!0,message:"请输入计划数量",trigger:"blur"}],planStartTime:[{required:!0,message:"请选择计划开始时间",trigger:"change"}],planEndTime:[{required:!0,message:"请选择计划结束时间",trigger:"change"}]},submitLoading:!1}},computed:{dialogTitle:function(){return"create"===this.dialogStatus?"新增生产计划工单":"编辑生产计划工单"},productionOrderQuery:function(){return this.form.saleOrderNo?{FSaleOrderNo:this.form.saleOrderNo}:{}},materialQuery:function(){return this.form.materialId?{FMaterialId:this.form.materialId}:{}}},watch:{visible:function(e){e&&this.initFormData()},rowData:{handler:function(e){e&&this.visible&&this.initFormData()},deep:!0}},methods:{initFormData:function(){"edit"===this.dialogStatus?this.form=Object(o.a)({},this.rowData):this.form={workOrderNo:"P"+(new Date).getFullYear().toString()+((new Date).getMonth()+1).toString().padStart(2,"0")+(new Date).getDate().toString().padStart(2,"0")+Date.now().toString(),status:"PENDING",saleOrderId:"",saleOrderNo:"",productionOrderId:"",productionOrderNo:"",materialId:"",materialNumber:"",materialName:"",fSpecification:"",FMATERIALID:"",productionLineId:"",lineName:"",businessType:"NORMAL",planQuantity:0,inputQuantity:0,outputQuantity:0,planStartTime:"",planEndTime:"",remark:""}},handleSaleOrderSelect:function(e){e&&(console.log(e),this.form.saleOrderId=e._id,this.form.saleOrderNo=e.FBillNo,this.form.productionOrderId="",this.form.productionOrderNo="")},handleProductionOrderSelect:function(){var e=Object(i.a)(Object(a.a)().mark((function e(t){var r,i;return Object(a.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t){e.next=12;break}return console.log(t),this.form.productionOrderId=t._id,this.form.productionOrderNo=t.FBillNo,this.form.fSpecification=t.FSpecification||"",this.form.materialName=t.FMaterialName||"",this.form.planQuantity=t.FQty||0,e.next=9,Object(l.b)("k3_BD_MATERIAL",{FMATERIALID:t.FMaterialId});case 9:r=e.sent,(i=r.data).length&&(this.form.materialId=i[0]._id);case 12:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),handleMaterialSelect:function(e){e&&(this.form.materialId=e._id,this.form.materialNumber=e.FNumber,this.form.materialName=e.FName,this.form.fSpecification=e.FSpecification,this.form.FMATERIALID=e.FMATERIALID)},handleProductionLineSelect:function(e){e&&(this.form.lineName=e.lineName)},handleClose:function(){this.$emit("update:visible",!1),this.$refs.form&&this.$refs.form.resetFields()},handleSubmit:function(){var e=this;this.$refs.form.validate(function(){var t=Object(i.a)(Object(a.a)().mark((function t(r){var i;return Object(a.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r){e.submitLoading=!0;try{i=Object(o.a)({},e.form),e.$emit("submit",i),e.handleClose()}catch(t){console.error("提交失败:",t),e.$message.error("提交失败")}finally{e.submitLoading=!1}}case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())}}},s=n,d=(r("af8a"),r("2877")),c=Object(d.a)(s,(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("el-dialog",{attrs:{title:e.dialogTitle,visible:e.visible,width:"60%"},on:{"update:visible":function(t){e.visible=t},close:e.handleClose}},[r("el-form",{ref:"form",attrs:{model:e.form,rules:e.rules,"label-width":"120px",size:"small"}},[r("el-row",{attrs:{gutter:20}},[r("el-col",{attrs:{span:12}},[r("el-form-item",{attrs:{label:"工单号",prop:"workOrderNo"}},[r("el-input",{attrs:{placeholder:"请输入工单号",disabled:"edit"===e.dialogStatus},model:{value:e.form.workOrderNo,callback:function(t){e.$set(e.form,"workOrderNo",t)},expression:"form.workOrderNo"}})],1)],1),e._v(" "),r("el-col",{attrs:{span:12}},[r("el-form-item",{attrs:{label:"工单状态",prop:"status"}},[r("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择工单状态"},model:{value:e.form.status,callback:function(t){e.$set(e.form,"status",t)},expression:"form.status"}},[r("el-option",{attrs:{label:"待生产",value:"PENDING"}}),e._v(" "),r("el-option",{attrs:{label:"生产中",value:"IN_PROGRESS"}}),e._v(" "),r("el-option",{attrs:{label:"已完成",value:"COMPLETED"}}),e._v(" "),r("el-option",{attrs:{label:"已取消",value:"CANCELLED"}})],1)],1)],1)],1),e._v(" "),r("el-row",{attrs:{gutter:20}},[r("el-col",{attrs:{span:12}},[r("el-form-item",{attrs:{label:"销售单号",prop:"saleOrderId"}},[r("zr-select",{attrs:{collection:"k3_SAL_SaleOrder","search-fields":["FBillNo"],"label-key":"FBillNo","sub-key":"FCustId",multiple:!1,placeholder:"请输入销售单号搜索"},on:{select:e.handleSaleOrderSelect},scopedSlots:e._u([{key:"option",fn:function(t){var a=t.item;return[r("div",{staticClass:"item-option"},[r("div",{staticClass:"item-info"},[r("span",{staticClass:"name"},[e._v(e._s(a.FBillNo))]),e._v(" "),r("el-tag",{attrs:{size:"mini",type:"info"}},[e._v(e._s(a.FCustId))])],1),e._v(" "),r("div",{staticClass:"sub-info"},[r("small",[e._v(e._s(a.FDate))])])])]}}]),model:{value:e.form.saleOrderId,callback:function(t){e.$set(e.form,"saleOrderId",t)},expression:"form.saleOrderId"}})],1)],1),e._v(" "),r("el-col",{attrs:{span:12}},[r("el-form-item",{attrs:{label:"生产单号",prop:"productionOrderId"}},[r("zr-select",{attrs:{collection:"k3_PRD_MO","search-fields":["FBillNo"],"label-key":"FBillNo","sub-key":"FMaterialName",multiple:!1,"additional-query":e.productionOrderQuery,placeholder:"请输入生产单号搜索"},on:{select:e.handleProductionOrderSelect},scopedSlots:e._u([{key:"option",fn:function(t){var a=t.item;return[r("div",{staticClass:"item-option"},[r("div",{staticClass:"item-info"},[r("span",{staticClass:"name"},[e._v(e._s(a.FBillNo))]),e._v(" "),r("el-tag",{attrs:{size:"mini",type:"info"}},[e._v(e._s(a.FMaterialName))])],1),e._v(" "),r("div",{staticClass:"sub-info"},[r("small",[e._v("计划数量: "+e._s(a.FQty))])])])]}}]),model:{value:e.form.productionOrderId,callback:function(t){e.$set(e.form,"productionOrderId",t)},expression:"form.productionOrderId"}})],1)],1)],1),e._v(" "),r("el-row",{attrs:{gutter:20}},[r("el-col",{attrs:{span:12}},[r("el-form-item",{attrs:{label:"产品",prop:"materialId"}},[r("zr-select",{attrs:{collection:"k3_BD_MATERIAL","search-fields":["FNumber","FName","FSpecification"],"label-key":"FName","value-key":"_id","tag-key":"FNumber","sub-key":"FSpecification",multiple:!1,placeholder:"请输入产品信息搜索","additional-query":e.materialQuery},on:{select:e.handleMaterialSelect},model:{value:e.form.materialId,callback:function(t){e.$set(e.form,"materialId",t)},expression:"form.materialId"}})],1)],1),e._v(" "),r("el-col",{attrs:{span:12}},[r("el-form-item",{attrs:{label:"产线",prop:"productionLineId"}},[r("zr-select",{attrs:{collection:"production_line","search-fields":["lineCode","lineName"],"label-key":"lineName","tag-key":"lineCode","sub-key":"workshop",multiple:!1,placeholder:"请输入产线信息搜索"},on:{select:e.handleProductionLineSelect},model:{value:e.form.productionLineId,callback:function(t){e.$set(e.form,"productionLineId",t)},expression:"form.productionLineId"}})],1)],1)],1),e._v(" "),r("el-row",{attrs:{gutter:20}},[r("el-col",{attrs:{span:8}},[r("el-form-item",{attrs:{label:"计划数量",prop:"planQuantity"}},[r("el-input-number",{staticStyle:{width:"100%"},attrs:{min:0,"controls-position":"right"},model:{value:e.form.planQuantity,callback:function(t){e.$set(e.form,"planQuantity",t)},expression:"form.planQuantity"}})],1)],1),e._v(" "),r("el-col",{attrs:{span:8}},[r("el-form-item",{attrs:{label:"投入数量",prop:"inputQuantity"}},[r("el-input-number",{staticStyle:{width:"100%"},attrs:{min:0,"controls-position":"right"},model:{value:e.form.inputQuantity,callback:function(t){e.$set(e.form,"inputQuantity",t)},expression:"form.inputQuantity"}})],1)],1),e._v(" "),r("el-col",{attrs:{span:8}},[r("el-form-item",{attrs:{label:"产出数量",prop:"outputQuantity"}},[r("el-input-number",{staticStyle:{width:"100%"},attrs:{min:0,"controls-position":"right"},model:{value:e.form.outputQuantity,callback:function(t){e.$set(e.form,"outputQuantity",t)},expression:"form.outputQuantity"}})],1)],1)],1),e._v(" "),r("el-row",{attrs:{gutter:20}},[r("el-col",{attrs:{span:12}},[r("el-form-item",{attrs:{label:"计划开始时间",prop:"planStartTime"}},[r("el-date-picker",{staticStyle:{width:"100%"},attrs:{type:"datetime",placeholder:"选择计划开始时间"},model:{value:e.form.planStartTime,callback:function(t){e.$set(e.form,"planStartTime",t)},expression:"form.planStartTime"}})],1)],1),e._v(" "),r("el-col",{attrs:{span:12}},[r("el-form-item",{attrs:{label:"计划结束时间",prop:"planEndTime"}},[r("el-date-picker",{staticStyle:{width:"100%"},attrs:{type:"datetime",placeholder:"选择计划结束时间"},model:{value:e.form.planEndTime,callback:function(t){e.$set(e.form,"planEndTime",t)},expression:"form.planEndTime"}})],1)],1)],1),e._v(" "),r("el-form-item",{attrs:{label:"备注",prop:"remark"}},[r("el-input",{attrs:{type:"textarea",placeholder:"请输入备注信息"},model:{value:e.form.remark,callback:function(t){e.$set(e.form,"remark",t)},expression:"form.remark"}})],1)],1),e._v(" "),r("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{on:{click:e.handleClose}},[e._v("取 消")]),e._v(" "),r("el-button",{attrs:{type:"primary",loading:e.submitLoading},on:{click:e.handleSubmit}},[e._v("确 定")])],1)],1)}),[],!1,null,"badef61e",null);t.default=c.exports},"49e8":function(e,t,r){},af8a:function(e,t,r){"use strict";r("49e8")}}]);