(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-fbc2892e"],{"0923":function(e,t,a){"use strict";a.r(t);var r=a("5530"),s=(a("14b9"),a("b85c")),i=a("c7eb"),n=(a("1c4c"),a("ac6a"),a("5df3"),a("4f7f"),a("96cf"),a("1da1")),o=a("7e1e"),l={name:"EditDialog",dicts:["machine_type"],props:{visible:{type:Boolean,default:!1},dialogStatus:{type:String,default:"create"},rowData:{type:Object,default:function(){return{}}}},data:function(){return{dialogVisible:this.visible,form:{machineName:"",machineCode:"",machineIp:"",principal:"",comment:""},rules:{machineName:[{required:!0,message:"请输入设备名称",trigger:"blur"}],machineCode:[{required:!0,message:"请输入设备编号",trigger:"blur"}],machineIp:[{required:!0,message:"请输入设备IP",trigger:"blur"}],principal:[{required:!0,message:"请输入负责人",trigger:"blur"}]},processStepOptions:[],submitLoading:!1,processLoading:!1}},computed:{dialogTitle:function(){return"create"===this.dialogStatus?"新增设备信息":"编辑设备信息"}},watch:{visible:function(e){this.dialogVisible=e,e&&this.initFormData()},rowData:{handler:function(e){e&&this.dialogVisible&&this.initFormData()},deep:!0}},methods:{handleProcessChange:function(e){this.form.processStepId=e||""},handleProductChange:function(){var e=Object(n.a)(Object(i.a)().mark((function e(t){var a,r,s;return Object(i.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=t._id,this.processStepOptions=[],this.form.processStepId="",this.form.materialId="",a){e.next=6;break}return e.abrupt("return");case 6:return r=this.$loading({lock:!0,text:"正在获取数据，请稍候...",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"}),e.prev=7,e.next=10,this.getAllProcessSteps(a,new Set,new Set);case 10:s=e.sent,console.log("获取到的工序:",s),this.processStepOptions=Array.from(s),this.form.materialId=a,e.next=20;break;case 16:e.prev=16,e.t0=e.catch(7),console.error("获取工序列表失败:",e.t0),this.$message.error("获取工序列表失败");case 20:return e.prev=20,r.close(),e.finish(20);case 23:case"end":return e.stop()}}),e,this,[[7,16,20,23]])})));return function(t){return e.apply(this,arguments)}}(),getAllProcessSteps:function(){var e=Object(n.a)(Object(i.a)().mark((function e(t){var a,r,n,l,c,p,m,u,d,f,h,b,v,g=arguments;return Object(i.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=g.length>1&&void 0!==g[1]?g[1]:new Set,r=g.length>2&&void 0!==g[2]?g[2]:new Set,n=g.length>3&&void 0!==g[3]?g[3]:0,e.prev=3,!r.has(t)){e.next=6;break}return e.abrupt("return",a);case 6:return r.add(t),e.next=9,Object(o.b)("craft",{query:{materialId:t},page:1,limit:1});case 9:if((l=e.sent).data&&0!==l.data.length){e.next=12;break}return e.abrupt("return",a);case 12:return c=l.data[0],e.next=15,Object(o.b)("processStep",{query:{craftId:c._id},sort:{sort:1}});case 15:if(!(p=e.sent).data){e.next=55;break}m=Object(s.a)(p.data),e.prev=18,m.s();case 20:if((u=m.n()).done){e.next=47;break}return(d=u.value).levelPrefix="┗".repeat(n),a.add(d),e.next=26,Object(o.b)("processMaterials",{query:{processStepId:d._id}});case 26:if(!(f=e.sent).data){e.next=45;break}h=Object(s.a)(f.data),e.prev=29,h.s();case 31:if((b=h.n()).done){e.next=37;break}return v=b.value,e.next=35,this.getAllProcessSteps(v.materialId,a,r,n+1);case 35:e.next=31;break;case 37:e.next=42;break;case 39:e.prev=39,e.t0=e.catch(29),h.e(e.t0);case 42:return e.prev=42,h.f(),e.finish(42);case 45:e.next=20;break;case 47:e.next=52;break;case 49:e.prev=49,e.t1=e.catch(18),m.e(e.t1);case 52:return e.prev=52,m.f(),e.finish(52);case 55:return e.abrupt("return",a);case 58:return e.prev=58,e.t2=e.catch(3),console.error("获取工序失败:",e.t2),e.abrupt("return",a);case 62:case"end":return e.stop()}}),e,this,[[3,58],[18,49,52,55],[29,39,42,45]])})));return function(t){return e.apply(this,arguments)}}(),handleSearchLineChange:function(e){console.log(e),this.form.lineCode=e.lineCode,this.form.lineName=e.lineName},initFormData:function(){var e=Object(n.a)(Object(i.a)().mark((function e(){var t;return Object(i.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("edit"!==this.dialogStatus){e.next=16;break}if(this.form=Object(r.a)({},this.rowData),!this.form.materialId){e.next=14;break}return e.prev=3,e.next=6,this.getAllProcessSteps(this.form.materialId,new Set,new Set);case 6:t=e.sent,this.processStepOptions=Array.from(t),e.next=14;break;case 10:e.prev=10,e.t0=e.catch(3),console.error("初始化工序列表失败:",e.t0),this.$message.error("初始化工序列表失败");case 14:e.next=17;break;case 16:this.form={machineName:"",machineCode:"",machineIp:"",principal:"",comment:""};case 17:case"end":return e.stop()}}),e,this,[[3,10]])})));return function(){return e.apply(this,arguments)}}(),handleClose:function(){this.$emit("update:visible",!1),this.$refs.form&&this.$refs.form.resetFields()},handleSubmit:function(){var e=this;this.$refs.form.validate(function(){var t=Object(n.a)(Object(i.a)().mark((function t(a){var s;return Object(i.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(a){e.submitLoading=!0;try{s=Object(r.a)({},e.form),e.$emit("submit",s),e.handleClose()}catch(t){console.error("提交失败:",t),e.$message.error("提交失败")}finally{e.submitLoading=!1}}case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())}}},c=l,p=(a("4be3"),a("2877")),m=Object(p.a)(c,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{attrs:{title:e.dialogTitle,visible:e.dialogVisible,width:"60%"},on:{close:e.handleClose,"update:visible":function(t){return e.$emit("update:visible",t)}}},[a("el-form",{ref:"form",attrs:{model:e.form,rules:e.rules,"label-width":"120px",size:"small"}},[a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"设备名称",prop:"machineName"}},[a("el-input",{attrs:{placeholder:"请输入设备名称"},model:{value:e.form.machineName,callback:function(t){e.$set(e.form,"machineName",t)},expression:"form.machineName"}})],1)],1),e._v(" "),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"设备编号",prop:"machineCode"}},[a("el-input",{attrs:{placeholder:"请输入设备编号"},model:{value:e.form.machineCode,callback:function(t){e.$set(e.form,"machineCode",t)},expression:"form.machineCode"}})],1)],1)],1),e._v(" "),a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"设备IP",prop:"machineIp"}},[a("el-input",{attrs:{placeholder:"请输入设备IP"},model:{value:e.form.machineIp,callback:function(t){e.$set(e.form,"machineIp",t)},expression:"form.machineIp"}})],1)],1),e._v(" "),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"负责人",prop:"principal"}},[a("el-input",{attrs:{placeholder:"请输入负责人"},model:{value:e.form.principal,callback:function(t){e.$set(e.form,"principal",t)},expression:"form.principal"}})],1)],1)],1),e._v(" "),a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"产线名称",prop:"lineName"}},[a("zr-select",{staticStyle:{width:"100%"},attrs:{collection:"production_line","search-fields":["lineName","lineCode"],"label-key":"lineName","sub-key":"lineCode",multiple:!1,placeholder:"请输入产线名称搜索",clearable:""},on:{select:e.handleSearchLineChange},scopedSlots:e._u([{key:"option",fn:function(t){var r=t.item;return[a("div",{staticClass:"select-option"},[a("div",{staticClass:"option-main"},[a("span",{staticClass:"option-label"},[e._v(e._s(r.lineName)+" - "+e._s(r.lineCode))]),e._v(" "),a("el-tag",{staticClass:"option-tag",attrs:{size:"mini",type:"info"}},[e._v("\n                                        线路编号: "+e._s(r.lineNum)+"\n                                    ")])],1)])]}}]),model:{value:e.form.lineId,callback:function(t){e.$set(e.form,"lineId",t)},expression:"form.lineId"}})],1)],1),e._v(" "),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"设备类型",prop:"machineType"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择设备类型",clearable:"","popper-append-to-body":!0},model:{value:e.form.machineType,callback:function(t){e.$set(e.form,"machineType",t)},expression:"form.machineType"}},e._l(e.dict.type.machine_type,(function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)],1)],1),e._v(" "),a("el-form-item",{attrs:{label:"备注",prop:"comment"}},[a("el-input",{attrs:{type:"textarea",placeholder:"请输入备注信息"},model:{value:e.form.comment,callback:function(t){e.$set(e.form,"comment",t)},expression:"form.comment"}})],1),e._v(" "),a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:24}},[a("hr",{staticStyle:{"border-top":"1px solid #dcdfe6",width:"100%",margin:"20px 0"}})])],1),e._v(" "),a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:24}},[a("div",{staticClass:"tip-box"},[a("p",[e._v("请勿随意修改当前设备的当前生产工序")])])])],1),e._v(" "),a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"产品型号"}},[a("zr-select",{attrs:{collection:"k3_BD_MATERIAL","search-fields":["FNumber","FName"],"label-key":"FName","sub-key":"FMATERIALID",multiple:!1,placeholder:"请输入物料编码/名称搜索"},on:{select:e.handleProductChange},scopedSlots:e._u([{key:"option",fn:function(t){var r=t.item;return[a("div",{staticClass:"item-option"},[a("div",{staticClass:"item-info"},[a("span",[e._v(e._s(r.FNumber)+" - "+e._s(r.FName))]),e._v(" "),a("el-tag",{attrs:{size:"mini",type:"info"}},[e._v(e._s(r.FMATERIALID)+" -"+e._s(r.FUseOrgId))])],1)])]}}]),model:{value:e.form.materialId,callback:function(t){e.$set(e.form,"materialId",t)},expression:"form.materialId"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"当前生产工序"}},[a("el-select",{staticClass:"custom-select",attrs:{placeholder:"当前生产工序"},on:{change:e.handleProcessChange},model:{value:e.form.processStepId,callback:function(t){e.$set(e.form,"processStepId",t)},expression:"form.processStepId"}},e._l(e.processStepOptions,(function(t){return a("el-option",{key:t._id,attrs:{label:t.processName,value:t._id}},[a("div",{staticClass:"option-content"},[a("span",{staticClass:"option-main"},[e._v(e._s(""+(t.levelPrefix||"")+t.sort+"."+t.processName))]),e._v(" "),a("span",{staticClass:"option-sub"},[e._v(e._s(t.processCode))])])])})),1)],1)],1)],1)],1),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:e.handleClose}},[e._v("取 消")]),e._v(" "),a("el-button",{attrs:{type:"primary",loading:e.submitLoading},on:{click:e.handleSubmit}},[e._v("确 定")])],1)],1)}),[],!1,null,"4a601b54",null);t.default=m.exports},"4be3":function(e,t,a){"use strict";a("59ce")},"59ce":function(e,t,a){}}]);