(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-1e10722e"],{"03a7":function(t,e,r){},2212:function(t,e,r){"use strict";r.r(e);var a=(r("f576"),r("6b54"),r("5530")),o=r("c7eb"),i=(r("96cf"),r("1da1")),n=r("7e1e"),l=r("6ace"),s=r("3b8b"),c=r("ed91"),u={name:"EditDialog",dicts:["work_order_status"],components:{ZrSelect:l.a,workDialog:s.a},props:{visible:{type:Boolean,default:!1},dialogStatus:{type:String,default:"create"},rowData:{type:Object,default:function(){return{}}}},data:function(){return{form:{workOrderNo:"",status:"PENDING",saleOrderId:"",saleOrderNo:"",productionOrderId:"",productionOrderNo:"",materialId:"",productModel:"",productName:"",productionLineId:"",lineName:"",businessType:"NORMAL",planQuantity:0,inputQuantity:0,outputQuantity:0,planStartTime:"",planEndTime:"",remark:""},rules:{workOrderNo:[{required:!0,message:"请输入工单号",trigger:"blur"}],status:[{required:!0,message:"请选择工单状态",trigger:"change"}],saleOrderId:[{required:!0,message:"请选择销售单号",trigger:"change"}],productionOrderId:[{required:!0,message:"请选择生产单号",trigger:"change"}],materialId:[{required:!0,message:"请选择产品",trigger:"change"}],productionLineId:[{required:!0,message:"请选择产线",trigger:"change"}],businessType:[{required:!0,message:"请选择业务类型",trigger:"change"}],planQuantity:[{required:!0,message:"请输入计划数量",trigger:"blur"}],planStartTime:[{required:!0,message:"请选择计划开始时间",trigger:"change"}],planEndTime:[{required:!0,message:"请选择计划结束时间",trigger:"change"}]},submitLoading:!1,workDialogVisible:!1,workTableData:[]}},computed:{dialogTitle:function(){return"create"===this.dialogStatus?"新增生产计划工单":"编辑生产计划工单"},productionOrderQuery:function(){return this.form.saleOrderNo?{FSaleOrderNo:this.form.saleOrderNo}:{}},materialQuery:function(){return this.form.materialId?{FMaterialId:this.form.materialId}:{}},canStart:function(){return"PENDING"===this.form.status||"PAUSED"===this.form.status}},watch:{visible:function(t){t&&this.initFormData()},rowData:{handler:function(t){t&&this.visible&&this.initFormData()},deep:!0}},methods:{handleOneKeyProduction:function(){var t=Object(i.a)(Object(o.a)().mark((function t(){var e,r;return Object(o.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,this.form.productionLineId){t.next=4;break}return this.$message.error("请先选择产线"),t.abrupt("return");case 4:return t.next=6,Object(c.b)(this.form.materialId);case 6:if(e=t.sent,r=e.data,console.log("获取到的工序:",r),0!==r.length){t.next=12;break}return this.$message.error("该物料没有对应的工艺"),t.abrupt("return");case 12:this.workTableData=r,console.log(this.workTableData,"this.workTableData"),this.workDialogVisible=!0,t.next=20;break;case 17:t.prev=17,t.t0=t.catch(0),this.$message.error("获取工序数据失败");case 20:case"end":return t.stop()}}),t,this,[[0,17]])})));return function(){return t.apply(this,arguments)}}(),initFormData:function(){"edit"===this.dialogStatus?this.form=Object(a.a)({},this.rowData):this.form={workOrderNo:"P"+(new Date).getFullYear().toString()+((new Date).getMonth()+1).toString().padStart(2,"0")+(new Date).getDate().toString().padStart(2,"0")+Date.now().toString(),status:"PENDING",saleOrderId:"",saleOrderNo:"",productionOrderId:"",productionOrderNo:"",materialId:"",materialNumber:"",materialName:"",fSpecification:"",FMATERIALID:"",productionLineId:"",lineName:"",businessType:"NORMAL",planQuantity:0,inputQuantity:0,outputQuantity:0,planStartTime:"",planEndTime:"",remark:""}},handleSaleOrderSelect:function(t){var e=this;this.form.saleOrderId=null,this.form.productionOrderId=null,t&&(console.log(t),this.$nextTick((function(){e.form.saleOrderId=t._id,e.form.saleOrderNo=t.FBillNo,e.form.productionOrderId="",e.form.productionOrderNo=""})))},handleProductionOrderSelect:function(){var t=Object(i.a)(Object(o.a)().mark((function t(e){var r=this;return Object(o.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:this.form.productionOrderId=null,this.form.materialId=null,e&&(console.log(e),this.$nextTick(Object(i.a)(Object(o.a)().mark((function t(){var a,i;return Object(o.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r.form.productionOrderId=e._id,r.form.productionOrderNo=e.FBillNo,r.form.fSpecification=e.FSpecification||"",r.form.materialName=e.FMaterialName||"",r.form.planQuantity=e.FQty||0,r.form.materialCode=e.FNumber||"",t.next=8,Object(n.b)("k3_BD_MATERIAL",{query:{FMATERIALID:e.FMaterialId}});case 8:a=t.sent,i=a.data,console.log(i),i.length&&(r.form.materialId=i[0]._id);case 12:case"end":return t.stop()}}),t)})))));case 3:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}(),handleMaterialSelect:function(t){t&&(this.form.materialId=t._id,this.form.materialNumber=t.FNumber,this.form.materialName=t.FName,this.form.fSpecification=t.FSpecification,this.form.FMATERIALID=t.FMATERIALID)},handleProductionLineSelect:function(t){t&&(this.form.lineName=t.lineName)},handleClose:function(){this.$emit("update:visible",!1),this.$refs.form&&this.$refs.form.resetFields()},handleSubmit:function(){var t=this;this.$refs.form.validate(function(){var e=Object(i.a)(Object(o.a)().mark((function e(r){var i;return Object(o.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r){t.submitLoading=!0;try{i=Object(a.a)({},t.form),t.$emit("submit",i),t.handleClose()}catch(e){console.error("提交失败:",e),t.$message.error("提交失败")}finally{t.submitLoading=!1}}case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())},handleStartProduction:function(){var t=this;this.$confirm("确认开始生产该工单?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){t.form.status="IN_PROGRESS",t.handleSubmit()})).catch((function(){}))},handlePauseProduction:function(){var t=this;this.$confirm("确认暂停生产该工单?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){t.form.status="PAUSED",t.handleSubmit()})).catch((function(){}))},handleCancelProduction:function(){var t=this;this.$confirm("确认取消生产该工单?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){t.form.status="CANCELLED",t.handleSubmit()})).catch((function(){}))}}},d=u,m=(r("bae5"),r("2877")),p=Object(m.a)(d,(function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("el-dialog",{attrs:{title:t.dialogTitle,visible:t.visible,width:"60%"},on:{"update:visible":function(e){t.visible=e},close:t.handleClose}},[r("el-form",{ref:"form",attrs:{model:t.form,rules:t.rules,"label-width":"120px",size:"small"}},[r("el-row",{attrs:{gutter:20}},[r("el-col",{attrs:{span:12}},[r("el-form-item",{attrs:{label:"工单号",prop:"workOrderNo"}},[r("el-input",{attrs:{placeholder:"请输入工单号",disabled:"edit"===t.dialogStatus},model:{value:t.form.workOrderNo,callback:function(e){t.$set(t.form,"workOrderNo",e)},expression:"form.workOrderNo"}})],1)],1),t._v(" "),r("el-col",{attrs:{span:12}},[r("el-form-item",{attrs:{label:"工单状态",prop:"status"}},[r("el-select",{staticStyle:{width:"100%"},attrs:{disabled:"",placeholder:"请选择工单状态"},model:{value:t.form.status,callback:function(e){t.$set(t.form,"status",e)},expression:"form.status"}},t._l(t.dict.type.work_order_status,(function(t){return r("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),1)],1)],1)],1),t._v(" "),r("el-row",{attrs:{gutter:20}},[r("el-col",{attrs:{span:12}},[r("el-form-item",{attrs:{label:"销售单号",prop:"saleOrderId"}},[r("zr-select",{attrs:{collection:"k3_SAL_SaleOrder","search-fields":["FBillNo"],"label-key":"FBillNo","sub-key":"FCustId",multiple:!1,placeholder:"请输入销售单号搜索"},on:{select:t.handleSaleOrderSelect},scopedSlots:t._u([{key:"option",fn:function(e){var a=e.item;return[r("div",{staticClass:"item-option"},[r("div",{staticClass:"item-info"},[r("span",{staticClass:"name"},[t._v(t._s(a.FBillNo))]),t._v(" "),r("el-tag",{attrs:{size:"mini",type:"info"}},[t._v(t._s(a.FCustId))])],1),t._v(" "),r("div",{staticClass:"sub-info"},[r("small",[t._v(t._s(a.FDate))])])])]}}]),model:{value:t.form.saleOrderId,callback:function(e){t.$set(t.form,"saleOrderId",e)},expression:"form.saleOrderId"}})],1)],1),t._v(" "),r("el-col",{attrs:{span:12}},[r("el-form-item",{attrs:{label:"生产单号",prop:"productionOrderId"}},[t.form.saleOrderId?r("zr-select",{attrs:{collection:"k3_PRD_MO","search-fields":["FBillNo"],"label-key":"FBillNo","sub-key":"FMaterialName",multiple:!1,"additional-query":t.productionOrderQuery,placeholder:"请输入生产单号搜索"},on:{select:t.handleProductionOrderSelect},scopedSlots:t._u([{key:"option",fn:function(e){var a=e.item;return[r("div",{staticClass:"item-option"},[r("div",{staticClass:"item-info"},[r("span",{staticClass:"name"},[t._v(t._s(a.FBillNo))]),t._v(" "),r("el-tag",{attrs:{size:"mini",type:"info"}},[t._v(t._s(a.FMaterialName))])],1),t._v(" "),r("div",{staticClass:"sub-info"},[r("small",[t._v("计划数量: "+t._s(a.FQty))])])])]}}],null,!1,2920372338),model:{value:t.form.productionOrderId,callback:function(e){t.$set(t.form,"productionOrderId",e)},expression:"form.productionOrderId"}}):r("el-input",{attrs:{disabled:!0,placeholder:"请先选择销售单号"},model:{value:t.form.productionOrderNo,callback:function(e){t.$set(t.form,"productionOrderNo",e)},expression:"form.productionOrderNo"}})],1)],1)],1),t._v(" "),r("el-row",{attrs:{gutter:20}},[r("el-col",{attrs:{span:12}},[r("el-form-item",{attrs:{label:"产品",prop:"materialId"}},[t.form.productionOrderId?r("zr-select",{attrs:{collection:"k3_BD_MATERIAL","search-fields":["FNumber","FName","FSpecification"],"label-key":"FName","sub-key":"FMATERIALID",multiple:!1,"additional-query":t.materialQuery,placeholder:"请输入物料编码/名称搜索"},on:{select:t.handleMaterialSelect},scopedSlots:t._u([{key:"option",fn:function(e){var a=e.item;return[r("div",{staticClass:"select-option"},[r("div",{staticClass:"option-main"},[r("span",{staticClass:"option-label"},[t._v(t._s(a.FNumber)+" - "+t._s(a.FName))]),t._v(" "),r("el-tag",{staticClass:"option-tag",attrs:{size:"mini",type:"info"}},[t._v("\n                                        "+t._s(a.FMATERIALID)+" - "+t._s(a.FUseOrgId)+"\n                                    ")])],1),t._v(" "),a.FSpecification?r("div",{staticClass:"option-sub"},[r("small",[t._v("规格: "+t._s(a.FSpecification))])]):t._e()])]}}],null,!1,546627704),model:{value:t.form.materialId,callback:function(e){t.$set(t.form,"materialId",e)},expression:"form.materialId"}}):r("el-input",{attrs:{disabled:!0,placeholder:"请先选择生产单号"},model:{value:t.form.materialName,callback:function(e){t.$set(t.form,"materialName",e)},expression:"form.materialName"}})],1)],1),t._v(" "),r("el-col",{attrs:{span:12}},[r("el-form-item",{attrs:{label:"产线",prop:"productionLineId"}},[r("zr-select",{attrs:{collection:"production_line","search-fields":["lineCode","lineName"],"label-key":"lineName","tag-key":"lineCode","sub-key":"workshop",multiple:!1,placeholder:"请输入产线信息搜索"},on:{select:t.handleProductionLineSelect},model:{value:t.form.productionLineId,callback:function(e){t.$set(t.form,"productionLineId",e)},expression:"form.productionLineId"}})],1)],1)],1),t._v(" "),r("el-row",{attrs:{gutter:20}},[r("el-col",{attrs:{span:8}},[r("el-form-item",{attrs:{label:"计划数量",prop:"planQuantity"}},[r("el-input-number",{staticStyle:{width:"100%"},attrs:{min:0,"controls-position":"right"},model:{value:t.form.planQuantity,callback:function(e){t.$set(t.form,"planQuantity",e)},expression:"form.planQuantity"}})],1)],1),t._v(" "),r("el-col",{attrs:{span:8}},[r("el-form-item",{attrs:{label:"投入数量",prop:"inputQuantity"}},[r("el-input-number",{staticStyle:{width:"100%"},attrs:{min:0,"controls-position":"right"},model:{value:t.form.inputQuantity,callback:function(e){t.$set(t.form,"inputQuantity",e)},expression:"form.inputQuantity"}})],1)],1),t._v(" "),r("el-col",{attrs:{span:8}},[r("el-form-item",{attrs:{label:"产出数量",prop:"outputQuantity"}},[r("el-input-number",{staticStyle:{width:"100%"},attrs:{min:0,"controls-position":"right"},model:{value:t.form.outputQuantity,callback:function(e){t.$set(t.form,"outputQuantity",e)},expression:"form.outputQuantity"}})],1)],1)],1),t._v(" "),r("el-row",{attrs:{gutter:20}},[r("el-col",{attrs:{span:12}},[r("el-form-item",{attrs:{label:"计划开始时间",prop:"planStartTime"}},[r("el-date-picker",{staticStyle:{width:"100%"},attrs:{type:"datetime",placeholder:"选择计划开始时间"},model:{value:t.form.planStartTime,callback:function(e){t.$set(t.form,"planStartTime",e)},expression:"form.planStartTime"}})],1)],1),t._v(" "),r("el-col",{attrs:{span:12}},[r("el-form-item",{attrs:{label:"计划结束时间",prop:"planEndTime"}},[r("el-date-picker",{staticStyle:{width:"100%"},attrs:{type:"datetime",placeholder:"选择计划结束时间"},model:{value:t.form.planEndTime,callback:function(e){t.$set(t.form,"planEndTime",e)},expression:"form.planEndTime"}})],1)],1)],1),t._v(" "),r("el-form-item",{attrs:{label:"备注",prop:"remark"}},[r("el-input",{attrs:{type:"textarea",placeholder:"请输入备注信息"},model:{value:t.form.remark,callback:function(e){t.$set(t.form,"remark",e)},expression:"form.remark"}})],1)],1),t._v(" "),r("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},["edit"===t.dialogStatus?[r("el-button",{attrs:{type:"info"},on:{click:t.handleOneKeyProduction}},[t._v("\n                一键生产\n            ")]),t._v(" "),"PENDING"===t.form.status||"PAUSED"===t.form.status?r("el-button",{attrs:{type:"success",disabled:!t.canStart},on:{click:t.handleStartProduction}},[t._v("\n                开始生产\n            ")]):t._e(),t._v(" "),"IN_PROGRESS"===t.form.status?r("el-button",{attrs:{type:"warning",disabled:"IN_PROGRESS"!==t.form.status},on:{click:t.handlePauseProduction}},[t._v("\n                暂停生产\n            ")]):t._e(),t._v(" "),"IN_PROGRESS"===t.form.status?r("el-button",{attrs:{type:"danger",disabled:"IN_PROGRESS"!==t.form.status},on:{click:t.handleCancelProduction}},[t._v("\n                取消生产\n            ")]):t._e()]:t._e(),t._v(" "),r("el-button",{on:{click:t.handleClose}},[t._v("取 消")]),t._v(" "),r("el-button",{attrs:{type:"primary",loading:t.submitLoading},on:{click:t.handleSubmit}},[t._v("确 定")])],2),t._v(" "),t.workDialogVisible&&"edit"===t.dialogStatus?r("work-dialog",{attrs:{"line-id":t.form.productionLineId,visible:t.workDialogVisible,"material-id":t.form.materialId,productionPlanWorkOrderId:t.form._id,"work-table-data":t.workTableData},on:{"update:visible":function(e){t.workDialogVisible=e}}}):t._e()],1)}),[],!1,null,"79a2a0c3",null);e.default=p.exports},"77d2":function(t,e,r){"use strict";r.d(e,"a",(function(){return o})),r.d(e,"b",(function(){return i}));var a=r("b775");function o(t){return Object(a.a)({url:"/machine/progress",method:"get",params:t})}function i(t){return Object(a.a)({url:"/machine/refresh",method:"post",data:t})}},bae5:function(t,e,r){"use strict";r("03a7")},ed91:function(t,e,r){"use strict";r.d(e,"a",(function(){return o})),r.d(e,"c",(function(){return i})),r.d(e,"d",(function(){return n})),r.d(e,"e",(function(){return l})),r.d(e,"b",(function(){return s}));var a=r("b775");function o(t){return Object(a.a)({url:"/create-flow",method:"post",data:t})}function i(t){return Object(a.a)({url:"/scan-components",method:"post",data:t})}function n(t){return Object(a.a)({url:"/unbind-components",method:"post",data:t})}function l(t){return Object(a.a)({url:"/update-flow-nodes",method:"post",data:t})}function s(t){return Object(a.a)({url:"/all-process-steps/".concat(t),method:"get"})}}}]);