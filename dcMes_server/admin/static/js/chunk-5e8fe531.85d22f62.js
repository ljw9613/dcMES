(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-5e8fe531"],{"14e1":function(e,t,a){e.exports=a.p+"static/media/cfbd.7c42ce8c.mp3"},"31b6":function(e,t,a){e.exports=a.p+"static/media/bdcg.762434df.mp3"},"33fd":function(e,t,a){e.exports=a.p+"static/media/tmyw.a5dd40df.mp3"},"45bf":function(e,t,a){},9503:function(e,t,a){"use strict";a("45bf")},de6b:function(e,t,a){e.exports=a.p+"static/media/smcg.fe637541.mp3"},f783:function(e,t,a){"use strict";a.r(t);var r=(a("a481"),a("8615"),a("7514"),a("28a5"),a("6762"),a("2fdb"),a("1c4c"),a("b85c")),n=(a("ac6a"),a("5df3"),a("4f7f"),a("c7eb")),s=(a("96cf"),a("1da1")),i=a("7e1e"),c=a("b775");function o(e){return Object(c.a)({url:"/create-flow",method:"post",data:e})}function l(e){return Object(c.a)({url:"/scan-components",method:"post",data:e})}var u=a("6ace");function d(e){new Audio(e).play().catch((function(e){console.warn("éŸ³é¢‘æ’­æ”¾å¤±è´¥:",e)}))}var p=a("de6b"),m=a.n(p),f=a("33fd"),h=a.n(f),b=a("31b6"),v=a.n(b),g=a("14e1"),x=a.n(g),I={name:"ScanBarCode",components:{ZrSelect:u.a},data:function(){return{formData:{productModel:"",productLine:"",processStep:"",componentName:""},productOptions:[],processStepOptions:[],materialOptions:[],materialLoading:!1,mainMaterialName:"",mainMaterialCode:"",processMaterials:[],scanForm:{mainBarcode:"",barcodes:{}},productLineOptions:[{_id:"1",FNumber:"1",FName:"äº§çº¿1"},{_id:"2",FNumber:"2",FName:"äº§çº¿2"}],validateStatus:{mainBarcode:!1},loading:!1,unifiedScanInput:"",hasEditPermission:!1,scanTimer:null}},computed:{mainMaterialId:{get:function(){return localStorage.getItem("mainMaterialId")||""},set:function(e){localStorage.setItem("mainMaterialId",e)}},processStepId:{get:function(){return localStorage.getItem("processStepId")||""},set:function(e){localStorage.setItem("processStepId",e)}},materialName:{get:function(){return localStorage.getItem("materialName")||""},set:function(e){localStorage.setItem("materialName",e)}},processName:{get:function(){return localStorage.getItem("processName")||""},set:function(e){localStorage.setItem("processName",e)}},productLineId:{get:function(){return localStorage.getItem("productLineId")||""},set:function(e){localStorage.setItem("productLineId",e)}},productLineName:{get:function(){return localStorage.getItem("productLineName")||""},set:function(e){localStorage.setItem("productLineName",e)}}},watch:{mainMaterialId:function(){var e=Object(s.a)(Object(n.a)().mark((function e(t){return Object(n.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t){e.next=5;break}return e.next=3,this.getMainMaterialInfo();case 3:e.next=6;break;case 5:this.mainMaterialName="";case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),processStepId:function(){var e=Object(s.a)(Object(n.a)().mark((function e(t){return Object(n.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t){e.next=5;break}return e.next=3,this.getProcessMaterials();case 3:e.next=8;break;case 5:this.processMaterials=[],this.scanForm.barcodes={},this.validateStatus={mainBarcode:!1};case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),validateStatus:{handler:function(e){},deep:!0}},methods:{handleProductionLineSelect:function(e){e&&(this.formData.lineName=e.lineName,this.formData.productLine=e._id)},getMaterialById:function(){var e=Object(s.a)(Object(n.a)().mark((function e(t){var a;return Object(n.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(i.b)("k3_BD_MATERIAL",{query:{_id:t}});case 2:return a=e.sent,e.abrupt("return",a.data[0]);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),getCraftByMaterialId:function(){var e=Object(s.a)(Object(n.a)().mark((function e(t){var a;return Object(n.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(i.b)("craft",{query:{materialId:t}});case 2:return a=e.sent,e.abrupt("return",a.data[0]);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),getProcessStepById:function(){var e=Object(s.a)(Object(n.a)().mark((function e(t){var a;return Object(n.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(i.b)("processStep",{query:{_id:t}});case 2:return a=e.sent,e.abrupt("return",a.data[0]);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),getProcessMaterialById:function(){var e=Object(s.a)(Object(n.a)().mark((function e(t){var a;return Object(n.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(i.b)("processMaterials",{query:{_id:t}});case 2:return a=e.sent,e.abrupt("return",a.data[0]);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),getMaterialList:function(){var e=Object(s.a)(Object(n.a)().mark((function e(t){var a;return Object(n.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(""===t){e.next=18;break}return this.materialLoading=!0,e.prev=2,e.next=5,Object(i.b)("k3_BD_MATERIAL",{query:{$or:[{FNumber:{$regex:t,$options:"i"}},{FName:{$regex:t,$options:"i"}}]},page:1,limit:20});case 5:a=e.sent,this.productOptions=a.data,e.next=13;break;case 9:e.prev=9,e.t0=e.catch(2),console.error("è·å–äº§å“å‹å·å¤±è´¥:",e.t0),this.$message.error("è·å–äº§å“å‹å·å¤±è´¥");case 13:return e.prev=13,this.materialLoading=!1,e.finish(13);case 16:e.next=19;break;case 18:this.productOptions=[];case 19:case"end":return e.stop()}}),e,this,[[2,9,13,16]])})));return function(t){return e.apply(this,arguments)}}(),getAllProcessSteps:function(){var e=Object(s.a)(Object(n.a)().mark((function e(t){var a,s,c,o,l,u,d,p,m,f,h,b=arguments;return Object(n.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=b.length>1&&void 0!==b[1]?b[1]:new Set,s=b.length>2&&void 0!==b[2]?b[2]:new Set,e.prev=2,!s.has(t)){e.next=6;break}return console.warn("æ£€æµ‹åˆ°å¾ªç¯ä¾èµ–, ææ–™ID: ".concat(t)),e.abrupt("return",a);case 6:return s.add(t),e.next=9,this.getCraftByMaterialId(t);case 9:if((c=e.sent)&&c.processSteps){e.next=12;break}return e.abrupt("return",a);case 12:o=Object(r.a)(c.processSteps),e.prev=13,o.s();case 15:if((l=o.n()).done){e.next=46;break}if(u=l.value,a.has(u)){e.next=44;break}return e.next=20,this.getProcessStepById(u);case 20:if(!(d=e.sent)){e.next=44;break}return a.add(d),e.next=25,Object(i.b)("processMaterials",{query:{processStepId:u}});case 25:if(!(p=e.sent).data){e.next=44;break}m=Object(r.a)(p.data),e.prev=28,m.s();case 30:if((f=m.n()).done){e.next=36;break}return h=f.value,e.next=34,this.getAllProcessSteps(h.materialId,a,s);case 34:e.next=30;break;case 36:e.next=41;break;case 38:e.prev=38,e.t0=e.catch(28),m.e(e.t0);case 41:return e.prev=41,m.f(),e.finish(41);case 44:e.next=15;break;case 46:e.next=51;break;case 48:e.prev=48,e.t1=e.catch(13),o.e(e.t1);case 51:return e.prev=51,o.f(),e.finish(51);case 54:return e.abrupt("return",a);case 57:return e.prev=57,e.t2=e.catch(2),console.error("è·å–å·¥åºå¤±è´¥:",e.t2),e.abrupt("return",a);case 61:case"end":return e.stop()}}),e,this,[[2,57],[13,48,51,54],[28,38,41,44]])})));return function(t){return e.apply(this,arguments)}}(),handleProductChange:function(){var e=Object(s.a)(Object(n.a)().mark((function e(t){var a,r;return Object(n.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=t._id,this.processStepOptions=[],this.formData.processStep="",this.mainMaterialId="",a){e.next=6;break}return e.abrupt("return");case 6:return e.prev=6,e.next=9,this.getAllProcessSteps(a,new Set,new Set);case 9:r=e.sent,console.log("è·å–åˆ°çš„å·¥åº:",r),this.processStepOptions=Array.from(r),this.formData.productModel=a,e.next=19;break;case 15:e.prev=15,e.t0=e.catch(6),console.error("è·å–å·¥åºåˆ—è¡¨å¤±è´¥:",e.t0),this.$message.error("è·å–å·¥åºåˆ—è¡¨å¤±è´¥");case 19:case"end":return e.stop()}}),e,this,[[6,15]])})));return function(t){return e.apply(this,arguments)}}(),handleProcessChange:function(e){e?this.formData.processStep=e:this.processStepId=""},handleSave:function(){var e=Object(s.a)(Object(n.a)().mark((function e(){var t,a,r;return Object(n.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.formData.productModel&&this.formData.processStep&&this.formData.productLine){e.next=3;break}return this.$message.warning("è¯·é€‰æ‹©äº§å“å‹å·ã€å·¥åºå’Œäº§çº¿"),e.abrupt("return");case 3:return t=this.$loading({lock:!0,text:"ä¿å­˜ä¸­...",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"}),e.prev=4,this.resetScanForm(),this.mainMaterialId=this.formData.productModel,this.processStepId=this.formData.processStep,this.productLineId=this.formData.productLine,e.next=11,this.getMaterialById(this.formData.productModel);case 11:return(a=e.sent)&&(this.materialName="".concat(a.FNumber," - ").concat(a.FName)),e.next=15,this.getProcessStepById(this.formData.processStep);case 15:(r=e.sent)&&(this.processName=r.processName),this.$message.success("ä¿å­˜æˆåŠŸ"),setTimeout((function(){t.close(),window.location.reload()}),500),e.next=26;break;case 21:e.prev=21,e.t0=e.catch(4),console.error("ä¿å­˜å¤±è´¥:",e.t0),this.$message.error("ä¿å­˜å¤±è´¥"),t.close();case 26:case"end":return e.stop()}}),e,this,[[4,21]])})));return function(){return e.apply(this,arguments)}}(),getMainMaterialInfo:function(){var e=Object(s.a)(Object(n.a)().mark((function e(){var t;return Object(n.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,console.log("æ­£åœ¨è·å–ä¸»ç‰©æ–™ä¿¡æ¯ï¼ŒID:",this.mainMaterialId),e.next=4,Object(i.b)("k3_BD_MATERIAL",{query:{_id:this.mainMaterialId},page:1,limit:1});case 4:(t=e.sent).data&&t.data[0]?(console.log("è·å–åˆ°çš„ä¸»ç‰©æ–™ä¿¡æ¯:",t.data[0]),this.mainMaterialName=t.data[0].FName,this.mainMaterialCode=t.data[0].FNumber):(console.log("æœªæ‰¾åˆ°ä¸»ç‰©æ–™ä¿¡æ¯"),this.mainMaterialName="",this.mainMaterialCode=""),e.next=14;break;case 8:e.prev=8,e.t0=e.catch(0),console.error("è·å–ä¸»ç‰©æ–™ä¿¡æ¯å¤±è´¥:",e.t0),this.$message.error("è·å–ä¸»ç‰©æ–™ä¿¡æ¯å¤±è´¥"),this.mainMaterialName="",this.mainMaterialCode="";case 14:case"end":return e.stop()}}),e,this,[[0,8]])})));return function(){return e.apply(this,arguments)}}(),getProcessMaterials:function(){var e=Object(s.a)(Object(n.a)().mark((function e(){var t,a,r,s,c,o,l,u=this;return Object(n.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,console.log("æ­£åœ¨è·å–å·¥åºä¿¡æ¯ï¼ŒID:",this.processStepId),e.next=4,Object(i.b)("processStep",{query:{_id:this.processStepId},page:1,limit:1});case 4:if((t=e.sent).data&&0!==!t.data.length){e.next=7;break}throw new Error("æœªæ‰¾åˆ°å·¥åºä¿¡æ¯");case 7:return a=t.data[0],e.next=10,Object(i.b)("craft",{query:{processSteps:this.processStepId},page:1,limit:1});case 10:if((r=e.sent).data&&0!==!r.data.length){e.next=13;break}throw new Error("æœªæ‰¾åˆ°å·¥è‰ºä¿¡æ¯");case 13:return s=r.data[0],e.next=16,this.getMaterialById(s.materialId);case 16:if(c=e.sent){e.next=19;break}throw new Error("æœªæ‰¾åˆ°ç‰©æ–™ä¿¡æ¯");case 19:if(this.mainMaterialName=c.FName,this.mainMaterialCode=c.FNumber,!(a.materials&&a.materials.length>0)){e.next=32;break}return o=a.materials.map((function(e){return Object(i.b)("processMaterials",{query:{_id:e},page:1,limit:1})})),e.next=25,Promise.all(o);case 25:l=e.sent,this.processMaterials=l.map((function(e){return e.data[0]})).filter((function(e){return e})),this.validateStatus={mainBarcode:!1},this.scanForm.barcodes={},this.processMaterials.forEach((function(e){u.validateStatus[e._id]=!1,u.$set(u.scanForm.barcodes,e._id,"")})),e.next=35;break;case 32:this.processMaterials=[],this.validateStatus={mainBarcode:!1},this.scanForm.barcodes={};case 35:e.next=44;break;case 37:e.prev=37,e.t0=e.catch(0),console.error("è·å–å·¥åºç‰©æ–™å¤±è´¥:",e.t0),this.$message.error(e.t0.message||"è·å–å·¥åºç‰©æ–™å¤±è´¥"),this.processMaterials=[],this.validateStatus={mainBarcode:!1},this.scanForm.barcodes={};case 44:case"end":return e.stop()}}),e,this,[[0,37]])})));return function(){return e.apply(this,arguments)}}(),validateDICode:function(){var e=Object(s.a)(Object(n.a)().mark((function e(t){var a;return Object(n.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Object(i.b)("productDiNum",{query:{diNum:t},populate:JSON.stringify([{path:"productId",model:"k3_BD_MATERIAL"}])});case 3:if(0!==(a=e.sent).data.length){e.next=7;break}return this.$message.error("è¯¥DIç¼–ç ä¸å­˜åœ¨æœ¬ç³»ç»Ÿ"),e.abrupt("return",{isValid:!1});case 7:return e.abrupt("return",{isValid:!0,materialCode:a.data[0].productId.FNumber});case 10:return e.prev=10,e.t0=e.catch(0),console.error("DIç éªŒè¯å¤±è´¥:",e.t0),this.$message.error("DIç éªŒè¯å¤±è´¥"),e.abrupt("return",{isValid:!1});case 15:case"end":return e.stop()}}),e,this,[[0,10]])})));return function(t){return e.apply(this,arguments)}}(),validateBarcode:function(){var e=Object(s.a)(Object(n.a)().mark((function e(t){var a,r,s,i,c,o,l,u,p,m,f,b,v,g;return Object(n.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("validateBarcode",t),t){e.next=3;break}return e.abrupt("return",!1);case 3:if(r="",s=!1,t.includes("-")&&34!=t.length&&(a=t.split("-")[0],r=t.split("-")[1],s=!0),s){e.next=58;break}e.t0=t.length,e.next=47===e.t0?10:34===e.t0?19:48===e.t0?28:32===e.t0?37:20===e.t0?46:55;break;case 10:return i=t.substring(4,18),console.log("productDI",i),e.next=14,this.validateDICode(i);case 14:if((c=e.sent).isValid){e.next=17;break}return e.abrupt("return",!1);case 17:return a=c.materialCode,e.abrupt("break",58);case 19:return o=t.substring(7,19),console.log("fanDI",o),e.next=23,this.validateDICode(o);case 23:if((l=e.sent).isValid){e.next=26;break}return e.abrupt("return",!1);case 26:return a=l.materialCode,e.abrupt("break",58);case 28:return u=t.substring(0,5),console.log("lightDI",u),e.next=32,this.validateDICode(u);case 32:if((p=e.sent).isValid){e.next=35;break}return e.abrupt("return",!1);case 35:return a=p.materialCode,e.abrupt("break",58);case 37:return m=t.substring(0,8),console.log("remoteDI",m),e.next=41,this.validateDICode(m);case 41:if((f=e.sent).isValid){e.next=44;break}return e.abrupt("return",!1);case 44:return a=f.materialCode,e.abrupt("break",58);case 46:return b=t.substring(0,11),console.log("batchDI",b),e.next=50,this.validateDICode(b);case 50:if((v=e.sent).isValid){e.next=53;break}return e.abrupt("return",!1);case 53:return a=v.materialCode,e.abrupt("break",58);case 55:return this.$message.error("æ¡ç æ ¼å¼ä¸æ­£ç¡®ï¼Œåº”ä¸ºï¼šç‰©æ–™ç¼–å·-åºå·"),d(h.a),e.abrupt("return",!1);case 58:if(a!==this.mainMaterialCode){e.next=60;break}return e.abrupt("return",{materialCode:a,isValid:!0,relatedBill:r});case 60:if(g=this.processMaterials.find((function(e){return e.materialCode===a})),!g){e.next=63;break}return e.abrupt("return",{materialCode:a,isValid:!0,relatedBill:r});case 63:return this.$message.error("è¯¥æ¡ç å¯¹åº”çš„ç‰©æ–™ä¸å½“å‰å·¥åºæ‰€éœ€ç‰©æ–™ä¸åŒ¹é…"),e.abrupt("return",{materialCode:a,isValid:!1});case 65:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),handleMainBarcode:function(){var e=Object(s.a)(Object(n.a)().mark((function e(t){var a,r,s,c;return Object(n.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Object(i.b)("material_process_flow",{query:{barcode:t}});case 3:if(!((a=e.sent).data&&a.data.length>0)){e.next=9;break}a.data[0],this.$message.success("æ‰«ææˆåŠŸ"),e.next=19;break;case 9:return r=this.mainMaterialCode,s=this.mainMaterialId,e.next=13,o({mainMaterialId:s,materialCode:r,barcode:t});case 13:if(200!==(c=e.sent).code){e.next=18;break}this.$message.success("æˆå“æ¡ç è¿½æº¯è®°å½•åˆ›å»ºæˆåŠŸ"),e.next=19;break;case 18:throw new Error(c.msg||"åˆ›å»ºæˆå“æ¡ç è¿½æº¯è®°å½•å¤±è´¥");case 19:e.next=26;break;case 21:throw e.prev=21,e.t0=e.catch(0),console.error("å¤„ç†ä¸»æ¡ç å¤±è´¥:",e.t0),d(h.a),e.t0;case 26:case"end":return e.stop()}}),e,this,[[0,21]])})));return function(t){return e.apply(this,arguments)}}(),handleSubBarcode:function(){var e=Object(s.a)(Object(n.a)().mark((function e(t,a){var r;return Object(n.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,r=this.processMaterials.find((function(e){return e._id===t})),r){e.next=4;break}throw new Error("æœªæ‰¾åˆ°å¯¹åº”çš„ç‰©æ–™ä¿¡æ¯");case 4:if(r.materialCode===a){e.next=6;break}throw new Error("ç‰©æ–™ç¼–ç ä¸ä¸€è‡´");case 6:this.validateStatus[t]=!0,this.$message.success("æ‰«ç æˆåŠŸ"),e.next=15;break;case 10:throw e.prev=10,e.t0=e.catch(0),console.error("å¤„ç†å­ç‰©æ–™æ¡ç å¤±è´¥:",e.t0),d(h.a),e.t0;case 15:case"end":return e.stop()}}),e,this,[[0,10]])})));return function(t,a){return e.apply(this,arguments)}}(),fillFormData:function(){var e=Object(s.a)(Object(n.a)().mark((function e(){return Object(n.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.mainMaterialId&&this.materialName&&(this.formData.productName=this.materialName),this.processStepId&&this.processName&&(this.formData.processStep=this.processName),this.productLineId&&(this.formData.productLine=this.productLineId);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),handleCancelSave:function(){var e=Object(s.a)(Object(n.a)().mark((function e(){var t;return Object(n.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.$confirm("ç¡®è®¤å–æ¶ˆå½“å‰å·¥åºè®¾ç½®ï¼Ÿ","æç¤º",{confirmButtonText:"ç¡®å®š",cancelButtonText:"å–æ¶ˆ",type:"warning"});case 3:t=this.$loading({lock:!0,text:"å–æ¶ˆè®¾ç½®ä¸­...",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"}),localStorage.removeItem("mainMaterialId"),localStorage.removeItem("processStepId"),localStorage.removeItem("materialName"),localStorage.removeItem("processName"),localStorage.removeItem("productLineId"),localStorage.removeItem("productLineName"),this.formData={productModel:"",productLine:"",processStep:"",componentName:""},this.$message.success("å·²å–æ¶ˆå·¥åºè®¾ç½®"),setTimeout((function(){t.close(),window.location.reload()}),500),e.next=18;break;case 15:e.prev=15,e.t0=e.catch(0),"cancel"!==e.t0&&(console.error("å–æ¶ˆè®¾ç½®å¤±è´¥:",e.t0),this.$message.error("å–æ¶ˆè®¾ç½®å¤±è´¥"));case 18:case"end":return e.stop()}}),e,this,[[0,15]])})));return function(){return e.apply(this,arguments)}}(),getValidateIcon:function(e){return this.validateStatus[e]?"el-icon-check success-icon":"el-icon-close error-icon"},resetScanForm:function(){var e=this;this.scanForm.mainBarcode="";var t={};this.processMaterials.forEach((function(a){a.isBatch&&e.scanForm.barcodes[a._id]?(t[a._id]=e.scanForm.barcodes[a._id],e.$set(e.validateStatus,a._id,!0)):(t[a._id]="",e.$set(e.validateStatus,a._id,!1))})),this.scanForm.barcodes=t,this.$set(this.validateStatus,"mainBarcode",!1),this.currentFlowId=null},handleConfirm:function(){var e=Object(s.a)(Object(n.a)().mark((function e(){var t,a,r,s,c,o=this;return Object(n.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,t=Object.values(this.validateStatus).every((function(e){return!0===e})),t){e.next=5;break}return this.$message.warning("è¯·å®Œæˆæ‰€æœ‰æ¡ç æ‰«æ"),e.abrupt("return");case 5:return e.next=7,Object(i.b)("material_process_flow",{query:{barcode:this.scanForm.mainBarcode}});case 7:if((a=e.sent).data&&0!==!a.data.length){e.next=10;break}throw new Error("æœªæ‰¾åˆ°å¯¹åº”çš„å·¥è‰ºæµç¨‹è®°å½•");case 10:return r=[],this.processMaterials.forEach((function(e){r.push({materialId:e.materialId,barcode:o.scanForm.barcodes[e._id]})})),console.log("ğŸš€ ~ handleConfirm ~ componentScans:",r),s={mainBarcode:this.scanForm.mainBarcode,processStepId:this.processStepId,componentScans:r,userId:this.$store.getters.id},console.log("ğŸš€ ~ handleConfirm ~ scanReq:",s),e.next=17,l(s);case 17:if(200===(c=e.sent).code){e.next=20;break}throw new Error(c.message||"æ‰«ç å¤±è´¥");case 20:setTimeout((function(){d(v.a)}),1e3),this.resetScanForm(),e.next=28;break;case 24:e.prev=24,e.t0=e.catch(0),console.error("ç¡®è®¤å¤±è´¥:",e.t0),e.t0.message.includes("è¯¥ä¸»ç‰©æ–™æ¡ç å¯¹åº”å·¥åºèŠ‚ç‚¹å·²å®Œæˆæˆ–å¤„äºå¼‚å¸¸çŠ¶æ€")?(this.$message.warning(e.t0.message),setTimeout((function(){d(x.a)}),1e3)):(this.$message.error("ç¡®è®¤å¤±è´¥:"+e.t0.message),setTimeout((function(){d(h.a)}),1e3));case 28:case"end":return e.stop()}}),e,this,[[0,24]])})));return function(){return e.apply(this,arguments)}}(),handleUnifiedScan:function(){var e=Object(s.a)(Object(n.a)().mark((function e(t){var a=this;return Object(n.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return");case 2:this.scanTimer&&clearTimeout(this.scanTimer),this.scanTimer=setTimeout(Object(s.a)(Object(n.a)().mark((function e(){var s,i,c,o,l,u,p,f,b;return Object(n.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,s=t.trim().replace(/[\r\n]/g,"")){e.next=4;break}return e.abrupt("return");case 4:return e.next=6,a.validateBarcode(s);case 6:if((i=e.sent).isValid){e.next=13;break}return setTimeout((function(){d(h.a)}),300),a.$notify({title:"æ¡ç éªŒè¯å¤±è´¥",message:"æ¡ç æ ¼å¼ä¸æ­£ç¡®æˆ–æœªåœ¨ç³»ç»Ÿä¸­æ³¨å†Œ",type:"error",duration:3e3,position:"top-right"}),a.unifiedScanInput="",a.$refs.scanInput.focus(),e.abrupt("return");case 13:if(c=i.materialCode,o=!1,c!==a.mainMaterialCode){e.next=23;break}return a.scanForm.mainBarcode=t,e.next=19,a.handleMainBarcode(t);case 19:a.validateStatus.mainBarcode=!0,setTimeout((function(){d(m.a)}),500),a.$notify({title:"ä¸»ç‰©æ–™æ‰«ææˆåŠŸ",dangerouslyUseHTMLString:!0,message:'\n                                <div style="line-height: 1.5">\n                                    <div>ç‰©æ–™åç§°: '.concat(a.mainMaterialName,"</div>\n                                    <div>ç‰©æ–™ç¼–ç : ").concat(c,"</div>\n                                    <div>æ¡ç : ").concat(t,"</div>\n                                </div>\n                            "),type:"success",duration:3e3,position:"top-right"}),o=!0;case 23:if(o){e.next=47;break}l=Object(r.a)(a.processMaterials),e.prev=25,l.s();case 27:if((u=l.n()).done){e.next=39;break}if((p=u.value).materialCode!==c){e.next=37;break}return a.$set(a.scanForm.barcodes,p._id,t),e.next=33,a.handleSubBarcode(p._id,c);case 33:return d(m.a),a.$notify({title:"å­ç‰©æ–™æ‰«ææˆåŠŸ",dangerouslyUseHTMLString:!0,message:'\n                                        <div style="line-height: 1.5">\n                                            <div>ç‰©æ–™åç§°: '.concat(p.materialName,"</div>\n                                            <div>ç‰©æ–™ç¼–ç : ").concat(p.materialCode,"</div>\n                                            <div>æ¡ç : ").concat(t,"</div>\n                                            ").concat(i.relatedBill?"<div>å…³è”å•å·: ".concat(i.relatedBill,"</div>"):"","\n                                        </div>\n                                    "),type:"success",duration:3e3,position:"top-right"}),o=!0,e.abrupt("break",39);case 37:e.next=27;break;case 39:e.next=44;break;case 41:e.prev=41,e.t0=e.catch(25),l.e(e.t0);case 44:return e.prev=44,l.f(),e.finish(44);case 47:if(o){e.next=51;break}return setTimeout((function(){d(h.a)}),1e3),a.$notify({title:"æœªåŒ¹é…æˆåŠŸ",dangerouslyUseHTMLString:!0,message:'\n                                <div style="line-height: 1.5">\n                                    <div>æ¡ç : '.concat(t,"</div>\n                                    <div>ç‰©æ–™ç¼–ç : ").concat(c,'</div>\n                                    <div style="color: #F56C6C">è¯¥ç‰©æ–™ä¸å½“å‰å·¥åºä¸åŒ¹é…</div>\n                                </div>\n                            '),type:"warning",duration:3e3,position:"top-right"}),e.abrupt("return");case 51:f=Object.values(a.validateStatus).every((function(e){return!0===e})),f?(setTimeout((function(){d(v.a)}),1e3),a.$notify({title:"æ‰«æå®Œæˆ",dangerouslyUseHTMLString:!0,message:'\n                                <div style="line-height: 1.5">\n                                    <div>æ‰€æœ‰ç‰©æ–™å·²æ‰«æå®Œæˆ</div>\n                                    <div style="color: #67C23A">æ­£åœ¨å‘èµ·ç¡®è®¤æäº¤...</div>\n                                </div>\n                            ',type:"success",duration:3e3,position:"top-right"}),a.handleConfirm()):(b=a.processMaterials.filter((function(e){return!a.validateStatus[e._id]})).map((function(e){return"".concat(e.materialName,"(").concat(e.materialCode,")")})).join("\n"),b&&a.$notify({title:"ç»§ç»­æ‰«æ",dangerouslyUseHTMLString:!0,message:'\n                                    <div style="line-height: 1.5">\n                                        <div>è¯·ç»§ç»­æ‰«æä»¥ä¸‹ç‰©æ–™ï¼š</div>\n                                        <div style="color: #E6A23C; white-space: pre-line">'.concat(b,"</div>\n                                    </div>\n                                "),type:"info",duration:3e3,position:"top-right"})),e.next=60;break;case 55:e.prev=55,e.t1=e.catch(0),console.error("æ‰«æå¤„ç†å¤±è´¥:",e.t1),setTimeout((function(){d(h.a)}),1e3),a.$notify({title:"æ‰«æå¤±è´¥",message:e.t1.message||"æ‰«æå¤„ç†å¤±è´¥",type:"error",duration:3e3,position:"top-right"});case 60:return e.prev=60,a.unifiedScanInput="",a.$refs.scanInput.focus(),e.finish(60);case 64:case"end":return e.stop()}}),e,null,[[0,55,60,64],[25,41,44,47]])}))),1e3);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),focusInput:function(){this.$refs.scanInput.focus()}},created:function(){var e=Object(s.a)(Object(n.a)().mark((function e(){return Object(n.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.mainMaterialId){e.next=3;break}return e.next=3,this.getMainMaterialInfo();case 3:if(!this.processStepId){e.next=6;break}return e.next=6,this.getProcessMaterials();case 6:return e.next=8,this.fillFormData();case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),mounted:function(){console.log("ğŸš€ ~ mounted ~ this.$store.getters.id:",this.$store.getters),this.mainMaterialId&&this.processStepId&&this.$refs.scanInput.focus(),console.log("Complete roles data:",this.$store.getters.roles);var e=this.$store.getters.roles;if(!e||!e.buttonList)return!1;e.buttonList.includes("scan_edit_configuration")&&(this.hasEditPermission=!0)},beforeDestroy:function(){this.scanTimer&&clearTimeout(this.scanTimer)}},k=I,S=(a("9503"),a("2877")),_=Object(S.a)(k,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"scan-container"},[a("div",{staticClass:"left-form"},[a("el-card",{staticClass:"init-card"},[a("div",{staticClass:"card-header"},[a("i",{staticClass:"el-icon-setting"}),e._v(" "),a("span",[e._v("å·¥åºåˆå§‹åŒ–è®¾ç½®")])]),e._v(" "),a("el-form",{attrs:{model:e.formData,"label-width":"100px"}},[a("div",{staticClass:"form-section"},[a("div",{staticClass:"section-header"},[a("i",{staticClass:"el-icon-goods"}),e._v(" "),a("span",[e._v("åŸºç¡€ä¿¡æ¯")])]),e._v(" "),a("el-form-item",{attrs:{label:"äº§å“å‹å·"}},[e.mainMaterialId?a("el-input",{attrs:{placeholder:"è¯·è¾“å…¥ç‰©æ–™ç¼–ç /åç§°æœç´¢",disabled:!!e.mainMaterialId&&!!e.processStepId},model:{value:e.formData.productName,callback:function(t){e.$set(e.formData,"productName",t)},expression:"formData.productName"}}):a("zr-select",{attrs:{collection:"k3_BD_MATERIAL",disabled:!!e.mainMaterialId&&!!e.processStepId,"search-fields":["FNumber","FName"],"label-key":"FName","sub-key":"FMATERIALID",multiple:!1,placeholder:"è¯·è¾“å…¥ç‰©æ–™ç¼–ç /åç§°æœç´¢"},on:{select:e.handleProductChange},scopedSlots:e._u([{key:"option",fn:function(t){var r=t.item;return[a("div",{staticClass:"item-option"},[a("div",{staticClass:"item-info"},[a("span",[e._v(e._s(r.FNumber)+" - "+e._s(r.FName))]),e._v(" "),a("el-tag",{attrs:{size:"mini",type:"info"}},[e._v(e._s(r.FMATERIALID)+" -"+e._s(r.FUseOrgId))])],1)])]}}],null,!1,1794309911),model:{value:e.formData.productModel,callback:function(t){e.$set(e.formData,"productModel",t)},expression:"formData.productModel"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"äº§å“å·¥åº"}},[a("el-select",{staticClass:"custom-select",attrs:{placeholder:"è¯·é€‰æ‹©äº§å“å·¥åº",disabled:!!e.mainMaterialId&&!!e.processStepId},on:{change:e.handleProcessChange},model:{value:e.formData.processStep,callback:function(t){e.$set(e.formData,"processStep",t)},expression:"formData.processStep"}},e._l(e.processStepOptions,(function(t){return a("el-option",{key:t._id,attrs:{label:t.processName,value:t._id}},[a("div",{staticClass:"option-content"},[a("span",{staticClass:"option-main"},[e._v(e._s(t.sort+"."+t.processName))]),e._v(" "),a("span",{staticClass:"option-sub"},[e._v(e._s(t.processCode))])])])})),1)],1),e._v(" "),a("el-form-item",{attrs:{label:"äº§çº¿ç¼–ç "}},[a("zr-select",{attrs:{disabled:!!e.mainMaterialId&&!!e.processStepId,collection:"production_line","search-fields":["lineCode","lineName"],"label-key":"lineName","tag-key":"lineCode","sub-key":"workshop",multiple:!1,placeholder:"è¯·è¾“å…¥äº§çº¿ä¿¡æ¯æœç´¢"},on:{select:e.handleProductionLineSelect},model:{value:e.formData.productLine,callback:function(t){e.$set(e.formData,"productLine",t)},expression:"formData.productLine"}})],1)],1),e._v(" "),e.hasEditPermission?a("div",{staticClass:"button-group"},[e.mainMaterialId&&e.processStepId?a("el-button",{attrs:{type:"danger",icon:"el-icon-close"},on:{click:e.handleCancelSave}},[e._v("\n                        å–æ¶ˆè®¾ç½®\n                    ")]):a("el-button",{attrs:{type:"primary",icon:"el-icon-check"},on:{click:e.handleSave}},[e._v("\n                        ä¿å­˜è®¾ç½®\n                    ")])],1):e._e()])],1)],1),e._v(" "),a("div",{staticClass:"right-content"},[e.mainMaterialId&&e.processStepId?[a("el-card",{staticClass:"scan-card"},[a("div",{staticClass:"card-header"},[a("i",{staticClass:"el-icon-scan"}),e._v(" "),a("span",[e._v("æ¡ç æ‰«æ")])]),e._v(" "),a("el-form",{ref:"scanForm",attrs:{model:e.scanForm,"label-width":"100%"}},[a("div",{staticClass:"section-header"},[a("i",{staticClass:"el-icon-camera"}),e._v(" "),a("span",[e._v("ç»Ÿä¸€æ‰«æåŒºåŸŸ")])]),e._v(" "),a("div",{staticClass:"scan-input-section"},[a("el-input",{ref:"scanInput",attrs:{placeholder:"è¯·æ‰«ææ¡ç ",clearable:""},on:{input:e.handleUnifiedScan,clear:e.focusInput},model:{value:e.unifiedScanInput,callback:function(t){e.unifiedScanInput=t},expression:"unifiedScanInput"}})],1),e._v(" "),a("div",{staticClass:"section-header"},[a("i",{staticClass:"el-icon-goods"}),e._v(" "),a("span",[e._v("ä¸»ç‰©æ–™")])]),e._v(" "),a("div",{staticClass:"material-section"},[a("el-form-item",{staticClass:"vertical-form-item",attrs:{label:"ç¼–å·ï¼š"+e.mainMaterialCode+"  åç§°ï¼š"+e.mainMaterialName,"label-width":"100%"}},[a("div",{staticClass:"input-with-status"},[a("el-input",{class:{"valid-input":e.validateStatus.mainBarcode},attrs:{placeholder:"è¯·æ‰«æä¸»ç‰©æ–™æ¡ç ",readonly:""},model:{value:e.scanForm.mainBarcode,callback:function(t){e.$set(e.scanForm,"mainBarcode",t)},expression:"scanForm.mainBarcode"}},[a("template",{slot:"prefix"},[a("i",{staticClass:"el-icon-full-screen"})])],2),e._v(" "),a("div",{staticClass:"status-indicator",class:{valid:e.validateStatus.mainBarcode}},[a("i",{class:e.getValidateIcon("mainBarcode")})])],1)])],1),e._v(" "),a("div",{staticClass:"section-header"},[a("i",{staticClass:"el-icon-box"}),e._v(" "),a("span",[e._v("å­ç‰©æ–™")])]),e._v(" "),a("div",{staticClass:"material-section"},[a("el-row",{attrs:{gutter:20}},e._l(e.processMaterials,(function(t){return a("el-col",{key:t._id,attrs:{span:12}},[a("el-form-item",{staticClass:"vertical-form-item",attrs:{label:"ç¼–å·ï¼š"+t.materialCode+"  åç§°ï¼š"+t.materialName+"  "}},[a("div",{staticClass:"input-with-status"},[a("el-input",{class:{"valid-input":e.validateStatus[t._id]},attrs:{placeholder:"è¯·æ‰«æå­ç‰©æ–™æ¡ç ",readonly:""},model:{value:e.scanForm.barcodes[t._id],callback:function(a){e.$set(e.scanForm.barcodes,t._id,a)},expression:"scanForm.barcodes[material._id]"}},[a("template",{slot:"prefix"},[a("i",{staticClass:"el-icon-full-screen"})]),e._v(" "),t.isBatch?a("template",{slot:"suffix"},[a("el-tag",{attrs:{type:"warning"}},[e._v("æ‰¹æ¬¡ç‰©æ–™")])],1):e._e()],2),e._v(" "),a("div",{staticClass:"status-indicator",class:{valid:e.validateStatus[t._id]}},[a("i",{class:e.getValidateIcon(t._id)})])],1)])],1)})),1)],1),e._v(" "),a("div",{staticClass:"button-group"},[a("el-button",{attrs:{plain:"",icon:"el-icon-refresh"},on:{click:e.resetScanForm}},[e._v("é‡ç½®")]),e._v(" "),a("el-button",{attrs:{type:"primary",icon:"el-icon-check"},on:{click:e.handleConfirm}},[e._v("ç¡®è®¤")])],1)])],1)]:[e._m(0)]],2)])}),[function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"init-tip"},[a("div",{staticClass:"overlay"},[a("i",{staticClass:"el-icon-warning-outline pulse"}),e._v(" "),a("p",[e._v("è¯·å…ˆåˆå§‹åŒ–å·¥åºè®¾ç½®")])])])}],!1,null,"b192c64c",null);t.default=_.exports}}]);