(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-0663a6e3"],{"008c":function(e,t,a){"use strict";a("1edb")},"0268":function(e){e.exports={startDate:"æ—¥æœŸ",workstation:"å·¥ä½å·",productModel:"äº§å“å‹å·",red:"çº¢è‰²",blue:"è“è‰²",infrared:"çº¢å¤–",red2:"çº¢è‰²2",blue2:"è“è‰²2",infrared2:"çº¢å¤–2",udiCode:"UDIç ",lampBoardQrCode:"ç¯æ¿äºŒç»´ç ",batteryCellCode:"ç”µèŠ¯ç ",chargingBoardPcbaCode:"å……ç”µæ¿PCBAç ",maskPcbaCode:"é¢ç½©PCBAç ",controllerPcbaCode:"æ‰‹æ§å™¨PCBAç ",controllerSoftwareVersion:"æ‰‹æ§å™¨è½¯ä»¶ç‰ˆæœ¬",maskSoftwareVersion:"é¢ç½©è½¯ä»¶ç‰ˆæœ¬",controllerFactoryQrCode:"æ‰‹æ§å™¨å‡ºå‚äºŒç»´ç ",faceDetectionProgramVersion:"é¢éƒ¨æ¢æµ‹ç¨‹åºç‰ˆæœ¬",circuitFaultCode:"ç”µè·¯æ•…éšœç ",redLightWavelength:"çº¢ç¯æ³¢é•¿",blueLightWavelength:"è“ç¯æ³¢é•¿",infraredLightWavelength:"çº¢å¤–ç¯æ³¢é•¿",redLightCurrent:"çº¢ç¯ç”µæµ",blueLightCurrent:"è“ç¯ç”µæµ",infraredLightCurrent:"çº¢å¤–ç¯ç”µæµ",msiLightCurrent:"MSIç¯ç”µæµ",fanCurrent:"é£æ‰‡ç”µæµ",batteryVoltage:"ç”µæ± ç”µå‹",dischargeCurrent:"æ”¾ç”µç”µæµ",batteryPower:"ç”µæ± ç”µé‡",faceSensorStatus:"é¢éƒ¨ä¼ æ„Ÿå™¨çŠ¶æ€",faceSensorValue:"é¢éƒ¨ä¼ æ„Ÿå™¨å€¼",batteryCell1Voltage:"ç”µèŠ¯1ç”µå‹",batteryCell2Voltage:"ç”µèŠ¯2ç”µå‹",productNtc1TemperatureStart:"äº§å“NTC1æ¸©åº¦S",productNtc1TemperatureEnd:"äº§å“NTC1æ¸©åº¦E",productNtc2TemperatureStart:"äº§å“NTC2æ¸©åº¦S",productNtc2TemperatureEnd:"äº§å“NTC2æ¸©åº¦E",instrumentNtc1TemperatureStart:"ä»ªè¡¨NTC1æ¸©åº¦S",instrumentNtc1TemperatureEnd:"ä»ªè¡¨NTC1æ¸©åº¦E",instrumentNtc2TemperatureStart:"ä»ªè¡¨NTC2æ¸©åº¦S",instrumentNtc2TemperatureEnd:"ä»ªè¡¨NTC2æ¸©åº¦E",productNtc1Difference:"äº§å“NTC1å·®å€¼",productNtc2Difference:"äº§å“NTC2å·®å€¼",instrumentNtc1Difference:"ä»ªè¡¨NTC1å·®å€¼",instrumentNtc2Difference:"ä»ªè¡¨NTC2å·®å€¼",productNtcDifferenceStart:"äº§å“NTCå·®å€¼S",productNtcDifferenceEnd:"äº§å“NTCå·®å€¼E",instrumentNtcDifferenceStart:"ä»ªè¡¨NTCå·®å€¼S",instrumentNtcDifferenceEnd:"ä»ªè¡¨NTCå·®å€¼E",chargingStatus:"å……ç”µçŠ¶æ€",chargingVoltage:"å……ç”µç”µå‹",chargingCurrent:"å……ç”µç”µæµ",instrumentChargingCurrent:"ä»ªè¡¨å……ç”µç”µæµ",chargingCurrentDifference:"å……ç”µç”µæµå·®å€¼",instrumentNtcDifferenceBeforeCooling:"ä»ªå™¨NTC1å’ŒNTC2çš„å·®å€¼(åˆ¶å†·å‰)",productAndInstrumentNtc1Difference:"äº§å“NTC1å’Œä»ªå™¨NTC1å·®å€¼",productAndInstrumentNtc2Difference:"äº§å“NTC2å’Œä»ªå™¨NTC2å·®å€¼",coolingStatus:"åˆ¶å†·çŠ¶æ€",coolingSetTemperature:"åˆ¶å†·è®¾ç½®æ¸©åº¦",chargingTest:"å……ç”µæµ‹è¯•",withstandVoltageTest:"è€å‹æµ‹è¯•",cellCode:"ç”µèŠ¯ç ",handheldControllerPcbaCode:"æ‰‹æ§å™¨PCBAç ",handheldSoftwareVersion:"æ‰‹æ§å™¨è½¯ä»¶ç‰ˆæœ¬",handheldFactoryQrCode:"æ‰‹æ§å™¨å‡ºå‚äºŒç»´ç ",batteryCapacity:"ç”µæ± ç”µé‡",cell1Voltage:"ç”µèŠ¯1ç”µå‹",cell2Voltage:"ç”µèŠ¯2ç”µå‹",productNtc1TempS:"äº§å“NTC1æ¸©åº¦S",productNtc1TempE:"äº§å“NTC1æ¸©åº¦E",productNtc2TempS:"äº§å“NTC2æ¸©åº¦S",productNtc2TempE:"äº§å“NTC2æ¸©åº¦E",meterNtc1TempS:"ä»ªè¡¨NTC1æ¸©åº¦S",meterNtc1TempE:"ä»ªè¡¨NTC1æ¸©åº¦E",meterNtc2TempS:"ä»ªè¡¨NTC2æ¸©åº¦S",meterNtc2TempE:"ä»ªè¡¨NTC2æ¸©åº¦E",meterNtc1Difference:"ä»ªè¡¨NTC1å·®å€¼",meterNtc2Difference:"ä»ªè¡¨NTC2å·®å€¼",productNtcDifferenceS:"äº§å“NTCå·®å€¼S",productNtcDifferenceE:"äº§å“NTCå·®å€¼E",meterNtcDifferenceS:"ä»ªè¡¨NTCå·®å€¼S",meterNtcDifferenceE:"ä»ªè¡¨NTCå·®å€¼E",meterChargingCurrent:"ä»ªè¡¨å……ç”µç”µæµ",weight:"ç§°é‡é‡é‡",lineNumber:"çº¿ä½“",showSerialNo:"0.4 SHOW SERIALNO æ˜¾ç¤ºåºåˆ—å·",chkPowerOn:"A1.0 CHK POWER ON ATE ä¸Šç”µå¼€æœº",enterDebugMode:"A1.1 ENTER DEBUG MODE è¿›å…¥è°ƒè¯•æ¨¡å¼",showReadCellMsg:"A7.7 SHOW READ CELL MSG æ˜¾ç¤ºè¯»å–ç”µæ± æ¶ˆæ¯",showReadMainPcbaMsg:"A7.9 SHOW READ MAIN PCBA MSG æ˜¾ç¤ºè¯»å–ä¸»PCBAæ¶ˆæ¯",showReadPcba2Msg:"A7.11 SHOW READ PCBA2 MSG æ˜¾ç¤ºè¯»å–PCBA2æ¶ˆæ¯",showReadPackMsg:"A7.13 SHOW READ PACK MSG è¯»å– MCU é¥æ§å™¨æœºèº«ç ",readAllKeyOff:"A1.2 READ ALL KEY OFF è¯»å–æ‰€æœ‰æŒ‰é”®å…³é—­çŠ¶æ€",readK4K5:"A1.3 READ K4 K5 è¯»å– K4 K5 å·¦å³é”®çŠ¶æ€",readPotentiometer:"A1.4 READ POTENTIOMETER æ£€æŸ¥ç¼–ç å¼€å…³",readAllKeyOff2:"A1.5 READ ALL KEY OFF è¯»å–æ‰€æœ‰æŒ‰é”®å…³é—­çŠ¶æ€",readPackVol:"A1.10 READ PACK VOL è¯»å– PACK æ€»ç”µå‹",readPackCell1Vol:"A1.12 READ PACK CELL1 VOL è¯»å– CL1 ç”µå‹",readPackCell2Vol:"A1.13 READ PACK CELL2 VOL è¯»å– CL2 ç”µå‹",chkCellVolDiffMax:"A1.14 CHK CELL VOL DIFF MAX CL1 CL2 å‹å·®æ ¡éªŒ",readNtc:"A1.15 READ NTC è¯»å– NTC",chkUiVersion:"A1.17 CHK UI VERSION è¯»å–è½¯ä»¶ç‰ˆæœ¬",discharge1ATestPrepare:"A3.2 DISCHARGE1A TEST PREPARE æ”¾ç”µå‡†å¤‡-ç”µå­è´Ÿè½½æ’æµ 1Aï¼Œæ”¹ä¸º 3A",chkBatOutVol:"A3.9 CHK BATOUT VOL æ”¾ç”µ BAT è¾“å‡ºç”µå‹",chkDischargeCur:"A3.10 CHK DISCHARGE CUR è´Ÿè½½æ”¾ç”µå’Œç”µå­è´Ÿè½½ç”µæµæ ¡éªŒ",readDischargeCur:"A3.11 READ DISCHARGE CUR è¯»å–æ”¾ç”µç”µæµ",readDischargeSta:"A3.11B READ DISCHARGE STA è¯»å–æ”¾ç”µçŠ¶æ€",dischargeOcpTestPrepare:"A3.12 DISCHARGE OCP TEST PREPARE è¿‡æµæ£€æŸ¥",readDischargeCur2:"A3.13 READ DISCHARGE CUR è¯»å–æ”¾ç”µç”µæµ",readDischargeSta2:"A3.13B READ DISCHARGE STA è¯»å–æ”¾ç”µç»“æŸ",dischargeTestEnd:"A3.17 DISCHARGE TEST END æ”¾ç”µæµ‹è¯•ç»“æŸ",chkUiTx:"A3.22A CHK UI TX é¥æ§å™¨é€šè®¯å£æ ¡éªŒ",chargeTestPrepare:"A6.01 CHARGE TEST PREPARE 2A é€‚é…å™¨å……ç”µå‡†å¤‡",readChargerVolt:"A6.03 READ CHARGER VOLT è¯»å–å……ç”µå™¨ç”µå‹",readChargeCur:"A6.04 READ CHARGE CUR è¯»å–å……ç”µç”µæµ",ateChangeCur:"A6.05 ATECHARGE CUR è‡ªæ£€ ATE å……ç”µç”µæµ",chkStillChargeCur:"A6.06 CHK STILL CHARGE CUR å……ç”µä¿æŒç”µæµ",chargeTestEnd:"A6.07 CHARGE TEST END å……ç”µç»“æŸ",readSoc:"A7.14 READ SOC è¯»å– SOC",packOff:"A8.0 PACK OFF é¥æ§å™¨å…³æœº",allTestEnd:"A9.0 ALL TEST END æ‰€æœ‰æµ‹è¯•ç»“æŸ",passFail:"PASS/Fail æµ‹è¯•ç»“æœ",testTime:"æ—¥æœŸ",positiveNegativeResult:"æ­£åç»“æœ",revolutionSpeedTestValue:"è½¬é€Ÿæµ‹è¯•å€¼",vacuumTestValue:"çœŸç©ºæµ‹è¯•å€¼"}},"1c77":function(e,t,a){},"1edb":function(e,t,a){},2:function(e,t){},3:function(e,t){},3575:function(e,t,a){"use strict";a("6a1f")},3835:function(e,t,a){"use strict";var r=a("06c5");function s(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var a=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=a){var r,s,n,o,i=[],c=!0,l=!1;try{if(n=(a=a.call(e)).next,0===t){if(Object(a)!==a)return;c=!1}else for(;!(c=(r=n.call(a)).done)&&(i.push(r.value),i.length!==t);c=!0);}catch(e){l=!0,s=e}finally{try{if(!c&&null!=a.return&&(o=a.return(),Object(o)!==o))return}finally{if(l)throw s}}return i}}(e,t)||Object(r.a)(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}a.d(t,"a",(function(){return s}))},3927:function(e,t,a){},4:function(e,t){},"668b":function(e,t,a){"use strict";function r(e){var t,a,r,n=2;for("undefined"!=typeof Symbol&&(a=Symbol.asyncIterator,r=Symbol.iterator);n--;){if(a&&null!=(t=e[a]))return t.call(e);if(r&&null!=(t=e[r]))return new s(t.call(e));a="@@asyncIterator",r="@@iterator"}throw new TypeError("Object is not async iterable")}function s(e){function t(e){if(Object(e)!==e)return Promise.reject(new TypeError(e+" is not an object."));var t=e.done;return Promise.resolve(e.value).then((function(e){return{value:e,done:t}}))}return s=function(e){this.s=e,this.n=e.next},s.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(e){var a=this.s.return;return void 0===a?Promise.resolve({value:e,done:!0}):t(a.apply(this.s,arguments))},throw:function(e){var a=this.s.return;return void 0===a?Promise.reject(e):t(a.apply(this.s,arguments))}},new s(e)}a.d(t,"a",(function(){return r}))},"6a1f":function(e,t,a){},"778a":function(e,t,a){"use strict";a("1c77")},b58f:function(e,t,a){"use strict";a("3927")},ed91:function(e,t,a){"use strict";a.d(t,"a",(function(){return s})),a.d(t,"c",(function(){return n})),a.d(t,"d",(function(){return o})),a.d(t,"e",(function(){return i})),a.d(t,"b",(function(){return c}));var r=a("b775");function s(e){return Object(r.a)({url:"/create-flow",method:"post",data:e})}function n(e){return Object(r.a)({url:"/scan-components",method:"post",data:e})}function o(e){return Object(r.a)({url:"/unbind-components",method:"post",data:e})}function i(e){return Object(r.a)({url:"/update-flow-nodes",method:"post",data:e})}function c(e){return Object(r.a)({url:"/all-process-steps/".concat(e),method:"get"})}},fb50:function(e,t,a){"use strict";a.r(t);var r,s=(a("7f7f"),a("ade3")),n=a("3835"),o=(a("ffc1"),a("c5f6"),a("a481"),a("c7eb")),i=(a("20d6"),a("96cf"),a("1da1")),c=a("5530"),l=(a("55dd"),a("ac6a"),a("5df3"),a("f400"),a("7e1e")),d={name:"FlowNode",props:{node:{type:Object,required:!0}}},u=(a("3575"),a("2877")),p=Object(u.a)(d,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"flow-level"},[a("div",{staticClass:"node-container"},[a("div",{staticClass:"material-node",class:{"root-node":!e.node.materialQuantity,completed:e.node.barcode||"COMPLETED"===e.node.status}},[a("div",{staticClass:"node-title"},[e._v(e._s(e.node.materialName))]),e._v(" "),e.node.craftName?a("div",{staticClass:"node-subtitle"},[e._v("\n                å·¥è‰ºï¼š"+e._s(e.node.craftName)+"\n            ")]):e._e(),e._v(" "),e.node.barcode?a("div",{staticClass:"node-info"},[e._v("\n                æ¡ç ï¼š"+e._s(e.node.barcode)+"\n            ")]):e._e(),e._v(" "),e.node.materialCode?a("div",{staticClass:"node-info"},[e._v("\n                ç¼–ç ï¼š"+e._s(e.node.materialCode)+"\n            ")]):e._e(),e._v(" "),e.node.scanOperation?a("div",{staticClass:"node-info"},[e._v("\n                æ‰«ç æ“ä½œï¼š"+e._s(e.node.scanOperation?"éœ€è¦æ‰«ç ":"ä¸éœ€è¦æ‰«ç ")+"\n            ")]):e._e(),e._v(" "),e.node.isComponent?a("div",{staticClass:"node-info"},[e._v("\n                æ˜¯å¦ç»„ä»¶ï¼š"+e._s(e.node.isComponent?"æ˜¯":"å¦")+"\n            ")]):e._e(),e._v(" "),e.node.materialQuantity?a("div",{staticClass:"node-info"},[e._v("\n                ç”¨é‡ï¼š"+e._s(e.node.materialQuantity)+e._s(e.node.unit||"ä¸ª")+"\n            ")]):e._e()])]),e._v(" "),e.node.children&&e.node.children.length?[e._m(0),e._v(" "),a("div",{staticClass:"process-level"},e._l(e.node.children,(function(t){return a("div",{key:t._id,staticClass:"process-container"},[a("div",{staticClass:"process-node"},[a("div",{staticClass:"node-title",style:{background:"COMPLETED"===t.status?"#67C23A":"#ffa640"}},[e._v(e._s(t.processSort)+"."+e._s(t.processName))]),e._v(" "),a("div",{staticClass:"node-content"},[t.children&&t.children.length?e._l(t.children,(function(e){return a("div",{key:e._id,staticClass:"sub-material"},[a("flow-node",{attrs:{node:e}})],1)})):a("div",{staticClass:"no-materials"},[e._v("\n                            æš‚æ— å…³è”ç‰©æ–™\n                        ")])],2)])])})),0)]:e._e()],2)}),[function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"arrow-container"},[t("div",{staticClass:"arrow-right"})])}],!1,null,"2dccef75",null),h={name:"MaterialFlowChart",components:{FlowNode:p.exports},props:{visible:{type:Boolean,default:!1},loading:{type:Boolean,default:!1},flowData:{type:Array,default:function(){return[]}}},computed:{dialogVisible:{get:function(){return this.visible},set:function(e){this.$emit("update:visible",e)}}},data:function(){return{scale:1,minScale:.5,maxScale:2,scaleStep:.1,position:{x:0,y:0},isDragging:!1,dragStart:{x:0,y:0},lastPosition:{x:0,y:0}}},methods:{zoomIn:function(){this.scale<this.maxScale&&(this.scale=Math.min(this.scale+this.scaleStep,this.maxScale))},zoomOut:function(){this.scale>this.minScale&&(this.scale=Math.max(this.scale-this.scaleStep,this.minScale))},resetZoom:function(){this.scale=1,this.position={x:0,y:0}},handleWheel:function(e){e.ctrlKey&&(e.preventDefault(),e.deltaY<0?this.zoomIn():this.zoomOut())},startDrag:function(e){this.isDragging=!0,this.dragStart={x:e.clientX-this.position.x,y:e.clientY-this.position.y},this.lastPosition=Object(c.a)({},this.position)},onDrag:function(e){this.isDragging&&(e.preventDefault(),this.position={x:e.clientX-this.dragStart.x,y:e.clientY-this.dragStart.y})},stopDrag:function(){this.isDragging=!1}},mounted:function(){this.$el.querySelector(".flow-container").addEventListener("wheel",this.handleWheel,{passive:!1})},beforeDestroy:function(){this.$el.querySelector(".flow-container").removeEventListener("wheel",this.handleWheel)}},f=h,v=(a("b58f"),Object(u.a)(f,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"flow-chart-dialog",attrs:{title:"ç‰©æ–™å·¥è‰ºæµç¨‹å›¾","custom-class":"material-flow-dialog"}},[a("div",{staticClass:"zoom-controls"},[a("el-button-group",[a("el-button",{attrs:{size:"small",icon:"el-icon-zoom-in"},on:{click:e.zoomIn}}),e._v(" "),a("el-button",{attrs:{size:"small",icon:"el-icon-zoom-out"},on:{click:e.zoomOut}}),e._v(" "),a("el-button",{attrs:{size:"small",icon:"el-icon-refresh"},on:{click:e.resetZoom}},[e._v("é‡ç½®")])],1)],1),e._v(" "),a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"flow-container",on:{mousedown:e.startDrag,mousemove:e.onDrag,mouseup:e.stopDrag,mouseleave:e.stopDrag}},[a("div",{staticClass:"zoom-wrapper",style:{transform:"scale("+e.scale+") translate("+e.position.x+"px, "+e.position.y+"px)",cursor:e.isDragging?"grabbing":"grab"}},[e.flowData&&0!==e.flowData.length?[a("flow-node",{attrs:{node:e.flowData[0]}})]:a("div",{staticClass:"empty-data"},[e._v("\n                æš‚æ— æµç¨‹å›¾æ•°æ®\n            ")])],2)])])}),[],!1,null,null,null)),m=v.exports,b=(a("456d"),a("53ca")),_=a("2909"),g=a("668b"),C=a("0268"),w={name:"InspectionList",props:{inspections:{type:Object,default:function(){}}},data:function(){return{displayData:[],barcodeList:[],historyDialogVisible:!1,detailDialogVisible:!1,historyData:[],historyLoading:!1,selectedRecord:null,currentPage:1,pageSize:20,total:0,currentBarcode:"",currentProcessStep:null}},watch:{inspections:{handler:function(){var e=Object(i.a)(Object(o.a)().mark((function e(t){var a,r,s,n,i,c,d,u,p,h,f,v,m;return Object(o.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return");case 2:if(!(a=Array.isArray(t)?t[0]:t)){e.next=46;break}if(r={barcode:a.barcode,inspectionItem:"ä¸»ç‰©æ–™",inspectionTime:null,inspector:null,materialCode:a.materialCode,materialId:a.materialId,materialName:a.materialName,materialSpec:a.materialSpec,standard:"",result:""},a.barcode,s=a.processNodes||[],n=[a.barcode].concat(Object(_.a)(s.map((function(e){return e.barcode})))).filter((function(e){return e&&e.trim()})),i=[r].concat(Object(_.a)(s)),0!==n.length){e.next=12;break}return this.displayData=[],e.abrupt("return");case 12:return e.next=14,Object(l.b)("InspectionLastData",{query:{scanCode:{$in:n}},populate:JSON.stringify([{path:"processId",select:"processCode processName processDesc processStage processType"}])});case 14:c=e.sent,d=c.data,u=!1,p=!1,e.prev=18,f=Object(o.a)().mark((function e(){var t,a,r;return Object(o.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=m.value,a=t.barcode,r=d.filter((function(e){return e.scanCode==a})),r.length>0&&(console.log("ğŸš€ ~ handler ~ processNode:",r),t.inspectionData=r);case 4:case"end":return e.stop()}}),e)})),v=Object(g.a)(i);case 21:return e.next=23,v.next();case 23:if(!(u=!(m=e.sent).done)){e.next=28;break}return e.delegateYield(f(),"t0",25);case 25:u=!1,e.next=21;break;case 28:e.next=34;break;case 30:e.prev=30,e.t1=e.catch(18),p=!0,h=e.t1;case 34:if(e.prev=34,e.prev=35,!u||null==v.return){e.next=39;break}return e.next=39,v.return();case 39:if(e.prev=39,!p){e.next=42;break}throw h;case 42:return e.finish(39);case 43:return e.finish(34);case 44:console.log("ğŸš€ ~ handler ~ allBarcodesData:",i),this.displayData=i.filter((function(e){return e.inspectionData}));case 46:case"end":return e.stop()}}),e,this,[[18,30,34,44],[35,,39,43]])})));return function(t){return e.apply(this,arguments)}}(),immediate:!0}},methods:{formatDate:function(e){return e?new Date(e).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}):"æš‚æ— æ•°æ®"},formatValue:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";if(!e)return"æœªæµ‹è¯•";var a="number"==typeof e?Number(e).toFixed(2):e;return"".concat(a).concat(t)},showHistory:function(){var e=Object(i.a)(Object(o.a)().mark((function e(t,a){return Object(o.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.currentBarcode=t,this.currentProcessStep=a,this.historyDialogVisible=!0,this.currentPage=1,e.next=6,this.fetchHistoryData();case 6:case"end":return e.stop()}}),e,this)})));return function(t,a){return e.apply(this,arguments)}}(),fetchHistoryData:function(){var e=Object(i.a)(Object(o.a)().mark((function e(){var t,a;return Object(o.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.historyLoading=!0,e.prev=1,t={scanCode:this.currentBarcode},this.currentProcessStep&&(t.processId=this.currentProcessStep._id),e.next=6,Object(l.b)("InspectionData",{query:t,page:this.currentPage,limit:this.pageSize,skip:(this.currentPage-1)*this.pageSize,sort:{createTime:-1},count:!0,populate:JSON.stringify([{path:"processId",select:"processCode processName processDesc processStage processType"}])});case 6:a=e.sent,this.historyData=a.data,this.total=a.countnum,e.next=15;break;case 11:e.prev=11,e.t0=e.catch(1),console.error("è·å–å†å²æ•°æ®å¤±è´¥:",e.t0),this.$message.error("è·å–å†å²æ•°æ®å¤±è´¥");case 15:return e.prev=15,this.historyLoading=!1,e.finish(15);case 18:case"end":return e.stop()}}),e,this,[[1,11,15,18]])})));return function(){return e.apply(this,arguments)}}(),handleClose:function(){this.historyDialogVisible=!1,this.historyData=[],this.currentBarcode="",this.currentProcessStep=null},showHistoryDetail:function(e){this.selectedRecord=e,this.detailDialogVisible=!0},handleSizeChange:function(e){this.pageSize=e,this.fetchHistoryData()},handleCurrentChange:function(e){this.currentPage=e,this.fetchHistoryData()},hasLampBoardTestData:function(e){return e.red||e.blue||e.infrared||e.red2||e.blue2||e.infrared2},hasSemiFinishedTestData:function(e){return e.udiCode||e.lampBoardQrCode||e.batteryCellCode},hasTemperatureTestData:function(e){return e.instrumentNtcDifferenceBeforeCooling||e.coolingStatus},hasVoltageWithstandTestData:function(e){return e.chargingTest||e.withstandVoltageTest},hasFullMachineTestData:function(e){return e.cellCode||e.handheldControllerPcbaCode},hasWeightData:function(e){return e.weight},hasRemoteControlTestData:function(e){return e.showSerialNo||e.chkPowerOn||e.enterDebugMode},inspectionDataHandle:function(e){var t=[];for(var a in C)"error"!==a&&!this.isBlank(e[a])&&t.push("".concat(C[a],"ï¼š").concat(e[a]));return t},isBlank:function(e){return null==e||""===e||Array.isArray(e)&&0===e.length||"object"===Object(b.a)(e)&&0===Object.keys(e).length}},computed:{}},S=w,y=(a("008c"),Object(u.a)(S,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-table",{attrs:{data:e.displayData,border:"","header-cell-style":{background:"#f5f7fa",color:"#606266",fontWeight:"bold",textAlign:"center"},"cell-style":{textAlign:"center"}}},[a("el-table-column",{attrs:{label:"æ¡ç ",prop:"barcode"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-tooltip",{attrs:{content:t.row.barcode,placement:"top",effect:"light"}},[a("span",[e._v(e._s(t.row.barcode))])])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"ç‰©æ–™ä¿¡æ¯"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",{staticClass:"material-info"},[a("div",[e._v("ç‰©æ–™ç¼–ç ï¼š"+e._s(t.row.materialCode))]),e._v(" "),a("div",[e._v("ç‰©æ–™åç§°ï¼š"+e._s(t.row.materialName))]),e._v(" "),t.row.materialSpec?a("div",[e._v("è§„æ ¼ï¼š"+e._s(t.row.materialSpec))]):e._e()])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"æ£€æµ‹ç»“æœ",width:"300"},scopedSlots:e._u([{key:"default",fn:function(t){return e._l(t.row.inspectionData,(function(r,s){return a("div",{key:s,staticClass:"inspection-result"},[a("div",{staticClass:"result-info"},[r?a("el-popover",{attrs:{placement:"right",width:"500",trigger:"hover"}},[a("div",{staticClass:"test-details"},[a("div",{staticClass:"detail-section"},[a("div",{staticClass:"section-title"},[e._v("åŸºç¡€ä¿¡æ¯")]),e._v(" "),r.startDate?a("div",[e._v("æ—¥æœŸï¼š"+e._s(r.startDate))]):e._e(),e._v(" "),r.workstation?a("div",[e._v("å·¥ä½å·ï¼š"+e._s(r.workstation))]):e._e(),e._v(" "),r.productModel?a("div",[e._v("äº§å“å‹å·ï¼š"+e._s(r.productModel))]):e._e()]),e._v(" "),e.hasLampBoardTestData(r)?a("div",{staticClass:"detail-section"},[a("div",{staticClass:"section-title"},[e._v("é¢ç½©ç¯æ¿æµ‹è¯•")]),e._v(" "),r.red?a("div",[e._v("çº¢è‰²ï¼š"+e._s(r.red))]):e._e(),e._v(" "),r.blue?a("div",[e._v("è“è‰²ï¼š"+e._s(r.blue))]):e._e(),e._v(" "),r.infrared?a("div",[e._v("çº¢å¤–ï¼š"+e._s(r.infrared))]):e._e(),e._v(" "),r.red2?a("div",[e._v("çº¢è‰²2ï¼š"+e._s(r.red2))]):e._e(),e._v(" "),r.blue2?a("div",[e._v("è“è‰²2ï¼š"+e._s(r.blue2))]):e._e(),e._v(" "),r.infrared2?a("div",[e._v("çº¢å¤–2ï¼š"+e._s(r.infrared2))]):e._e()]):e._e(),e._v(" "),e.hasSemiFinishedTestData(r)?a("div",{staticClass:"detail-section"},[a("div",{staticClass:"section-title"},[e._v("é¢ç½©åŠæˆå“æµ‹è¯•")]),e._v(" "),r.udiCode?a("div",[e._v("UDIç ï¼š"+e._s(r.udiCode))]):e._e(),e._v(" "),r.lampBoardQrCode?a("div",[e._v("ç¯æ¿äºŒç»´ç ï¼š"+e._s(r.lampBoardQrCode))]):e._e(),e._v(" "),r.batteryCellCode?a("div",[e._v("ç”µèŠ¯ç ï¼š"+e._s(r.batteryCellCode))]):e._e(),e._v(" "),r.chargingBoardPcbaCode?a("div",[e._v("å……ç”µæ¿PCBAç ï¼š"+e._s(r.chargingBoardPcbaCode))]):e._e(),e._v(" "),r.maskPcbaCode?a("div",[e._v("é¢ç½©PCBAç ï¼š"+e._s(r.maskPcbaCode))]):e._e(),e._v(" "),r.controllerPcbaCode?a("div",[e._v("æ‰‹æ§å™¨PCBAç ï¼š"+e._s(r.controllerPcbaCode))]):e._e(),e._v(" "),r.controllerSoftwareVersion?a("div",[e._v("æ‰‹æ§å™¨è½¯ä»¶ç‰ˆæœ¬ï¼š"+e._s(r.controllerSoftwareVersion))]):e._e(),e._v(" "),r.maskSoftwareVersion?a("div",[e._v("é¢ç½©è½¯ä»¶ç‰ˆæœ¬ï¼š"+e._s(r.maskSoftwareVersion))]):e._e(),e._v(" "),r.controllerFactoryQrCode?a("div",[e._v("æ‰‹æ§å™¨å‡ºå‚äºŒç»´ç ï¼š"+e._s(r.controllerFactoryQrCode))]):e._e(),e._v(" "),r.faceDetectionProgramVersion?a("div",[e._v("é¢éƒ¨æ¢æµ‹ç¨‹åºç‰ˆæœ¬ï¼š"+e._s(r.faceDetectionProgramVersion))]):e._e(),e._v(" "),r.circuitFaultCode?a("div",[e._v("ç”µè·¯æ•…éšœç ï¼š"+e._s(r.circuitFaultCode)+"\n                  ")]):e._e(),e._v(" "),a("div",{staticClass:"sub-section"},[a("div",{staticClass:"sub-title"},[e._v("å…‰æ³¢å‚æ•°")]),e._v(" "),r.redLightWavelength?a("div",[e._v("çº¢ç¯æ³¢é•¿ï¼š"+e._s(r.redLightWavelength)+"\n                    ")]):e._e(),e._v(" "),r.blueLightWavelength?a("div",[e._v("è“ç¯æ³¢é•¿ï¼š"+e._s(r.blueLightWavelength))]):e._e(),e._v(" "),r.infraredLightWavelength?a("div",[e._v("çº¢å¤–ç¯æ³¢é•¿ï¼š"+e._s(r.infraredLightWavelength))]):e._e(),e._v(" "),r.redLightCurrent?a("div",[e._v("çº¢ç¯ç”µæµï¼š"+e._s(r.redLightCurrent))]):e._e(),e._v(" "),r.blueLightCurrent?a("div",[e._v("è“ç¯ç”µæµï¼š"+e._s(r.blueLightCurrent)+"\n                    ")]):e._e(),e._v(" "),r.infraredLightCurrent?a("div",[e._v("çº¢å¤–ç¯ç”µæµï¼š"+e._s(r.infraredLightCurrent))]):e._e(),e._v(" "),r.msiLightCurrent?a("div",[e._v("MSIç¯ç”µæµï¼š"+e._s(r.msiLightCurrent)+"\n                    ")]):e._e()]),e._v(" "),a("div",{staticClass:"sub-section"},[a("div",{staticClass:"sub-title"},[e._v("ç”µæ± å‚æ•°")]),e._v(" "),r.batteryVoltage?a("div",[e._v("ç”µæ± ç”µå‹ï¼š"+e._s(r.batteryVoltage))]):e._e(),e._v(" "),r.dischargeCurrent?a("div",[e._v("æ”¾ç”µç”µæµï¼š"+e._s(r.dischargeCurrent)+"\n                    ")]):e._e(),e._v(" "),r.batteryPower?a("div",[e._v("ç”µæ± ç”µé‡ï¼š"+e._s(r.batteryPower))]):e._e(),e._v(" "),r.batteryCell1Voltage?a("div",[e._v("ç”µèŠ¯1ç”µå‹ï¼š"+e._s(r.batteryCell1Voltage))]):e._e(),e._v(" "),r.batteryCell2Voltage?a("div",[e._v("ç”µèŠ¯2ç”µå‹ï¼š"+e._s(r.batteryCell2Voltage))]):e._e()]),e._v(" "),a("div",{staticClass:"sub-section"},[a("div",{staticClass:"sub-title"},[e._v("ä¼ æ„Ÿå™¨å‚æ•°")]),e._v(" "),r.faceSensorStatus?a("div",[e._v("é¢éƒ¨ä¼ æ„Ÿå™¨çŠ¶æ€ï¼š"+e._s(r.faceSensorStatus)+"\n                    ")]):e._e(),e._v(" "),r.faceSensorValue?a("div",[e._v("é¢éƒ¨ä¼ æ„Ÿå™¨å€¼ï¼š"+e._s(r.faceSensorValue)+"\n                    ")]):e._e(),e._v(" "),r.fanCurrent?a("div",[e._v("é£æ‰‡ç”µæµï¼š"+e._s(r.fanCurrent))]):e._e()])]):e._e(),e._v(" "),e.hasTemperatureTestData(r)?a("div",{staticClass:"detail-section"},[a("div",{staticClass:"section-title"},[e._v("é¢ç½©æ¸©åº¦æµ‹è¯•")]),e._v(" "),r.instrumentNtcDifferenceBeforeCooling?a("div",[e._v("åˆ¶å†·å‰NTCå·®å€¼ï¼š"+e._s(r.instrumentNtcDifferenceBeforeCooling))]):e._e(),e._v(" "),r.productAndInstrumentNtc1Difference?a("div",[e._v("äº§å“NTC1å’Œä»ªå™¨NTC1å·®å€¼ï¼š"+e._s(r.productAndInstrumentNtc1Difference))]):e._e(),e._v(" "),r.productAndInstrumentNtc2Difference?a("div",[e._v("äº§å“NTC2å’Œä»ªå™¨NTC2å·®å€¼ï¼š"+e._s(r.productAndInstrumentNtc2Difference))]):e._e(),e._v(" "),r.coolingStatus?a("div",[e._v("åˆ¶å†·çŠ¶æ€ï¼š"+e._s(r.coolingStatus))]):e._e(),e._v(" "),r.coolingSetTemperature?a("div",[e._v("åˆ¶å†·è®¾ç½®æ¸©åº¦ï¼š"+e._s(r.coolingSetTemperature))]):e._e()]):e._e(),e._v(" "),e.hasVoltageWithstandTestData(r)?a("div",{staticClass:"detail-section"},[a("div",{staticClass:"section-title"},[e._v("è€å‹æµ‹è¯•")]),e._v(" "),r.chargingTest?a("div",[e._v("å……ç”µæµ‹è¯•ï¼š"+e._s(r.chargingTest))]):e._e(),e._v(" "),r.withstandVoltageTest?a("div",[e._v("è€å‹æµ‹è¯•ï¼š"+e._s(r.withstandVoltageTest))]):e._e()]):e._e(),e._v(" "),e.hasFullMachineTestData(r)?a("div",{staticClass:"detail-section"},[a("div",{staticClass:"section-title"},[e._v("æ•´æœºç¯å…‰æµ‹è¯•")]),e._v(" "),r.cellCode?a("div",[e._v("ç”µèŠ¯ç ï¼š"+e._s(r.cellCode))]):e._e(),e._v(" "),r.handheldControllerPcbaCode?a("div",[e._v("æ‰‹æ§å™¨PCBAç ï¼š"+e._s(r.handheldControllerPcbaCode))]):e._e(),e._v(" "),r.handheldSoftwareVersion?a("div",[e._v("æ‰‹æ§å™¨è½¯ä»¶ç‰ˆæœ¬ï¼š"+e._s(r.handheldSoftwareVersion))]):e._e(),e._v(" "),r.handheldFactoryQrCode?a("div",[e._v("æ‰‹æ§å™¨å‡ºå‚äºŒç»´ç ï¼š"+e._s(r.handheldFactoryQrCode))]):e._e(),e._v(" "),r.batteryCapacity?a("div",[e._v("ç”µæ± ç”µé‡ï¼š"+e._s(r.batteryCapacity))]):e._e(),e._v(" "),r.cell1Voltage?a("div",[e._v("ç”µèŠ¯1ç”µå‹ï¼š"+e._s(r.cell1Voltage))]):e._e(),e._v(" "),r.cell2Voltage?a("div",[e._v("ç”µèŠ¯2ç”µå‹ï¼š"+e._s(r.cell2Voltage))]):e._e(),e._v(" "),r.meterChargingCurrent?a("div",[e._v("ä»ªè¡¨å……ç”µç”µæµï¼š"+e._s(r.meterChargingCurrent))]):e._e()]):e._e(),e._v(" "),e.hasWeightData(r)?a("div",{staticClass:"detail-section"},[a("div",{staticClass:"section-title"},[e._v("ç”µå­ç§¤é‡é‡")]),e._v(" "),r.weight?a("div",[e._v("ç§°é‡é‡é‡ï¼š"+e._s(r.weight))]):e._e()]):e._e(),e._v(" "),e.hasRemoteControlTestData(r)?a("div",{staticClass:"detail-section"},[a("div",{staticClass:"section-title"},[e._v("é¥æ§æµ‹è¯•")]),e._v(" "),r.showSerialNo?a("div",[e._v("æ˜¾ç¤ºåºåˆ—å·ï¼š"+e._s(r.showSerialNo))]):e._e(),e._v(" "),r.chkPowerOn?a("div",[e._v("ä¸Šç”µå¼€æœºï¼š"+e._s(r.chkPowerOn))]):e._e(),e._v(" "),r.enterDebugMode?a("div",[e._v("è¿›å…¥è°ƒè¯•æ¨¡å¼ï¼š"+e._s(r.enterDebugMode))]):e._e(),e._v(" "),r.readAllKeyOff?a("div",[e._v("æŒ‰é”®å…³é—­çŠ¶æ€ï¼š"+e._s(r.readAllKeyOff))]):e._e(),e._v(" "),r.readK4K5?a("div",[e._v("å·¦å³é”®çŠ¶æ€ï¼š"+e._s(r.readK4K5))]):e._e(),e._v(" "),r.readPotentiometer?a("div",[e._v("ç¼–ç å¼€å…³ï¼š"+e._s(r.readPotentiometer)+"\n                  ")]):e._e(),e._v(" "),r.chkUiVersion?a("div",[e._v("è½¯ä»¶ç‰ˆæœ¬ï¼š"+e._s(r.chkUiVersion))]):e._e(),e._v(" "),r.chkUiTx?a("div",[e._v("é€šè®¯å£æ ¡éªŒï¼š"+e._s(r.chkUiTx))]):e._e()]):e._e(),e._v(" "),r.passFail?a("div",{staticClass:"detail-section"},[a("div",{staticClass:"section-title"},[e._v("æµ‹è¯•ç»“æœ")]),e._v(" "),r.passFail?a("div",[e._v("æµ‹è¯•ç»“æœï¼š"+e._s(r.passFail))]):e._e(),e._v(" "),r.testTime?a("div",[e._v("æµ‹è¯•è€—æ—¶ï¼š"+e._s(r.testTime)+"ç§’")]):e._e(),e._v(" "),r.startTime?a("div",[e._v("å¼€å§‹æ—¶é—´ï¼š"+e._s(r.startTime))]):e._e()]):e._e()]),e._v(" "),a("div",{staticClass:"result-main",attrs:{slot:"reference"},slot:"reference"},[a("div",{staticClass:"process-info"},[r.processId?a("el-tag",{attrs:{type:r.error?"danger":"success",size:"small"}},[e._v(e._s(r.processId.processName))]):e._e(),e._v(" "),r.processId?a("span",[e._v("("+e._s(r.processId.processStage)+")")]):e._e()],1),e._v(" "),a("span",{class:{success:!1===r.error,error:!0===r.error}},[e._v(e._s(r.error?"ä¸åˆæ ¼":"åˆæ ¼"))])])]):e._e(),e._v(" "),a("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(a){return e.showHistory(t.row.barcode,r.processId)}}},[e._v("å†å²è®°å½•")])],1)])}))}}])})],1),e._v(" "),a("el-dialog",{attrs:{title:"æ£€æµ‹å†å²è®°å½•","append-to-body":"",visible:e.historyDialogVisible,width:"80%","before-close":e.handleClose},on:{"update:visible":function(t){e.historyDialogVisible=t}}},[a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.historyLoading,expression:"historyLoading"}],attrs:{data:e.historyData,border:"",stripe:"",height:"500"}},[e._v("\n      :header-cell-style=\"{\n      background: '#f5f7fa',\n      color: '#606266',\n      fontWeight: 'bold',\n      textAlign: 'center'\n      }\"\n      :cell-style=\"{ textAlign: 'center' }\"\n      >\n      "),a("el-table-column",{attrs:{type:"expand"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-form",{staticClass:"table-expand",attrs:{"label-position":"left",inline:""}},[e.inspectionDataHandle(t.row).length?a("div",e._l(e.inspectionDataHandle(t.row),(function(t){return a("el-tag",{key:t,staticStyle:{margin:"3px"}},[e._v("\n                "+e._s(t)+"\n              ")])})),1):e._e()])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"æ£€æµ‹æ—¶é—´",prop:"testTime",width:"180"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n          "+e._s(e.formatDate(t.row.testTime||t.row.createTime))+"\n        ")]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"æ£€æµ‹ç»“æœ",prop:"error",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-tag",{attrs:{type:t.row.error?"danger":"success"}},[e._v("\n            "+e._s(t.row.error?"ä¸åˆæ ¼":"åˆæ ¼")+"\n          ")])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"å·¥åºåç§°",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n          "+e._s(t.row.processId?t.row.processId.processName:"--")+"\n        ")]}}])})],1),e._v(" "),a("div",{staticClass:"pagination-container"},[a("el-pagination",{attrs:{"current-page":e.currentPage,"page-sizes":[10,20,50,100],"page-size":e.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1)],1)],1)}),[],!1,null,"5b65b657",null)),x=y.exports,O=a("ed91"),T=a("1146"),k=a.n(T),D=a("c4e3"),N=a.n(D),A=a("21a6"),E=a.n(A),P={name:"SaleOrder",components:{ProcessStepList:m,InspectionList:x},data:function(){return{searchForm:{barcode:"",materialCode:"",status:"",dateRange:[],progress:""},tableList:[],total:0,currentPage:1,pageSize:10,listLoading:!0,showAdvanced:!1,dialogFormVisible:!1,dialogStatus:"",selection:[],dataForm:{barcode:"",materialCode:"",materialName:"",materialSpec:"",craftVersion:"",startTime:null,planCompletionTime:null,endTime:null,status:"PENDING",progress:0,processNodes:[],remark:""},rules:{FCustomerName:[{required:!0,message:"è¯·è¾“å…¥å®¢æˆ·åç§°",trigger:"blur"}],FDate:[{required:!0,message:"è¯·é€‰æ‹©è®¢å•æ—¥æœŸ",trigger:"change"}],FSaleDeptName:[{required:!0,message:"è¯·è¾“å…¥é”€å”®éƒ¨é—¨",trigger:"blur"}]},processedFlowChartData:[],activeTab:"process",barcodeSearchVisible:!1,searchBarcode:"",searchResults:[],searchLoading:!1,unbindRecord:[],exportDialogVisible:!1,exportForm:{exportOption:"current"},exportLoading:!1}},computed:{processedMaterialBarcodeData:function(){if(!this.dataForm.processNodes)return[];var e=new Map;return this.dataForm.processNodes.forEach((function(t){"PROCESS_STEP"===t.nodeType&&e.set(t.nodeId,{processName:t.processName,processCode:t.processCode})})),this.dataForm.processNodes.filter((function(e){return"MATERIAL"===e.nodeType&&e.barcode})).map((function(t){var a=t.parentNodeId?e.get(t.parentNodeId):null;return Object(c.a)(Object(c.a)({},t),{},{processName:a?a.processName:"-",processCode:a?a.processCode:""})})).sort((function(e,t){return new Date(t.scanTime||0)-new Date(e.scanTime||0)}))},formattedUnbindRecord:function(){var e=this;return this.unbindRecord.map((function(t){return Object(c.a)(Object(c.a)({},t),{},{formattedTime:e.formatDate(t.operateTime),materialList:t.unbindMaterials?t.unbindMaterials.map((function(e){return Object(c.a)(Object(c.a)({},e),{},{displayText:"".concat(e.materialCode," - ").concat(e.materialName)})})):[]})}))}},methods:(r={handleUnbind:function(){var e=Object(i.a)(Object(o.a)().mark((function e(t){var a,r,s,n,i,c=this;return Object(o.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.$confirm("æ­¤æ“ä½œå°†è§£ç»‘å½“å‰å·¥åºåŠå…¶åç»­æ‰€æœ‰å·¥åºçš„ç‰©æ–™ï¼Œæ˜¯å¦ç»§ç»­ï¼Ÿ","è§£ç»‘ç¡®è®¤",{confirmButtonText:"ç¡®å®š",cancelButtonText:"å–æ¶ˆ",type:"warning",showInput:!0,inputPlaceholder:"è¯·è¾“å…¥è§£ç»‘åŸå› (éå¿…å¡«)",inputValidator:function(e){return!0}});case 3:if(a=e.sent,r=a.value,s=this.$loading({lock:!0,text:"æ­£åœ¨è§£ç»‘...",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"}),e.prev=6,"PROCESS_STEP"!==t.nodeType){e.next=25;break}return e.next=10,Object(O.d)({mainBarcode:this.dataForm.barcode,processStepId:t.processStepId,userId:this.$store.state.user.id,reason:r||"æœªå¡«å†™è§£ç»‘åŸå› ",unbindSubsequent:!0});case 10:if(200!==(n=e.sent).code||!n.success){e.next=22;break}return this.$message.success("è§£ç»‘æˆåŠŸ"),n.data&&(this.dataForm=JSON.parse(JSON.stringify(n.data)),this.dataForm.processNodes&&(this.processedFlowChartData=this.processNodes(this.dataForm.processNodes))),e.next=16,this.getUnbindRecords();case 16:this.activeTab="unbind",i=this.tableList.findIndex((function(e){return e._id===c.dataForm._id})),-1!==i&&this.$set(this.tableList,i,JSON.parse(JSON.stringify(n.data))),this.$nextTick((function(){c.$forceUpdate()})),e.next=23;break;case 22:throw new Error(n.message||"è§£ç»‘å¤±è´¥");case 23:e.next=26;break;case 25:throw new Error("åªèƒ½å¯¹å·¥åºèŠ‚ç‚¹è¿›è¡Œè§£ç»‘æ“ä½œ");case 26:e.next=31;break;case 28:e.prev=28,e.t0=e.catch(6),this.$message.error(e.t0.message||"è§£ç»‘å¤±è´¥");case 31:return e.prev=31,s.close(),e.finish(31);case 34:e.next=39;break;case 36:e.prev=36,e.t1=e.catch(0),"cancel"!==e.t1&&this.$message.error(e.t1.message||"è§£ç»‘å¤±è´¥");case 39:case"end":return e.stop()}}),e,this,[[0,36],[6,28,31,34]])})));return function(t){return e.apply(this,arguments)}}(),getUnbindRecords:function(){var e=Object(i.a)(Object(o.a)().mark((function e(){var t;return Object(o.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Object(l.b)("unbindRecord",{query:{flowRecordId:this.dataForm._id},populate:JSON.stringify([{path:"operatorId"}]),sort:{createTime:-1}});case 3:200===(t=e.sent).code&&(this.unbindRecord=t.data),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),console.error("è·å–è§£ç»‘è®°å½•å¤±è´¥:",e.t0);case 10:case"end":return e.stop()}}),e,this,[[0,7]])})));return function(){return e.apply(this,arguments)}}(),getProcessStatusType:function(e){return{PENDING:"info",IN_PROCESS:"warning",COMPLETED:"success",ABNORMAL:"danger"}[e]||"info"},getProcessStatusText:function(e){return{PENDING:"å¾…å¤„ç†",IN_PROCESS:"è¿›è¡Œä¸­",COMPLETED:"å·²å®Œæˆ",ABNORMAL:"å¼‚å¸¸"}[e]||e},fetchData:function(){var e=Object(i.a)(Object(o.a)().mark((function e(){var t,a;return Object(o.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.listLoading=!0,e.prev=1,(t=this.searchData()).page=this.currentPage,t.skip=(this.currentPage-1)*this.pageSize,t.limit=this.pageSize,t.sort={createAt:-1},t.count=!0,e.next=10,Object(l.b)("material_process_flow",t);case 10:200===(a=e.sent).code?(this.tableList=a.data,this.total=a.countnum||a.data.length):this.$message.error(a.msg||"è·å–æ•°æ®å¤±è´¥"),e.next=18;break;case 14:e.prev=14,e.t0=e.catch(1),console.error("è·å–æ•°æ®å¤±è´¥:",e.t0),this.$message.error("è·å–æ•°æ®å¤±è´¥: "+e.t0.message);case 18:return e.prev=18,this.listLoading=!1,e.finish(18);case 21:case"end":return e.stop()}}),e,this,[[1,14,18,21]])})));return function(){return e.apply(this,arguments)}}(),baseTableHandleCurrentChange:function(e){this.currentPage=e,this.fetchData()},baseTableHandleSizeChange:function(e){this.pageSize=e,this.fetchData()},toggleAdvanced:function(){this.showAdvanced=!this.showAdvanced},formatDate:function(e){return e?new Date(e).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}):"æš‚æ— æ•°æ®"},formatNumber:function(e){return e||0===e?"Â¥"+Number(e).toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g,","):"Â¥0.00"},search:function(){this.currentPage=1,this.fetchData()},handleSelectionChange:function(e){this.selection=e},handleInit:function(){var e=Object(i.a)(Object(o.a)().mark((function e(t){var a;return Object(o.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,console.log(t,"row"),e.next=4,this.$confirm("ç¡®è®¤è¦æˆå“åˆå§‹åŒ–å—?è¯¥æ“ä½œæ— æ³•æ’¤å›ï¼è¯·è°¨æ…æ“ä½œï¼","æç¤º",{confirmButtonText:"ç¡®å®š",cancelButtonText:"å–æ¶ˆ",type:"warning"});case 4:if(t._id){e.next=7;break}return this.$message.error("è¯·é€‰æ‹©è¦åˆå§‹åŒ–çš„è®°å½•"),e.abrupt("return");case 7:return e.next=9,Object(l.c)("material_process_flow",{query:{_id:t._id}});case 9:if(200!==(a=e.sent).code){e.next=15;break}this.$message.success("åˆå§‹åŒ–æˆåŠŸ"),this.fetchData(),e.next=16;break;case 15:throw new Error(a.msg||"åˆå§‹åŒ–å¤±è´¥");case 16:e.next=21;break;case 18:e.prev=18,e.t0=e.catch(0),"cancel"!==e.t0&&(console.error("åˆ é™¤å¤±è´¥:",e.t0),this.$message.error(e.t0.message||"åˆ é™¤å¤±è´¥"));case 21:case"end":return e.stop()}}),e,this,[[0,18]])})));return function(t){return e.apply(this,arguments)}}(),handleUpdateFlowNodes:function(){var e=Object(i.a)(Object(o.a)().mark((function e(t){var a;return Object(o.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.$confirm("ç¡®è®¤è¦æ›´æ–°æµç¨‹èŠ‚ç‚¹å—?","æç¤º",{confirmButtonText:"ç¡®å®š",cancelButtonText:"å–æ¶ˆ",type:"warning"});case 3:return e.next=5,Object(O.e)({barcode:t.barcode});case 5:a=e.sent,console.log(a,"result"),200===a.code&&a.success?(this.$message.success("æ›´æ–°æˆåŠŸ"),this.fetchData()):this.$message.error("æ›´æ–°å¤±è´¥"),e.next=14;break;case 10:e.prev=10,e.t0=e.catch(0),console.error("æ›´æ–°å¤±è´¥:",e.t0),this.$message.error("æ›´æ–°å¤±è´¥: "+e.t0.message);case 14:case"end":return e.stop()}}),e,this,[[0,10]])})));return function(t){return e.apply(this,arguments)}}(),handleView:function(){var e=Object(i.a)(Object(o.a)().mark((function e(t){var a,r;return Object(o.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,console.log(t,"row"),this.listLoading=!0,e.next=5,Object(l.b)("material_process_flow",{query:{_id:t._id}});case 5:if(a=e.sent,console.log(a,"result"),!(200===a.code&&a.data.length>0)){e.next=18;break}return this.dataForm=a.data[0],this.processedFlowChartData=this.processNodes(this.dataForm.processNodes),this.dialogFormVisible=!0,e.next=13,Object(l.b)("unbindRecord",{query:{flowRecordId:t._id},populate:JSON.stringify([{path:"operatorId"}])});case 13:r=e.sent,console.log(r,"unbindRecord"),this.unbindRecord=r.data,e.next=19;break;case 18:this.$message.error("è·å–è¯¦æƒ…å¤±è´¥");case 19:e.next=25;break;case 21:e.prev=21,e.t0=e.catch(0),console.error("è·å–è¯¦æƒ…å¤±è´¥:",e.t0),this.$message.error("è·å–è¯¦æƒ…å¤±è´¥: "+e.t0.message);case 25:return e.prev=25,this.listLoading=!1,e.finish(25);case 28:case"end":return e.stop()}}),e,this,[[0,21,25,28]])})));return function(t){return e.apply(this,arguments)}}(),handleDelete:function(){var e=Object(i.a)(Object(o.a)().mark((function e(t){return Object(o.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.$confirm("ç¡®è®¤è¦åˆ é™¤è¯¥è®¢å•å—ï¼Ÿåˆ é™¤åä¸å¯æ¢å¤ï¼","è­¦å‘Š",{type:"warning",confirmButtonText:"ç¡®å®šåˆ é™¤",confirmButtonClass:"el-button--danger"});case 3:return e.next=5,Object(l.c)("k3_SAL_SaleOrder",{query:{_id:t._id}});case 5:this.$message.success("åˆ é™¤æˆåŠŸ"),this.fetchData(),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0),"cancel"===e.t0?this.$message.info("å·²å–æ¶ˆåˆ é™¤"):(console.error("åˆ é™¤å¤±è´¥:",e.t0),this.$message.error("åˆ é™¤å¤±è´¥"));case 12:case"end":return e.stop()}}),e,this,[[0,9]])})));return function(t){return e.apply(this,arguments)}}(),handleSubmit:function(){var e=Object(i.a)(Object(o.a)().mark((function e(t){return Object(o.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,"edit"!==this.dialogStatus){e.next=7;break}return e.next=4,Object(l.d)("k3_SAL_SaleOrder",t._id,t);case 4:this.$message.success("æ›´æ–°æˆåŠŸ"),e.next=10;break;case 7:return e.next=9,Object(l.a)("k3_SAL_SaleOrder",t);case 9:this.$message.success("æ·»åŠ æˆåŠŸ");case 10:this.dialogFormVisible=!1,this.fetchData(),e.next=18;break;case 14:e.prev=14,e.t0=e.catch(0),console.error("æ“ä½œå¤±è´¥:",e.t0),this.$message.error("æ“ä½œå¤±è´¥");case 18:case"end":return e.stop()}}),e,this,[[0,14]])})));return function(t){return e.apply(this,arguments)}}(),searchData:function(){var e={query:{$and:[]}};return Object.entries(this.searchForm).forEach((function(t){var a=Object(n.a)(t,2),r=a[0],o=a[1];if(o)switch(r){case"barcode":case"materialCode":if(o.trim()){var i=o.trim().replace(/[.*+?^${}()|[\]\\]/g,"\\$&");e.query.$and.push(Object(s.a)({},r,{$regex:i,$options:"i"}))}break;case"status":e.query.$and.push(Object(s.a)({},r,o));break;case"progress":""!==o&&e.query.$and.push({progress:o});break;case"dateRange":Array.isArray(o)&&2===o.length&&e.query.$and.push({startTime:{$gte:o[0]+" 00:00:00",$lte:o[1]+" 23:59:59"}})}})),e.query.$and.length||delete e.query.$and,e},resetForm:function(){this.$refs.searchForm.resetFields(),this.searchForm={barcode:"",materialCode:"",status:"",dateRange:[],progress:""},this.currentPage=1,this.fetchData()},handleEdit:function(e){var t=this;this.dialogStatus="edit",this.dialogFormVisible=!0,this.$nextTick((function(){t.$refs.dataForm.resetFields(),t.dataForm=Object.assign({},e)}))}},Object(s.a)(Object(s.a)(Object(s.a)(Object(s.a)(Object(s.a)(Object(s.a)(Object(s.a)(Object(s.a)(Object(s.a)(Object(s.a)(r,"handleDelete",function(){var e=Object(i.a)(Object(o.a)().mark((function e(t){return Object(o.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.$confirm("ç¡®è®¤è¦åˆ é™¤è¯¥è®¢å•å—ï¼Ÿ","è­¦å‘Š",{confirmButtonText:"ç¡®å®š",cancelButtonText:"å–æ¶ˆ",type:"warning"});case 3:return e.next=5,Object(l.c)("k3_SAL_SaleOrder",{query:{_id:t._id}});case 5:this.$message.success("åˆ é™¤æˆåŠŸ"),this.fetchData(),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0),"cancel"!==e.t0&&(console.error("åˆ é™¤å¤±è´¥:",e.t0),this.$message.error("åˆ é™¤å¤±è´¥: "+e.t0.message));case 12:case"end":return e.stop()}}),e,this,[[0,9]])})));return function(t){return e.apply(this,arguments)}}()),"handleSubmitAudit",function(){var e=Object(i.a)(Object(o.a)().mark((function e(t){var a;return Object(o.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.$confirm("ç¡®è®¤æäº¤æ­¤è®¢å•è¿›è¡Œå®¡æ ¸ï¼Ÿ","æç¤º",{confirmButtonText:"ç¡®å®š",cancelButtonText:"å–æ¶ˆ",type:"warning"});case 3:return a=Object(c.a)(Object(c.a)({},t),{},{FDocumentStatus:"B",FModifyDate:new Date,FModifierId:this.$store.state.user.name}),e.next=6,Object(l.d)("k3_SAL_SaleOrder",t._id,a);case 6:this.$message.success("æäº¤å®¡æ ¸æˆåŠŸ"),this.fetchData(),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(0),"cancel"!==e.t0&&(console.error("æäº¤å®¡æ ¸å¤±è´¥:",e.t0),this.$message.error("æäº¤å®¡æ ¸å¤±è´¥: "+e.t0.message));case 13:case"end":return e.stop()}}),e,this,[[0,10]])})));return function(t){return e.apply(this,arguments)}}()),"submitForm",(function(){var e=this;this.$refs.dataForm.validate(function(){var t=Object(i.a)(Object(o.a)().mark((function t(a){return Object(o.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!a){t.next=19;break}if(t.prev=1,"create"!==e.dialogStatus){t.next=8;break}return t.next=5,Object(l.a)("k3_SAL_SaleOrder",e.dataForm);case 5:e.$message.success("åˆ›å»ºæˆåŠŸ"),t.next=11;break;case 8:return t.next=10,Object(l.d)("k3_SAL_SaleOrder",e.dataForm._id,e.dataForm);case 10:e.$message.success("æ›´æ–°æˆåŠŸ");case 11:e.dialogFormVisible=!1,e.fetchData(),t.next=19;break;case 15:t.prev=15,t.t0=t.catch(1),console.error("æ“ä½œå¤±è´¥:",t.t0),e.$message.error("æ“ä½œå¤±è´¥: "+t.t0.message);case 19:case"end":return t.stop()}}),t,null,[[1,15]])})));return function(e){return t.apply(this,arguments)}}())})),"getNodeIcon",(function(e){return{PROCESS_STEP:{icon:"el-icon-s-operation",color:"#409EFF"},MATERIAL:{icon:"el-icon-box",color:"#67c23a"}}[e.nodeType]||{icon:"el-icon-more",color:"#909399"}})),"getTimelineItemType",(function(e){return{COMPLETED:"success",IN_PROCESS:"primary",ABNORMAL:"danger",PENDING:"info"}[e]||"info"})),"getScanIcon",(function(e){if(!e.requireScan)return"el-icon-minus info";return{COMPLETED:"el-icon-check success",IN_PROCESS:"el-icon-loading warning",ABNORMAL:"el-icon-close danger",PENDING:"el-icon-time info"}[e.status]||"el-icon-time info"})),"getScanStatus",(function(e){if(!e.requireScan)return"æ— éœ€æ‰«ç ";return{COMPLETED:"å·²å®Œæˆæ‰«ç ",IN_PROCESS:"ç­‰å¾…æ‰«ç ",ABNORMAL:"æ‰«ç å¼‚å¸¸",PENDING:"æœªå¼€å§‹"}[e.status]||"æœªå¼€å§‹"})),"getActiveStep",(function(e){var t=e.findIndex((function(e){return"IN_PROCESS"===e.status}));return-1===t?e.filter((function(e){return"COMPLETED"===e.status})).length:t+1})),"getStepStatus",(function(e){return{COMPLETED:"success",IN_PROCESS:"process",ABNORMAL:"error",PENDING:"wait"}[e]||"wait"})),"getStepIcon",(function(e){return"PROCESS_STEP"===e.nodeType?"el-icon-s-operation":"el-icon-box"})),Object(s.a)(Object(s.a)(Object(s.a)(Object(s.a)(Object(s.a)(Object(s.a)(Object(s.a)(Object(s.a)(Object(s.a)(Object(s.a)(r,"getProcessOverallStatus",(function(e){return e.some((function(e){return"ABNORMAL"===e.status}))?"error":e.some((function(e){return"IN_PROCESS"===e.status}))?"process":e.every((function(e){return"COMPLETED"===e.status}))?"success":"wait"})),"getProcessSteps",(function(){return this.dataForm.processNodes.filter((function(e){return"PROCESS_STEP"===e.nodeType&&1===e.level})).sort((function(e,t){return e.processSort-t.processSort}))})),"getRelatedMaterials",(function(e){return this.dataForm.processNodes.filter((function(t){return"MATERIAL"===t.nodeType&&t.parentNodeId===e&&2===t.level}))})),"hasRequireScanMaterials",(function(e){return this.getRelatedMaterials(e).some((function(e){return e.requireScan}))})),"processNodes",(function(e){if(!e||!e.length)return[];var t=new Map;e.forEach((function(e){t.set(e.nodeId,Object(c.a)(Object(c.a)({},e),{},{children:[]}))}));var a=[];e.forEach((function(e){var r=t.get(e.nodeId);e.parentNodeId&&t.has(e.parentNodeId)?t.get(e.parentNodeId).children.push(r):a.push(r)}));var r=function(e){e.children&&e.children.length&&("PROCESS_STEP"===e.nodeType?e.children.sort((function(e,t){return(e.materialCode||"").localeCompare(t.materialCode||"")})):"MATERIAL"===e.nodeType&&e.children.sort((function(e,t){return(e.processSort||0)-(t.processSort||0)})),e.children.forEach((function(e){return r(e)})))};return a.forEach((function(e){return r(e)})),a})),"openBarcodeSearch",(function(){this.barcodeSearchVisible=!0,this.searchBarcode="",this.searchResults=[]})),"handleBarcodeSearch",function(){var e=Object(i.a)(Object(o.a)().mark((function e(){var t,a,r,s,n=this;return Object(o.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.searchBarcode.trim()){e.next=3;break}return this.$message.warning("è¯·è¾“å…¥è¦æœç´¢çš„æ¡ç "),e.abrupt("return");case 3:return this.searchLoading=!0,e.prev=4,t={query:{"processNodes.barcode":this.searchBarcode}},e.next=8,Object(l.b)("material_process_flow",t);case 8:if(!(200===(a=e.sent).code&&a.data&&a.data.length>0)){e.next=13;break}return this.searchResults=[],a.data.forEach((function(e){n.searchResults.push(Object(c.a)({isMainBarcode:!0,barcode:e.barcode,materialCode:e.materialCode,materialName:e.materialName,materialSpec:e.materialSpec,status:e.status},e))})),e.abrupt("return");case 13:return r={query:{barcode:this.searchBarcode}},e.next=16,Object(l.b)("material_process_flow",r);case 16:if(!(200===(s=e.sent).code&&s.data&&s.data.length>0)){e.next=21;break}return this.searchResults=[],s.data.forEach((function(e){n.searchResults.push(Object(c.a)({isMainBarcode:!1,barcode:e.barcode,materialCode:e.materialCode,materialName:e.materialName,materialSpec:e.materialSpec,status:e.status},e))})),e.abrupt("return");case 21:this.$message.warning("æœªæ‰¾åˆ°ç›¸å…³æ•°æ®"),e.next=28;break;case 24:e.prev=24,e.t0=e.catch(4),console.error("æœç´¢å¤±è´¥:",e.t0),this.$message.error("æœç´¢å¤±è´¥: "+e.t0.message);case 28:return e.prev=28,this.searchBarcode="",this.searchLoading=!1,e.finish(28);case 32:case"end":return e.stop()}}),e,this,[[4,24,28,32]])})));return function(){return e.apply(this,arguments)}}()),"handleProcessedMaterialBarcodeData",(function(e){if(!e.processNodes)return[];var t=new Map;return e.processNodes.forEach((function(e){"PROCESS_STEP"===e.nodeType&&t.set(e.nodeId,{processName:e.processName,processCode:e.processCode})})),e.processNodes.filter((function(e){return"MATERIAL"===e.nodeType&&e.barcode})).map((function(e){var a=e.parentNodeId?t.get(e.parentNodeId):null;return Object(c.a)(Object(c.a)({},e),{},{processName:a?a.processName:"-",processCode:a?a.processCode:""})})).sort((function(e,t){return new Date(t.scanTime||0)-new Date(e.scanTime||0)}))})),"handleAllExport",(function(){this.exportDialogVisible=!0,this.exportForm.exportOption="current"})),"handleAllExcel",function(){var e=Object(i.a)(Object(o.a)().mark((function e(){var t,a,r,s,n,i,c,d,u,p,h,f,v=this;return Object(o.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,this.$loading({lock:!0,text:"æ­£åœ¨å¯¼å‡ºæ•°æ®ï¼Œè¯·ç¨å€™...",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"}),(t=this.searchData()).page=this.currentPage,t.skip=(this.currentPage-1)*this.pageSize,t.limit=this.pageSize,t.sort={createAt:-1},e.next=9,Object(l.b)("sale_order_barcode_mapping",t);case 9:if(200===(a=e.sent).code){e.next=12;break}throw new Error(a.msg||"è·å–æ•°æ®å¤±è´¥");case 12:r=a.data.map((function(e){return{"å‹å·":e.materialCode||"-","å®¢æˆ·è®¢å•":e.saleOrderNo?e.saleOrderNo:"-","UDIåºåˆ—å·":e.barcode||"-","ç”Ÿäº§æ‰¹å·":e.productionPlanWorkOrderId?e.productionPlanWorkOrderId.productionOrderNo:"-","å¤–ç®±UDI":e.barcode||"-","å½©ç›’UDI":e.barcode||"-","äº§å“UDI":e.barcode||"-","ç”Ÿäº§æ—¥æœŸ":e.createAt?v.formatDate(e.createAt):"-"}})),s=k.a.utils.book_new(),n=k.a.utils.json_to_sheet(r),i=[{wch:15},{wch:15},{wch:20},{wch:15},{wch:20},{wch:20},{wch:20},{wch:20}],n["!cols"]=i,c=k.a.utils.decode_range(n["!ref"]),d=c.s.c;case 19:if(!(d<=c.e.c)){e.next=27;break}if(u=k.a.utils.encode_cell({r:0,c:d}),n[u]){e.next=23;break}return e.abrupt("continue",24);case 23:n[u].s={font:{bold:!0},alignment:{horizontal:"center"},fill:{fgColor:{rgb:"f5f7fa"}}};case 24:++d,e.next=19;break;case 27:k.a.utils.book_append_sheet(s,n,"æ•°æ®åˆ—è¡¨"),p=k.a.write(s,{bookType:"xlsx",type:"array"}),h=new Blob([p],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),f="æ•°æ®å¯¼å‡º_".concat((new Date).toLocaleDateString(),".xlsx"),E.a.saveAs(h,f),this.$message.success("å¯¼å‡ºæˆåŠŸ"),e.next=39;break;case 35:e.prev=35,e.t0=e.catch(0),console.error("å¯¼å‡ºå¤±è´¥:",e.t0),this.$message.error("å¯¼å‡ºå¤±è´¥: "+e.t0.message);case 39:return e.prev=39,this.$loading().close(),e.finish(39);case 42:case"end":return e.stop()}}),e,this,[[0,35,39,42]])})));return function(){return e.apply(this,arguments)}}()),Object(s.a)(Object(s.a)(Object(s.a)(r,"confirmExport",function(){var e=Object(i.a)(Object(o.a)().mark((function e(){var t,a,r,s,n,i,c,d,u,p,h,f,v,m,b,_,g,C,w,S,y,x=this;return Object(o.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("all"!==(t=this.exportForm.exportOption)){e.next=12;break}return e.prev=2,e.next=5,this.$confirm("ç¡®è®¤å¯¼å‡ºå…¨éƒ¨æ•°æ®å—?æ•°æ®é‡è¾ƒå¤§å¯èƒ½éœ€è¦è¾ƒé•¿æ—¶é—´","äºŒæ¬¡ç¡®è®¤",{type:"warning"});case 5:e.next=12;break;case 7:if(e.prev=7,e.t0=e.catch(2),"cancel"!==e.t0){e.next=12;break}return this.$message.info("å·²å–æ¶ˆå¯¼å‡º"),e.abrupt("return");case 12:this.exportLoading=!0,e.prev=13,a=[],e.t1=t,e.next="all"===e.t1?18:"search"===e.t1?27:42;break;case 18:return e.next=20,Object(l.b)("material_process_flow",{query:{}});case 20:if(200!==(r=e.sent).code){e.next=25;break}a=r.data,e.next=26;break;case 25:throw new Error(r.msg||"è·å–æ•°æ®å¤±è´¥");case 26:return e.abrupt("break",42);case 27:return(s=this.searchData()).page=this.currentPage,s.skip=(this.currentPage-1)*this.pageSize,s.limit=this.pageSize,s.sort={createAt:-1},s.count=!0,e.next=35,Object(l.b)("material_process_flow",s);case 35:if(200!==(n=e.sent).code){e.next=40;break}a=n.data,e.next=41;break;case 40:throw new Error(n.msg||"è·å–æ•°æ®å¤±è´¥");case 41:return e.abrupt("break",42);case 42:if(console.log(a),0!==a.length){e.next=46;break}return this.$message.warning("æ²¡æœ‰å¯å¯¼å‡ºçš„æ•°æ®"),e.abrupt("return");case 46:i=this.$loading({lock:!0,text:"æ­£åœ¨å¤„ç†ç¬¬ 0/".concat(a.length," æ¡æ•°æ®..."),spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"}),c=new N.a,d=0;case 49:if(!(d<a.length)){e.next=88;break}return i.text="æ­£åœ¨å¤„ç†ç¬¬ ".concat(d+1,"/").concat(a.length," æ¡æ•°æ®..."),u=a[d],e.prev=52,e.next=55,Object(l.b)("material_process_flow",{query:{_id:u._id}});case 55:if(!(200===(p=e.sent).code&&p.data.length>0)){e.next=79;break}if(h=p.data[0],0!==(f=this.handleProcessedMaterialBarcodeData(h)).length){e.next=61;break}return e.abrupt("continue",85);case 61:v=f.map((function(e){return{"æ¡ç ":e.barcode||"-","ç‰©æ–™ç¼–ç ":e.materialCode||"-","ç‰©æ–™åç§°":e.materialName||"-","è§„æ ¼å‹å·":e.materialSpec||"-","çŠ¶æ€":x.getProcessStatusText(e.status)||"-","æ‰€å±å·¥åº":"".concat(e.processName||""," ").concat(e.processCode?"(".concat(e.processCode,")"):""),"æ‰«ç æ—¶é—´":e.scanTime?x.formatDate(e.scanTime):"-"}})),m=k.a.utils.book_new(),(b=k.a.utils.json_to_sheet(v))["!cols"]=[{wch:20},{wch:15},{wch:20},{wch:15},{wch:10},{wch:20},{wch:20}],_=k.a.utils.decode_range(b["!ref"]),g=_.s.c;case 67:if(!(g<=_.e.c)){e.next=75;break}if(C=k.a.utils.encode_cell({r:0,c:g}),b[C]){e.next=71;break}return e.abrupt("continue",72);case 71:b[C].s={font:{bold:!0},alignment:{horizontal:"center"},fill:{fgColor:{rgb:"f5f7fa"}}};case 72:++g,e.next=67;break;case 75:k.a.utils.book_append_sheet(m,b,"ç‰©æ–™æ¡ç ä¿¡æ¯"),w=k.a.write(m,{bookType:"xlsx",type:"array"}),S="".concat(u.materialCode,"_").concat(u.materialName,"_").concat(u.barcode,".xlsx"),c.file(S,w);case 79:e.next=85;break;case 81:return e.prev=81,e.t2=e.catch(52),console.error("å¤„ç†æ•°æ®å¤±è´¥:",e.t2),e.abrupt("continue",85);case 85:d++,e.next=49;break;case 88:return e.next=90,c.generateAsync({type:"blob"});case 90:y=e.sent,E.a.saveAs(y,"ç‰©æ–™æ¡ç ä¿¡æ¯_".concat((new Date).toLocaleDateString(),".zip")),this.$message.success("å¯¼å‡ºæˆåŠŸ"),this.exportDialogVisible=!1,i.close(),e.next=101;break;case 97:e.prev=97,e.t3=e.catch(13),console.error("å¯¼å‡ºå¤±è´¥:",e.t3),this.$message.error("å¯¼å‡ºå¤±è´¥: "+e.t3.message);case 101:return e.prev=101,this.exportLoading=!1,e.finish(101);case 104:case"end":return e.stop()}}),e,this,[[2,7],[13,97,101,104],[52,81]])})));return function(){return e.apply(this,arguments)}}()),"processMaterialBarcodeData",(function(e){return e?e.filter((function(e){return"MATERIAL"===e.nodeType&&e.barcode})).map((function(e){return{barcode:e.barcode,materialCode:e.materialCode,materialName:e.materialName,materialSpec:e.materialSpec,status:e.status,processName:e.processName,processCode:e.processCode,scanTime:e.scanTime}})).sort((function(e,t){return new Date(t.scanTime||0)-new Date(e.scanTime||0)})):[]})),"handleSingleMainExport",function(){var e=Object(i.a)(Object(o.a)().mark((function e(t){var a,r,s,n,i,c,d,u,p,h,f,v,m,b,_,g=this;return Object(o.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,a=this.$loading({lock:!0,text:"æ­£åœ¨è·å–æ•°æ®ï¼Œè¯·ç¨å€™...",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"}),e.prev=2,e.next=5,Object(l.b)("material_process_flow",{query:{_id:t._id}});case 5:if(!(200===(r=e.sent).code&&r.data.length>0)){e.next=37;break}if(s=r.data[0],0!==(n=this.handleProcessedMaterialBarcodeData(s)).length){e.next=13;break}return this.$message.warning("è¯¥è®°å½•æ²¡æœ‰å¯å¯¼å‡ºçš„æ¡ç æ•°æ®"),a.close(),e.abrupt("return");case 13:i=n.map((function(e){return{"æ¡ç ":e.barcode||"-","ç‰©æ–™ç¼–ç ":e.materialCode||"-","ç‰©æ–™åç§°":e.materialName||"-","è§„æ ¼å‹å·":e.materialSpec||"-","çŠ¶æ€":g.getProcessStatusText(e.status)||"-","æ‰€å±å·¥åº":"".concat(e.processName||""," ").concat(e.processCode?"(".concat(e.processCode,")"):""),"æ‰«ç æ—¶é—´":e.scanTime?g.formatDate(e.scanTime):"-"}})),c=k.a.utils.book_new(),d=k.a.utils.json_to_sheet(i),u=[{wch:20},{wch:15},{wch:20},{wch:15},{wch:10},{wch:20},{wch:20}],d["!cols"]=u,p={font:{bold:!0},alignment:{horizontal:"center"},fill:{fgColor:{rgb:"f5f7fa"}}},h=k.a.utils.decode_range(d["!ref"]),f=h.s.c;case 21:if(!(f<=h.e.c)){e.next=29;break}if(v=k.a.utils.encode_cell({r:0,c:f}),d[v]){e.next=25;break}return e.abrupt("continue",26);case 25:d[v].s=p;case 26:++f,e.next=21;break;case 29:k.a.utils.book_append_sheet(c,d,"ç‰©æ–™æ¡ç ä¿¡æ¯"),m=k.a.write(c,{bookType:"xlsx",type:"array"}),b=new Blob([m],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),_="".concat(t.materialCode,"_").concat(t.materialName,"_").concat(t.barcode,".xlsx"),E.a.saveAs(b,_),this.$message.success("å¯¼å‡ºæˆåŠŸ"),e.next=38;break;case 37:throw new Error("è·å–æ•°æ®å¤±è´¥");case 38:e.next=44;break;case 40:e.prev=40,e.t0=e.catch(2),console.error("å¯¼å‡ºå¤±è´¥:",e.t0),this.$message.error("å¯¼å‡ºå¤±è´¥: "+e.t0.message);case 44:return e.prev=44,a.close(),e.finish(44);case 47:e.next=53;break;case 49:e.prev=49,e.t1=e.catch(0),console.error("å¯¼å‡ºå¤±è´¥:",e.t1),this.$message.error("å¯¼å‡ºå¤±è´¥: "+e.t1.message);case 53:case"end":return e.stop()}}),e,this,[[0,49],[2,40,44,47]])})));return function(t){return e.apply(this,arguments)}}())),created:function(){this.fetchData()}},j=P,L=(a("778a"),Object(u.a)(j,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"app-container"},[a("el-card",{staticClass:"filter-container"},[a("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[a("span",[e._v("ç­›é€‰æœç´¢")]),e._v(" "),a("el-button",{staticStyle:{float:"right",padding:"3px 0"},attrs:{type:"text"},on:{click:e.toggleAdvanced}},[e._v("\n                "+e._s(e.showAdvanced?"æ”¶èµ·":"å±•å¼€")+"é«˜çº§æœç´¢\n            ")])],1),e._v(" "),a("el-form",{ref:"searchForm",staticClass:"demo-form-inline",attrs:{model:e.searchForm}},[a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:6}},[a("el-form-item",{attrs:{label:"ä¸»æ¡ç "}},[a("el-input",{attrs:{placeholder:"è¯·è¾“å…¥ä¸»æ¡ç ",clearable:""},model:{value:e.searchForm.barcode,callback:function(t){e.$set(e.searchForm,"barcode",t)},expression:"searchForm.barcode"}})],1)],1),e._v(" "),a("el-col",{attrs:{span:6}},[a("el-form-item",{attrs:{label:"ç‰©æ–™ç¼–ç "}},[a("el-input",{attrs:{placeholder:"è¯·è¾“å…¥ç‰©æ–™ç¼–ç ",clearable:""},model:{value:e.searchForm.materialCode,callback:function(t){e.$set(e.searchForm,"materialCode",t)},expression:"searchForm.materialCode"}})],1)],1),e._v(" "),a("el-col",{attrs:{span:6}},[a("el-form-item",{attrs:{label:"æµç¨‹çŠ¶æ€"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"è¯·é€‰æ‹©æµç¨‹çŠ¶æ€",clearable:""},model:{value:e.searchForm.status,callback:function(t){e.$set(e.searchForm,"status",t)},expression:"searchForm.status"}},[a("el-option",{attrs:{label:"å¾…å¤„ç†",value:"PENDING"}}),e._v(" "),a("el-option",{attrs:{label:"è¿›è¡Œä¸­",value:"IN_PROCESS"}}),e._v(" "),a("el-option",{attrs:{label:"å·²å®Œæˆ",value:"COMPLETED"}}),e._v(" "),a("el-option",{attrs:{label:"å¼‚å¸¸",value:"ABNORMAL"}})],1)],1)],1)],1),e._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:e.showAdvanced,expression:"showAdvanced"}]},[a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"å¼€å§‹æ—¶é—´"}},[a("el-date-picker",{staticStyle:{width:"100%"},attrs:{type:"daterange","range-separator":"è‡³","start-placeholder":"å¼€å§‹æ—¥æœŸ","end-placeholder":"ç»“æŸæ—¥æœŸ","value-format":"yyyy-MM-dd"},model:{value:e.searchForm.dateRange,callback:function(t){e.$set(e.searchForm,"dateRange",t)},expression:"searchForm.dateRange"}})],1)],1),e._v(" "),a("el-col",{attrs:{span:6}},[a("el-form-item",{attrs:{label:"å®Œæˆè¿›åº¦"}},[a("el-input-number",{attrs:{min:0,max:100,placeholder:"å®Œæˆè¿›åº¦"},model:{value:e.searchForm.progress,callback:function(t){e.$set(e.searchForm,"progress",t)},expression:"searchForm.progress"}})],1)],1)],1)],1),e._v(" "),a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:e.search}},[e._v("æŸ¥è¯¢æœç´¢")]),e._v(" "),a("el-button",{on:{click:e.resetForm}},[e._v("é‡ç½®")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:e.openBarcodeSearch}},[e._v("æˆå“è¿½æº¯")])],1)],1)],1),e._v(" "),a("div",{staticClass:"screen1"},[a("div",{staticClass:"screen_content"},[a("div",{staticClass:"screen_content_first"},[a("i",{staticClass:"el-icon-tickets"},[e._v("ä¸»æ¡ç ç”Ÿäº§æµç¨‹åˆ—è¡¨")]),e._v(" "),a("div",[a("el-button",{attrs:{type:"primary"},on:{click:e.handleAllExcel}},[e._v("å¯¼å‡ºæ•°æ®è¡¨")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:e.handleAllExport}},[e._v("æ‰¹é‡å¯¼å‡ºæ•°æ®")])],1)])])]),e._v(" "),a("base-table",{ref:"baseTable",attrs:{currentPage:e.currentPage,"highlight-current-row":!0,pageSize:e.pageSize,tableData:e.tableList,tableDataloading:e.listLoading,total:e.total,"cell-style":{textAlign:"center"}},on:{"selection-change":e.handleSelectionChange,handleCurrentChange:e.baseTableHandleCurrentChange,handleSizeChange:e.baseTableHandleSizeChange}},[a("template",{slot:"law"},[a("el-table-column",{attrs:{label:"ä¸»æ¡ç ",prop:"barcode"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                    "+e._s(t.row.barcode)+"\n                ")]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"ç‰©æ–™ä¿¡æ¯"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",[e._v("ç¼–ç ï¼š"+e._s(t.row.materialCode))]),e._v(" "),a("div",[e._v("åç§°ï¼š"+e._s(t.row.materialName))]),e._v(" "),a("div",[e._v("è§„æ ¼ï¼š"+e._s(t.row.materialSpec))])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"æµç¨‹çŠ¶æ€",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-tag",{attrs:{type:e.getProcessStatusType(t.row.status)}},[e._v("\n                        "+e._s(e.getProcessStatusText(t.row.status))+"\n                    ")])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"å®Œæˆè¿›åº¦",width:"200"},scopedSlots:e._u([{key:"default",fn:function(e){return[a("el-progress",{attrs:{percentage:e.row.progress||0}})]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"æ“ä½œ",fixed:"right",width:"200"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"text",size:"small"},on:{click:function(a){return e.handleView(t.row)}}},[e._v("æŸ¥çœ‹")]),e._v(" "),a("el-button",{attrs:{type:"text",size:"small"},on:{click:function(a){return e.handleUpdateFlowNodes(t.row)}}},[e._v("æ›´æ–°æµç¨‹èŠ‚ç‚¹")]),e._v(" "),a("el-button",{attrs:{type:"text",size:"small"},on:{click:function(a){return e.handleSingleMainExport(t.row)}}},[e._v("\n                        å¯¼å‡ºæ¡ç æ•°æ®\n                    ")])]}}])})],1)],2),e._v(" "),a("el-dialog",{staticClass:"process-flow-dialog",attrs:{title:"å·¥è‰ºæµç¨‹è¯¦æƒ… - "+e.dataForm.barcode,visible:e.dialogFormVisible,width:"80%","close-on-click-modal":!1},on:{"update:visible":function(t){e.dialogFormVisible=t}}},[a("div",{staticClass:"process-flow-container"},[a("div",{staticClass:"process-section"},[a("el-card",{staticClass:"process-card"},[a("div",{attrs:{slot:"header"},slot:"header"},[a("span",[a("i",{staticClass:"el-icon-time"}),e._v(" å·¥è‰ºæµç¨‹")])]),e._v(" "),a("div",{staticClass:"process-flow"},[a("div",{staticClass:"main-material"},[a("div",{staticClass:"main-material-header"},[a("i",{staticClass:"el-icon-box"}),e._v(" "),a("span",{staticClass:"title"},[e._v("ä¸»äº§å“ä¿¡æ¯")]),e._v(" "),a("el-tag",{attrs:{type:"primary",size:"mini"}},[e._v(e._s(e.dataForm.materialCode))])],1),e._v(" "),a("div",{staticClass:"main-material-content"},[a("div",{staticClass:"info-row"},[a("div",{staticClass:"info-item"},[a("label",[e._v("äº§å“æ¡ç ï¼š")]),e._v(" "),a("span",[e._v(e._s(e.dataForm.barcode))])])]),e._v(" "),a("div",{staticClass:"info-row"},[a("div",{staticClass:"info-item"},[a("label",[e._v("ç‰©æ–™åç§°ï¼š")]),e._v(" "),a("span",[e._v(e._s(e.dataForm.materialName))])]),e._v(" "),a("div",{staticClass:"info-item"},[a("label",[e._v("è§„æ ¼å‹å·ï¼š")]),e._v(" "),a("span",[e._v(e._s(e.dataForm.materialSpec))])])]),e._v(" "),a("div",{staticClass:"info-row"},[a("div",{staticClass:"info-item"},[a("label",[e._v("æ•´ä½“è¿›åº¦ï¼š")]),e._v(" "),a("el-progress",{attrs:{percentage:e.dataForm.progress||0}})],1),e._v(" "),a("div",{staticClass:"info-item"},[a("label",[e._v("å½“å‰çŠ¶æ€ï¼š")]),e._v(" "),a("el-tag",{attrs:{type:e.getProcessStatusType(e.dataForm.status)}},[e._v("\n                                            "+e._s(e.getProcessStatusText(e.dataForm.status))+"\n                                        ")])],1)])])]),e._v(" "),a("el-tabs",{attrs:{type:"border-card"},model:{value:e.activeTab,callback:function(t){e.activeTab=t},expression:"activeTab"}},[a("el-tab-pane",{attrs:{label:"å·¥åºä¿¡æ¯",name:"process"}},[a("process-step-list",{ref:"processStepList",attrs:{loading:e.listLoading,"flow-data":e.processedFlowChartData}})],1),e._v(" "),a("el-tab-pane",{attrs:{label:"ç‰©æ–™ä¿¡æ¯",name:"material"}},[a("div",{staticClass:"material-info-container"},[a("div",{staticClass:"table-header"},[a("i",{staticClass:"el-icon-box"}),e._v(" "),a("span",[e._v("å·¥è‰ºç‰©æ–™æ¸…å•")])]),e._v(" "),a("el-table",{staticClass:"material-table",attrs:{data:e.processedFlowChartData[0]&&e.processedFlowChartData[0].children?e.processedFlowChartData[0].children.filter((function(e){return"PROCESS_STEP"===e.nodeType})):[],border:"","header-cell-style":{background:"#f5f7fa",color:"#606266",fontWeight:"bold",fontSize:"14px",textAlign:"center",height:"50px"},"cell-style":{textAlign:"center"}}},[a("el-table-column",{attrs:{label:"å·¥åº",width:"300"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",{staticClass:"process-info"},[a("el-tag",{attrs:{size:"medium",type:e.getProcessStatusType(t.row.status)}},[e._v("\n                                                        "+e._s(t.row.processName)+"\n                                                        "),a("el-tag",{attrs:{size:"mini",type:"info"}},[e._v(e._s(t.row.processCode))])],1)],1)]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"å…³è”ç‰©æ–™"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.children&&t.row.children.length?a("el-table",{staticClass:"inner-table",attrs:{data:t.row.children.filter((function(e){return"MATERIAL"===e.nodeType})),border:""}},[a("el-table-column",{attrs:{label:"ç‰©æ–™ç¼–ç ",prop:"materialCode","min-width":"120"}}),e._v(" "),a("el-table-column",{attrs:{label:"ç‰©æ–™åç§°",prop:"materialName","min-width":"150"}}),e._v(" "),a("el-table-column",{attrs:{label:"è§„æ ¼å‹å·",prop:"materialSpec","min-width":"120"}}),e._v(" "),a("el-table-column",{attrs:{label:"æ•°é‡",width:"80"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                                                            "+e._s(t.row.materialQuantity)+" "+e._s(t.row.materialUnit)+"\n                                                        ")]}}],null,!0)}),e._v(" "),a("el-table-column",{attrs:{label:"çŠ¶æ€",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-tag",{attrs:{type:e.getProcessStatusType(t.row.status),size:"small"}},[e._v("\n                                                                "+e._s(e.getProcessStatusText(t.row.status))+"\n                                                            ")])]}}],null,!0)}),e._v(" "),a("el-table-column",{attrs:{label:"æ¡ç ","min-width":"150"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.barcode?a("span",[e._v(e._s(t.row.barcode))]):a("span",{staticClass:"no-barcode"},[e._v("-")])]}}],null,!0)}),e._v(" "),a("el-table-column",{attrs:{label:"ç±»å‹",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.isComponent?a("el-tag",{attrs:{type:"warning",size:"mini"}},[e._v("ç»„ä»¶")]):e._e(),e._v(" "),t.row.isKeyMaterial?a("el-tag",{attrs:{type:"danger",size:"mini"}},[e._v("å…³é”®")]):e._e(),e._v(" "),t.row.isComponent||t.row.isKeyMaterial?e._e():a("span",[e._v("-")])]}}],null,!0)})],1):a("div",{staticClass:"no-material"},[e._v("æš‚æ— å…³è”ç‰©æ–™")])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"æ“ä½œ",width:"120",fixed:"right"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"text",size:"small"},on:{click:function(a){return e.handleUnbind(t.row)}}},[e._v("è§£ç»‘")])]}}])})],1)],1)]),e._v(" "),a("el-tab-pane",{attrs:{label:"ç‰©æ–™æ¡ç ä¿¡æ¯",name:"materialBarcode"}},[a("el-table",{attrs:{data:e.processedMaterialBarcodeData,border:"","header-cell-style":{background:"#f5f7fa",color:"#606266",fontWeight:"bold",textAlign:"center"},"cell-style":{textAlign:"center"}}},[a("el-table-column",{attrs:{label:"æ¡ç ",prop:"barcode","min-width":"150"}}),e._v(" "),a("el-table-column",{attrs:{label:"ç‰©æ–™ç¼–ç ",prop:"materialCode","min-width":"120"}}),e._v(" "),a("el-table-column",{attrs:{label:"ç‰©æ–™åç§°",prop:"materialName","min-width":"150"}}),e._v(" "),a("el-table-column",{attrs:{label:"è§„æ ¼å‹å·",prop:"materialSpec","min-width":"120"}}),e._v(" "),a("el-table-column",{attrs:{label:"çŠ¶æ€",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-tag",{attrs:{type:e.getProcessStatusType(t.row.status)}},[e._v("\n                                                "+e._s(e.getProcessStatusText(t.row.status))+"\n                                            ")])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"æ‰€å±å·¥åº","min-width":"120"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-tag",{attrs:{size:"medium",type:"info"}},[e._v("\n                                                "+e._s(t.row.processName)+"\n                                                "),t.row.processCode?a("el-tag",{attrs:{size:"mini",type:"info"}},[e._v("\n                                                    "+e._s(t.row.processCode)+"\n                                                ")]):e._e()],1)]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"æ‰«ç æ—¶é—´",width:"160"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                                            "+e._s(e.formatDate(t.row.scanTime))+"\n                                        ")]}}])})],1)],1),e._v(" "),a("el-tab-pane",{attrs:{label:"æ£€æµ‹ä¿¡æ¯",name:"inspection"}},[a("inspection-list",{attrs:{inspections:e.dataForm}})],1),e._v(" "),a("el-tab-pane",{attrs:{label:"è§£ç»‘ä¿¡æ¯",name:"unbind"}},[a("el-table",{attrs:{data:e.unbindRecord||[],border:"","header-cell-style":{background:"#f5f7fa",color:"#606266",fontWeight:"bold",textAlign:"center"},"cell-style":{textAlign:"center"}}},[a("el-table-column",{attrs:{label:"è§£ç»‘æ—¶é—´",width:"160"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                                            "+e._s(e.formatDate(t.row.operateTime))+"\n                                        ")]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"å·¥åºä¿¡æ¯","min-width":"150"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-tag",{attrs:{size:"medium",type:"info"}},[e._v("\n                                                "+e._s(t.row.processName)+"\n                                                "),t.row.processCode?a("el-tag",{attrs:{size:"mini",type:"info"}},[e._v("\n                                                    "+e._s(t.row.processCode)+"\n                                                ")]):e._e()],1)]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"è§£ç»‘ç‰©æ–™","min-width":"200"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.unbindMaterials&&t.row.unbindMaterials.length?a("el-table",{staticClass:"inner-table",attrs:{data:t.row.unbindMaterials,border:"",size:"mini"}},[a("el-table-column",{attrs:{label:"ç‰©æ–™ç¼–ç ",prop:"materialCode","min-width":"120"}}),e._v(" "),a("el-table-column",{attrs:{label:"ç‰©æ–™åç§°",prop:"materialName","min-width":"150"}}),e._v(" "),a("el-table-column",{attrs:{label:"åŸæ¡ç ",prop:"originalBarcode","min-width":"150"}})],1):a("span",[e._v("-")])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"è§£ç»‘åŸå› ","min-width":"150"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.reason?a("el-tooltip",{attrs:{content:t.row.reason,placement:"top"}},[a("span",[e._v(e._s(t.row.reason))])]):a("span",[e._v("-")])]}}])})],1)],1)],1)],1)])],1)])]),e._v(" "),a("el-dialog",{attrs:{title:"æ¡ç æŸ¥è¯¢",visible:e.barcodeSearchVisible,width:"70%","close-on-click-modal":!1},on:{"update:visible":function(t){e.barcodeSearchVisible=t}}},[a("div",{staticClass:"barcode-search-container"},[a("div",{staticClass:"search-area"},[a("el-input",{attrs:{placeholder:"è¯·è¾“å…¥æ¡ç ",clearable:""},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleBarcodeSearch(t)}},model:{value:e.searchBarcode,callback:function(t){e.searchBarcode=t},expression:"searchBarcode"}},[a("el-button",{attrs:{slot:"append",icon:"el-icon-search"},on:{click:e.handleBarcodeSearch},slot:"append"},[e._v("\n                        æœç´¢\n                    ")])],1)],1),e._v(" "),a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.searchLoading,expression:"searchLoading"}],staticClass:"search-result"},[e.searchResults.length?a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.searchResults,border:"","header-cell-style":{background:"#f5f7fa",color:"#606266",fontWeight:"bold",textAlign:"center"},"cell-style":{textAlign:"center"}}},[a("el-table-column",{attrs:{label:"æ¡ç ",prop:"barcode","min-width":"150"}}),e._v(" "),a("el-table-column",{attrs:{label:"ç‰©æ–™ä¿¡æ¯","min-width":"200"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",[e._v("ç¼–ç ï¼š"+e._s(t.row.materialCode))]),e._v(" "),a("div",[e._v("åç§°ï¼š"+e._s(t.row.materialName))]),e._v(" "),a("div",[e._v("è§„æ ¼ï¼š"+e._s(t.row.materialSpec))])]}}],null,!1,2839144854)}),e._v(" "),a("el-table-column",{attrs:{label:"çŠ¶æ€",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-tag",{attrs:{type:e.getProcessStatusType(t.row.status)}},[e._v("\n                                "+e._s(e.getProcessStatusText(t.row.status))+"\n                            ")])]}}],null,!1,363000109)}),e._v(" "),a("el-table-column",{attrs:{label:"å®Œæˆè¿›åº¦",width:"200"},scopedSlots:e._u([{key:"default",fn:function(e){return[a("el-progress",{attrs:{percentage:e.row.progress||0}})]}}],null,!1,3194896933)}),e._v(" "),a("el-table-column",{attrs:{label:"æ“ä½œ",width:"120",fixed:"right"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"text"},on:{click:function(a){return e.handleView(t.row)}}},[e._v("\n                                æŸ¥çœ‹è¯¦æƒ…\n                            ")]),e._v(" "),a("el-button",{staticStyle:{color:"red"},attrs:{type:"text"},on:{click:function(a){return e.handleInit(t.row)}}},[e._v("æˆå“åˆå§‹åŒ–")])]}}],null,!1,3659207568)})],1):e.searchLoading?e._e():a("div",{staticClass:"no-result"},[a("i",{staticClass:"el-icon-warning-outline"}),e._v(" "),a("span",[e._v("æš‚æ— æœç´¢ç»“æœ")])])],1)])]),e._v(" "),a("el-dialog",{attrs:{title:"å¯¼å‡ºé€‰é¡¹",visible:e.exportDialogVisible,width:"400px","close-on-click-modal":!1},on:{"update:visible":function(t){e.exportDialogVisible=t}}},[a("el-form",{attrs:{model:e.exportForm,"label-width":"0px"}},[a("el-form-item",[a("el-radio-group",{staticStyle:{width:"100%",height:"100%","align-items":"center",display:"flex","flex-wrap":"wrap","justify-content":"space-around"},model:{value:e.exportForm.exportOption,callback:function(t){e.$set(e.exportForm,"exportOption",t)},expression:"exportForm.exportOption"}},[a("el-radio-button",{attrs:{border:"",label:"search",value:"search"}}),e._v(" "),a("el-radio-button",{attrs:{border:"",label:"all",value:"all"}})],1)],1)],1),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.exportDialogVisible=!1}}},[e._v("å– æ¶ˆ")]),e._v(" "),a("el-button",{attrs:{type:"primary",loading:e.exportLoading},on:{click:e.confirmExport}},[e._v("\n                ç¡® å®š\n            ")])],1)],1)],1)}),[],!1,null,"43cceb63",null));t.default=L.exports}}]);