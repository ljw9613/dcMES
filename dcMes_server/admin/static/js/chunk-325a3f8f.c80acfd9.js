(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-325a3f8f"],{3640:function(e,t,a){"use strict";a("a0c7")},8996:function(e,t,a){"use strict";a.r(t);var r=a("3835"),s=(a("6b54"),a("a481"),a("f576"),a("8615"),a("6762"),a("2fdb"),a("456d"),a("ac6a"),a("c7eb")),n=(a("96cf"),a("1da1")),c=a("7e1e"),o=a("b810"),l={name:"ProductionOrder",dicts:["product_type"],data:function(){return{searchForm:{FBillNo:"",FDocumentStatus:"",FMaterialId:"",FMaterialName:"",FWorkShopID_FName:"",FProductType:"",dateRange:[]},tableList:[],total:0,currentPage:1,pageSize:10,listLoading:!0,showAdvanced:!1,dialogFormVisible:!1,dialogStatus:"",detailDialogVisible:!1,selection:[],dataForm:{FBillNo:"",FDocumentStatus:"",FDate:"",FWorkShopID_FName:"",FMaterialId:"",FMaterialName:"",FSpecification:"",FProductType:"",FUnitId:"",FQty:0,FPlanStartDate:"",FPlanFinishDate:""},syncProgressTimer:null,syncDialogVisible:!1,syncForm:{syncType:"date",dateRange:[],documentStatus:"C"}}},methods:{getStatusType:function(e){return{DRAFT:"info",APPROVED:"success",PROCESSING:"warning"}[e]||"info"},getStatusText:function(e){return{DRAFT:"草稿",APPROVED:"已审核",PROCESSING:"审核中"}[e]||e},searchData:function(){var e={query:{$and:[]}};return this.searchForm.FBillNo&&e.query.$and.push({FBillNo:{$regex:this.searchForm.FBillNo,$options:"i"}}),this.searchForm.FDocumentStatus&&e.query.$and.push({FDocumentStatus:this.searchForm.FDocumentStatus}),this.searchForm.FMaterialId&&e.query.$and.push({FMaterialId:{$regex:this.searchForm.FMaterialId,$options:"i"}}),this.searchForm.FMaterialName&&e.query.$and.push({FMaterialName:{$regex:this.searchForm.FMaterialName,$options:"i"}}),this.searchForm.FWorkShopID_FName&&e.query.$and.push({FWorkShopID_FName:{$regex:this.searchForm.FWorkShopID_FName,$options:"i"}}),this.searchForm.FProductType&&e.query.$and.push({FProductType:this.searchForm.FProductType}),this.searchForm.dateRange&&2===this.searchForm.dateRange.length&&e.query.$and.push({FPlanStartDate:{$gte:new Date(this.searchForm.dateRange[0]),$lte:new Date(this.searchForm.dateRange[1])}}),e.query.$and.length||delete e.query.$and,e},resetForm:function(){this.$refs.searchForm.resetFields(),this.searchForm={FBillNo:"",FDocumentStatus:"",FMaterialId:"",FMaterialName:"",FWorkShopID_FName:"",FProductType:"",dateRange:[]},this.currentPage=1,this.fetchData()},fetchData:function(){var e=Object(n.a)(Object(s.a)().mark((function e(){var t,a;return Object(s.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.listLoading=!0,e.prev=1,(t=this.searchData()).page=this.currentPage,t.skip=(this.currentPage-1)*this.pageSize,t.limit=this.pageSize,t.count=!0,e.next=9,Object(c.b)("k3_PRD_MO",t);case 9:a=e.sent,this.tableList=a.data,this.total=a.countnum,e.next=18;break;case 14:e.prev=14,e.t0=e.catch(1),this.$message.error("获取数据失败");case 18:return e.prev=18,this.listLoading=!1,e.finish(18);case 21:case"end":return e.stop()}}),e,this,[[1,14,18,21]])})));return function(){return e.apply(this,arguments)}}(),exportData:function(){var e=Object(n.a)(Object(s.a)().mark((function e(){var t,a,r,n,o,l,i,u,h=this;return Object(s.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,this.$message({message:"正在导出数据,请稍候...",type:"info"}),t=this.$loading({lock:!0,text:"导出中...",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"}),(a=this.searchData()).limit=1e6,e.next=7,Object(c.b)("k3_PRD_MO",a);case 7:if((r=e.sent).data&&0!==r.data.length){e.next=12;break}return this.$message.warning("没有数据可供导出"),t.close(),e.abrupt("return");case 12:n={FBillNo:"单据编号",FDocumentStatus:"单据状态",FDate:"单据日期",FWorkShopID_FName:"生产车间",FMaterialId:"物料编码",FMaterialName:"物料名称",FSpecification:"规格型号",FProductType:"产品类型",FUnitId:"单位",FQty:"数量",FPlanStartDate:"计划开工时间",FPlanFinishDate:"计划完工时间"},o=r.data.map((function(e){var t={};return Object.keys(n).forEach((function(a){a.includes("Date")?t[n[a]]=h.formatDate(e[a]):t[n[a]]=e[a]})),t})),l=XLSX.utils.book_new(),i=XLSX.utils.json_to_sheet(o),u=Object.values(n).map((function(e){return{wch:Math.max(2*e.length,15)}})),i["!cols"]=u,XLSX.utils.book_append_sheet(l,i,"生产订单数据"),XLSX.writeFile(l,"生产订单数据.xlsx"),t.close(),this.$message.success("导出成功"),e.next=28;break;case 24:e.prev=24,e.t0=e.catch(0),this.$message.error("导出失败");case 28:case"end":return e.stop()}}),e,this,[[0,24]])})));return function(){return e.apply(this,arguments)}}(),baseTableHandleCurrentChange:function(e){this.currentPage=e,this.fetchData()},baseTableHandleSizeChange:function(e){this.pageSize=e,this.fetchData()},toggleAdvanced:function(){this.showAdvanced=!this.showAdvanced},formatDate:function(e){if(!e)return"暂无数据";var t=new Date(e);if(isNaN(t.getTime()))return"无效日期";var a=t.getFullYear(),r=String(t.getMonth()+1).padStart(2,"0"),s=String(t.getDate()).padStart(2,"0");return"".concat(a,"-").concat(r,"-").concat(s)},formatNumber:function(e){return e||0===e?e.toString().replace(/\B(?=(\d{3})+(?!\d))/g,","):"0"},search:function(){this.currentPage=1,this.fetchData()},handleSelectionChange:function(e){this.selection=e},handleView:function(e){this.dataForm=JSON.parse(JSON.stringify(e)),this.dialogStatus="view",this.dialogFormVisible=!0},handleEdit:function(e){this.dataForm=JSON.parse(JSON.stringify(e)),this.dialogStatus="edit",this.dialogFormVisible=!0},handleDelete:function(e){var t=this;this.$confirm("确认要删除该生产订单吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(Object(n.a)(Object(s.a)().mark((function a(){return Object(s.a)().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.prev=0,a.next=3,Object(c.c)("k3_PRD_MO",e._id);case 3:t.$message.success("删除成功"),t.fetchData(),a.next=11;break;case 7:a.prev=7,a.t0=a.catch(0),t.$message.error("删除失败");case 11:case"end":return a.stop()}}),a,null,[[0,7]])})))).catch((function(){t.$message.info("已取消删除")}))},handleSubmit:function(){var e=Object(n.a)(Object(s.a)().mark((function e(t){return Object(s.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,"edit"!==this.dialogStatus){e.next=7;break}return e.next=4,Object(c.d)("k3_PRD_MO",t._id,t);case 4:this.$message.success("更新成功"),e.next=10;break;case 7:return e.next=9,Object(c.a)("k3_PRD_MO",t);case 9:this.$message.success("添加成功");case 10:this.dialogFormVisible=!1,this.fetchData(),e.next=18;break;case 14:e.prev=14,e.t0=e.catch(0),this.$message.error("操作失败");case 18:case"end":return e.stop()}}),e,this,[[0,14]])})));return function(t){return e.apply(this,arguments)}}(),handleSync:function(){this.syncDialogVisible=!0,this.syncForm={syncType:"date",dateRange:[],documentStatus:"C"}},confirmSync:function(){var e=Object(n.a)(Object(s.a)().mark((function e(){var t,a,n,c,l,i,u;return Object(s.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("date"!==this.syncForm.syncType||this.syncForm.dateRange&&2===this.syncForm.dateRange.length){e.next=3;break}return this.$message.warning("请选择审核日期范围"),e.abrupt("return");case 3:return e.prev=3,t="all"===this.syncForm.syncType?"确认要同步所有生产订单数据吗？此操作可能需要较长时间":"确认要同步选定日期范围的生产订单数据吗？此操作可能需要一些时间",e.next=7,this.$confirm(t,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});case 7:return a=this.$loading({lock:!0,text:"正在启动同步任务...",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"}),e.prev=8,n={FilterString:[]},"date"===this.syncForm.syncType&&(c=Object(r.a)(this.syncForm.dateRange,2),l=c[0],i=c[1],n.FilterString=[{FieldName:"FDocumentStatus",Compare:"105",Value:this.syncForm.documentStatus,Left:"",Right:"",Logic:0},{FieldName:"FApproveDate",Compare:"88",Value:"".concat(l," 00:00:00"),Left:"",Right:"",Logic:0},{FieldName:"FApproveDate",Compare:"32",Value:"".concat(i," 23:59:59"),Left:"",Right:"",Logic:"0"}]),e.next=13,Object(o.d)(n);case 13:200===(u=e.sent).code?(this.syncDialogVisible=!1,a.close(),u.taskStatus?(this.startSyncProgressCheck(),this.$message.success("同步中：当前".concat(u.taskStatus.processedRecords,"条数据同步完成，耗时").concat(u.taskStatus.elapsedTime,"秒"))):this.$message.success("同步任务已启动")):(a.close(),this.$message.error(u.message||"生产订单同步失败")),e.next=22;break;case 17:e.prev=17,e.t0=e.catch(8),a.close(),this.$message.error("生产订单同步失败: "+e.t0.message);case 22:e.next=27;break;case 24:e.prev=24,e.t1=e.catch(3),"cancel"!==e.t1&&this.$message.error("操作失败");case 27:case"end":return e.stop()}}),e,this,[[3,24],[8,17]])})));return function(){return e.apply(this,arguments)}}(),startSyncProgressCheck:function(){var e=this;this.syncProgressTimer&&clearInterval(this.syncProgressTimer),this.syncProgressTimer=setInterval(Object(n.a)(Object(s.a)().mark((function t(){var a,r;return Object(s.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,Object(o.a)("k3_PRD_MO");case 3:if(200!==(a=t.sent).code){t.next=22;break}if(!(r=a.taskStatus)){t.next=20;break}t.t0=r.status,t.next="running"===t.t0?10:"no_task"===t.t0?12:16;break;case 10:return e.$notify({type:"info",message:"同步中：当前".concat(r.processedRecords,"条数据同步完成，耗时").concat(r.elapsedTime,"秒"),duration:5e3}),t.abrupt("break",18);case 12:return e.$message.success("同步完成！"),e.stopSyncProgressCheck(),e.fetchData(),t.abrupt("break",18);case 16:e.$message.warning("未知的同步状态"),e.stopSyncProgressCheck();case 18:t.next=22;break;case 20:e.$message.warning("未找到生产订单同步任务"),e.stopSyncProgressCheck();case 22:t.next=29;break;case 24:t.prev=24,t.t1=t.catch(0),e.$message.error("查询同步进度失败"),e.stopSyncProgressCheck();case 29:case"end":return t.stop()}}),t,null,[[0,24]])}))),1e4)},stopSyncProgressCheck:function(){this.syncProgressTimer&&(clearInterval(this.syncProgressTimer),this.syncProgressTimer=null)},beforeDestroy:function(){this.stopSyncProgressCheck()}},created:function(){this.fetchData()}},i=l,u=(a("3640"),a("2877")),h=Object(u.a)(i,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"app-container"},[a("el-card",{staticClass:"filter-container"},[a("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[a("span",[e._v("筛选搜索")]),e._v(" "),a("el-button",{staticStyle:{float:"right",padding:"3px 0"},attrs:{type:"text"},on:{click:e.toggleAdvanced}},[e._v("\n                "+e._s(e.showAdvanced?"收起":"展开")+"高级搜索\n            ")])],1),e._v(" "),a("el-form",{ref:"searchForm",staticClass:"demo-form-inline",attrs:{model:e.searchForm}},[a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:6}},[a("el-form-item",{attrs:{label:"单据编号"}},[a("el-input",{attrs:{placeholder:"请输入单据编号",clearable:""},model:{value:e.searchForm.FBillNo,callback:function(t){e.$set(e.searchForm,"FBillNo",t)},expression:"searchForm.FBillNo"}})],1)],1),e._v(" "),a("el-col",{attrs:{span:6}},[a("el-form-item",{attrs:{label:"单据状态"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择单据状态",clearable:""},model:{value:e.searchForm.FDocumentStatus,callback:function(t){e.$set(e.searchForm,"FDocumentStatus",t)},expression:"searchForm.FDocumentStatus"}},[a("el-option",{attrs:{label:"草稿",value:"DRAFT"}}),e._v(" "),a("el-option",{attrs:{label:"已审核",value:"APPROVED"}}),e._v(" "),a("el-option",{attrs:{label:"审核中",value:"PROCESSING"}})],1)],1)],1),e._v(" "),a("el-col",{attrs:{span:6}},[a("el-form-item",{attrs:{label:"物料编码"}},[a("el-input",{attrs:{placeholder:"请输入物料编码",clearable:""},model:{value:e.searchForm.FMaterialId,callback:function(t){e.$set(e.searchForm,"FMaterialId",t)},expression:"searchForm.FMaterialId"}})],1)],1),e._v(" "),a("el-col",{attrs:{span:6}},[a("el-form-item",{attrs:{label:"物料名称"}},[a("el-input",{attrs:{placeholder:"请输入物料名称",clearable:""},model:{value:e.searchForm.FMaterialName,callback:function(t){e.$set(e.searchForm,"FMaterialName",t)},expression:"searchForm.FMaterialName"}})],1)],1)],1),e._v(" "),a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:6}},[a("el-form-item",{attrs:{label:"生产车间"}},[a("el-input",{attrs:{placeholder:"请输入生产车间",clearable:""},model:{value:e.searchForm.FWorkShopID_FName,callback:function(t){e.$set(e.searchForm,"FWorkShopID_FName",t)},expression:"searchForm.FWorkShopID_FName"}})],1)],1),e._v(" "),a("el-col",{attrs:{span:6}},[a("el-form-item",{attrs:{label:"产品类型"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择产品类型",clearable:""},model:{value:e.searchForm.FProductType,callback:function(t){e.$set(e.searchForm,"FProductType",t)},expression:"searchForm.FProductType"}},e._l(e.dict.type.product_type,(function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)],1),e._v(" "),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"计划日期"}},[a("el-date-picker",{staticStyle:{width:"100%"},attrs:{type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","value-format":"yyyy-MM-dd"},model:{value:e.searchForm.dateRange,callback:function(t){e.$set(e.searchForm,"dateRange",t)},expression:"searchForm.dateRange"}})],1)],1)],1),e._v(" "),a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:e.search}},[e._v("查询搜索")]),e._v(" "),a("el-button",{on:{click:e.resetForm}},[e._v("重置")]),e._v(" "),a("el-button",{attrs:{type:"success"},on:{click:e.exportData}},[e._v("导出数据")]),e._v(" "),a("el-button",{attrs:{type:"warning"},on:{click:e.handleSync}},[e._v("同步订单")])],1)],1)],1),e._v(" "),e._m(0),e._v(" "),a("base-table",{ref:"baseTable",attrs:{currentPage:e.currentPage,"highlight-current-row":!0,pageSize:e.pageSize,tableData:e.tableList,tableDataloading:e.listLoading,total:e.total},on:{"selection-change":e.handleSelectionChange,handleCurrentChange:e.baseTableHandleCurrentChange,handleSizeChange:e.baseTableHandleSizeChange}},[a("template",{slot:"law"},[a("el-table-column",{attrs:{label:"单据编号",width:"150"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-link",{attrs:{type:"primary"},on:{click:function(a){return e.handleView(t.row)}}},[e._v(e._s(t.row.FBillNo))])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"单据状态",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-tag",{attrs:{type:e.getStatusType(t.row.FDocumentStatus)}},[e._v("\n                        "+e._s(e.getStatusText(t.row.FDocumentStatus))+"\n                    ")])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"单据日期",width:"120"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                    "+e._s(e.formatDate(t.row.FDate))+"\n                ")]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"生产车间",width:"120"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                    "+e._s(t.row.FWorkShopID_FName)+"\n                ")]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"物料编码",width:"120"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                    "+e._s(t.row.FMaterialId)+"\n                ")]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"物料名称",width:"200"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                    "+e._s(t.row.FMaterialName)+"\n                ")]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"规格型号",width:"150"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                    "+e._s(t.row.FSpecification)+"\n                ")]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"产品类型",width:"120"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                    "+e._s(t.row.FProductType)+"\n                ")]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"单位",width:"80"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                    "+e._s(t.row.FUnitId)+"\n                ")]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"数量",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                    "+e._s(t.row.FQty)+"\n                ")]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"计划开工时间",width:"150"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                    "+e._s(e.formatDate(t.row.FPlanStartDate))+"\n                ")]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"计划完工时间",width:"150"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                    "+e._s(e.formatDate(t.row.FPlanFinishDate))+"\n                ")]}}])})],1)],2),e._v(" "),a("el-dialog",{attrs:{title:"同步生产订单",visible:e.syncDialogVisible,width:"500px"},on:{"update:visible":function(t){e.syncDialogVisible=t}}},[a("el-form",{ref:"syncForm",attrs:{model:e.syncForm,"label-width":"100px"}},[a("el-form-item",{attrs:{label:"同步方式"}},[a("el-radio-group",{model:{value:e.syncForm.syncType,callback:function(t){e.$set(e.syncForm,"syncType",t)},expression:"syncForm.syncType"}},[a("el-radio",{attrs:{label:"date"}},[e._v("按日期同步")]),e._v(" "),a("el-radio",{attrs:{label:"all"}},[e._v("同步全部")])],1)],1),e._v(" "),"date"===e.syncForm.syncType?a("el-form-item",{attrs:{label:"审核日期",required:""}},[a("el-date-picker",{staticStyle:{width:"100%"},attrs:{type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","value-format":"yyyy-MM-dd"},model:{value:e.syncForm.dateRange,callback:function(t){e.$set(e.syncForm,"dateRange",t)},expression:"syncForm.dateRange"}})],1):e._e(),e._v(" "),a("el-form-item",{attrs:{label:"单据状态"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{disabled:"all"===e.syncForm.syncType,placeholder:"请选择单据状态"},model:{value:e.syncForm.documentStatus,callback:function(t){e.$set(e.syncForm,"documentStatus",t)},expression:"syncForm.documentStatus"}},[a("el-option",{attrs:{label:"已审核",value:"C"}}),e._v(" "),a("el-option",{attrs:{label:"审核中",value:"B"}}),e._v(" "),a("el-option",{attrs:{label:"草稿",value:"A"}})],1)],1)],1),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.syncDialogVisible=!1}}},[e._v("取 消")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:e.confirmSync}},[e._v("确 定")])],1)],1)],1)}),[function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"screen1"},[a("div",{staticClass:"screen_content"},[a("div",{staticClass:"screen_content_first"},[a("i",{staticClass:"el-icon-tickets"},[e._v("生产管理列表")])])])])}],!1,null,"9a66ce1c",null);t.default=h.exports},a0c7:function(e,t,a){}}]);