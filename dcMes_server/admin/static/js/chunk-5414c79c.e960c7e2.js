(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-5414c79c"],{"0934":function(e,t,n){},"1efa":function(e,t,n){"use strict";n("0934")},5:function(e,t){},"9ed6":function(e,t,n){"use strict";n.r(t);var r=(n("ac6a"),n("456d"),n("c7eb")),s=(n("96cf"),n("1da1")),o=(n("6b54"),n("61f7")),a=n("3452"),i=n.n(a),c={name:"Login",directives:{focus:{inserted:function(e){e.querySelector("input").focus()}}},watch:{$route:{handler:function(e){var t=e.query;t&&(this.redirect=t.redirect,this.otherQuery=this.getOtherQuery(t))},immediate:!0},loginType:function(e){var t=this;"qrcode"===e&&this.$nextTick((function(){t.focusScanInput()}))}},data:function(){return{title:"德昌MES系统",loginForm:{userName:"",password:"",encryptedId:""},loginRules:{userName:[{required:!0,trigger:"blur",validator:function(e,t,n){""==t?n(new Error("用户名不能为空")):n()}}],password:[{required:!0,trigger:"blur",validator:function(e,t,n){Object(o.b)(t)?n():n(new Error("密码不能少于6位"))}}]},accountLoading:!1,qrcodeLoading:!1,passwordType:"password",redirect:void 0,loginType:"account",encryptionKey:"your-secure-encryption-key",inputLoading:!1,scanTimer:null,scanBuffer:""}},created:function(){},methods:{showPwd:function(){var e=this;"password"===this.passwordType?this.passwordType="":this.passwordType="password",this.$nextTick((function(){e.$refs.password.focus()}))},decryptId:function(e){try{return i.a.AES.decrypt(e,"your-secret-key").toString(i.a.enc.Utf8)}catch(e){return console.error("解密失败:",e),null}},decryptLoginData:function(e){try{var t=i.a.AES.decrypt(e,this.encryptionKey);return JSON.parse(t.toString(i.a.enc.Utf8))}catch(e){return console.error("解密失败:",e),null}},handleAccountLogin:function(){var e=Object(s.a)(Object(r.a)().mark((function e(){var t=this;return Object(r.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.$refs.loginForm.validate(function(){var e=Object(s.a)(Object(r.a)().mark((function e(n){var s;return Object(r.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!n){e.next=17;break}return e.prev=1,t.accountLoading=!0,s={userName:(t.loginForm.userName||"").trim(),password:(t.loginForm.password||"").trim()},e.next=6,t.$store.dispatch("user/login",s);case 6:e.sent,t.$router.push("/"),e.next=14;break;case 10:e.prev=10,e.t0=e.catch(1),console.error("登录失败:",e.t0&&e.t0.message||"未知错误"),t.$message.error(e.t0&&e.t0.message||"登录失败，请重试");case 14:return e.prev=14,t.accountLoading=!1,e.finish(14);case 17:case"end":return e.stop()}}),e,null,[[1,10,14,17]])})));return function(t){return e.apply(this,arguments)}}());case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),handleQrcodeLogin:function(){var e=Object(s.a)(Object(r.a)().mark((function e(){var t,n,s;return Object(r.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.qrcodeLoading){e.next=2;break}return e.abrupt("return");case 2:if(e.prev=2,this.qrcodeLoading=!0,t=this.loginForm.encryptedId){e.next=8;break}return this.$message.error("请扫描二维码"),e.abrupt("return");case 8:if(n=this.decryptLoginData(t)){e.next=12;break}return this.$message.error("二维码无效或已过期"),e.abrupt("return");case 12:return s={userName:n.userName,password:n.password,id:n.id},e.next=15,this.$store.dispatch("user/login",s);case 15:e.sent,this.$router.push("/");case 17:return e.prev=17,this.qrcodeLoading=!1,this.loginForm.encryptedId="",this.focusScanInput(),e.finish(17);case 22:case"end":return e.stop()}}),e,this,[[2,,17,22]])})));return function(){return e.apply(this,arguments)}}(),getOtherQuery:function(e){return Object.keys(e).reduce((function(t,n){return"redirect"!==n&&(t[n]=e[n]),t}),{})},focusScanInput:function(){"qrcode"===this.loginType&&this.$refs.scanInput&&this.$refs.scanInput.focus()},handleScanInput:function(e){var t=this;console.log("handleScanInput",e),"qrcode"===this.loginType&&(this.scanBuffer=e,this.inputLoading=this.$loading({lock:!0,text:"Loading",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"}),this.scanTimer&&clearTimeout(this.scanTimer),this.scanTimer=setTimeout((function(){t.scanBuffer&&(t.loginForm.encryptedId=t.scanBuffer.trim(),t.handleQrcodeLogin()),t.inputLoading.close(),t.scanBuffer=""}),1500))},handleScanChange:function(e){}},mounted:function(){"qrcode"===this.loginType&&this.focusScanInput()}},u=c,l=(n("1efa"),n("2877")),p=Object(l.a)(u,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"login-container"},[n("div",{staticClass:"login-logo-bysj"}),e._v(" "),n("el-row",[n("el-col",{attrs:{lg:8,md:24,sm:24,xl:8,xs:24}},[n("el-form",{ref:"loginForm",staticClass:"login-form",attrs:{model:e.loginForm,rules:e.loginRules,"auto-complete":"off","label-position":"left"}},[n("div",{staticClass:"title"},[e._v("\n          hello !\n        ")]),e._v(" "),n("div",{staticClass:"title-tips"},[e._v("欢迎来到"+e._s(e.title)+"！")]),e._v(" "),n("el-tabs",{model:{value:e.loginType,callback:function(t){e.loginType=t},expression:"loginType"}},[n("el-tab-pane",{attrs:{label:"账号密码登录",name:"account"}},[n("el-form-item",{staticClass:"login-form-admin",staticStyle:{"margin-top":"49px"},attrs:{prop:"userName"}},[n("span",{staticClass:"svg-container svg-container-admin"},[n("byui-icon",{attrs:{icon:["fas","user"]}})],1),e._v(" "),n("el-input",{directives:[{name:"focus",rawName:"v-focus"}],attrs:{"auto-complete":"off",placeholder:"请输入用户名",tabindex:"1",type:"text"},on:{input:function(t){return e.loginForm.userName=t?t.trim():""}},model:{value:e.loginForm.userName,callback:function(t){e.$set(e.loginForm,"userName",t)},expression:"loginForm.userName"}})],1),e._v(" "),n("el-form-item",{staticClass:"login-form-pass",attrs:{prop:"password"}},[n("span",{staticClass:"svg-container svg-container-pass"},[n("byui-icon",{attrs:{icon:["fas","lock"]}})],1),e._v(" "),n("el-input",{key:e.passwordType,ref:"password",attrs:{type:e.passwordType,"auto-complete":"on",placeholder:"请输入密码",tabindex:"2"},on:{input:function(t){return e.loginForm.password=t?t.trim():""}},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleLogin(t)}},model:{value:e.loginForm.password,callback:function(t){e.$set(e.loginForm,"password",t)},expression:"loginForm.password"}}),e._v(" "),"password"===e.passwordType?n("span",{staticClass:"show-pwd",on:{click:e.showPwd}},[n("byui-icon",{attrs:{icon:["fas","eye-slash"]}})],1):n("span",{staticClass:"show-pwd",on:{click:e.showPwd}},[n("byui-icon",{attrs:{icon:["fas","eye"]}})],1)],1),e._v(" "),n("el-button",{staticClass:"login-btn",attrs:{loading:e.accountLoading,type:"primary"},nativeOn:{click:function(t){return t.preventDefault(),e.handleAccountLogin(t)}}},[e._v("\n              账号登录\n            ")])],1),e._v(" "),n("el-tab-pane",{attrs:{label:"扫码登录",name:"qrcode"}},[n("el-form-item",{attrs:{prop:"encryptedId"}},[n("span",{staticClass:"svg-container"},[n("byui-icon",{attrs:{icon:["fas","qrcode"]}})],1),e._v(" "),n("el-input",{ref:"scanInput",attrs:{placeholder:"请使用扫描枪扫描二维码",disabled:e.inputLoading},on:{input:e.handleScanInput,change:e.handleScanChange},model:{value:e.loginForm.encryptedId,callback:function(t){e.$set(e.loginForm,"encryptedId",t)},expression:"loginForm.encryptedId"}},[n("template",{slot:"append"},[e.inputLoading?n("i",{staticClass:"el-icon-loading"}):e._e()])],2)],1)],1)],1)],1)],1)],1)],1)}),[],!1,null,"02936cba",null);t.default=p.exports}}]);