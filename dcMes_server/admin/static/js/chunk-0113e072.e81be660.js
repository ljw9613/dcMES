(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-0113e072","chunk-2d0b9b83"],{"22a8":function(e,t,a){"use strict";a.d(t,"a",(function(){return n})),a.d(t,"c",(function(){return o})),a.d(t,"b",(function(){return s}));var r=a("b775");function n(e){return Object(r.a)({url:"/handlePalletBarcode",method:"post",data:e})}function o(e){return Object(r.a)({url:"/unbindPalletBarcode",method:"post",data:e})}function s(e){return Object(r.a)({url:"/unbindPalletAllBarcode",method:"post",data:e})}},"33c0":function(e,t,a){"use strict";a.r(t);var r=a("c7eb"),n=(a("96cf"),a("1da1")),o=a("5530"),s={name:"EditDialog",props:{visible:{type:Boolean,default:!1},dialogStatus:{type:String,default:"create"},rowData:{type:Object,default:function(){return{}}}},data:function(){return{dialogVisible:this.visible,form:{machineName:"",machineCode:"",machineIp:"",principal:"",comment:""},rules:{machineName:[{required:!0,message:"请输入设备名称",trigger:"blur"}],machineCode:[{required:!0,message:"请输入设备编号",trigger:"blur"}],machineIp:[{required:!0,message:"请输入设备IP",trigger:"blur"}],principal:[{required:!0,message:"请输入负责人",trigger:"blur"}]},submitLoading:!1}},computed:{dialogTitle:function(){return"create"===this.dialogStatus?"新增设备信息":"编辑设备信息"}},watch:{visible:function(e){this.dialogVisible=e,e&&this.initFormData()},rowData:{handler:function(e){e&&this.dialogVisible&&this.initFormData()},deep:!0}},methods:{initFormData:function(){"edit"===this.dialogStatus?this.form=Object(o.a)({},this.rowData):this.form={machineName:"",machineCode:"",machineIp:"",principal:"",comment:""}},handleClose:function(){this.$emit("update:visible",!1),this.$refs.form&&this.$refs.form.resetFields()},handleSubmit:function(){var e=this;this.$refs.form.validate(function(){var t=Object(n.a)(Object(r.a)().mark((function t(a){var n;return Object(r.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(a){e.submitLoading=!0;try{n=Object(o.a)({},e.form),e.$emit("submit",n),e.handleClose()}catch(t){console.error("提交失败:",t),e.$message.error("提交失败")}finally{e.submitLoading=!1}}case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())}}},i=s,l=a("2877"),c=Object(l.a)(i,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{attrs:{title:e.dialogTitle,visible:e.dialogVisible,width:"60%"},on:{close:e.handleClose,"update:visible":function(t){return e.$emit("update:visible",t)}}},[a("el-form",{ref:"form",attrs:{model:e.form,rules:e.rules,"label-width":"120px",size:"small"}},[a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"设备名称",prop:"machineName"}},[a("el-input",{attrs:{placeholder:"请输入设备名称"},model:{value:e.form.machineName,callback:function(t){e.$set(e.form,"machineName",t)},expression:"form.machineName"}})],1)],1),e._v(" "),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"设备编号",prop:"machineCode"}},[a("el-input",{attrs:{placeholder:"请输入设备编号",disabled:"edit"===e.dialogStatus},model:{value:e.form.machineCode,callback:function(t){e.$set(e.form,"machineCode",t)},expression:"form.machineCode"}})],1)],1)],1),e._v(" "),a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"设备IP",prop:"machineIp"}},[a("el-input",{attrs:{placeholder:"请输入设备IP"},model:{value:e.form.machineIp,callback:function(t){e.$set(e.form,"machineIp",t)},expression:"form.machineIp"}})],1)],1),e._v(" "),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"负责人",prop:"principal"}},[a("el-input",{attrs:{placeholder:"请输入负责人"},model:{value:e.form.principal,callback:function(t){e.$set(e.form,"principal",t)},expression:"form.principal"}})],1)],1)],1),e._v(" "),a("el-form-item",{attrs:{label:"备注",prop:"comment"}},[a("el-input",{attrs:{type:"textarea",placeholder:"请输入备注信息"},model:{value:e.form.comment,callback:function(t){e.$set(e.form,"comment",t)},expression:"form.comment"}})],1)],1),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:e.handleClose}},[e._v("取 消")]),e._v(" "),a("el-button",{attrs:{type:"primary",loading:e.submitLoading},on:{click:e.handleSubmit}},[e._v("确 定")])],1)],1)}),[],!1,null,null,null);t.default=c.exports},3835:function(e,t,a){"use strict";var r=a("06c5");function n(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var a=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=a){var r,n,o,s,i=[],l=!0,c=!1;try{if(o=(a=a.call(e)).next,0===t){if(Object(a)!==a)return;l=!1}else for(;!(l=(r=o.call(a)).done)&&(i.push(r.value),i.length!==t);l=!0);}catch(e){c=!0,n=e}finally{try{if(!l&&null!=a.return&&(s=a.return(),Object(s)!==s))return}finally{if(c)throw n}}return i}}(e,t)||Object(r.a)(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}a.d(t,"a",(function(){return n}))},"6eb0":function(e,t,a){},a217:function(e,t,a){"use strict";a.r(t);var r=a("2909"),n=(a("f576"),a("c7eb")),o=(a("96cf"),a("1da1")),s=a("3835"),i=(a("ac6a"),a("456d"),a("53ca")),l=a("7e1e"),c=a("22a8"),u=a("33c0"),d=a("aad8"),p={name:"MaterialPalletizing",components:{EditDialog:u.default,HirInput:d.a},data:function(){return{searchForm:{palletCode:"",saleOrderNo:"",productionOrderNo:"",workOrderNo:"",productLineId:"",status:"",dateRange:[]},tableList:[],total:0,currentPage:1,pageSize:10,listLoading:!0,dialogFormVisible:!1,dialogStatus:"",selection:[],dataForm:{},historyDialogVisible:!1,historyCurrentPage:1,historyPageSize:10,historyTableList:[],historyListLoading:!0,historyTotal:0,exportLoading:!1,exportProgress:0,exportDialogVisible:!1,printDialogVisible:!1,printData:{},printTemplate:null}},computed:{localPrintTemplate:{get:function(){try{var e=localStorage.getItem("printTemplate_materialPalletizing");return e?JSON.parse(e):null}catch(e){return console.error("解析缓存模板失败:",e),null}},set:function(e){try{localStorage.setItem("printTemplate_materialPalletizing",JSON.stringify(e))}catch(e){console.error("保存模板到缓存失败:",e)}}}},methods:{inspectionDataHandle:function(e){var t=[];for(var a in inspectionFieldEnum)"error"!==a&&!this.isBlank(e[a])&&t.push("".concat(inspectionFieldEnum[a],"：").concat(e[a]));return t},isBlank:function(e){return null==e||""===e||Array.isArray(e)&&0===e.length||"object"===Object(i.a)(e)&&0===Object.keys(e).length},searchData:function(){var e={query:{$and:[]}};if(this.searchForm.palletCode&&e.query.$and.push({palletCode:{$regex:this.escapeRegex(this.searchForm.palletCode),$options:"i"}}),this.searchForm.saleOrderNo&&e.query.$and.push({saleOrderNo:{$regex:this.escapeRegex(this.searchForm.saleOrderNo),$options:"i"}}),this.searchForm.productionOrderNo&&e.query.$and.push({productionOrderNo:{$regex:this.escapeRegex(this.searchForm.productionOrderNo),$options:"i"}}),this.searchForm.workOrderNo&&e.query.$and.push({workOrderNo:{$regex:this.escapeRegex(this.searchForm.workOrderNo),$options:"i"}}),this.searchForm.productLineId&&e.query.$and.push({productLineId:this.searchForm.productLineId}),this.searchForm.status&&e.query.$and.push({status:this.searchForm.status}),this.searchForm.dateRange&&2===this.searchForm.dateRange.length){var t=Object(s.a)(this.searchForm.dateRange,2),a=t[0],r=t[1];e.query.$and.push({createAt:{$gte:new Date(a).toISOString(),$lte:new Date(r+" 23:59:59.999").toISOString()}})}return e.query.$and.length||delete e.query.$and,e},resetForm:function(){this.$refs.searchForm.resetFields(),this.searchForm={palletCode:"",saleOrderNo:"",productionOrderNo:"",workOrderNo:"",productLineId:"",status:"",dateRange:[]},this.currentPage=1,this.fetchData()},fetchData:function(){var e=Object(o.a)(Object(n.a)().mark((function e(){var t,a;return Object(n.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.listLoading=!0,e.prev=1,(t=this.searchData()).page=this.currentPage,t.skip=(this.currentPage-1)*this.pageSize,t.limit=this.pageSize,t.sort={_id:-1},t.populate=JSON.stringify([{path:"productLineId"},{path:"productionOrderId"}]),t.count=!0,e.next=11,Object(l.b)("material_palletizing",t);case 11:a=e.sent,this.tableList=a.data,this.total=a.countnum,e.next=20;break;case 16:e.prev=16,e.t0=e.catch(1),console.error("获取数据失败:",e.t0),this.$message.error("获取数据失败");case 20:return e.prev=20,this.listLoading=!1,e.finish(20);case 23:case"end":return e.stop()}}),e,this,[[1,16,20,23]])})));return function(){return e.apply(this,arguments)}}(),baseTableHandleCurrentChange:function(e){this.currentPage=e,this.fetchData()},baseTableHandleSizeChange:function(e){this.pageSize=e,this.fetchData()},formatDate:function(e){if(!e)return"暂无数据";var t=new Date(e);if(isNaN(t.getTime()))return"无效日期";var a=t.getFullYear(),r=String(t.getMonth()+1).padStart(2,"0"),n=String(t.getDate()).padStart(2,"0"),o=String(t.getHours()).padStart(2,"0"),s=String(t.getMinutes()).padStart(2,"0"),i=String(t.getSeconds()).padStart(2,"0");return"".concat(a,"-").concat(r,"-").concat(n," ").concat(o,":").concat(s,":").concat(i)},search:function(){this.currentPage=1,this.fetchData()},handleSelectionChange:function(e){this.selection=e},handleView:function(e){this.dataForm=JSON.parse(JSON.stringify(e)),this.dialogStatus="view",this.dialogFormVisible=!0},handleEdit:function(e){this.dialogStatus="edit",this.dataForm=JSON.parse(JSON.stringify(e)),this.dialogFormVisible=!0},Delete:function(e){var t=this;this.$confirm("确认要删除该单据吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(Object(o.a)(Object(n.a)().mark((function a(){return Object(n.a)().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,Object(l.c)("material_palletizing",{query:{_id:e._id}});case 2:t.$message.success("删除成功"),t.fetchData();case 4:case"end":return a.stop()}}),a)}))))},handleAllDelete:function(e){var t=this;this.$confirm("确认要初始化该单据吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(Object(o.a)(Object(n.a)().mark((function a(){var r;return Object(n.a)().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.prev=0,a.next=3,Object(c.b)({palletCode:e.palletCode,userId:t.$store.state.user.id});case 3:(r=a.sent).success?(t.$message.success("初始化成功"),t.fetchData()):t.$message.error(r.message),a.next=11;break;case 7:a.prev=7,a.t0=a.catch(0),console.error("初始化失败:",a.t0),t.$message.error("初始化失败");case 11:case"end":return a.stop()}}),a,null,[[0,7]])}))))},handleDelete:function(e,t){var a=this;this.$confirm("确认要解绑该条码吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(Object(o.a)(Object(n.a)().mark((function r(){var o;return Object(n.a)().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,Object(c.c)({palletCode:e,barcode:t,userId:a.$store.state.user.id});case 3:(o=r.sent).success?(a.$message.success("解绑成功"),a.fetchData()):a.$message.error(o.message),r.next=11;break;case 7:r.prev=7,r.t0=r.catch(0),console.error("解绑失败:",r.t0),a.$message.error("解绑失败");case 11:case"end":return r.stop()}}),r,null,[[0,7]])})))).catch((function(){a.$message.info("已取消解绑")}))},handleAdd:function(){this.dialogStatus="create",this.dataForm={},this.dialogFormVisible=!0},handleBatchDelete:function(){var e=this;this.selection.length?this.$confirm("确认删除选中的 ".concat(this.selection.length," 条记录吗？"),"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(Object(o.a)(Object(n.a)().mark((function t(){var a;return Object(n.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,a=e.selection.map((function(e){return e._id})),t.next=4,Object(l.c)("InspectionLastData",{query:{_id:{$in:a}}});case 4:e.$message.success("批量删除成功"),e.fetchData(),t.next=12;break;case 8:t.prev=8,t.t0=t.catch(0),console.error("批量删除失败:",t.t0),e.$message.error("批量删除失败");case 12:case"end":return t.stop()}}),t,null,[[0,8]])})))).catch((function(){})):this.$message.warning("请选择要删除的记录")},handleSubmit:function(){var e=Object(o.a)(Object(n.a)().mark((function e(t){return Object(n.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,"create"!==this.dialogStatus){e.next=7;break}return e.next=4,Object(l.a)("InspectionLastData",t);case 4:this.$message.success("新增成功"),e.next=10;break;case 7:return e.next=9,Object(l.d)("InspectionLastData",{query:{_id:t._id},update:t});case 9:this.$message.success("更新成功");case 10:this.dialogFormVisible=!1,this.fetchData(),e.next=18;break;case 14:e.prev=14,e.t0=e.catch(0),console.error("操作失败:",e.t0),this.$message.error("操作失败");case 18:case"end":return e.stop()}}),e,this,[[0,14]])})));return function(t){return e.apply(this,arguments)}}(),handlePrint:function(e){var t=this,a=e;a.createAt=this.formatDate(e.createAt),a.workshop=e.productionOrderId&&e.productionOrderId.FWorkShopID_FName||"未记录生产车间",a.qrcode="".concat(e.palletCode,"#").concat(e.saleOrderNo,"#").concat(e.materialCode,"#").concat(e.totalQuantity,"#").concat(e.productLineId&&e.productLineId.lineCode||"未记录生产线"),a.palletBarcodes=e.palletBarcodes.map((function(e){return e.scanTime=t.formatDate(e.scanTime),e})),this.printData=a,this.$nextTick((function(){t.$refs.hirInput.handlePrints()}))},showHistory:function(e){this.historyCurrentPage=1,this.dataForm=e,this.fetchHistoryData(e.scanCode),this.historyDialogVisible=!0},getUnbindTypeTag:function(e){return{SINGLE:"info",BOX:"warning",PALLET:"danger"}[e]||"info"},getUnbindTypeText:function(e){return{SINGLE:"单个解绑",BOX:"整箱解绑",PALLET:"整托解绑"}[e]||e},fetchHistoryData:function(){var e=Object(o.a)(Object(n.a)().mark((function e(t){var a,r;return Object(n.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.historyListLoading=!0,e.prev=1,a={query:{palletCode:t},page:this.historyCurrentPage,skip:(this.historyCurrentPage-1)*this.historyPageSize,limit:this.historyPageSize,sort:{createAt:-1},count:!0},e.next=5,Object(l.b)("material_palletizing_unbind_log",a);case 5:r=e.sent,this.historyTableList=r.data,this.historyTotal=r.countnum,e.next=14;break;case 10:e.prev=10,e.t0=e.catch(1),console.error("获取解绑记录失败:",e.t0),this.$message.error("获取解绑记录失败");case 14:return e.prev=14,this.historyListLoading=!1,e.finish(14);case 17:case"end":return e.stop()}}),e,this,[[1,10,14,17]])})));return function(t){return e.apply(this,arguments)}}(),historyTableHandleCurrentChange:function(e){this.historyCurrentPage=e,this.fetchHistoryData(this.dataForm.palletCode)},historyTableHandleSizeChange:function(e){this.historyPageSize=e,this.historyCurrentPage=1,this.fetchHistoryData(this.dataForm.palletCode)},handleExport:function(){var e=Object(o.a)(Object(n.a)().mark((function e(){var t,o,s,i,c,u,d,p,h=this;return Object(n.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.exportLoading=!0,this.exportProgress=0,this.exportDialogVisible=!0,e.prev=3,(t=this.searchData()).populate=JSON.stringify([{path:"machineId"},{path:"processId"}]),e.next=8,Object(l.b)("InspectionLastData",t);case 8:o=e.sent,s=o.data.length,i=[],c=100,u=["扫描码","设备名称","工序名称","检测结果","检测时间","检测详情"],d=0;case 14:if(!(d<s)){e.next=23;break}return p=o.data.slice(d,d+c).map((function(e){return[e.scanCode,e.machineId?e.machineId.machineName:"--",e.processId?e.processId.processName:"--",e.error?"不合格":"合格",h.formatDate(e.createTime),h.inspectionDataHandle(e).join("; ")]})),i.push.apply(i,Object(r.a)(p)),this.exportProgress=Math.round((d+p.length)/s*100),e.next=20,new Promise((function(e){return setTimeout(e,10)}));case 20:d+=c,e.next=14;break;case 23:console.log(i),Promise.all([a.e("chunk-6e83591c"),a.e("chunk-aa6495fe"),a.e("chunk-54c12e41")]).then(a.bind(null,"4bf8d")).then((function(e){e.export_json_to_excel({header:u,data:i,filename:"检测数据"+(new Date).getTime(),autoWidth:!0,bookType:"xlsx"}),h.exportProgress=100,h.$message.success("导出成功")})),setTimeout((function(){h.exportDialogVisible=!1,h.exportProgress=0}),1e3),e.next=33;break;case 28:e.prev=28,e.t0=e.catch(3),console.error("导出失败:",e.t0),this.$message.error("导出失败"),this.exportDialogVisible=!1;case 33:return e.prev=33,this.exportLoading=!1,e.finish(33);case 36:case"end":return e.stop()}}),e,this,[[3,28,33,36]])})));return function(){return e.apply(this,arguments)}}(),handleTemplateChange:function(e){if(e)try{this.printTemplate=e,this.localPrintTemplate=e,this.$message.success("打印模板已保存到本地")}catch(e){console.error("保存打印模板失败:",e),this.$message.error("保存打印模板失败")}}},created:function(){var e=this;this.fetchData();var t=this.localPrintTemplate;t&&this.$nextTick((function(){e.$refs.hirInput&&e.$refs.hirInput.handleTemplateChange(t)}))}},h=p,m=(a("e392"),a("2877")),f=Object(m.a)(h,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"app-container"},[a("el-card",{staticClass:"filter-container"},[a("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[a("span",[e._v("筛选搜索")])]),e._v(" "),a("el-form",{ref:"searchForm",staticClass:"demo-form-inline",attrs:{model:e.searchForm}},[a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:6}},[a("el-form-item",{attrs:{label:"托盘编号"}},[a("el-input",{attrs:{placeholder:"请输入托盘编号",clearable:""},model:{value:e.searchForm.palletCode,callback:function(t){e.$set(e.searchForm,"palletCode",t)},expression:"searchForm.palletCode"}})],1)],1),e._v(" "),a("el-col",{attrs:{span:6}},[a("el-form-item",{attrs:{label:"销售订单号"}},[a("el-input",{attrs:{placeholder:"请输入销售订单号",clearable:""},model:{value:e.searchForm.saleOrderNo,callback:function(t){e.$set(e.searchForm,"saleOrderNo",t)},expression:"searchForm.saleOrderNo"}})],1)],1),e._v(" "),a("el-col",{attrs:{span:6}},[a("el-form-item",{attrs:{label:"生产订单号"}},[a("el-input",{attrs:{placeholder:"请输入生产订单号",clearable:""},model:{value:e.searchForm.productionOrderNo,callback:function(t){e.$set(e.searchForm,"productionOrderNo",t)},expression:"searchForm.productionOrderNo"}})],1)],1),e._v(" "),a("el-col",{attrs:{span:6}},[a("el-form-item",{attrs:{label:"工单号"}},[a("el-input",{attrs:{placeholder:"请输入工单号",clearable:""},model:{value:e.searchForm.workOrderNo,callback:function(t){e.$set(e.searchForm,"workOrderNo",t)},expression:"searchForm.workOrderNo"}})],1)],1)],1),e._v(" "),a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:6}},[a("el-form-item",{attrs:{label:"产线"}},[a("zr-select",{staticStyle:{width:"100%"},attrs:{collection:"production_line","search-fields":["lineCode","lineName"],"label-key":"lineName","tag-key":"lineCode","sub-key":"workshop",multiple:!1,placeholder:"请输入产线信息搜索"},model:{value:e.searchForm.productLineId,callback:function(t){e.$set(e.searchForm,"productLineId",t)},expression:"searchForm.productLineId"}})],1)],1),e._v(" "),a("el-col",{attrs:{span:6}},[a("el-form-item",{attrs:{label:"组托状态"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择状态",clearable:""},model:{value:e.searchForm.status,callback:function(t){e.$set(e.searchForm,"status",t)},expression:"searchForm.status"}},[a("el-option",{attrs:{label:"组托中",value:"STACKING"}}),e._v(" "),a("el-option",{attrs:{label:"组托完成",value:"STACKED"}})],1)],1)],1),e._v(" "),a("el-col",{attrs:{span:6}},[a("el-form-item",{attrs:{label:"创建时间"}},[a("el-date-picker",{staticStyle:{width:"100%"},attrs:{type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","value-format":"yyyy-MM-dd"},model:{value:e.searchForm.dateRange,callback:function(t){e.$set(e.searchForm,"dateRange",t)},expression:"searchForm.dateRange"}})],1)],1)],1),e._v(" "),a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:e.search}},[e._v("查询搜索")]),e._v(" "),a("el-button",{on:{click:e.resetForm}},[e._v("重置")]),e._v(" "),a("el-button",{attrs:{type:"primary",loading:e.exportLoading},on:{click:e.handleExport}},[a("i",{staticClass:"el-icon-download"}),e._v("\n                    "+e._s(e.exportLoading?"正在导出("+e.exportProgress+"%)":"导出数据")+"\n                ")])],1)],1)],1),e._v(" "),a("div",{staticClass:"screen1"},[a("div",{staticClass:"screen_content"},[a("div",{staticClass:"screen_content_first"},[a("i",{staticClass:"el-icon-tickets"},[e._v("托盘组托列表")]),e._v(" "),a("hir-input",{ref:"hirInput",attrs:{printData:e.printData,"default-template":e.localPrintTemplate},on:{"template-change":e.handleTemplateChange}})],1)])]),e._v(" "),a("base-table",{ref:"baseTable",attrs:{currentPage:e.currentPage,"highlight-current-row":!0,pageSize:e.pageSize,tableData:e.tableList,tableDataloading:e.listLoading,total:e.total},on:{"selection-change":e.handleSelectionChange,handleCurrentChange:e.baseTableHandleCurrentChange,handleSizeChange:e.baseTableHandleSizeChange}},[a("template",{slot:"law"},[a("el-table-column",{attrs:{type:"expand"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-form",{staticClass:"table-expand",attrs:{"label-position":"left",inline:""}},[a("el-card",{staticClass:"box-card",staticStyle:{width:"100%","margin-bottom":"10px"}},[a("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[a("span",[e._v("订单信息")])]),e._v(" "),a("div",{staticClass:"order-info-grid"},[a("div",{staticClass:"info-item"},[a("span",{staticClass:"label"},[e._v("销售订单号：")]),e._v(" "),a("span",{staticClass:"value"},[e._v(e._s(t.row.saleOrderNo||"--"))])]),e._v(" "),a("div",{staticClass:"info-item"},[a("span",{staticClass:"label"},[e._v("生产订单号：")]),e._v(" "),a("span",{staticClass:"value"},[e._v(e._s(t.row.productionOrderNo||"--"))])]),e._v(" "),a("div",{staticClass:"info-item"},[a("span",{staticClass:"label"},[e._v("工单号：")]),e._v(" "),a("span",{staticClass:"value"},[e._v(e._s(t.row.workOrderNo||"--"))])])])]),e._v(" "),a("el-card",{staticClass:"box-card",staticStyle:{width:"100%"}},[a("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[a("span",[e._v("箱子明细")])]),e._v(" "),t.row.boxItems.length?a("el-table",{staticStyle:{width:"100%"},attrs:{data:t.row.boxItems,border:""}},[a("el-table-column",{attrs:{label:"箱子条码",prop:"boxBarcode",align:"center"}}),e._v(" "),a("el-table-column",{attrs:{label:"数量",prop:"quantity",align:"center"}}),e._v(" "),a("el-table-column",{attrs:{label:"扫描时间",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                                        "+e._s(e.formatDate(t.row.scanTime))+"\n                                    ")]}}],null,!0)}),e._v(" "),a("el-table-column",{attrs:{label:"操作",align:"center"},scopedSlots:e._u([{key:"default",fn:function(r){return[a("el-button",{staticStyle:{color:"red"},attrs:{type:"text"},on:{click:function(a){return e.handleDelete(t.row.palletCode,r.row.boxBarcode)}}},[e._v("解绑箱条码")])]}}],null,!0)})],1):e._e(),e._v(" "),a("el-divider",{attrs:{"content-position":"left"}},[e._v("托盘条码明细")]),e._v(" "),a("el-table",{staticStyle:{width:"100%"},attrs:{data:t.row.palletBarcodes,border:""}},[a("el-table-column",{attrs:{label:"条码",prop:"barcode",align:"center"}}),e._v(" "),a("el-table-column",{attrs:{label:"扫描时间",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                                        "+e._s(e.formatDate(t.row.scanTime))+"\n                                    ")]}}],null,!0)}),e._v(" "),a("el-table-column",{attrs:{label:"操作",align:"center"},scopedSlots:e._u([{key:"default",fn:function(r){return[a("el-button",{staticStyle:{color:"red"},attrs:{type:"text"},on:{click:function(a){return e.handleDelete(t.row.palletCode,r.row.barcode)}}},[e._v("解绑条码")])]}}],null,!0)})],1)],1)],1)]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"托盘编号",align:"center",prop:"palletCode"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-link",{attrs:{type:"primary"}},[e._v(e._s(t.row.palletCode))])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"订单信息",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",[e._v("销售单号: "+e._s(t.row.saleOrderNo||"--"))]),e._v(" "),a("div",[e._v("生产单号: "+e._s(t.row.productionOrderNo||"--"))]),e._v(" "),a("div",[e._v("工单号: "+e._s(t.row.workOrderNo||"--"))])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"产线名称",prop:"productLineName",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                    "+e._s(t.row.productLineName)+"\n                    "),t.row.productLineId&&t.row.productLineId.workshop?a("el-tag",{attrs:{size:"mini"}},[e._v(e._s(t.row.productLineId.workshop))]):a("el-tag",[e._v("未记录生产车间")])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"物料信息",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                    "+e._s(t.row.materialName)+"\n                    "),t.row.materialSpec?a("el-tag",{attrs:{size:"mini"}},[e._v(e._s(t.row.materialSpec))]):e._e()]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"组托状态",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-tag",{attrs:{type:"STACKED"===t.row.status?"success":"warning"}},[e._v("\n                        "+e._s("STACKED"===t.row.status?"组托完成":"组托中")+"\n                    ")])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"数量信息",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",[e._v("总数量: "+e._s(t.row.totalQuantity))]),e._v(" "),t.row.boxCount?a("div",[e._v("箱数: "+e._s(t.row.boxCount))]):e._e()]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"创建时间",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                    "+e._s(e.formatDate(t.row.createAt))+"\n                ")]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"操作",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{staticStyle:{color:"red"},attrs:{type:"text"},on:{click:function(a){return e.handleAllDelete(t.row)}}},[e._v("初始化单据")]),e._v(" "),a("el-button",{staticStyle:{color:"red"},attrs:{type:"text"},on:{click:function(a){return e.Delete(t.row)}}},[e._v("删除单据")]),e._v(" "),a("el-button",{attrs:{type:"text"},on:{click:function(a){return e.handlePrint(t.row)}}},[e._v("打印单据")]),e._v(" "),a("el-button",{staticStyle:{color:"orange"},attrs:{type:"text"},on:{click:function(a){return e.showHistory(t.row)}}},[e._v("解绑记录")])]}}])})],1)],2),e._v(" "),a("edit-dialog",{attrs:{visible:e.dialogFormVisible,"dialog-status":e.dialogStatus,"row-data":e.dataForm},on:{"update:visible":function(t){e.dialogFormVisible=t},submit:e.handleSubmit}}),e._v(" "),a("el-dialog",{attrs:{title:"解绑记录",visible:e.historyDialogVisible,width:"80%"},on:{"update:visible":function(t){e.historyDialogVisible=t}}},[a("base-table",{ref:"historyTable",attrs:{currentPage:e.historyCurrentPage,"highlight-current-row":!0,pageSize:e.historyPageSize,tableData:e.historyTableList,tableDataloading:e.historyListLoading,total:e.historyTotal},on:{handleCurrentChange:e.historyTableHandleCurrentChange,handleSizeChange:e.historyTableHandleSizeChange}},[a("template",{slot:"law"},[a("el-table-column",{attrs:{type:"expand"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-form",{staticClass:"table-expand",attrs:{"label-position":"left",inline:""}},[a("el-card",{staticClass:"box-card",staticStyle:{width:"100%"}},[a("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[a("span",[e._v("影响的条码")])]),e._v(" "),a("el-table",{staticStyle:{width:"100%"},attrs:{data:t.row.affectedBarcodes,border:""}},[a("el-table-column",{attrs:{label:"条码",prop:"barcode",align:"center"}}),e._v(" "),a("el-table-column",{attrs:{label:"条码类型",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-tag",{attrs:{type:"MAIN"===t.row.barcodeType?"primary":"success"}},[e._v("\n                                                "+e._s("MAIN"===t.row.barcodeType?"主条码":"箱条码")+"\n                                            ")])]}}],null,!0)}),e._v(" "),a("el-table-column",{attrs:{label:"所属箱码",prop:"boxBarcode",align:"center"}})],1)],1)],1)]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"托盘编号",prop:"palletCode",align:"center"}}),e._v(" "),a("el-table-column",{attrs:{label:"解绑类型",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-tag",{attrs:{type:e.getUnbindTypeTag(t.row.unbindType)}},[e._v("\n                            "+e._s(e.getUnbindTypeText(t.row.unbindType))+"\n                        ")])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"解绑条码",prop:"unbindBarcode",align:"center"}}),e._v(" "),a("el-table-column",{attrs:{label:"解绑原因",prop:"reason",align:"center"}}),e._v(" "),a("el-table-column",{attrs:{label:"操作人",prop:"createBy",align:"center"}}),e._v(" "),a("el-table-column",{attrs:{label:"操作时间",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                        "+e._s(e.formatDate(t.row.createAt))+"\n                    ")]}}])})],1)],2)],1),e._v(" "),a("el-dialog",{attrs:{title:"导出进度",visible:e.exportDialogVisible,"close-on-click-modal":!1,"close-on-press-escape":!1,"show-close":!1,width:"30%"},on:{"update:visible":function(t){e.exportDialogVisible=t}}},[a("el-progress",{attrs:{percentage:e.exportProgress,status:100===e.exportProgress?"success":"","stroke-width":18}}),e._v(" "),a("div",{staticStyle:{"text-align":"center","margin-top":"10px"}},[e._v("\n            "+e._s(100===e.exportProgress?"导出完成":"正在导出数据，请稍候...")+"\n        ")])],1)],1)}),[],!1,null,"2e275642",null);t.default=f.exports},e392:function(e,t,a){"use strict";a("6eb0")}}]);