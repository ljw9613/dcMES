(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-648efcbe"],{"38db":function(e,t,n){"use strict";n("a395d")},"4f49":function(e,t,n){"use strict";n.r(t);var a=(n("7514"),n("c7eb")),s=(n("5df3"),n("f400"),n("ac6a"),n("2909")),c=(n("6762"),n("2fdb"),n("96cf"),n("1da1")),i=n("7e1e"),r={name:"AgentSelect",props:{value:{type:Array,default:function(){return[]}}},data:function(){return{loading:!1,agents:[],selectedAgents:this.value}},watch:{value:{handler:function(e){this.selectedAgents=e,e&&e.length&&!this.agents.length&&this.fetchAgentsByIds(e)},immediate:!0}},methods:{getAgentLabel:function(e){return"".concat(e.nickName).concat(e.company?" - ".concat(e.company):"")},remoteSearch:function(){var e=Object(c.a)(Object(a.a)().mark((function e(t){var n,c,r=this;return Object(a.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(""===t){e.next=15;break}return this.loading=!0,e.prev=2,e.next=5,Object(i.b)("user_login",{query:JSON.stringify({$or:[{nickName:{$regex:t,$options:"i"}},{phone:{$regex:t,$options:"i"}}],roles:{$elemMatch:{label:"Agent"}}}),limit:20});case 5:n=e.sent,c=this.agents.filter((function(e){return r.selectedAgents.includes(e._id)})),this.agents=Object(s.a)(new Map([].concat(Object(s.a)(c),Object(s.a)(n.data)).map((function(e){return[e._id,e]}))).values()),e.next=14;break;case 10:e.prev=10,e.t0=e.catch(2),this.$message.error("搜索经纪人失败");case 14:this.loading=!1;case 15:case"end":return e.stop()}}),e,this,[[2,10]])})));return function(t){return e.apply(this,arguments)}}(),handleChange:function(e){this.$emit("input",e);var t=this.agents.filter((function(t){return e.includes(t._id)}));this.$emit("select",t)},fetchAgentsByIds:function(){var e=Object(c.a)(Object(a.a)().mark((function e(t){var n,c;return Object(a.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.length){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,e.next=5,Object(i.b)("user_login",{query:JSON.stringify({_id:{$in:t}})});case 5:(n=e.sent).data&&n.data.length>0&&(c=this.agents.filter((function(e){return!n.data.find((function(t){return t._id===e._id}))})),this.agents=[].concat(Object(s.a)(c),Object(s.a)(n.data))),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(2);case 12:case"end":return e.stop()}}),e,this,[[2,9]])})));return function(t){return e.apply(this,arguments)}}()}},o=r,l=(n("38db"),n("2877")),u=Object(l.a)(o,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("el-select",{attrs:{filterable:"",remote:"","reserve-keyword":"",placeholder:"请输入经纪人名称搜索","remote-method":e.remoteSearch,loading:e.loading,clearable:"","collapse-tags":""},on:{change:e.handleChange},model:{value:e.selectedAgents,callback:function(t){e.selectedAgents=t},expression:"selectedAgents"}},e._l(e.agents,(function(t){return n("el-option",{key:t._id,attrs:{label:e.getAgentLabel(t),value:t._id}},[n("div",{staticClass:"agent-option"},[n("div",{staticClass:"agent-info"},[n("span",{staticClass:"name"},[e._v(e._s(t.nickName))]),e._v(" "),n("el-tag",{attrs:{size:"mini",type:"info"}},[e._v(e._s(t.phone))])],1),e._v(" "),t.company?n("div",{staticClass:"company-info"},[n("small",[e._v(e._s(t.company))])]):e._e()])])})),1)}),[],!1,null,"3aa9eef4",null);t.default=u.exports},a395d:function(e,t,n){}}]);