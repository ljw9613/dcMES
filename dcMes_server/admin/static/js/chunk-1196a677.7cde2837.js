(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-1196a677","chunk-359af2df","chunk-ce46be46"],{"17e8":function(e,t,a){"use strict";a("46e7")},"1fef":function(e,t,a){},2295:function(e,t,a){"use strict";a("a9ed")},3835:function(e,t,a){"use strict";var r=a("06c5");function s(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var a=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=a){var r,s,n,c,i=[],o=!0,l=!1;try{if(n=(a=a.call(e)).next,0===t){if(Object(a)!==a)return;o=!1}else for(;!(o=(r=n.call(a)).done)&&(i.push(r.value),i.length!==t);o=!0);}catch(e){l=!0,s=e}finally{try{if(!o&&null!=a.return&&(c=a.return(),Object(c)!==c))return}finally{if(l)throw s}}return i}}(e,t)||Object(r.a)(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}a.d(t,"a",(function(){return s}))},"46e7":function(e,t,a){},"4e86":function(e,t,a){"use strict";a.r(t);var r={name:"MaterialFlowChart",components:{FlowNode:a("af3b").default},props:{visible:{type:Boolean,default:!1},loading:{type:Boolean,default:!1},flowData:{type:Array,default:function(){return[]}}},computed:{dialogVisible:{get:function(){return this.visible},set:function(e){this.$emit("update:visible",e)}}},methods:{handleDialogClosed:function(){this.$emit("update:visible",!1)}}},s=r,n=(a("2295"),a("2877")),c=Object(n.a)(s,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{staticClass:"material-flow-dialog",attrs:{title:"ç‰©æ–™å·¥è‰ºæµç¨‹å›¾",visible:e.dialogVisible,width:"90%","append-to-body":!0,"modal-append-to-body":!0,"close-on-click-modal":!1,"destroy-on-close":!0},on:{"update:visible":function(t){e.dialogVisible=t},closed:e.handleDialogClosed}},[a("div",{staticClass:"flow-chart-container"},[a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"flow-container"},[e.flowData&&0!==e.flowData.length?[a("flow-node",{attrs:{node:e.flowData[0]}})]:a("div",{staticClass:"empty-data"},[e._v("\n                æš‚æ— æµç¨‹å›¾æ•°æ®\n            ")])],2)])])}),[],!1,null,"1c0588fe",null);t.default=c.exports},"7a56a":function(e,t,a){"use strict";a("1fef")},a9ed:function(e,t,a){},af3b:function(e,t,a){"use strict";a.r(t);var r={name:"FlowNode",props:{node:{type:Object,required:!0}}},s=(a("7a56a"),a("2877")),n=Object(s.a)(r,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"flow-level"},[a("div",{staticClass:"node-container"},[a("div",{staticClass:"material-node",class:{"root-node":!e.node.materialQuantity}},[a("div",{staticClass:"node-title"},[e._v(e._s(e.node.materialName))]),e._v(" "),e.node.craftName?a("div",{staticClass:"node-subtitle"},[e._v("\n                å·¥è‰ºï¼š"+e._s(e.node.craftName)+"\n            ")]):e._e(),e._v(" "),e.node.materialCode?a("div",{staticClass:"node-info"},[e._v("\n                ç¼–ç ï¼š"+e._s(e.node.materialCode)+"\n            ")]):e._e(),e._v(" "),e.node.scanOperation?a("div",{staticClass:"node-info"},[e._v("\n                æ‰«ç æ“ä½œï¼š"+e._s(e.node.scanOperation?"éœ€è¦æ‰«ç ":"ä¸éœ€è¦æ‰«ç ")+"\n            ")]):e._e(),e._v(" "),e.node.isComponent?a("div",{staticClass:"node-info"},[e._v("\n                æ˜¯å¦ç»„ä»¶ï¼š"+e._s(e.node.isComponent?"æ˜¯":"å¦")+"\n            ")]):e._e(),e._v(" "),e.node.materialQuantity?a("div",{staticClass:"node-info"},[e._v("\n                ç”¨é‡ï¼š"+e._s(e.node.materialQuantity)+e._s(e.node.unit||"ä¸ª")+"\n            ")]):e._e()])]),e._v(" "),e.node.children&&e.node.children.length?[e._m(0),e._v(" "),a("div",{staticClass:"process-level"},e._l(e.node.children,(function(t){return a("div",{key:t._id,staticClass:"process-container"},[a("div",{staticClass:"process-node"},[a("div",{staticClass:"node-title"},[e._v(e._s(t.sort)+"."+e._s(t.processName))]),e._v(" "),a("div",{staticClass:"node-content"},[t.children&&t.children.length?e._l(t.children,(function(e){return a("div",{key:e._id,staticClass:"sub-material"},[a("flow-node",{attrs:{node:e}})],1)})):a("div",{staticClass:"no-materials"},[e._v("\n                            æš‚æ— å…³è”ç‰©æ–™\n                        ")])],2)])])})),0)]:e._e()],2)}),[function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"arrow-container"},[t("div",{staticClass:"arrow-right"})])}],!1,null,"d061e8cc",null);t.default=n.exports},e9f7:function(e,t,a){"use strict";a.r(t);var r=(a("7514"),a("28a5"),a("55dd"),a("5df3"),a("4f7f"),a("7f7f"),a("5530")),s=(a("6b54"),a("a481"),a("f576"),a("8615"),a("6762"),a("2fdb"),a("456d"),a("c7eb")),n=(a("96cf"),a("1da1")),c=a("ade3"),i=a("3835"),o=(a("ffc1"),a("ac6a"),a("7e1e")),l=a("b810"),u=a("4e86"),d=(a("9339"),{name:"MaterialManagement",dicts:["product_type"],components:{MaterialFlowChart:u.default},data:function(){return{searchForm:{FNumber:"",FName:"",FSpecification:"",FDocumentStatus:"",FForbidStatus:"",FOldNumber:"",FBaseUnitId_FNumber:"",FStockId_FNumber:"",F_TFQJ_CheckBox:"",FNameEn:"",FCreateOrgId:"",FUseOrgId:""},tableList:[],total:0,currentPage:1,pageSize:10,listLoading:!0,showAdvanced:!1,dialogFormVisible:!1,dialogStatus:"",detailDialogVisible:!1,selection:[],dataForm:{FNumber:"",FName:"",FSpecification:"",FDocumentStatus:"",FForbidStatus:"",FOldNumber:"",FBaseUnitId_FNumber:"",FBaseUnitId_FName:"",FStockId_FNumber:"",FStockId_FName:"",F_TFQJ_CheckBox:"",FNameEn:"",FCreateOrgId:"",FUseOrgId:"",FDescription:"",FMnemonicCode:"",FMaterialGroup:"",FCreatorId:"",FCreateDate:null,FModifierId:"",FModifyDate:null,diNum:""},DINum:"",rules:{FName:[{required:!0,message:"è¯·è¾“å…¥ç‰©æ–™åç§°",trigger:"blur"}],FBaseUnitId_FNumber:[{required:!0,message:"è¯·é€‰æ‹©åŸºæœ¬å•ä½",trigger:"change"}],FStockId_FNumber:[{required:!0,message:"è¯·é€‰æ‹©ä»“åº“",trigger:"change"}],FCreateOrgId:[{required:!0,message:"è¯·é€‰æ‹©åˆ›å»ºç»„ç»‡",trigger:"change"}],FUseOrgId:[{required:!0,message:"è¯·é€‰æ‹©ä½¿ç”¨ç»„ç»‡",trigger:"change"}],diNum:[{max:100,message:"DIç é•¿åº¦ä¸èƒ½è¶…è¿‡100ä¸ªå­—ç¬¦",trigger:"blur"}]},flowChartDialogVisible:!1,flowChartLoading:!1,flowChartData:[],defaultProps:{children:"children",label:"label"},processedFlowChartData:[],productDiNumId:null,syncProgressTimer:null,syncDialogVisible:!1,syncForm:{syncType:"date",materialNumbers:"",dateRange:[],documentStatus:"C"},diNumList:[],diNumTemp:{},barcodeRuleDialogVisible:!1,addBarcodeRuleDialogVisible:!1,barcodeRuleList:[],barcodeRuleOptions:[],barcodeRuleForm:{barcodeRule:""},currentMaterialId:null}},methods:{getStatusType:function(e){return{DRAFT:"info",APPROVED:"success",PROCESSING:"warning"}[e]||"info"},getStatusText:function(e){return{DRAFT:"è‰ç¨¿",APPROVED:"å·²å®¡æ ¸",PROCESSING:"å®¡æ ¸ä¸­"}[e]||e},searchData:function(){var e={query:{$and:[]}};return Object.entries(this.searchForm).forEach((function(t){var a=Object(i.a)(t,2),r=a[0],s=a[1];if(s)switch(r){case"FNumber":case"FName":case"FSpecification":case"FOldNumber":case"FNameEn":e.query.$and.push(Object(c.a)({},r,{$regex:s,$options:"i"}));break;case"FDocumentStatus":case"FForbidStatus":case"FBaseUnitId_FNumber":case"FStockId_FNumber":case"F_TFQJ_CheckBox":case"FBOMCATEGORY":case"FBOMUSE":case"FITEMPPROPERTY":e.query.$and.push(Object(c.a)({},r,s))}})),e.query.$and.length||delete e.query.$and,e},resetForm:function(){this.$refs.searchForm.resetFields(),this.searchForm={FNumber:"",FName:"",FSpecification:"",FDocumentStatus:"",FForbidStatus:"",FOldNumber:"",FBaseUnitId_FNumber:"",FStockId_FNumber:"",F_TFQJ_CheckBox:"",FNameEn:"",FCreateOrgId:"",FUseOrgId:"",FBOMCATEGORY:"",FBOMUSE:"",FITEMPPROPERTY:""},this.showAdvanced=!1,this.currentPage=1,this.pageSize=10,this.fetchData(),this.$message.success("é‡ç½®æˆåŠŸ")},fetchData:function(){var e=Object(n.a)(Object(s.a)().mark((function e(){var t,a;return Object(s.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.listLoading=!0,e.prev=1,(t=this.searchData()).page=this.currentPage,t.skip=(this.currentPage-1)*this.pageSize,t.limit=this.pageSize,t.count=!0,t.sort={FNumber:1},e.next=10,Object(o.b)("k3_BD_MATERIAL",t);case 10:200===(a=e.sent).code?(this.tableList=a.data,this.total=a.countnum):this.$message.error(a.msg||"èŽ·å–æ•°æ®å¤±è´¥"),e.next=18;break;case 14:e.prev=14,e.t0=e.catch(1),console.error("èŽ·å–æ•°æ®å¤±è´¥:",e.t0),this.$message.error("èŽ·å–æ•°æ®å¤±è´¥: "+e.t0.message);case 18:return e.prev=18,this.listLoading=!1,e.finish(18);case 21:case"end":return e.stop()}}),e,this,[[1,14,18,21]])})));return function(){return e.apply(this,arguments)}}(),exportData:function(){var e=Object(n.a)(Object(s.a)().mark((function e(){var t,a,r,n,c,i,l,u,d=this;return Object(s.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,this.$message({message:"æ­£åœ¨å¯¼å‡ºæ•°æ®,è¯·ç¨å€™...",type:"info"}),t=this.$loading({lock:!0,text:"å¯¼å‡ºä¸­...",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"}),(a=this.searchData()).limit=1e6,e.next=7,Object(o.b)("k3_PRD_MO",a);case 7:if((r=e.sent).data&&0!==r.data.length){e.next=12;break}return this.$message.warning("æ²¡æœ‰æ•°æ®å¯ä¾›å¯¼å‡º"),t.close(),e.abrupt("return");case 12:n={FNumber:"ç‰©æ–™ç¼–ç ",FName:"ç‰©æ–™åç§°",FSpecification:"è§„æ ¼åž‹å·",FDocumentStatus:"æ•°æ®çŠ¶æ€",FBOMCATEGORY:"BOMåˆ†ç±»",FBOMUSE:"BOMç”¨é€”",FITEMPPROPERTY:"ç‰©æ–™å±žæ€§",FForbidStatus:"ç¦ç”¨çŠ¶æ€"},c=r.data.map((function(e){var t={};return Object.keys(n).forEach((function(a){a.includes("Date")?t[n[a]]=d.formatDate(e[a]):t[n[a]]=e[a]})),t})),i=XLSX.utils.book_new(),l=XLSX.utils.json_to_sheet(c),u=Object.values(n).map((function(e){return{wch:Math.max(2*e.length,15)}})),l["!cols"]=u,XLSX.utils.book_append_sheet(i,l,"ç‰©æ–™ç®¡ç†æ•°æ®"),XLSX.writeFile(i,"ç‰©æ–™ç®¡ç†æ•°æ®.xlsx"),t.close(),this.$message.success("å¯¼å‡ºæˆåŠŸ"),e.next=28;break;case 24:e.prev=24,e.t0=e.catch(0),console.error("å¯¼å‡ºå¤±è´¥:",e.t0),this.$message.error("å¯¼å‡ºå¤±è´¥");case 28:case"end":return e.stop()}}),e,this,[[0,24]])})));return function(){return e.apply(this,arguments)}}(),baseTableHandleCurrentChange:function(e){this.currentPage=e,this.fetchData()},baseTableHandleSizeChange:function(e){this.pageSize=e,this.fetchData()},toggleAdvanced:function(){this.showAdvanced=!this.showAdvanced},formatDate:function(e){if(!e)return"æš‚æ— æ•°æ®";var t=new Date(e);if(isNaN(t.getTime()))return"æ— æ•ˆæ—¥æœŸ";var a=t.getFullYear(),r=String(t.getMonth()+1).padStart(2,"0"),s=String(t.getDate()).padStart(2,"0");return"".concat(a,"-").concat(r,"-").concat(s)},formatNumber:function(e){return e||0===e?e.toString().replace(/\B(?=(\d{3})+(?!\d))/g,","):"0"},search:function(){var e=this;this.$refs.searchForm.validate((function(t){if(!t)return e.$message.warning("è¯·æ£€æŸ¥è¾“å…¥é¡¹æ˜¯å¦æ­£ç¡®"),!1;e.currentPage=1,e.fetchData()}))},handleSelectionChange:function(e){this.selection=e},handleView:function(){var e=Object(n.a)(Object(s.a)().mark((function e(t){return Object(s.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.dataForm=JSON.parse(JSON.stringify(t)),e.next=3,this.fetchDiNumList(t._id);case 3:this.dialogStatus="view",this.dialogFormVisible=!0;case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),handleEdit:function(){var e=Object(n.a)(Object(s.a)().mark((function e(t){return Object(s.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.dataForm=JSON.parse(JSON.stringify(t)),e.next=3,this.fetchDiNumList(t._id);case 3:this.dialogStatus="edit",this.dialogFormVisible=!0;case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),handleDelete:function(e){var t=this;this.$confirm("ç¡®è®¤è¦åˆ é™¤è¯¥ç‰©æ–™å—?","æç¤º",{confirmButtonText:"ç¡®å®š",cancelButtonText:"å–æ¶ˆ",type:"warning"}).then(Object(n.a)(Object(s.a)().mark((function a(){return Object(s.a)().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.prev=0,a.next=3,Object(o.c)("k3_PRD_MO",{query:{_id:e._id}});case 3:t.$message.success("åˆ é™¤æˆåŠŸ"),t.fetchData(),a.next=11;break;case 7:a.prev=7,a.t0=a.catch(0),console.error("åˆ é™¤å¤±è´¥:",a.t0),t.$message.error("åˆ é™¤å¤±è´¥");case 11:case"end":return a.stop()}}),a,null,[[0,7]])})))).catch((function(){t.$message.info("å·²å–æ¶ˆåˆ é™¤")}))},submitForm:function(){var e=Object(n.a)(Object(s.a)().mark((function e(){var t=this;return Object(s.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.$refs.dataForm.validate(function(){var e=Object(n.a)(Object(s.a)().mark((function e(a){var n;return Object(s.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!a){e.next=20;break}if(e.prev=1,n={productId:t.dataForm._id,diNum:t.DINum,updateBy:t.$store.state.user.id},!t.productDiNumId){e.next=8;break}return e.next=6,Object(o.d)("productDiNum",{query:{_id:t.productDiNumId},update:n});case 6:e.next=11;break;case 8:if(!t.DINum){e.next=11;break}return e.next=11,Object(o.a)("productDiNum",Object(r.a)(Object(r.a)({},n),{},{createBy:t.$store.state.user.id}));case 11:t.$message.success("edit"===t.dialogStatus?"æ›´æ–°æˆåŠŸ":"æ·»åŠ æˆåŠŸ"),t.dialogFormVisible=!1,t.fetchData(),e.next=20;break;case 16:e.prev=16,e.t0=e.catch(1),console.error("ä¿å­˜å¤±è´¥:",e.t0),t.$message.error("ä¿å­˜å¤±è´¥");case 20:case"end":return e.stop()}}),e,null,[[1,16]])})));return function(t){return e.apply(this,arguments)}}());case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),handleToggleStatus:function(){var e=Object(n.a)(Object(s.a)().mark((function e(t){var a;return Object(s.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.$confirm("ç¡®è®¤è¦".concat("DISABLE"===t.FForbidStatus?"å¯ç”¨":"ç¦ç”¨","è¯¥ç‰©æ–™å—ï¼Ÿ"),"æç¤º",{type:"warning"});case 3:return a="DISABLE"===t.FForbidStatus?"ENABLE":"DISABLE",e.next=6,Object(o.d)("BD_MATERIAL",t._id,Object(r.a)(Object(r.a)({},t),{},{FForbidStatus:a,FForbidderId:this.$store.state.user.name,FForbidDate:new Date}));case 6:this.$message.success("".concat("DISABLE"===a?"ç¦ç”¨":"å¯ç”¨","æˆåŠŸ")),this.fetchData(),e.next=14;break;case 10:e.prev=10,e.t0=e.catch(0),console.error("æ“ä½œå¤±è´¥:",e.t0),this.$message.error("æ“ä½œå¤±è´¥");case 14:case"end":return e.stop()}}),e,this,[[0,10]])})));return function(t){return e.apply(this,arguments)}}(),handleViewFlowChart:function(){var e=Object(n.a)(Object(s.a)().mark((function e(t){var a,r,n,c;return Object(s.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.flowChartLoading=!0,e.prev=1,console.log("å½“å‰ç‰©æ–™:",t),e.next=5,Object(o.b)("craft",{query:{materialId:t._id},page:1,limit:1});case 5:if((a=e.sent).data&&0!==a.data.length){e.next=9;break}return this.$message.info("è¯¥ç‰©æ–™æœªå…³è”å·¥è‰ºï¼Œæ— æµç¨‹å›¾"),e.abrupt("return");case 9:return r=a.data[0],e.next=12,Object(o.b)("processStep",{query:{craftId:r._id},sort:{sort:1}});case 12:if((n=e.sent).data&&0!==n.data.length){e.next=16;break}return this.$message.info("è¯¥ç‰©æ–™å·¥è‰ºä¸‹æ— å·¥åºï¼Œæ— æµç¨‹å›¾"),e.abrupt("return");case 16:return this.flowChartDialogVisible=!0,e.next=19,this.buildFlowChartData(t._id,new Set);case 19:c=e.sent,console.log("æž„å»ºçš„æµç¨‹å›¾æ•°æ®:",c),this.processedFlowChartData=[c],console.log("å¤„ç†åŽçš„æµç¨‹å›¾æ•°æ®:",this.processedFlowChartData),e.next=29;break;case 25:e.prev=25,e.t0=e.catch(1),console.error("èŽ·å–æµç¨‹å›¾æ•°æ®å¤±è´¥:",e.t0),this.$message.error("èŽ·å–æµç¨‹å›¾æ•°æ®å¤±è´¥");case 29:return e.prev=29,this.flowChartLoading=!1,e.finish(29);case 32:case"end":return e.stop()}}),e,this,[[1,25,29,32]])})));return function(t){return e.apply(this,arguments)}}(),buildFlowChartData:function(){var e=Object(n.a)(Object(s.a)().mark((function e(t){var a,r,c,i,l,u,d,m=this,p=arguments;return Object(s.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(a=p.length>1&&void 0!==p[1]?p[1]:new Set).has(t)){e.next=3;break}return e.abrupt("return",null);case 3:return a.add(t),e.prev=4,e.next=7,this.getMaterialById(t);case 7:if(r=e.sent){e.next=10;break}return e.abrupt("return",null);case 10:return c={_id:t,label:r.FName,materialName:r.FName,materialCode:r.FNumber,children:[]},e.next=13,Object(o.b)("craft",{query:{materialId:t},page:1,limit:1});case 13:if((i=e.sent).data&&0!==i.data.length){e.next=16;break}return e.abrupt("return",c);case 16:return l=i.data[0],c.craftName=l.craftName,e.next=20,Object(o.b)("processStep",{query:{craftId:l._id},sort:{sort:1}});case 20:if(!((u=e.sent).data&&u.data.length>0)){e.next=26;break}return e.next=24,Promise.all(u.data.map(function(){var e=Object(n.a)(Object(s.a)().mark((function e(t){var r,c,i;return Object(s.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r={_id:t._id,label:t.processName,sort:t.sort,processName:t.processName,children:[]},e.next=3,Object(o.b)("processMaterials",{query:{processStepId:t._id}});case 3:if(!((c=e.sent).data&&c.data.length>0)){e.next=9;break}return e.next=7,Promise.all(c.data.map(function(){var e=Object(n.a)(Object(s.a)().mark((function e(t){var r;return Object(s.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,m.buildFlowChartData(t.materialId,a);case 2:return(r=e.sent)&&(r.materialRelationType=t.relationType,r.isComponent=t.isComponent,r.scanOperation=t.scanOperation,r.materialQuantity=t.quantity),e.abrupt("return",r);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 7:i=e.sent,r.children=i.filter(Boolean);case 9:return e.abrupt("return",r);case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 24:d=e.sent,c.children=d.filter(Boolean);case 26:return e.abrupt("return",c);case 29:return e.prev=29,e.t0=e.catch(4),console.error("æž„å»ºæµç¨‹å›¾æ•°æ®å¤±è´¥:",e.t0),this.$message.error("æž„å»ºæµç¨‹å›¾æ•°æ®å¤±è´¥"),e.abrupt("return",null);case 34:case"end":return e.stop()}}),e,this,[[4,29]])})));return function(t){return e.apply(this,arguments)}}(),getMaterialById:function(){var e=Object(n.a)(Object(s.a)().mark((function e(t){var a;return Object(s.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(o.b)("k3_BD_MATERIAL",{query:{_id:t}});case 2:return a=e.sent,e.abrupt("return",a.data[0]);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),getCraftByMaterialId:function(){var e=Object(n.a)(Object(s.a)().mark((function e(t){var a;return Object(s.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(o.b)("craft",{query:{materialId:t}});case 2:return a=e.sent,e.abrupt("return",a.data[0]);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),getProcessStepById:function(){var e=Object(n.a)(Object(s.a)().mark((function e(t){var a;return Object(s.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(o.b)("processStep",{query:{_id:t},sort:{sort:1}});case 2:return a=e.sent,e.abrupt("return",a.data[0]);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),getProcessMaterialById:function(){var e=Object(n.a)(Object(s.a)().mark((function e(t){var a;return Object(s.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(o.b)("processMaterials",{query:{_id:t}});case 2:return a=e.sent,e.abrupt("return",a.data[0]);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),processFlowChartData:function(e){var t=[],a=function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;e&&0!==e.length&&(t[r]||(t[r]=[]),e.forEach((function(e){var s={_id:e._id,label:e.label,craftName:e.craftName||"",processName:e.processName||"",materialName:e.materialName||"",materialRelationType:e.materialRelationType||"",materialQuantity:e.materialQuantity||"",children:e.children||[]};t[r].push(s),s.children&&s.children.length>0&&a(s.children,r+1)})))};return a(e),t},getProcessMaterialByMaterialId:function(){var e=Object(n.a)(Object(s.a)().mark((function e(t){var a;return Object(s.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(o.b)("processMaterials",{query:{materialId:t}});case 2:return a=e.sent,e.abrupt("return",a.data[0]);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),fetchDiNum:function(){var e=Object(n.a)(Object(s.a)().mark((function e(t){var a;return Object(s.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Object(o.b)("productDiNum",{query:{productId:t}});case 3:(a=e.sent).data&&a.data.length>0?(this.DINum=a.data[0].diNum,this.productDiNumId=a.data[0]._id):(this.DINum="",this.productDiNumId=null),e.next=11;break;case 7:e.prev=7,e.t0=e.catch(0),console.error("èŽ·å–DIç ä¿¡æ¯å¤±è´¥:",e.t0),this.$message.error("èŽ·å–DIç ä¿¡æ¯å¤±è´¥");case 11:case"end":return e.stop()}}),e,this,[[0,7]])})));return function(t){return e.apply(this,arguments)}}(),handleSync:function(){var e=Object(n.a)(Object(s.a)().mark((function e(){return Object(s.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.syncDialogVisible=!0,this.syncForm={syncType:"date",materialNumbers:"",dateRange:[],documentStatus:"C"};case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),handleOneSync:function(){var e=Object(n.a)(Object(s.a)().mark((function e(t){var a,r;return Object(s.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("ðŸš€ ~ handleOneSync ~ row:",t),e.prev=1,a={FilterString:[]},e.next=5,this.$confirm("ç¡®è®¤æ›´æ–°".concat(t.FNumber,"çš„æ•°æ®å—ï¼Ÿ"),"æç¤º",{confirmButtonText:"ç¡®å®š",cancelButtonText:"å–æ¶ˆ",type:"warning"});case 5:return a.FilterString=[{FieldName:"FMATERIALID",Compare:"=",Value:t.FMATERIALID,Left:"",Right:"",Logic:0}],e.next=8,Object(l.c)(a);case 8:200===(r=e.sent).code?(this.startSyncProgressCheck(),r.taskStatus?this.$message.success("åŒæ­¥ä¸­ï¼šå½“å‰".concat(r.taskStatus.processedRecords,"æ¡æ•°æ®åŒæ­¥å®Œæˆï¼Œè€—æ—¶").concat(r.taskStatus.elapsedTime,"ç§’")):this.$message.success("åŒæ­¥ä»»åŠ¡å·²å¯åŠ¨")):this.$message.error(r.message||"ç‰©æ–™åŒæ­¥å¤±è´¥"),e.next=16;break;case 12:e.prev=12,e.t0=e.catch(1),console.error("ç‰©æ–™åŒæ­¥å¤±è´¥:",e.t0),this.$message.error("ç‰©æ–™åŒæ­¥å¤±è´¥");case 16:case"end":return e.stop()}}),e,this,[[1,12]])})));return function(t){return e.apply(this,arguments)}}(),confirmSync:function(){var e=Object(n.a)(Object(s.a)().mark((function e(){var t,a,r,n,c,o,u;return Object(s.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("number"!==this.syncForm.syncType||this.syncForm.materialNumbers.trim()){e.next=3;break}return this.$message.warning("è¯·è¾“å…¥ç‰©æ–™ç¼–å·"),e.abrupt("return");case 3:if("date"!==this.syncForm.syncType||this.syncForm.dateRange&&2===this.syncForm.dateRange.length){e.next=6;break}return this.$message.warning("è¯·é€‰æ‹©å®¡æ ¸æ—¥æœŸèŒƒå›´"),e.abrupt("return");case 6:return e.prev=6,t={number:"ç¡®è®¤è¦åŒæ­¥é€‰å®šç‰©æ–™ç¼–å·çš„æ•°æ®å—ï¼Ÿ",date:"ç¡®è®¤è¦åŒæ­¥é€‰å®šæ—¥æœŸèŒƒå›´çš„æ•°æ®å—ï¼Ÿ",all:"ç¡®è®¤è¦åŒæ­¥æ‰€æœ‰ç‰©æ–™æ•°æ®å—ï¼Ÿæ­¤æ“ä½œå¯èƒ½éœ€è¦è¾ƒé•¿æ—¶é—´"}[this.syncForm.syncType],e.next=10,this.$confirm(t,"æç¤º",{confirmButtonText:"ç¡®å®š",cancelButtonText:"å–æ¶ˆ",type:"warning"});case 10:a=this.$loading({lock:!0,text:"æ­£åœ¨å¯åŠ¨åŒæ­¥ä»»åŠ¡...",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"}),e.prev=11,r={FilterString:[]},e.t0=this.syncForm.syncType,e.next="number"===e.t0?16:"date"===e.t0?18:"all"===e.t0?21:23;break;case 16:return r.FilterString=[{FieldName:"FNumber",Compare:"IN",Value:this.syncForm.materialNumbers.replace(/[\n\r\s]+/g,",").split(",").filter((function(e){return e})).map((function(e){return e.trim()})).join(","),Left:"",Right:"",Logic:0},{FieldName:"FDocumentStatus",Compare:"StatusEqualto",Value:this.syncForm.documentStatus,Left:"",Right:"",Logic:0}],e.abrupt("break",23);case 18:return n=Object(i.a)(this.syncForm.dateRange,2),c=n[0],o=n[1],r.FilterString=[{FieldName:"FDocumentStatus",Compare:"StatusEqualto",Value:this.syncForm.documentStatus,Left:"",Right:"",Logic:0},{FieldName:"FApproveDate",Compare:">",Value:"".concat(c," 00:00:00"),Left:"",Right:"",Logic:0},{FieldName:"FApproveDate",Compare:"<",Value:"".concat(o," 23:59:59"),Left:"",Right:"",Logic:0}],e.abrupt("break",23);case 21:return r.FilterString=[{FieldName:"FDocumentStatus",Compare:"StatusEqualto",Value:"C",Left:"",Right:"",Logic:0}],e.abrupt("break",23);case 23:return e.next=25,Object(l.c)(r);case 25:200===(u=e.sent).code?(this.syncDialogVisible=!1,a.close(),this.startSyncProgressCheck(),u.taskStatus?this.$message.success("åŒæ­¥ä¸­ï¼šå½“å‰".concat(u.taskStatus.processedRecords,"æ¡æ•°æ®åŒæ­¥å®Œæˆï¼Œè€—æ—¶").concat(u.taskStatus.elapsedTime,"ç§’")):this.$message.success("åŒæ­¥ä»»åŠ¡å·²å¯åŠ¨")):(a.close(),this.$message.error(u.message||"ç‰©æ–™åŒæ­¥å¤±è´¥")),e.next=34;break;case 29:e.prev=29,e.t1=e.catch(11),a.close(),console.error("ç‰©æ–™åŒæ­¥å¤±è´¥:",e.t1),this.$message.error("ç‰©æ–™åŒæ­¥å¤±è´¥: "+e.t1.message);case 34:e.next=39;break;case 36:e.prev=36,e.t2=e.catch(6),"cancel"!==e.t2&&(console.error("æ“ä½œå¤±è´¥:",e.t2),this.$message.error("æ“ä½œå¤±è´¥"));case 39:case"end":return e.stop()}}),e,this,[[6,36],[11,29]])})));return function(){return e.apply(this,arguments)}}(),startSyncProgressCheck:function(){var e=this;this.syncProgressTimer&&clearInterval(this.syncProgressTimer),this.syncProgressTimer=setInterval(Object(n.a)(Object(s.a)().mark((function t(){var a,r;return Object(s.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,Object(l.a)("k3_BD_MATERIAL");case 3:if(a=t.sent,console.log("ðŸš€ ~ this.syncProgressTimer=setInterval ~ response:",a),200!==a.code){t.next=27;break}if(!(r=a.taskStatus)){t.next=25;break}t.t0=r.status,t.next="running"===t.t0?11:"no_task"===t.t0?13:"completed"===t.t0?17:21;break;case 11:return e.$notify({type:"info",message:"åŒæ­¥ä¸­ï¼šå½“å‰".concat(r.processedRecords,"æ¡æ•°æ®åŒæ­¥å®Œæˆï¼Œè€—æ—¶").concat(r.elapsedTime,"ç§’"),duration:5e3}),t.abrupt("break",23);case 13:case 17:return e.$message.success("åŒæ­¥å®Œæˆï¼"),e.stopSyncProgressCheck(),e.fetchData(),t.abrupt("break",23);case 21:e.$message.warning("æœªçŸ¥çš„åŒæ­¥çŠ¶æ€"),e.stopSyncProgressCheck();case 23:t.next=27;break;case 25:e.$message.warning("æœªæ‰¾åˆ°ç‰©æ–™åŒæ­¥ä»»åŠ¡"),e.stopSyncProgressCheck();case 27:t.next=34;break;case 29:t.prev=29,t.t1=t.catch(0),console.error("æŸ¥è¯¢åŒæ­¥è¿›åº¦å¤±è´¥:",t.t1),e.$message.error("æŸ¥è¯¢åŒæ­¥è¿›åº¦å¤±è´¥"),e.stopSyncProgressCheck();case 34:case"end":return t.stop()}}),t,null,[[0,29]])}))),5e3)},stopSyncProgressCheck:function(){this.syncProgressTimer&&(clearInterval(this.syncProgressTimer),this.syncProgressTimer=null)},beforeDestroy:function(){this.stopSyncProgressCheck()},fetchDiNumList:function(){var e=Object(n.a)(Object(s.a)().mark((function e(t){var a;return Object(s.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Object(o.b)("productDiNum",{query:{productId:t}});case 3:(a=e.sent).data&&(this.diNumList=a.data.map((function(e){return Object(r.a)(Object(r.a)({},e),{},{isEdit:!1})}))),e.next=11;break;case 7:e.prev=7,e.t0=e.catch(0),console.error("èŽ·å–DIç åˆ—è¡¨å¤±è´¥:",e.t0),this.$message.error("èŽ·å–DIç åˆ—è¡¨å¤±è´¥");case 11:case"end":return e.stop()}}),e,this,[[0,7]])})));return function(t){return e.apply(this,arguments)}}(),handleAddDI:function(){console.log("ðŸš€ ~ handleAddDI ~ this.dataForm:",this.$store.state.user),this.diNumList.unshift({diNum:"",productId:this.dataForm._id,createBy:this.$store.state.user.id,createTime:new Date,isEdit:!0,isNew:!0})},editDI:function(e){this.diNumTemp=Object(r.a)({},e),e.isEdit=!0},cancelEdit:function(e){e.isNew?this.diNumList=this.diNumList.filter((function(e){return!e.isNew})):(Object.assign(e,this.diNumTemp),e.isEdit=!1)},saveDI:function(){var e=Object(n.a)(Object(s.a)().mark((function e(t){return Object(s.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,t.diNum){e.next=4;break}return this.$message.warning("è¯·è¾“å…¥DIç "),e.abrupt("return");case 4:if(t.diNum){e.next=7;break}return this.$message.warning("DIç ä¸èƒ½ä¸ºç©º"),e.abrupt("return");case 7:if(!t.isNew){e.next=12;break}return e.next=10,Object(o.a)("productDiNum",{productId:this.dataForm._id,diNum:t.diNum,createBy:this.$store.state.user.id});case 10:e.next=14;break;case 12:return e.next=14,Object(o.d)("productDiNum",{query:{_id:t._id},update:{$set:{diNum:t.diNum,updateBy:this.$store.state.user.id}}});case 14:return t.isEdit=!1,t.isNew&&delete t.isNew,this.$message.success("ä¿å­˜æˆåŠŸ"),e.next=19,this.fetchDiNumList(this.dataForm._id);case 19:e.next=25;break;case 21:e.prev=21,e.t0=e.catch(0),console.error("ä¿å­˜DIç å¤±è´¥:",e.t0),this.$message.error("ä¿å­˜DIç å¤±è´¥");case 25:case"end":return e.stop()}}),e,this,[[0,21]])})));return function(t){return e.apply(this,arguments)}}(),deleteDI:function(){var e=Object(n.a)(Object(s.a)().mark((function e(t){return Object(s.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.$confirm("ç¡®è®¤åˆ é™¤è¯¥DIç å—?","æç¤º",{type:"warning"});case 3:return e.next=5,Object(o.c)("productDiNum",{query:{_id:t._id}});case 5:return this.$message.success("åˆ é™¤æˆåŠŸ"),e.next=8,this.fetchDiNumList(this.dataForm._id);case 8:e.next=13;break;case 10:e.prev=10,e.t0=e.catch(0),"cancel"!==e.t0&&(console.error("åˆ é™¤DIç å¤±è´¥:",e.t0),this.$message.error("åˆ é™¤DIç å¤±è´¥"));case 13:case"end":return e.stop()}}),e,this,[[0,10]])})));return function(t){return e.apply(this,arguments)}}(),handleBarcodeRule:function(){var e=Object(n.a)(Object(s.a)().mark((function e(t){return Object(s.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.currentMaterialId=t._id,e.next=3,this.fetchBarcodeRuleList(t._id);case 3:return e.next=5,this.fetchBarcodeRuleOptions();case 5:this.barcodeRuleDialogVisible=!0;case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),fetchBarcodeRuleList:function(){var e=Object(n.a)(Object(s.a)().mark((function e(t){var a;return Object(s.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Object(o.b)("productBarcodeRule",{query:{productId:t},populate:JSON.stringify([{path:"barcodeRule",select:"name description"}])});case 3:(a=e.sent).data&&(this.barcodeRuleList=a.data),e.next=11;break;case 7:e.prev=7,e.t0=e.catch(0),console.error("èŽ·å–æ¡ç è§„åˆ™åˆ—è¡¨å¤±è´¥:",e.t0),this.$message.error("èŽ·å–æ¡ç è§„åˆ™åˆ—è¡¨å¤±è´¥");case 11:case"end":return e.stop()}}),e,this,[[0,7]])})));return function(t){return e.apply(this,arguments)}}(),fetchBarcodeRuleOptions:function(){var e=Object(n.a)(Object(s.a)().mark((function e(){var t;return Object(s.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Object(o.b)("barcodeRule",{});case 3:(t=e.sent).data&&(this.barcodeRuleOptions=t.data),e.next=11;break;case 7:e.prev=7,e.t0=e.catch(0),console.error("èŽ·å–æ¡ç è§„åˆ™é€‰é¡¹å¤±è´¥:",e.t0),this.$message.error("èŽ·å–æ¡ç è§„åˆ™é€‰é¡¹å¤±è´¥");case 11:case"end":return e.stop()}}),e,this,[[0,7]])})));return function(){return e.apply(this,arguments)}}(),handleAddBarcodeRule:function(){this.barcodeRuleForm={barcodeRule:""},this.addBarcodeRuleDialogVisible=!0},saveBarcodeRule:function(){var e=Object(n.a)(Object(s.a)().mark((function e(){var t,a=this;return Object(s.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,this.barcodeRuleForm.barcodeRule){e.next=4;break}return this.$message.warning("è¯·é€‰æ‹©æ¡ç è§„åˆ™"),e.abrupt("return");case 4:if(t=this.barcodeRuleList.find((function(e){return e.barcodeRule._id===a.barcodeRuleForm.barcodeRule})),!t){e.next=8;break}return this.$message.warning("è¯¥è§„åˆ™å·²ç»‘å®šï¼Œè¯·å‹¿é‡å¤æ·»åŠ "),e.abrupt("return");case 8:return e.next=10,Object(o.a)("productBarcodeRule",{productId:this.currentMaterialId,barcodeRule:this.barcodeRuleForm.barcodeRule,createBy:this.$store.state.user.id});case 10:return this.$message.success("è§„åˆ™ç»‘å®šæˆåŠŸ"),this.addBarcodeRuleDialogVisible=!1,e.next=14,this.fetchBarcodeRuleList(this.currentMaterialId);case 14:e.next=20;break;case 16:e.prev=16,e.t0=e.catch(0),console.error("ä¿å­˜æ¡ç è§„åˆ™å¤±è´¥:",e.t0),this.$message.error("ä¿å­˜æ¡ç è§„åˆ™å¤±è´¥");case 20:case"end":return e.stop()}}),e,this,[[0,16]])})));return function(){return e.apply(this,arguments)}}(),deleteBarcodeRule:function(){var e=Object(n.a)(Object(s.a)().mark((function e(t){return Object(s.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.$confirm("ç¡®è®¤è§£é™¤è¯¥è§„åˆ™ç»‘å®šå—?","æç¤º",{type:"warning"});case 3:return e.next=5,Object(o.c)("productBarcodeRule",{query:{_id:t._id}});case 5:return this.$message.success("è§£é™¤ç»‘å®šæˆåŠŸ"),e.next=8,this.fetchBarcodeRuleList(this.currentMaterialId);case 8:e.next=13;break;case 10:e.prev=10,e.t0=e.catch(0),"cancel"!==e.t0&&(console.error("åˆ é™¤æ¡ç è§„åˆ™å¤±è´¥:",e.t0),this.$message.error("åˆ é™¤æ¡ç è§„åˆ™å¤±è´¥"));case 13:case"end":return e.stop()}}),e,this,[[0,10]])})));return function(t){return e.apply(this,arguments)}}()},created:function(){this.fetchData()}}),m=d,p=(a("17e8"),a("2877")),b=Object(p.a)(m,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"app-container"},[a("el-card",{staticClass:"filter-container"},[a("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[a("span",[e._v("ç­›é€‰æœç´¢")]),e._v(" "),a("el-button",{staticStyle:{float:"right",padding:"3px 0"},attrs:{type:"text"},on:{click:e.toggleAdvanced}},[e._v("\n                "+e._s(e.showAdvanced?"æ”¶èµ·":"å±•å¼€")+"é«˜çº§æœç´¢\n            ")])],1),e._v(" "),a("el-form",{ref:"searchForm",staticClass:"demo-form-inline",attrs:{model:e.searchForm}},[a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:6}},[a("el-form-item",{attrs:{label:"ç‰©æ–™ç¼–ç "}},[a("el-input",{attrs:{placeholder:"è¯·è¾“å…¥ç‰©æ–™ç¼–ç ",clearable:""},model:{value:e.searchForm.FNumber,callback:function(t){e.$set(e.searchForm,"FNumber",t)},expression:"searchForm.FNumber"}})],1)],1),e._v(" "),a("el-col",{attrs:{span:6}},[a("el-form-item",{attrs:{label:"ç‰©æ–™åç§°"}},[a("el-input",{attrs:{placeholder:"è¯·è¾“å…¥ç‰©æ–™åç§°",clearable:""},model:{value:e.searchForm.FName,callback:function(t){e.$set(e.searchForm,"FName",t)},expression:"searchForm.FName"}})],1)],1),e._v(" "),a("el-col",{attrs:{span:6}},[a("el-form-item",{attrs:{label:"è§„æ ¼åž‹å·"}},[a("el-input",{attrs:{placeholder:"è¯·è¾“å…¥è§„æ ¼åž‹å·",clearable:""},model:{value:e.searchForm.FSpecification,callback:function(t){e.$set(e.searchForm,"FSpecification",t)},expression:"searchForm.FSpecification"}})],1)],1),e._v(" "),a("el-col",{attrs:{span:6}},[a("el-form-item",{attrs:{label:"æ•°æ®çŠ¶æ€"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"è¯·é€‰æ‹©æ•°æ®çŠ¶æ€",clearable:""},model:{value:e.searchForm.FDocumentStatus,callback:function(t){e.$set(e.searchForm,"FDocumentStatus",t)},expression:"searchForm.FDocumentStatus"}},[a("el-option",{attrs:{label:"è‰ç¨¿",value:"DRAFT"}}),e._v(" "),a("el-option",{attrs:{label:"å·²å®¡æ ¸",value:"APPROVED"}}),e._v(" "),a("el-option",{attrs:{label:"å®¡æ ¸ä¸­",value:"PROCESSING"}})],1)],1)],1)],1),e._v(" "),a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:6}},[a("el-form-item",{attrs:{label:"æ—§ç‰©æ–™ç¼–ç "}},[a("el-input",{attrs:{placeholder:"è¯·è¾“å…¥æ—§ç‰©æ–™ç¼–ç ",clearable:""},model:{value:e.searchForm.FOldNumber,callback:function(t){e.$set(e.searchForm,"FOldNumber",t)},expression:"searchForm.FOldNumber"}})],1)],1),e._v(" "),a("el-col",{attrs:{span:6}},[a("el-form-item",{attrs:{label:"åŸºæœ¬å•ä½"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"è¯·é€‰æ‹©åŸºæœ¬å•ä½",clearable:""},model:{value:e.searchForm.FBaseUnitId_FNumber,callback:function(t){e.$set(e.searchForm,"FBaseUnitId_FNumber",t)},expression:"searchForm.FBaseUnitId_FNumber"}})],1)],1),e._v(" "),a("el-col",{attrs:{span:6}},[a("el-form-item",{attrs:{label:"ä»“åº“"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"è¯·é€‰æ‹©ä»“åº“",clearable:""},model:{value:e.searchForm.FStockId_FNumber,callback:function(t){e.$set(e.searchForm,"FStockId_FNumber",t)},expression:"searchForm.FStockId_FNumber"}})],1)],1),e._v(" "),a("el-col",{attrs:{span:6}},[a("el-form-item",{attrs:{label:"æ˜¯å¦é•¿æ–°ç‰©æ–™"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"è¯·é€‰æ‹©",clearable:""},model:{value:e.searchForm.F_TFQJ_CheckBox,callback:function(t){e.$set(e.searchForm,"F_TFQJ_CheckBox",t)},expression:"searchForm.F_TFQJ_CheckBox"}},[a("el-option",{attrs:{label:"æ˜¯",value:"1"}}),e._v(" "),a("el-option",{attrs:{label:"å¦",value:"0"}})],1)],1)],1)],1),e._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:e.showAdvanced,expression:"showAdvanced"}]},[a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:6}},[a("el-form-item",{attrs:{label:"BOMåˆ†ç±»"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"è¯·é€‰æ‹©BOMåˆ†ç±»",clearable:""},model:{value:e.searchForm.FBOMCATEGORY,callback:function(t){e.$set(e.searchForm,"FBOMCATEGORY",t)},expression:"searchForm.FBOMCATEGORY"}},[a("el-option",{attrs:{label:"æ ‡å‡†BOM",value:"STANDARD"}}),e._v(" "),a("el-option",{attrs:{label:"å·¥ç¨‹BOM",value:"ENGINEERING"}})],1)],1)],1),e._v(" "),a("el-col",{attrs:{span:6}},[a("el-form-item",{attrs:{label:"BOMç”¨é€”"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"è¯·é€‰æ‹©BOMç”¨é€”",clearable:""},model:{value:e.searchForm.FBOMUSE,callback:function(t){e.$set(e.searchForm,"FBOMUSE",t)},expression:"searchForm.FBOMUSE"}},[a("el-option",{attrs:{label:"ç”Ÿäº§ç”¨",value:"PRODUCTION"}}),e._v(" "),a("el-option",{attrs:{label:"è®¾è®¡ç”¨",value:"DESIGN"}})],1)],1)],1),e._v(" "),a("el-col",{attrs:{span:6}},[a("el-form-item",{attrs:{label:"ç‰©æ–™å±žæ€§"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"è¯·é€‰æ‹©ç‰©æ–™å±žæ€§",clearable:""},model:{value:e.searchForm.FITEMPPROPERTY,callback:function(t){e.$set(e.searchForm,"FITEMPPROPERTY",t)},expression:"searchForm.FITEMPPROPERTY"}},[a("el-option",{attrs:{label:"å¤–è´­",value:"PURCHASE"}}),e._v(" "),a("el-option",{attrs:{label:"è‡ªåˆ¶",value:"SELF_MADE"}}),e._v(" "),a("el-option",{attrs:{label:"å§”å¤–",value:"OUTSOURCE"}})],1)],1)],1),e._v(" "),a("el-col",{attrs:{span:6}},[a("el-form-item",{attrs:{label:"ç¦ç”¨çŠ¶æ€"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"è¯·é€‰æ‹©ç¦ç”¨çŠ¶æ€",clearable:""},model:{value:e.searchForm.FForbidStatus,callback:function(t){e.$set(e.searchForm,"FForbidStatus",t)},expression:"searchForm.FForbidStatus"}},[a("el-option",{attrs:{label:"å¯ç”¨",value:"ENABLE"}}),e._v(" "),a("el-option",{attrs:{label:"ç¦ç”¨",value:"DISABLE"}})],1)],1)],1)],1)],1),e._v(" "),a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:e.search}},[e._v("æŸ¥è¯¢æœç´¢")]),e._v(" "),a("el-button",{on:{click:e.resetForm}},[e._v("é‡ç½®")]),e._v(" "),a("el-button",{attrs:{type:"success"},on:{click:e.exportData}},[e._v("å¯¼å‡ºæ•°æ®")]),e._v(" "),a("el-button",{attrs:{type:"warning"},on:{click:e.handleSync}},[e._v("åŒæ­¥ç‰©æ–™")])],1)],1)],1),e._v(" "),e._m(0),e._v(" "),a("base-table",{ref:"baseTable",attrs:{currentPage:e.currentPage,"highlight-current-row":!0,pageSize:e.pageSize,tableData:e.tableList,tableDataloading:e.listLoading,total:e.total,"cell-style":{textAlign:"center"}},on:{"selection-change":e.handleSelectionChange,handleCurrentChange:e.baseTableHandleCurrentChange,handleSizeChange:e.baseTableHandleSizeChange}},[a("template",{slot:"law"},[a("el-table-column",{attrs:{label:"ä½¿ç”¨ç»„ç»‡",prop:"FUseOrgId",width:"150"}}),e._v(" "),a("el-table-column",{attrs:{label:"ç‰©æ–™ID",prop:"FMATERIALID",width:"150"}}),e._v(" "),a("el-table-column",{attrs:{label:"ç‰©æ–™ç¼–ç ",prop:"FNumber",width:"120"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-link",{attrs:{type:"primary"},on:{click:function(a){return e.handleView(t.row)}}},[e._v(e._s(t.row.FNumber))])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"ç‰©æ–™åç§°",prop:"FName"}}),e._v(" "),a("el-table-column",{attrs:{label:"è§„æ ¼åž‹å·",prop:"FSpecification",width:"120"}}),e._v(" "),a("el-table-column",{attrs:{label:"åŸºæœ¬å•ä½",prop:"FBaseUnitId.FName",width:"100"}}),e._v(" "),a("el-table-column",{attrs:{label:"ä»“åº“",prop:"FStockId_FName",width:"120"}}),e._v(" "),a("el-table-column",{attrs:{label:"è‹±æ–‡åç§°",prop:"FNameEn",width:"150"}}),e._v(" "),a("el-table-column",{attrs:{label:"æ•°æ®çŠ¶æ€",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-tag",{attrs:{type:e.getStatusType(t.row.FDocumentStatus)}},[e._v("\n                        "+e._s(e.getStatusText(t.row.FDocumentStatus))+"\n                    ")])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"ç¦ç”¨çŠ¶æ€",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-tag",{attrs:{type:"DISABLE"===t.row.FForbidStatus?"danger":"success"}},[e._v("\n                        "+e._s("DISABLE"===t.row.FForbidStatus?"ç¦ç”¨":"å¯ç”¨")+"\n                    ")])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"æ“ä½œ",fixed:"right",width:"200"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"text",size:"small"},on:{click:function(a){return e.handleViewFlowChart(t.row)}}},[e._v("æŸ¥çœ‹æµç¨‹å›¾")]),e._v(" "),a("el-button",{attrs:{type:"text",size:"small"},on:{click:function(a){return e.handleEdit(t.row)}}},[e._v("DIç ç®¡ç†")]),e._v(" "),a("el-button",{attrs:{type:"text",size:"small"},on:{click:function(a){return e.handleBarcodeRule(t.row)}}},[e._v("æ¡ç è§„åˆ™")]),e._v(" "),a("el-button",{attrs:{type:"text",size:"small"},on:{click:function(a){return e.handleOneSync(t.row)}}},[e._v("åŒæ­¥")])]}}])})],1)],2),e._v(" "),a("el-dialog",{attrs:{title:"create"===e.dialogStatus?"æ–°å¢žç‰©æ–™":"ç¼–è¾‘ç‰©æ–™",visible:e.dialogFormVisible,width:"60%"},on:{"update:visible":function(t){e.dialogFormVisible=t}}},[a("el-form",{ref:"dataForm",attrs:{model:e.dataForm,rules:e.rules,"label-width":"100px"}},[a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"ç‰©æ–™ç¼–ç ",prop:"FNumber"}},[a("el-input",{attrs:{readonly:"",disabled:"view"===e.dialogStatus,placeholder:"è¯·è¾“å…¥ç‰©æ–™ç¼–ç "},model:{value:e.dataForm.FNumber,callback:function(t){e.$set(e.dataForm,"FNumber",t)},expression:"dataForm.FNumber"}})],1)],1),e._v(" "),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"ç‰©æ–™åç§°",prop:"FName"}},[a("el-input",{attrs:{readonly:"",disabled:"view"===e.dialogStatus,placeholder:"è¯·è¾“å…¥ç‰©æ–™åç§°"},model:{value:e.dataForm.FName,callback:function(t){e.$set(e.dataForm,"FName",t)},expression:"dataForm.FName"}})],1)],1)],1),e._v(" "),a("el-row",[e._v("\n                DIç åˆ—è¡¨\n                "),a("div",{staticClass:"di-table-container"},[a("div",{staticClass:"di-table-header"},[a("el-button",{attrs:{type:"primary",size:"small"},on:{click:e.handleAddDI}},[e._v("æ–°å¢žDIç ")])],1),e._v(" "),a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.diNumList,border:""}},[a("el-table-column",{attrs:{prop:"diNum",label:"DIç "},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.isEdit?a("el-input",{attrs:{size:"small",placeholder:"è¯·è¾“å…¥DIç "},model:{value:t.row.diNum,callback:function(a){e.$set(t.row,"diNum",a)},expression:"scope.row.diNum"}}):a("span",[e._v(e._s(t.row.diNum))])]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"createTime",label:"åˆ›å»ºæ—¶é—´",width:"180"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                                "+e._s(e.formatDate(t.row.createTime))+"\n                            ")]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"æ“ä½œ",width:"200",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.isEdit?a("el-button",{attrs:{type:"success",size:"mini"},on:{click:function(a){return e.saveDI(t.row)}}},[e._v("ä¿å­˜")]):e._e(),e._v(" "),t.row.isEdit?a("el-button",{attrs:{type:"info",size:"mini"},on:{click:function(a){return e.cancelEdit(t.row)}}},[e._v("å–æ¶ˆ")]):e._e(),e._v(" "),t.row.isEdit?e._e():a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(a){return e.editDI(t.row)}}},[e._v("ç¼–è¾‘")]),e._v(" "),a("el-button",{attrs:{type:"danger",size:"mini"},on:{click:function(a){return e.deleteDI(t.row)}}},[e._v("åˆ é™¤")])]}}])})],1)],1)])],1),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.dialogFormVisible=!1}}},[e._v("å– æ¶ˆ")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:e.submitForm}},[e._v("ç¡® å®š")])],1)],1),e._v(" "),a("material-flow-chart",{attrs:{visible:e.flowChartDialogVisible,loading:e.flowChartLoading,"flow-data":e.processedFlowChartData},on:{"update:visible":function(t){e.flowChartDialogVisible=t}}}),e._v(" "),a("el-dialog",{attrs:{title:"åŒæ­¥ç‰©æ–™æ•°æ®",visible:e.syncDialogVisible,width:"500px"},on:{"update:visible":function(t){e.syncDialogVisible=t}}},[a("el-form",{ref:"syncForm",attrs:{model:e.syncForm,"label-width":"100px"}},[a("el-form-item",{attrs:{label:"åŒæ­¥æ–¹å¼"}},[a("el-radio-group",{model:{value:e.syncForm.syncType,callback:function(t){e.$set(e.syncForm,"syncType",t)},expression:"syncForm.syncType"}},[a("el-radio",{attrs:{label:"number"}},[e._v("æŒ‰ç‰©æ–™ç¼–å·åŒæ­¥")]),e._v(" "),a("el-radio",{attrs:{label:"date"}},[e._v("æŒ‰æ—¥æœŸåŒæ­¥")]),e._v(" "),a("el-radio",{attrs:{label:"all"}},[e._v("åŒæ­¥å…¨éƒ¨")])],1)],1),e._v(" "),"number"===e.syncForm.syncType?a("el-form-item",{attrs:{label:"ç‰©æ–™ç¼–å·"}},[a("el-input",{attrs:{type:"textarea",rows:3,placeholder:"è¯·è¾“å…¥ç‰©æ–™ç¼–å·ï¼Œå¤šä¸ªç¼–å·ç”¨è‹±æ–‡é€—å·åˆ†éš”"},model:{value:e.syncForm.materialNumbers,callback:function(t){e.$set(e.syncForm,"materialNumbers",t)},expression:"syncForm.materialNumbers"}})],1):e._e(),e._v(" "),"date"===e.syncForm.syncType?a("el-form-item",{attrs:{label:"å®¡æ ¸æ—¥æœŸ"}},[a("el-date-picker",{staticStyle:{width:"100%"},attrs:{type:"daterange","range-separator":"è‡³","start-placeholder":"å¼€å§‹æ—¥æœŸ","end-placeholder":"ç»“æŸæ—¥æœŸ","value-format":"yyyy-MM-dd"},model:{value:e.syncForm.dateRange,callback:function(t){e.$set(e.syncForm,"dateRange",t)},expression:"syncForm.dateRange"}})],1):e._e(),e._v(" "),a("el-form-item",{attrs:{label:"å•æ®çŠ¶æ€"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{disabled:"all"===e.syncForm.syncType,placeholder:"è¯·é€‰æ‹©å•æ®çŠ¶æ€"},model:{value:e.syncForm.documentStatus,callback:function(t){e.$set(e.syncForm,"documentStatus",t)},expression:"syncForm.documentStatus"}},[a("el-option",{attrs:{label:"å·²å®¡æ ¸",value:"C"}}),e._v(" "),a("el-option",{attrs:{label:"å®¡æ ¸ä¸­",value:"B"}}),e._v(" "),a("el-option",{attrs:{label:"è‰ç¨¿",value:"A"}})],1)],1)],1),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.syncDialogVisible=!1}}},[e._v("å– æ¶ˆ")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:e.confirmSync}},[e._v("ç¡® å®š")])],1)],1),e._v(" "),a("el-dialog",{attrs:{title:"æ¡ç è§„åˆ™ç®¡ç†",visible:e.barcodeRuleDialogVisible,width:"60%"},on:{"update:visible":function(t){e.barcodeRuleDialogVisible=t}}},[a("div",{staticClass:"barcode-rule-container"},[a("div",{staticClass:"barcode-rule-header"},[a("el-button",{attrs:{type:"primary",size:"small"},on:{click:e.handleAddBarcodeRule}},[e._v("æ–°å¢žè§„åˆ™ç»‘å®š")])],1),e._v(" "),a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.barcodeRuleList,border:""}},[a("el-table-column",{attrs:{prop:"barcodeRule.name",label:"è§„åˆ™åç§°"}}),e._v(" "),a("el-table-column",{attrs:{prop:"barcodeRule.description",label:"è§„åˆ™æè¿°"}}),e._v(" "),a("el-table-column",{attrs:{prop:"createTime",label:"åˆ›å»ºæ—¶é—´",width:"180"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                        "+e._s(e.formatDate(t.row.createTime))+"\n                    ")]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"æ“ä½œ",width:"150",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"danger",size:"mini"},on:{click:function(a){return e.deleteBarcodeRule(t.row)}}},[e._v("åˆ é™¤")])]}}])})],1)],1),e._v(" "),a("el-dialog",{attrs:{title:"æ–°å¢žè§„åˆ™ç»‘å®š",visible:e.addBarcodeRuleDialogVisible,width:"40%","append-to-body":""},on:{"update:visible":function(t){e.addBarcodeRuleDialogVisible=t}}},[a("el-form",{ref:"barcodeRuleForm",attrs:{model:e.barcodeRuleForm,"label-width":"100px"}},[a("el-form-item",{attrs:{label:"è§„åˆ™é€‰æ‹©",prop:"barcodeRule"}},[a("zr-select",{attrs:{collection:"barcodeRule","search-fields":["name","description"],"label-key":"name","sub-key":"_id",multiple:!1,placeholder:"è¯·è¾“å…¥è§„åˆ™åç§°/æè¿°æœç´¢"},on:{select:e.handleBarcodeRuleChange},scopedSlots:e._u([{key:"option",fn:function(t){var r=t.item;return[a("div",{staticClass:"select-option"},[a("div",{staticClass:"option-main"},[a("span",{staticClass:"option-label"},[e._v(e._s(r.name))]),e._v(" "),a("el-tag",{staticClass:"option-tag",attrs:{size:"mini",type:"info"}},[e._v("\n                                        "+e._s(r.description)+"\n                                    ")])],1)])]}}]),model:{value:e.barcodeRuleForm.barcodeRule,callback:function(t){e.$set(e.barcodeRuleForm,"barcodeRule",t)},expression:"barcodeRuleForm.barcodeRule"}})],1)],1),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.addBarcodeRuleDialogVisible=!1}}},[e._v("å– æ¶ˆ")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:e.saveBarcodeRule}},[e._v("ç¡® å®š")])],1)],1)],1)],1)}),[function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"screen1"},[a("div",{staticClass:"screen_content"},[a("div",{staticClass:"screen_content_first"},[a("i",{staticClass:"el-icon-tickets"},[e._v("ç‰©æ–™ç®¡ç†åˆ—è¡¨")])])])])}],!1,null,"1240f1a0",null);t.default=b.exports}}]);