(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-0ae27011"],{"128a":function(e,t,a){},3927:function(e,t,a){},8195:function(e,t,a){},"943f":function(e,t,a){"use strict";a("8195")},b58f:function(e,t,a){"use strict";a("3927")},c388:function(e,t,a){"use strict";a("f759")},d85c:function(e,t,a){"use strict";a("128a")},f759:function(e,t,a){},fb50:function(e,t,a){"use strict";a.r(t);var s,r=(a("20d6"),a("7f7f"),a("ade3")),n=a("3835"),o=(a("ffc1"),a("c5f6"),a("a481"),a("c7eb")),i=(a("96cf"),a("1da1")),c=a("5530"),l=(a("55dd"),a("ac6a"),a("5df3"),a("f400"),a("7e1e")),d={name:"FlowNode",props:{node:{type:Object,required:!0}}},u=(a("943f"),a("2877")),p=Object(u.a)(d,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"flow-level"},[a("div",{staticClass:"node-container"},[a("div",{staticClass:"material-node",class:{"root-node":!e.node.materialQuantity,completed:e.node.barcode}},[a("div",{staticClass:"node-title"},[e._v(e._s(e.node.materialName))]),e._v(" "),e.node.craftName?a("div",{staticClass:"node-subtitle"},[e._v("\n                工艺："+e._s(e.node.craftName)+"\n            ")]):e._e(),e._v(" "),e.node.barcode?a("div",{staticClass:"node-info"},[e._v("\n                条码："+e._s(e.node.barcode)+"\n            ")]):e._e(),e._v(" "),e.node.materialCode?a("div",{staticClass:"node-info"},[e._v("\n                编码："+e._s(e.node.materialCode)+"\n            ")]):e._e(),e._v(" "),e.node.scanOperation?a("div",{staticClass:"node-info"},[e._v("\n                扫码操作："+e._s(e.node.scanOperation?"需要扫码":"不需要扫码")+"\n            ")]):e._e(),e._v(" "),e.node.isComponent?a("div",{staticClass:"node-info"},[e._v("\n                是否组件："+e._s(e.node.isComponent?"是":"否")+"\n            ")]):e._e(),e._v(" "),e.node.materialQuantity?a("div",{staticClass:"node-info"},[e._v("\n                用量："+e._s(e.node.materialQuantity)+e._s(e.node.unit||"个")+"\n            ")]):e._e()])]),e._v(" "),e.node.children&&e.node.children.length?[e._m(0),e._v(" "),a("div",{staticClass:"process-level"},e._l(e.node.children,(function(t){return a("div",{key:t._id,staticClass:"process-container"},[a("div",{staticClass:"process-node"},[a("div",{staticClass:"node-title"},[e._v(e._s(t.processSort)+"."+e._s(t.processName))]),e._v(" "),a("div",{staticClass:"node-content"},[t.children&&t.children.length?e._l(t.children,(function(e){return a("div",{key:e._id,staticClass:"sub-material"},[a("flow-node",{attrs:{node:e}})],1)})):a("div",{staticClass:"no-materials"},[e._v("\n                            暂无关联物料\n                        ")])],2)])])})),0)]:e._e()],2)}),[function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"arrow-container"},[t("div",{staticClass:"arrow-right"})])}],!1,null,"adaa7214",null),m={name:"MaterialFlowChart",components:{FlowNode:p.exports},props:{visible:{type:Boolean,default:!1},loading:{type:Boolean,default:!1},flowData:{type:Array,default:function(){return[]}}},computed:{dialogVisible:{get:function(){return this.visible},set:function(e){this.$emit("update:visible",e)}}},data:function(){return{scale:1,minScale:.5,maxScale:2,scaleStep:.1,position:{x:0,y:0},isDragging:!1,dragStart:{x:0,y:0},lastPosition:{x:0,y:0}}},methods:{zoomIn:function(){this.scale<this.maxScale&&(this.scale=Math.min(this.scale+this.scaleStep,this.maxScale))},zoomOut:function(){this.scale>this.minScale&&(this.scale=Math.max(this.scale-this.scaleStep,this.minScale))},resetZoom:function(){this.scale=1,this.position={x:0,y:0}},handleWheel:function(e){e.ctrlKey&&(e.preventDefault(),e.deltaY<0?this.zoomIn():this.zoomOut())},startDrag:function(e){this.isDragging=!0,this.dragStart={x:e.clientX-this.position.x,y:e.clientY-this.position.y},this.lastPosition=Object(c.a)({},this.position)},onDrag:function(e){this.isDragging&&(e.preventDefault(),this.position={x:e.clientX-this.dragStart.x,y:e.clientY-this.dragStart.y})},stopDrag:function(){this.isDragging=!1}},mounted:function(){this.$el.querySelector(".flow-container").addEventListener("wheel",this.handleWheel,{passive:!1})},beforeDestroy:function(){this.$el.querySelector(".flow-container").removeEventListener("wheel",this.handleWheel)}},h=m,f=(a("b58f"),Object(u.a)(h,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"flow-chart-dialog",attrs:{title:"物料工艺流程图","custom-class":"material-flow-dialog"}},[a("div",{staticClass:"zoom-controls"},[a("el-button-group",[a("el-button",{attrs:{size:"small",icon:"el-icon-zoom-in"},on:{click:e.zoomIn}}),e._v(" "),a("el-button",{attrs:{size:"small",icon:"el-icon-zoom-out"},on:{click:e.zoomOut}}),e._v(" "),a("el-button",{attrs:{size:"small",icon:"el-icon-refresh"},on:{click:e.resetZoom}},[e._v("重置")])],1)],1),e._v(" "),a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"flow-container",on:{mousedown:e.startDrag,mousemove:e.onDrag,mouseup:e.stopDrag,mouseleave:e.stopDrag}},[a("div",{staticClass:"zoom-wrapper",style:{transform:"scale("+e.scale+") translate("+e.position.x+"px, "+e.position.y+"px)",cursor:e.isDragging?"grabbing":"grab"}},[e.flowData&&0!==e.flowData.length?[a("flow-node",{attrs:{node:e.flowData[0]}})]:a("div",{staticClass:"empty-data"},[e._v("\n                暂无流程图数据\n            ")])],2)])])}),[],!1,null,null,null)),b=f.exports,v={name:"InspectionList",props:{inspections:{type:Array,default:function(){return[]}}},methods:{formatDate:function(e){return e?new Date(e).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}):"暂无数据"}}},_=v,g=(a("d85c"),Object(u.a)(_,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-table",{attrs:{data:e.inspections,border:"","header-cell-style":{background:"#f5f7fa",color:"#606266",fontWeight:"bold",textAlign:"center"},"cell-style":{textAlign:"center"}}},[a("el-table-column",{attrs:{label:"检测项目",prop:"inspectionItem"}}),e._v(" "),a("el-table-column",{attrs:{label:"检测标准",prop:"standard"}}),e._v(" "),a("el-table-column",{attrs:{label:"检测结果",prop:"result"}}),e._v(" "),a("el-table-column",{attrs:{label:"检测时间",prop:"inspectionTime"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n      "+e._s(e.formatDate(t.row.inspectionTime))+"\n    ")]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"检测人员",prop:"inspector"}})],1)}),[],!1,null,"2dc68d9c",null)),w={name:"SaleOrder",components:{ProcessStepList:b,InspectionList:g.exports},data:function(){return{searchForm:{barcode:"",materialCode:"",status:"",dateRange:[],progress:""},tableList:[],total:0,currentPage:1,pageSize:10,listLoading:!0,showAdvanced:!1,dialogFormVisible:!1,dialogStatus:"",selection:[],dataForm:{barcode:"",materialCode:"",materialName:"",materialSpec:"",craftVersion:"",startTime:null,planCompletionTime:null,endTime:null,status:"PENDING",progress:0,processNodes:[],remark:""},rules:{FCustomerName:[{required:!0,message:"请输入客户名称",trigger:"blur"}],FDate:[{required:!0,message:"请选择订单日期",trigger:"change"}],FSaleDeptName:[{required:!0,message:"请输入销售部门",trigger:"blur"}]},processedFlowChartData:[],activeTab:"process",barcodeSearchVisible:!1,searchBarcode:"",searchResults:[],searchLoading:!1}},computed:{processedMaterialBarcodeData:function(){if(!this.dataForm.processNodes)return[];var e=new Map;return this.dataForm.processNodes.forEach((function(t){"PROCESS_STEP"===t.nodeType&&e.set(t.nodeId,{processName:t.processName,processCode:t.processCode})})),this.dataForm.processNodes.filter((function(e){return"MATERIAL"===e.nodeType&&e.barcode})).map((function(t){var a=t.parentNodeId?e.get(t.parentNodeId):null;return Object(c.a)(Object(c.a)({},t),{},{processName:a?a.processName:"-",processCode:a?a.processCode:""})})).sort((function(e,t){return new Date(t.scanTime||0)-new Date(e.scanTime||0)}))}},methods:(s={getProcessStatusType:function(e){return{PENDING:"info",IN_PROCESS:"warning",COMPLETED:"success",ABNORMAL:"danger"}[e]||"info"},getProcessStatusText:function(e){return{PENDING:"待处理",IN_PROCESS:"进行中",COMPLETED:"已完成",ABNORMAL:"异常"}[e]||e},fetchData:function(){var e=Object(i.a)(Object(o.a)().mark((function e(){var t,a;return Object(o.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.listLoading=!0,e.prev=1,(t=this.searchData()).page=this.currentPage,t.skip=(this.currentPage-1)*this.pageSize,t.limit=this.pageSize,t.sort={createAt:-1},t.count=!0,e.next=10,Object(l.b)("material_process_flow",t);case 10:200===(a=e.sent).code?(this.tableList=a.data,this.total=a.countnum||a.data.length):this.$message.error(a.msg||"获取数据失败"),e.next=18;break;case 14:e.prev=14,e.t0=e.catch(1),this.$message.error("获取数据失败: "+e.t0.message);case 18:return e.prev=18,this.listLoading=!1,e.finish(18);case 21:case"end":return e.stop()}}),e,this,[[1,14,18,21]])})));return function(){return e.apply(this,arguments)}}(),baseTableHandleCurrentChange:function(e){this.currentPage=e,this.fetchData()},baseTableHandleSizeChange:function(e){this.pageSize=e,this.fetchData()},toggleAdvanced:function(){this.showAdvanced=!this.showAdvanced},formatDate:function(e){return e?new Date(e).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}):"暂无数据"},formatNumber:function(e){return e||0===e?"¥"+Number(e).toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g,","):"¥0.00"},search:function(){this.currentPage=1,this.fetchData()},handleSelectionChange:function(e){this.selection=e},handleView:function(){var e=Object(i.a)(Object(o.a)().mark((function e(t){var a;return Object(o.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,this.listLoading=!0,e.next=4,Object(l.b)("material_process_flow",{query:{_id:t._id}});case 4:200===(a=e.sent).code&&a.data.length>0?(this.dataForm=a.data[0],this.processedFlowChartData=this.processNodes(this.dataForm.processNodes),this.dialogFormVisible=!0):this.$message.error("获取详情失败"),e.next=13;break;case 9:e.prev=9,e.t0=e.catch(0),this.$message.error("获取详情失败: "+e.t0.message);case 13:return e.prev=13,this.listLoading=!1,e.finish(13);case 16:case"end":return e.stop()}}),e,this,[[0,9,13,16]])})));return function(t){return e.apply(this,arguments)}}(),handleDelete:function(){var e=Object(i.a)(Object(o.a)().mark((function e(t){return Object(o.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.$confirm("确认要删除该订单吗？删除后不可恢复！","警告",{type:"warning",confirmButtonText:"确定删除",confirmButtonClass:"el-button--danger"});case 3:return e.next=5,Object(l.c)("k3_SAL_SaleOrder",t._id);case 5:this.$message.success("删除成功"),this.fetchData(),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0),"cancel"===e.t0?this.$message.info("已取消删除"):this.$message.error("删除失败");case 12:case"end":return e.stop()}}),e,this,[[0,9]])})));return function(t){return e.apply(this,arguments)}}(),handleSubmit:function(){var e=Object(i.a)(Object(o.a)().mark((function e(t){return Object(o.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,"edit"!==this.dialogStatus){e.next=7;break}return e.next=4,Object(l.d)("k3_SAL_SaleOrder",t._id,t);case 4:this.$message.success("更新成功"),e.next=10;break;case 7:return e.next=9,Object(l.a)("k3_SAL_SaleOrder",t);case 9:this.$message.success("添加成功");case 10:this.dialogFormVisible=!1,this.fetchData(),e.next=18;break;case 14:e.prev=14,e.t0=e.catch(0),this.$message.error("操作失败");case 18:case"end":return e.stop()}}),e,this,[[0,14]])})));return function(t){return e.apply(this,arguments)}}(),searchData:function(){var e={query:{$and:[]}};return Object.entries(this.searchForm).forEach((function(t){var a=Object(n.a)(t,2),s=a[0],o=a[1];if(o)switch(s){case"barcode":case"materialCode":o.trim()&&e.query.$and.push(Object(r.a)({},s,{$regex:o.trim(),$options:"i"}));break;case"status":e.query.$and.push(Object(r.a)({},s,o));break;case"progress":""!==o&&e.query.$and.push({progress:o});break;case"dateRange":Array.isArray(o)&&2===o.length&&e.query.$and.push({startTime:{$gte:o[0]+" 00:00:00",$lte:o[1]+" 23:59:59"}})}})),e.query.$and.length||delete e.query.$and,e},resetForm:function(){this.$refs.searchForm.resetFields(),this.searchForm={barcode:"",materialCode:"",status:"",dateRange:[],progress:""},this.currentPage=1,this.fetchData()},handleEdit:function(e){var t=this;this.dialogStatus="edit",this.dialogFormVisible=!0,this.$nextTick((function(){t.$refs.dataForm.resetFields(),t.dataForm=Object.assign({},e)}))}},Object(r.a)(Object(r.a)(Object(r.a)(Object(r.a)(Object(r.a)(Object(r.a)(Object(r.a)(Object(r.a)(Object(r.a)(Object(r.a)(s,"handleDelete",function(){var e=Object(i.a)(Object(o.a)().mark((function e(t){return Object(o.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.$confirm("确认要删除该订单吗？","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});case 3:return e.next=5,Object(l.c)("k3_SAL_SaleOrder",t._id);case 5:this.$message.success("删除成功"),this.fetchData(),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0),"cancel"!==e.t0&&this.$message.error("删除失败: "+e.t0.message);case 12:case"end":return e.stop()}}),e,this,[[0,9]])})));return function(t){return e.apply(this,arguments)}}()),"handleSubmitAudit",function(){var e=Object(i.a)(Object(o.a)().mark((function e(t){var a;return Object(o.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.$confirm("确认提交此订单进行审核？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});case 3:return a=Object(c.a)(Object(c.a)({},t),{},{FDocumentStatus:"B",FModifyDate:new Date,FModifierId:this.$store.state.user.name}),e.next=6,Object(l.d)("k3_SAL_SaleOrder",t._id,a);case 6:this.$message.success("提交审核成功"),this.fetchData(),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(0),"cancel"!==e.t0&&this.$message.error("提交审核失败: "+e.t0.message);case 13:case"end":return e.stop()}}),e,this,[[0,10]])})));return function(t){return e.apply(this,arguments)}}()),"submitForm",(function(){var e=this;this.$refs.dataForm.validate(function(){var t=Object(i.a)(Object(o.a)().mark((function t(a){return Object(o.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!a){t.next=19;break}if(t.prev=1,"create"!==e.dialogStatus){t.next=8;break}return t.next=5,Object(l.a)("k3_SAL_SaleOrder",e.dataForm);case 5:e.$message.success("创建成功"),t.next=11;break;case 8:return t.next=10,Object(l.d)("k3_SAL_SaleOrder",e.dataForm._id,e.dataForm);case 10:e.$message.success("更新成功");case 11:e.dialogFormVisible=!1,e.fetchData(),t.next=19;break;case 15:t.prev=15,t.t0=t.catch(1),e.$message.error("操作失败: "+t.t0.message);case 19:case"end":return t.stop()}}),t,null,[[1,15]])})));return function(e){return t.apply(this,arguments)}}())})),"getNodeIcon",(function(e){return{PROCESS_STEP:{icon:"el-icon-s-operation",color:"#409EFF"},MATERIAL:{icon:"el-icon-box",color:"#67c23a"}}[e.nodeType]||{icon:"el-icon-more",color:"#909399"}})),"getTimelineItemType",(function(e){return{COMPLETED:"success",IN_PROCESS:"primary",ABNORMAL:"danger",PENDING:"info"}[e]||"info"})),"getScanIcon",(function(e){if(!e.requireScan)return"el-icon-minus info";return{COMPLETED:"el-icon-check success",IN_PROCESS:"el-icon-loading warning",ABNORMAL:"el-icon-close danger",PENDING:"el-icon-time info"}[e.status]||"el-icon-time info"})),"getScanStatus",(function(e){if(!e.requireScan)return"无需扫码";return{COMPLETED:"已完成扫码",IN_PROCESS:"等待扫码",ABNORMAL:"扫码异常",PENDING:"未开始"}[e.status]||"未开始"})),"getActiveStep",(function(e){var t=e.findIndex((function(e){return"IN_PROCESS"===e.status}));return-1===t?e.filter((function(e){return"COMPLETED"===e.status})).length:t+1})),"getStepStatus",(function(e){return{COMPLETED:"success",IN_PROCESS:"process",ABNORMAL:"error",PENDING:"wait"}[e]||"wait"})),"getStepIcon",(function(e){return"PROCESS_STEP"===e.nodeType?"el-icon-s-operation":"el-icon-box"})),Object(r.a)(Object(r.a)(Object(r.a)(Object(r.a)(Object(r.a)(Object(r.a)(Object(r.a)(s,"getProcessOverallStatus",(function(e){return e.some((function(e){return"ABNORMAL"===e.status}))?"error":e.some((function(e){return"IN_PROCESS"===e.status}))?"process":e.every((function(e){return"COMPLETED"===e.status}))?"success":"wait"})),"getProcessSteps",(function(){return this.dataForm.processNodes.filter((function(e){return"PROCESS_STEP"===e.nodeType&&1===e.level})).sort((function(e,t){return e.processSort-t.processSort}))})),"getRelatedMaterials",(function(e){return this.dataForm.processNodes.filter((function(t){return"MATERIAL"===t.nodeType&&t.parentNodeId===e&&2===t.level}))})),"hasRequireScanMaterials",(function(e){return this.getRelatedMaterials(e).some((function(e){return e.requireScan}))})),"processNodes",(function(e){if(!e||!e.length)return[];var t=new Map;e.forEach((function(e){t.set(e.nodeId,Object(c.a)(Object(c.a)({},e),{},{children:[]}))}));var a=[];e.forEach((function(e){var s=t.get(e.nodeId);e.parentNodeId&&t.has(e.parentNodeId)?t.get(e.parentNodeId).children.push(s):a.push(s)}));var s=function(e){e.children&&e.children.length&&("PROCESS_STEP"===e.nodeType?e.children.sort((function(e,t){return(e.materialCode||"").localeCompare(t.materialCode||"")})):"MATERIAL"===e.nodeType&&e.children.sort((function(e,t){return(e.processSort||0)-(t.processSort||0)})),e.children.forEach((function(e){return s(e)})))};return a.forEach((function(e){return s(e)})),a})),"openBarcodeSearch",(function(){this.barcodeSearchVisible=!0,this.searchBarcode="",this.searchResults=[]})),"handleBarcodeSearch",function(){var e=Object(i.a)(Object(o.a)().mark((function e(){var t,a,s=this;return Object(o.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.searchBarcode.trim()){e.next=3;break}return this.$message.warning("请输入要搜索的条码"),e.abrupt("return");case 3:return this.searchLoading=!0,e.prev=4,t={query:{$or:[{barcode:this.searchBarcode.trim()},{"processNodes.barcode":this.searchBarcode.trim()}]}},e.next=8,Object(l.b)("material_process_flow",t);case 8:200===(a=e.sent).code&&a.data?(this.searchResults=[],a.data.forEach((function(e){e.barcode===s.searchBarcode.trim()&&s.searchResults.push(Object(c.a)({isMainBarcode:!0,barcode:e.barcode,materialCode:e.materialCode,materialName:e.materialName,materialSpec:e.materialSpec,status:e.status},e)),e.processNodes.filter((function(e){return e.barcode===s.searchBarcode.trim()})).forEach((function(t){s.searchResults.push(Object(c.a)({isMainBarcode:!1,barcode:t.barcode,materialCode:t.materialCode,materialName:t.materialName,materialSpec:t.materialSpec,status:t.status,mainBarcode:e.barcode,mainBarcodeData:e,processName:t.processName,processCode:t.processCode,scanTime:t.scanTime},t))}))}))):this.$message.error(a.msg||"搜索失败"),e.next=16;break;case 12:e.prev=12,e.t0=e.catch(4),this.$message.error("搜索失败: "+e.t0.message);case 16:return e.prev=16,this.searchLoading=!1,e.finish(16);case 19:case"end":return e.stop()}}),e,this,[[4,12,16,19]])})));return function(){return e.apply(this,arguments)}}())),created:function(){this.fetchData()}},S=w,y=(a("c388"),Object(u.a)(S,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"app-container"},[a("el-card",{staticClass:"filter-container"},[a("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[a("span",[e._v("筛选搜索")]),e._v(" "),a("el-button",{staticStyle:{float:"right",padding:"3px 0"},attrs:{type:"text"},on:{click:e.toggleAdvanced}},[e._v("\n                "+e._s(e.showAdvanced?"收起":"展开")+"高级搜索\n            ")])],1),e._v(" "),a("el-form",{ref:"searchForm",staticClass:"demo-form-inline",attrs:{model:e.searchForm}},[a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:6}},[a("el-form-item",{attrs:{label:"主条码"}},[a("el-input",{attrs:{placeholder:"请输入主条码",clearable:""},model:{value:e.searchForm.barcode,callback:function(t){e.$set(e.searchForm,"barcode",t)},expression:"searchForm.barcode"}})],1)],1),e._v(" "),a("el-col",{attrs:{span:6}},[a("el-form-item",{attrs:{label:"物料编码"}},[a("el-input",{attrs:{placeholder:"请输入物料编码",clearable:""},model:{value:e.searchForm.materialCode,callback:function(t){e.$set(e.searchForm,"materialCode",t)},expression:"searchForm.materialCode"}})],1)],1),e._v(" "),a("el-col",{attrs:{span:6}},[a("el-form-item",{attrs:{label:"流程状态"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择流程状态",clearable:""},model:{value:e.searchForm.status,callback:function(t){e.$set(e.searchForm,"status",t)},expression:"searchForm.status"}},[a("el-option",{attrs:{label:"待处理",value:"PENDING"}}),e._v(" "),a("el-option",{attrs:{label:"进行中",value:"IN_PROCESS"}}),e._v(" "),a("el-option",{attrs:{label:"已完成",value:"COMPLETED"}}),e._v(" "),a("el-option",{attrs:{label:"异常",value:"ABNORMAL"}})],1)],1)],1)],1),e._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:e.showAdvanced,expression:"showAdvanced"}]},[a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"开始时间"}},[a("el-date-picker",{staticStyle:{width:"100%"},attrs:{type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","value-format":"yyyy-MM-dd"},model:{value:e.searchForm.dateRange,callback:function(t){e.$set(e.searchForm,"dateRange",t)},expression:"searchForm.dateRange"}})],1)],1),e._v(" "),a("el-col",{attrs:{span:6}},[a("el-form-item",{attrs:{label:"完成进度"}},[a("el-input-number",{attrs:{min:0,max:100,placeholder:"完成进度"},model:{value:e.searchForm.progress,callback:function(t){e.$set(e.searchForm,"progress",t)},expression:"searchForm.progress"}})],1)],1)],1)],1),e._v(" "),a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:e.search}},[e._v("查询搜索")]),e._v(" "),a("el-button",{on:{click:e.resetForm}},[e._v("重置")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:e.openBarcodeSearch}},[e._v("成品追溯")])],1)],1)],1),e._v(" "),e._m(0),e._v(" "),a("base-table",{ref:"baseTable",attrs:{currentPage:e.currentPage,"highlight-current-row":!0,pageSize:e.pageSize,tableData:e.tableList,tableDataloading:e.listLoading,total:e.total,"cell-style":{textAlign:"center"}},on:{"selection-change":e.handleSelectionChange,handleCurrentChange:e.baseTableHandleCurrentChange,handleSizeChange:e.baseTableHandleSizeChange}},[a("template",{slot:"law"},[a("el-table-column",{attrs:{label:"主条码",prop:"barcode"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                    "+e._s(t.row.barcode)+"\n                ")]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"物料信息"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",[e._v("编码："+e._s(t.row.materialCode))]),e._v(" "),a("div",[e._v("名称："+e._s(t.row.materialName))]),e._v(" "),a("div",[e._v("规格："+e._s(t.row.materialSpec))])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"流程状态",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-tag",{attrs:{type:e.getProcessStatusType(t.row.status)}},[e._v("\n                        "+e._s(e.getProcessStatusText(t.row.status))+"\n                    ")])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"完成进度",width:"200"},scopedSlots:e._u([{key:"default",fn:function(e){return[a("el-progress",{attrs:{percentage:e.row.progress||0}})]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"操作",fixed:"right",width:"200"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"text",size:"small"},on:{click:function(a){return e.handleView(t.row)}}},[e._v("查看")])]}}])})],1)],2),e._v(" "),a("el-dialog",{staticClass:"process-flow-dialog",attrs:{title:"工艺流程详情 - "+e.dataForm.barcode,visible:e.dialogFormVisible,width:"80%","close-on-click-modal":!1},on:{"update:visible":function(t){e.dialogFormVisible=t}}},[a("div",{staticClass:"process-flow-container"},[a("div",{staticClass:"process-section"},[a("el-card",{staticClass:"process-card"},[a("div",{attrs:{slot:"header"},slot:"header"},[a("span",[a("i",{staticClass:"el-icon-time"}),e._v(" 工艺流程")])]),e._v(" "),a("div",{staticClass:"process-flow"},[a("div",{staticClass:"main-material"},[a("div",{staticClass:"main-material-header"},[a("i",{staticClass:"el-icon-box"}),e._v(" "),a("span",{staticClass:"title"},[e._v("主产品信息")]),e._v(" "),a("el-tag",{attrs:{type:"primary",size:"mini"}},[e._v(e._s(e.dataForm.materialCode))])],1),e._v(" "),a("div",{staticClass:"main-material-content"},[a("div",{staticClass:"info-row"},[a("div",{staticClass:"info-item"},[a("label",[e._v("产品条码：")]),e._v(" "),a("span",[e._v(e._s(e.dataForm.barcode))])])]),e._v(" "),a("div",{staticClass:"info-row"},[a("div",{staticClass:"info-item"},[a("label",[e._v("物料名称：")]),e._v(" "),a("span",[e._v(e._s(e.dataForm.materialName))])]),e._v(" "),a("div",{staticClass:"info-item"},[a("label",[e._v("规格型号：")]),e._v(" "),a("span",[e._v(e._s(e.dataForm.materialSpec))])])]),e._v(" "),a("div",{staticClass:"info-row"},[a("div",{staticClass:"info-item"},[a("label",[e._v("整体进度：")]),e._v(" "),a("el-progress",{attrs:{percentage:e.dataForm.progress||0}})],1),e._v(" "),a("div",{staticClass:"info-item"},[a("label",[e._v("当前状态：")]),e._v(" "),a("el-tag",{attrs:{type:e.getProcessStatusType(e.dataForm.status)}},[e._v("\n                                            "+e._s(e.getProcessStatusText(e.dataForm.status))+"\n                                        ")])],1)])])]),e._v(" "),a("el-tabs",{attrs:{type:"border-card"},model:{value:e.activeTab,callback:function(t){e.activeTab=t},expression:"activeTab"}},[a("el-tab-pane",{attrs:{label:"工序信息",name:"process"}},[a("process-step-list",{ref:"processStepList",attrs:{loading:e.listLoading,"flow-data":e.processedFlowChartData}})],1),e._v(" "),a("el-tab-pane",{attrs:{label:"物料信息",name:"material"}},[a("div",{staticClass:"material-info-container"},[a("div",{staticClass:"table-header"},[a("i",{staticClass:"el-icon-box"}),e._v(" "),a("span",[e._v("工艺物料清单")])]),e._v(" "),a("el-table",{staticClass:"material-table",attrs:{data:e.processedFlowChartData[0]&&e.processedFlowChartData[0].children?e.processedFlowChartData[0].children.filter((function(e){return"PROCESS_STEP"===e.nodeType})):[],border:"","header-cell-style":{background:"#f5f7fa",color:"#606266",fontWeight:"bold",fontSize:"14px",textAlign:"center",height:"50px"},"cell-style":{textAlign:"center"}}},[a("el-table-column",{attrs:{label:"工序",width:"180"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",{staticClass:"process-info"},[a("el-tag",{attrs:{size:"medium",type:e.getProcessStatusType(t.row.status)}},[e._v("\n                                                        "+e._s(t.row.processName)+"\n                                                        "),a("el-tag",{attrs:{size:"mini",type:"info"}},[e._v(e._s(t.row.processCode))])],1)],1)]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"关联物料"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.children&&t.row.children.length?a("el-table",{staticClass:"inner-table",attrs:{data:t.row.children.filter((function(e){return"MATERIAL"===e.nodeType})),border:""}},[a("el-table-column",{attrs:{label:"物料编码",prop:"materialCode","min-width":"120"}}),e._v(" "),a("el-table-column",{attrs:{label:"物料名称",prop:"materialName","min-width":"150"}}),e._v(" "),a("el-table-column",{attrs:{label:"规格型号",prop:"materialSpec","min-width":"120"}}),e._v(" "),a("el-table-column",{attrs:{label:"数量",width:"80"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                                                            "+e._s(t.row.materialQuantity)+" "+e._s(t.row.materialUnit)+"\n                                                        ")]}}],null,!0)}),e._v(" "),a("el-table-column",{attrs:{label:"状态",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-tag",{attrs:{type:e.getProcessStatusType(t.row.status),size:"small"}},[e._v("\n                                                                "+e._s(e.getProcessStatusText(t.row.status))+"\n                                                            ")])]}}],null,!0)}),e._v(" "),a("el-table-column",{attrs:{label:"条码","min-width":"150"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.barcode?a("span",[e._v(e._s(t.row.barcode))]):a("span",{staticClass:"no-barcode"},[e._v("-")])]}}],null,!0)}),e._v(" "),a("el-table-column",{attrs:{label:"类型",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.isComponent?a("el-tag",{attrs:{type:"warning",size:"mini"}},[e._v("组件")]):e._e(),e._v(" "),t.row.isKeyMaterial?a("el-tag",{attrs:{type:"danger",size:"mini"}},[e._v("关键")]):e._e(),e._v(" "),t.row.isComponent||t.row.isKeyMaterial?e._e():a("span",[e._v("-")])]}}],null,!0)})],1):a("div",{staticClass:"no-material"},[e._v("暂无关联物料")])]}}])})],1)],1)]),e._v(" "),a("el-tab-pane",{attrs:{label:"物料条码信息",name:"materialBarcode"}},[a("el-table",{attrs:{data:e.processedMaterialBarcodeData,border:"","header-cell-style":{background:"#f5f7fa",color:"#606266",fontWeight:"bold",textAlign:"center"},"cell-style":{textAlign:"center"}}},[a("el-table-column",{attrs:{label:"条码",prop:"barcode","min-width":"150"}}),e._v(" "),a("el-table-column",{attrs:{label:"物料编码",prop:"materialCode","min-width":"120"}}),e._v(" "),a("el-table-column",{attrs:{label:"物料名称",prop:"materialName","min-width":"150"}}),e._v(" "),a("el-table-column",{attrs:{label:"规格型号",prop:"materialSpec","min-width":"120"}}),e._v(" "),a("el-table-column",{attrs:{label:"状态",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-tag",{attrs:{type:e.getProcessStatusType(t.row.status)}},[e._v("\n                                                "+e._s(e.getProcessStatusText(t.row.status))+"\n                                            ")])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"所属工序","min-width":"120"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-tag",{attrs:{size:"medium",type:"info"}},[e._v("\n                                                "+e._s(t.row.processName)+"\n                                                "),t.row.processCode?a("el-tag",{attrs:{size:"mini",type:"info"}},[e._v("\n                                                    "+e._s(t.row.processCode)+"\n                                                ")]):e._e()],1)]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"扫码时间",width:"160"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                                            "+e._s(e.formatDate(t.row.scanTime))+"\n                                        ")]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"绑定人员",prop:"bindOperator",width:"100"}}),e._v(" "),a("el-table-column",{attrs:{label:"备注","min-width":"150"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.remark?a("el-tooltip",{attrs:{content:t.row.remark,placement:"top"}},[a("span",[e._v(e._s(t.row.remark))])]):a("span",[e._v("-")])]}}])})],1)],1),e._v(" "),a("el-tab-pane",{attrs:{label:"检测信息",name:"inspection"}},[a("inspection-list",{attrs:{inspections:e.dataForm.processNodes||[]}})],1),e._v(" "),a("el-tab-pane",{attrs:{label:"解绑信息",name:"unbind"}},[a("el-table",{attrs:{data:e.dataForm.unbindRecords||[],border:""}},[a("el-table-column",{attrs:{label:"解绑时间",prop:"unbindTime"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                                            "+e._s(e.formatDate(t.row.unbindTime))+"\n                                        ")]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"解绑原因",prop:"reason"}}),e._v(" "),a("el-table-column",{attrs:{label:"操作人",prop:"operator"}}),e._v(" "),a("el-table-column",{attrs:{label:"备注",prop:"remark"}})],1)],1)],1)],1)])],1)])]),e._v(" "),a("el-dialog",{attrs:{title:"条码查询",visible:e.barcodeSearchVisible,width:"70%","close-on-click-modal":!1},on:{"update:visible":function(t){e.barcodeSearchVisible=t}}},[a("div",{staticClass:"barcode-search-container"},[a("div",{staticClass:"search-area"},[a("el-input",{attrs:{placeholder:"请输入条码",clearable:""},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleBarcodeSearch(t)}},model:{value:e.searchBarcode,callback:function(t){e.searchBarcode=t},expression:"searchBarcode"}},[a("el-button",{attrs:{slot:"append",icon:"el-icon-search"},on:{click:e.handleBarcodeSearch},slot:"append"},[e._v("\n                        搜索\n                    ")])],1)],1),e._v(" "),a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.searchLoading,expression:"searchLoading"}],staticClass:"search-result"},[e.searchResults.length?a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.searchResults,border:"","header-cell-style":{background:"#f5f7fa",color:"#606266",fontWeight:"bold",textAlign:"center"},"cell-style":{textAlign:"center"}}},[a("el-table-column",{attrs:{label:"条码类型",width:"120"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-tag",{attrs:{type:t.row.isMainBarcode?"primary":"success"}},[e._v("\n                                "+e._s(t.row.isMainBarcode?"主条码":"子条码")+"\n                            ")])]}}],null,!1,1158433612)}),e._v(" "),a("el-table-column",{attrs:{label:"条码",prop:"barcode","min-width":"150"}}),e._v(" "),a("el-table-column",{attrs:{label:"物料信息","min-width":"200"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",[e._v("编码："+e._s(t.row.materialCode))]),e._v(" "),a("div",[e._v("名称："+e._s(t.row.materialName))]),e._v(" "),a("div",[e._v("规格："+e._s(t.row.materialSpec))])]}}],null,!1,2839144854)}),e._v(" "),a("el-table-column",{attrs:{label:"所属主条码","min-width":"150"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.isMainBarcode?a("span",[e._v("-")]):a("el-button",{attrs:{type:"text"},on:{click:function(a){return e.handleView(t.row.mainBarcodeData)}}},[e._v("\n                                "+e._s(t.row.mainBarcode)+"\n                            ")])]}}],null,!1,146026579)}),e._v(" "),a("el-table-column",{attrs:{label:"状态",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-tag",{attrs:{type:e.getProcessStatusType(t.row.status)}},[e._v("\n                                "+e._s(e.getProcessStatusText(t.row.status))+"\n                            ")])]}}],null,!1,363000109)}),e._v(" "),a("el-table-column",{attrs:{label:"所属工序","min-width":"150"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.isMainBarcode?a("span",[e._v("-")]):[a("el-tag",{attrs:{size:"medium",type:"info"}},[e._v("\n                                    "+e._s(t.row.processName)+"\n                                    "),t.row.processCode?a("el-tag",{attrs:{size:"mini",type:"info"}},[e._v("\n                                        "+e._s(t.row.processCode)+"\n                                    ")]):e._e()],1)]]}}],null,!1,769390516)}),e._v(" "),a("el-table-column",{attrs:{label:"操作",width:"120",fixed:"right"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"text"},on:{click:function(a){return e.handleView(t.row.isMainBarcode?t.row:t.row.mainBarcodeData)}}},[e._v("\n                                查看详情\n                            ")])]}}],null,!1,870936660)})],1):e.searchLoading?e._e():a("div",{staticClass:"no-result"},[a("i",{staticClass:"el-icon-warning-outline"}),e._v(" "),a("span",[e._v("暂无搜索结果")])])],1)])])],1)}),[function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"screen1"},[a("div",{staticClass:"screen_content"},[a("div",{staticClass:"screen_content_first"},[a("i",{staticClass:"el-icon-tickets"},[e._v("主条码生产流程列表")])])])])}],!1,null,"32543915",null));t.default=y.exports}}]);