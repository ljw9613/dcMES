(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-3dbecd17"],{2790:function(e,t,a){},"31b6":function(e,t,a){e.exports=a.p+"static/media/bdcg.762434df.mp3"},"33fd":function(e,t,a){e.exports=a.p+"static/media/tmyw.a5dd40df.mp3"},ccd6:function(e,t,a){"use strict";a("2790")},de6b:function(e,t,a){e.exports=a.p+"static/media/smcg.fe637541.mp3"},f783:function(e,t,a){"use strict";a.r(t);var r=(a("a481"),a("8615"),a("7514"),a("28a5"),a("6762"),a("2fdb"),a("1c4c"),a("b85c")),s=(a("ac6a"),a("5df3"),a("4f7f"),a("c7eb")),n=(a("96cf"),a("1da1")),i=a("7e1e"),c=a("b775");function o(e){return Object(c.a)({url:"/create-flow",method:"post",data:e})}function l(e){return Object(c.a)({url:"/scan-components",method:"post",data:e})}var u=a("6ace");function d(e){new Audio(e).play().catch((function(e){console.warn("éŸ³é¢‘æ’­æ”¾å¤±è´¥:",e)}))}var p=a("de6b"),m=a.n(p),h=a("33fd"),f=a.n(h),b=a("31b6"),v=a.n(b),g={name:"ScanBarCode",components:{ZrSelect:u.a},data:function(){return{formData:{productModel:"",productLine:"",processStep:"",componentName:""},productOptions:[],processStepOptions:[],materialOptions:[],materialLoading:!1,mainMaterialName:"",mainMaterialCode:"",processMaterials:[],scanForm:{mainBarcode:"",barcodes:{}},productLineOptions:[{_id:"1",FNumber:"1",FName:"äº§çº¿1"},{_id:"2",FNumber:"2",FName:"äº§çº¿2"}],validateStatus:{mainBarcode:!1},loading:!1,unifiedScanInput:"",hasEditPermission:!1}},computed:{mainMaterialId:{get:function(){return localStorage.getItem("mainMaterialId")||""},set:function(e){localStorage.setItem("mainMaterialId",e)}},processStepId:{get:function(){return localStorage.getItem("processStepId")||""},set:function(e){localStorage.setItem("processStepId",e)}},materialName:{get:function(){return localStorage.getItem("materialName")||""},set:function(e){localStorage.setItem("materialName",e)}},processName:{get:function(){return localStorage.getItem("processName")||""},set:function(e){localStorage.setItem("processName",e)}},productLineId:{get:function(){return localStorage.getItem("productLineId")||""},set:function(e){localStorage.setItem("productLineId",e)}},productLineName:{get:function(){return localStorage.getItem("productLineName")||""},set:function(e){localStorage.setItem("productLineName",e)}}},watch:{mainMaterialId:function(){var e=Object(n.a)(Object(s.a)().mark((function e(t){return Object(s.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t){e.next=5;break}return e.next=3,this.getMainMaterialInfo();case 3:e.next=6;break;case 5:this.mainMaterialName="";case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),processStepId:function(){var e=Object(n.a)(Object(s.a)().mark((function e(t){return Object(s.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t){e.next=5;break}return e.next=3,this.getProcessMaterials();case 3:e.next=8;break;case 5:this.processMaterials=[],this.scanForm.barcodes={},this.validateStatus={mainBarcode:!1};case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),validateStatus:{handler:function(e){},deep:!0}},methods:{handleProductionLineSelect:function(e){e&&(this.formData.lineName=e.lineName,this.formData.productLine=e._id)},getMaterialById:function(){var e=Object(n.a)(Object(s.a)().mark((function e(t){var a;return Object(s.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(i.b)("k3_BD_MATERIAL",{query:{_id:t}});case 2:return a=e.sent,e.abrupt("return",a.data[0]);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),getCraftByMaterialId:function(){var e=Object(n.a)(Object(s.a)().mark((function e(t){var a;return Object(s.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(i.b)("craft",{query:{materialId:t}});case 2:return a=e.sent,e.abrupt("return",a.data[0]);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),getProcessStepById:function(){var e=Object(n.a)(Object(s.a)().mark((function e(t){var a;return Object(s.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(i.b)("processStep",{query:{_id:t}});case 2:return a=e.sent,e.abrupt("return",a.data[0]);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),getProcessMaterialById:function(){var e=Object(n.a)(Object(s.a)().mark((function e(t){var a;return Object(s.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(i.b)("processMaterials",{query:{_id:t}});case 2:return a=e.sent,e.abrupt("return",a.data[0]);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),getMaterialList:function(){var e=Object(n.a)(Object(s.a)().mark((function e(t){var a;return Object(s.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(""===t){e.next=18;break}return this.materialLoading=!0,e.prev=2,e.next=5,Object(i.b)("k3_BD_MATERIAL",{query:{$or:[{FNumber:{$regex:t,$options:"i"}},{FName:{$regex:t,$options:"i"}}]},page:1,limit:20});case 5:a=e.sent,this.productOptions=a.data,e.next=13;break;case 9:e.prev=9,e.t0=e.catch(2),console.error("è·å–äº§å“å‹å·å¤±è´¥:",e.t0),this.$message.error("è·å–äº§å“å‹å·å¤±è´¥");case 13:return e.prev=13,this.materialLoading=!1,e.finish(13);case 16:e.next=19;break;case 18:this.productOptions=[];case 19:case"end":return e.stop()}}),e,this,[[2,9,13,16]])})));return function(t){return e.apply(this,arguments)}}(),getAllProcessSteps:function(){var e=Object(n.a)(Object(s.a)().mark((function e(t){var a,n,c,o,l,u,d,p,m,h,f=arguments;return Object(s.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=f.length>1&&void 0!==f[1]?f[1]:new Set,e.prev=1,e.next=4,this.getCraftByMaterialId(t);case 4:if((n=e.sent)&&n.processSteps){e.next=7;break}return e.abrupt("return",a);case 7:c=Object(r.a)(n.processSteps),e.prev=8,c.s();case 10:if((o=c.n()).done){e.next=40;break}return l=o.value,e.next=14,this.getProcessStepById(l);case 14:if(!(u=e.sent)){e.next=38;break}return a.add(u),e.next=19,Object(i.b)("processMaterials",{query:{processStepId:l}});case 19:if(!(d=e.sent).data){e.next=38;break}p=Object(r.a)(d.data),e.prev=22,p.s();case 24:if((m=p.n()).done){e.next=30;break}return h=m.value,e.next=28,this.getAllProcessSteps(h.materialId,a);case 28:e.next=24;break;case 30:e.next=35;break;case 32:e.prev=32,e.t0=e.catch(22),p.e(e.t0);case 35:return e.prev=35,p.f(),e.finish(35);case 38:e.next=10;break;case 40:e.next=45;break;case 42:e.prev=42,e.t1=e.catch(8),c.e(e.t1);case 45:return e.prev=45,c.f(),e.finish(45);case 48:return e.abrupt("return",a);case 51:return e.prev=51,e.t2=e.catch(1),console.error("è·å–å·¥åºå¤±è´¥:",e.t2),e.abrupt("return",a);case 55:case"end":return e.stop()}}),e,this,[[1,51],[8,42,45,48],[22,32,35,38]])})));return function(t){return e.apply(this,arguments)}}(),handleProductChange:function(){var e=Object(n.a)(Object(s.a)().mark((function e(t){var a,r;return Object(s.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=t._id,this.processStepOptions=[],this.formData.processStep="",this.mainMaterialId="",a){e.next=6;break}return e.abrupt("return");case 6:return e.prev=6,e.next=9,this.getAllProcessSteps(a);case 9:r=e.sent,console.log("ğŸš€ ~ handleProductChange ~ processSteps:",r),this.processStepOptions=Array.from(r),this.formData.productModel=a,e.next=19;break;case 15:e.prev=15,e.t0=e.catch(6),console.error("è·å–å·¥åºåˆ—è¡¨å¤±è´¥:",e.t0),this.$message.error("è·å–å·¥åºåˆ—è¡¨å¤±è´¥");case 19:case"end":return e.stop()}}),e,this,[[6,15]])})));return function(t){return e.apply(this,arguments)}}(),handleProcessChange:function(e){e?this.formData.processStep=e:this.processStepId=""},handleSave:function(){var e=Object(n.a)(Object(s.a)().mark((function e(){var t,a,r;return Object(s.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.formData.productModel&&this.formData.processStep&&this.formData.productLine){e.next=3;break}return this.$message.warning("è¯·é€‰æ‹©äº§å“å‹å·ã€å·¥åºå’Œäº§çº¿"),e.abrupt("return");case 3:return t=this.$loading({lock:!0,text:"ä¿å­˜ä¸­...",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"}),e.prev=4,this.resetScanForm(),this.mainMaterialId=this.formData.productModel,this.processStepId=this.formData.processStep,this.productLineId=this.formData.productLine,e.next=11,this.getMaterialById(this.formData.productModel);case 11:return(a=e.sent)&&(this.materialName="".concat(a.FNumber," - ").concat(a.FName)),e.next=15,this.getProcessStepById(this.formData.processStep);case 15:(r=e.sent)&&(this.processName=r.processName),this.$message.success("ä¿å­˜æˆåŠŸ"),setTimeout((function(){t.close(),window.location.reload()}),500),e.next=26;break;case 21:e.prev=21,e.t0=e.catch(4),console.error("ä¿å­˜å¤±è´¥:",e.t0),this.$message.error("ä¿å­˜å¤±è´¥"),t.close();case 26:case"end":return e.stop()}}),e,this,[[4,21]])})));return function(){return e.apply(this,arguments)}}(),getMainMaterialInfo:function(){var e=Object(n.a)(Object(s.a)().mark((function e(){var t;return Object(s.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,console.log("æ­£åœ¨è·å–ä¸»ç‰©æ–™ä¿¡æ¯ï¼ŒID:",this.mainMaterialId),e.next=4,Object(i.b)("k3_BD_MATERIAL",{query:{_id:this.mainMaterialId},page:1,limit:1});case 4:(t=e.sent).data&&t.data[0]?(console.log("è·å–åˆ°çš„ä¸»ç‰©æ–™ä¿¡æ¯:",t.data[0]),this.mainMaterialName=t.data[0].FName,this.mainMaterialCode=t.data[0].FNumber):(console.log("æœªæ‰¾åˆ°ä¸»ç‰©æ–™ä¿¡æ¯"),this.mainMaterialName="",this.mainMaterialCode=""),e.next=14;break;case 8:e.prev=8,e.t0=e.catch(0),console.error("è·å–ä¸»ç‰©æ–™ä¿¡æ¯å¤±è´¥:",e.t0),this.$message.error("è·å–ä¸»ç‰©æ–™ä¿¡æ¯å¤±è´¥"),this.mainMaterialName="",this.mainMaterialCode="";case 14:case"end":return e.stop()}}),e,this,[[0,8]])})));return function(){return e.apply(this,arguments)}}(),getProcessMaterials:function(){var e=Object(n.a)(Object(s.a)().mark((function e(){var t,a,r,n,c,o,l,u=this;return Object(s.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,console.log("æ­£åœ¨è·å–å·¥åºä¿¡æ¯ï¼ŒID:",this.processStepId),e.next=4,Object(i.b)("processStep",{query:{_id:this.processStepId},page:1,limit:1});case 4:if((t=e.sent).data&&0!==!t.data.length){e.next=7;break}throw new Error("æœªæ‰¾åˆ°å·¥åºä¿¡æ¯");case 7:return a=t.data[0],e.next=10,Object(i.b)("craft",{query:{processSteps:this.processStepId},page:1,limit:1});case 10:if((r=e.sent).data&&0!==!r.data.length){e.next=13;break}throw new Error("æœªæ‰¾åˆ°å·¥è‰ºä¿¡æ¯");case 13:return n=r.data[0],e.next=16,this.getMaterialById(n.materialId);case 16:if(c=e.sent){e.next=19;break}throw new Error("æœªæ‰¾åˆ°ç‰©æ–™ä¿¡æ¯");case 19:if(this.mainMaterialName=c.FName,this.mainMaterialCode=c.FNumber,!(a.materials&&a.materials.length>0)){e.next=32;break}return o=a.materials.map((function(e){return Object(i.b)("processMaterials",{query:{_id:e},page:1,limit:1})})),e.next=25,Promise.all(o);case 25:l=e.sent,this.processMaterials=l.map((function(e){return e.data[0]})).filter((function(e){return e})),this.validateStatus={mainBarcode:!1},this.scanForm.barcodes={},this.processMaterials.forEach((function(e){u.validateStatus[e._id]=!1,u.$set(u.scanForm.barcodes,e._id,"")})),e.next=35;break;case 32:this.processMaterials=[],this.validateStatus={mainBarcode:!1},this.scanForm.barcodes={};case 35:e.next=44;break;case 37:e.prev=37,e.t0=e.catch(0),console.error("è·å–å·¥åºç‰©æ–™å¤±è´¥:",e.t0),this.$message.error(e.t0.message||"è·å–å·¥åºç‰©æ–™å¤±è´¥"),this.processMaterials=[],this.validateStatus={mainBarcode:!1},this.scanForm.barcodes={};case 44:case"end":return e.stop()}}),e,this,[[0,37]])})));return function(){return e.apply(this,arguments)}}(),validateDICode:function(){var e=Object(n.a)(Object(s.a)().mark((function e(t){var a;return Object(s.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Object(i.b)("productDiNum",{query:{diNum:t},populate:JSON.stringify([{path:"productId",model:"k3_BD_MATERIAL"}])});case 3:if(0!==(a=e.sent).data.length){e.next=7;break}return this.$message.error("è¯¥DIç¼–ç ä¸å­˜åœ¨æœ¬ç³»ç»Ÿ"),e.abrupt("return",{isValid:!1});case 7:return e.abrupt("return",{isValid:!0,materialCode:a.data[0].productId.FNumber});case 10:return e.prev=10,e.t0=e.catch(0),console.error("DIç éªŒè¯å¤±è´¥:",e.t0),this.$message.error("DIç éªŒè¯å¤±è´¥"),e.abrupt("return",{isValid:!1});case 15:case"end":return e.stop()}}),e,this,[[0,10]])})));return function(t){return e.apply(this,arguments)}}(),validateBarcode:function(){var e=Object(n.a)(Object(s.a)().mark((function e(t){var a,r,n,i,c,o,l,u,p,m,h,b,v,g;return Object(s.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("validateBarcode",t),t){e.next=3;break}return e.abrupt("return",!1);case 3:if(r="",n=!1,t.includes("-")&&34!=t.length&&(a=t.split("-")[0],r=t.split("-")[1],n=!0),n){e.next=58;break}e.t0=t.length,e.next=47===e.t0?10:34===e.t0?19:48===e.t0?28:32===e.t0?37:20===e.t0?46:55;break;case 10:return i=t.substring(4,18),console.log("productDI",i),e.next=14,this.validateDICode(i);case 14:if((c=e.sent).isValid){e.next=17;break}return e.abrupt("return",!1);case 17:return a=c.materialCode,e.abrupt("break",58);case 19:return o=t.substring(7,19),console.log("fanDI",o),e.next=23,this.validateDICode(o);case 23:if((l=e.sent).isValid){e.next=26;break}return e.abrupt("return",!1);case 26:return a=l.materialCode,e.abrupt("break",58);case 28:return u=t.substring(0,5),console.log("lightDI",u),e.next=32,this.validateDICode(u);case 32:if((p=e.sent).isValid){e.next=35;break}return e.abrupt("return",!1);case 35:return a=p.materialCode,e.abrupt("break",58);case 37:return m=t.substring(0,8),console.log("remoteDI",m),e.next=41,this.validateDICode(m);case 41:if((h=e.sent).isValid){e.next=44;break}return e.abrupt("return",!1);case 44:return a=h.materialCode,e.abrupt("break",58);case 46:return b=t.substring(0,11),console.log("batchDI",b),e.next=50,this.validateDICode(b);case 50:if((v=e.sent).isValid){e.next=53;break}return e.abrupt("return",!1);case 53:return a=v.materialCode,e.abrupt("break",58);case 55:return this.$message.error("æ¡ç æ ¼å¼ä¸æ­£ç¡®ï¼Œåº”ä¸ºï¼šç‰©æ–™ç¼–å·-åºå·"),d(f.a),e.abrupt("return",!1);case 58:if(a!==this.mainMaterialCode){e.next=60;break}return e.abrupt("return",{materialCode:a,isValid:!0,relatedBill:r});case 60:if(g=this.processMaterials.find((function(e){return e.materialCode===a})),!g){e.next=63;break}return e.abrupt("return",{materialCode:a,isValid:!0,relatedBill:r});case 63:return this.$message.error("è¯¥æ¡ç å¯¹åº”çš„ç‰©æ–™ä¸å½“å‰å·¥åºæ‰€éœ€ç‰©æ–™ä¸åŒ¹é…"),e.abrupt("return",{materialCode:a,isValid:!1});case 65:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),handleMainBarcode:function(){var e=Object(n.a)(Object(s.a)().mark((function e(t){var a,r,n,c;return Object(s.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Object(i.b)("material_process_flow",{query:{barcode:t}});case 3:if(!((a=e.sent).data&&a.data.length>0)){e.next=9;break}a.data[0],this.$message.success("æ‰«ææˆåŠŸ"),e.next=19;break;case 9:return r=this.mainMaterialCode,n=this.mainMaterialId,e.next=13,o({mainMaterialId:n,materialCode:r,barcode:t});case 13:if(200!==(c=e.sent).code){e.next=18;break}this.$message.success("æˆå“æ¡ç è¿½æº¯è®°å½•åˆ›å»ºæˆåŠŸ"),e.next=19;break;case 18:throw new Error(c.msg||"åˆ›å»ºæˆå“æ¡ç è¿½æº¯è®°å½•å¤±è´¥");case 19:e.next=26;break;case 21:throw e.prev=21,e.t0=e.catch(0),console.error("å¤„ç†ä¸»æ¡ç å¤±è´¥:",e.t0),d(f.a),e.t0;case 26:case"end":return e.stop()}}),e,this,[[0,21]])})));return function(t){return e.apply(this,arguments)}}(),handleSubBarcode:function(){var e=Object(n.a)(Object(s.a)().mark((function e(t,a){var r;return Object(s.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,r=this.processMaterials.find((function(e){return e._id===t})),r){e.next=4;break}throw new Error("æœªæ‰¾åˆ°å¯¹åº”çš„ç‰©æ–™ä¿¡æ¯");case 4:if(r.materialCode===a){e.next=6;break}throw new Error("ç‰©æ–™ç¼–ç ä¸ä¸€è‡´");case 6:this.validateStatus[t]=!0,this.$message.success("æ‰«ç æˆåŠŸ"),e.next=15;break;case 10:throw e.prev=10,e.t0=e.catch(0),console.error("å¤„ç†å­ç‰©æ–™æ¡ç å¤±è´¥:",e.t0),d(f.a),e.t0;case 15:case"end":return e.stop()}}),e,this,[[0,10]])})));return function(t,a){return e.apply(this,arguments)}}(),fillFormData:function(){var e=Object(n.a)(Object(s.a)().mark((function e(){return Object(s.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.mainMaterialId&&this.materialName&&(this.formData.productModel=this.materialName),this.processStepId&&this.processName&&(this.formData.processStep=this.processName),this.productLineId&&(this.formData.productLine=this.productLineId);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),handleCancelSave:function(){var e=Object(n.a)(Object(s.a)().mark((function e(){var t;return Object(s.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.$confirm("ç¡®è®¤å–æ¶ˆå½“å‰å·¥åºè®¾ç½®ï¼Ÿ","æç¤º",{confirmButtonText:"ç¡®å®š",cancelButtonText:"å–æ¶ˆ",type:"warning"});case 3:t=this.$loading({lock:!0,text:"å–æ¶ˆè®¾ç½®ä¸­...",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"}),localStorage.removeItem("mainMaterialId"),localStorage.removeItem("processStepId"),localStorage.removeItem("materialName"),localStorage.removeItem("processName"),localStorage.removeItem("productLineId"),localStorage.removeItem("productLineName"),this.formData={productModel:"",productLine:"",processStep:"",componentName:""},this.$message.success("å·²å–æ¶ˆå·¥åºè®¾ç½®"),setTimeout((function(){t.close(),window.location.reload()}),500),e.next=18;break;case 15:e.prev=15,e.t0=e.catch(0),"cancel"!==e.t0&&(console.error("å–æ¶ˆè®¾ç½®å¤±è´¥:",e.t0),this.$message.error("å–æ¶ˆè®¾ç½®å¤±è´¥"));case 18:case"end":return e.stop()}}),e,this,[[0,15]])})));return function(){return e.apply(this,arguments)}}(),getValidateIcon:function(e){return this.validateStatus[e]?"el-icon-check success-icon":"el-icon-close error-icon"},resetScanForm:function(){var e=this;this.scanForm.mainBarcode="";var t={};this.processMaterials.forEach((function(a){a.isBatch&&e.scanForm.barcodes[a._id]?(t[a._id]=e.scanForm.barcodes[a._id],e.$set(e.validateStatus,a._id,!0)):(t[a._id]="",e.$set(e.validateStatus,a._id,!1))})),this.scanForm.barcodes=t,this.$set(this.validateStatus,"mainBarcode",!1),this.currentFlowId=null},handleConfirm:function(){var e=Object(n.a)(Object(s.a)().mark((function e(){var t,a,r,n,c,o=this;return Object(s.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,t=Object.values(this.validateStatus).every((function(e){return!0===e})),t){e.next=5;break}return this.$message.warning("è¯·å®Œæˆæ‰€æœ‰æ¡ç æ‰«æ"),e.abrupt("return");case 5:return e.next=7,Object(i.b)("material_process_flow",{query:{barcode:this.scanForm.mainBarcode}});case 7:if((a=e.sent).data&&0!==!a.data.length){e.next=10;break}throw new Error("æœªæ‰¾åˆ°å¯¹åº”çš„å·¥è‰ºæµç¨‹è®°å½•");case 10:return r=[],this.processMaterials.forEach((function(e){r.push({materialId:e.materialId,barcode:o.scanForm.barcodes[e._id]})})),console.log("ğŸš€ ~ handleConfirm ~ componentScans:",r),n={mainBarcode:this.scanForm.mainBarcode,processStepId:this.processStepId,componentScans:r,userId:this.$store.getters.id},console.log("ğŸš€ ~ handleConfirm ~ scanReq:",n),e.next=17,l(n);case 17:if(200===(c=e.sent).code){e.next=20;break}throw new Error(c.message||"æ‰«ç å¤±è´¥");case 20:d(v.a),this.resetScanForm(),e.next=29;break;case 24:e.prev=24,e.t0=e.catch(0),console.error("ç¡®è®¤å¤±è´¥:",e.t0),d(f.a),e.t0.message.includes("è¯¥ä¸»ç‰©æ–™æ¡ç å¯¹åº”å·¥åºèŠ‚ç‚¹å·²å®Œæˆæˆ–å¤„äºå¼‚å¸¸çŠ¶æ€")?this.$message.warning(e.t0.message):this.$message.error("ç¡®è®¤å¤±è´¥:"+e.t0.message);case 29:case"end":return e.stop()}}),e,this,[[0,24]])})));return function(){return e.apply(this,arguments)}}(),handleUnifiedScan:function(){var e=Object(n.a)(Object(s.a)().mark((function e(t){var a,n,i,c,o,l,u,p;return Object(s.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return");case 2:if(a=t.trim().replace(/[\r\n]/g,"")){e.next=5;break}return e.abrupt("return");case 5:return e.prev=5,e.next=8,this.validateBarcode(a);case 8:if((n=e.sent).isValid){e.next=13;break}return this.unifiedScanInput="",this.$refs.scanInput.focus(),e.abrupt("return");case 13:if(i=n.materialCode,c=!1,i!==this.mainMaterialCode){e.next=23;break}return this.scanForm.mainBarcode=t,e.next=19,this.handleMainBarcode(t);case 19:this.validateStatus.mainBarcode=!0,d(m.a),this.$message.success("ä¸»ç‰©æ–™æ‰«ææˆåŠŸ"),c=!0;case 23:if(c){e.next=47;break}o=Object(r.a)(this.processMaterials),e.prev=25,o.s();case 27:if((l=o.n()).done){e.next=39;break}if((u=l.value).materialCode!==i){e.next=37;break}return this.$set(this.scanForm.barcodes,u._id,t),e.next=33,this.handleSubBarcode(u._id,i);case 33:return d(m.a),this.$message.success("".concat(u.materialName," æ‰«ææˆåŠŸ")),c=!0,e.abrupt("break",39);case 37:e.next=27;break;case 39:e.next=44;break;case 41:e.prev=41,e.t0=e.catch(25),o.e(e.t0);case 44:return e.prev=44,o.f(),e.finish(44);case 47:if(c){e.next=51;break}return d(f.a),this.$message.warning("æœªæ‰¾åˆ°åŒ¹é…çš„ç‰©æ–™"),e.abrupt("return");case 51:p=Object.values(this.validateStatus).every((function(e){return!0===e})),p&&(this.$notify({title:"æ‰«æå®Œæˆ",message:"æ­£åœ¨å‘èµ·ç¡®è®¤æäº¤",type:"success",duration:3e3,position:"top-right"}),this.handleConfirm()),e.next=59;break;case 55:e.prev=55,e.t1=e.catch(5),console.error("æ‰«æå¤„ç†å¤±è´¥:",e.t1),this.$message.error(e.t1.message||"æ‰«æå¤„ç†å¤±è´¥");case 59:return e.prev=59,this.unifiedScanInput="",this.$refs.scanInput.focus(),e.finish(59);case 63:case"end":return e.stop()}}),e,this,[[5,55,59,63],[25,41,44,47]])})));return function(t){return e.apply(this,arguments)}}(),focusInput:function(){this.$refs.scanInput.focus()}},created:function(){var e=Object(n.a)(Object(s.a)().mark((function e(){return Object(s.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.mainMaterialId){e.next=3;break}return e.next=3,this.getMainMaterialInfo();case 3:if(!this.processStepId){e.next=6;break}return e.next=6,this.getProcessMaterials();case 6:return e.next=8,this.fillFormData();case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),mounted:function(){console.log("ğŸš€ ~ mounted ~ this.$store.getters.id:",this.$store.getters),this.mainMaterialId&&this.processStepId&&this.$refs.scanInput.focus(),console.log("Complete roles data:",this.$store.getters.roles);var e=this.$store.getters.roles;if(!e||!e.buttonList)return!1;e.buttonList.includes("scan_edit_configuration")&&(this.hasEditPermission=!0)}},x=g,I=(a("ccd6"),a("2877")),k=Object(I.a)(x,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"scan-container"},[a("div",{staticClass:"left-form"},[a("el-card",{staticClass:"init-card"},[a("div",{staticClass:"card-header"},[a("i",{staticClass:"el-icon-setting"}),e._v(" "),a("span",[e._v("å·¥åºåˆå§‹åŒ–è®¾ç½®")])]),e._v(" "),a("el-form",{attrs:{model:e.formData,"label-width":"100px"}},[a("div",{staticClass:"form-section"},[a("div",{staticClass:"section-header"},[a("i",{staticClass:"el-icon-goods"}),e._v(" "),a("span",[e._v("åŸºç¡€ä¿¡æ¯")])]),e._v(" "),a("el-form-item",{attrs:{label:"äº§å“å‹å·"}},[a("zr-select",{attrs:{collection:"k3_BD_MATERIAL",disabled:!!e.mainMaterialId&&!!e.processStepId,"search-fields":["FNumber","FName"],"label-key":"FName","sub-key":"FMATERIALID",multiple:!1,placeholder:"è¯·è¾“å…¥ç‰©æ–™ç¼–ç /åç§°æœç´¢"},on:{select:e.handleProductChange},scopedSlots:e._u([{key:"option",fn:function(t){var r=t.item;return[a("div",{staticClass:"item-option"},[a("div",{staticClass:"item-info"},[a("span",[e._v(e._s(r.FNumber)+" - "+e._s(r.FName))]),e._v(" "),a("el-tag",{attrs:{size:"mini",type:"info"}},[e._v(e._s(r.FMATERIALID)+" -"+e._s(r.FUseOrgId))])],1)])]}}]),model:{value:e.formData.productModel,callback:function(t){e.$set(e.formData,"productModel",t)},expression:"formData.productModel"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"äº§å“å·¥åº"}},[a("el-select",{staticClass:"custom-select",attrs:{placeholder:"è¯·é€‰æ‹©äº§å“å·¥åº",disabled:!!e.mainMaterialId&&!!e.processStepId},on:{change:e.handleProcessChange},model:{value:e.formData.processStep,callback:function(t){e.$set(e.formData,"processStep",t)},expression:"formData.processStep"}},e._l(e.processStepOptions,(function(t){return a("el-option",{key:t._id,attrs:{label:t.processName,value:t._id}},[a("div",{staticClass:"option-content"},[a("span",{staticClass:"option-main"},[e._v(e._s(t.sort+"."+t.processName))]),e._v(" "),a("span",{staticClass:"option-sub"},[e._v(e._s(t.processCode))])])])})),1)],1),e._v(" "),a("el-form-item",{attrs:{label:"äº§çº¿ç¼–ç "}},[a("zr-select",{attrs:{disabled:!!e.mainMaterialId&&!!e.processStepId,collection:"production_line","search-fields":["lineCode","lineName"],"label-key":"lineName","tag-key":"lineCode","sub-key":"workshop",multiple:!1,placeholder:"è¯·è¾“å…¥äº§çº¿ä¿¡æ¯æœç´¢"},on:{select:e.handleProductionLineSelect},model:{value:e.formData.productLine,callback:function(t){e.$set(e.formData,"productLine",t)},expression:"formData.productLine"}})],1)],1),e._v(" "),e.hasEditPermission?a("div",{staticClass:"button-group"},[e.mainMaterialId&&e.processStepId?a("el-button",{attrs:{type:"danger",icon:"el-icon-close"},on:{click:e.handleCancelSave}},[e._v("\n                        å–æ¶ˆè®¾ç½®\n                    ")]):a("el-button",{attrs:{type:"primary",icon:"el-icon-check"},on:{click:e.handleSave}},[e._v("\n                        ä¿å­˜è®¾ç½®\n                    ")])],1):e._e()])],1)],1),e._v(" "),a("div",{staticClass:"right-content"},[e.mainMaterialId&&e.processStepId?[a("el-card",{staticClass:"scan-card"},[a("div",{staticClass:"card-header"},[a("i",{staticClass:"el-icon-scan"}),e._v(" "),a("span",[e._v("æ¡ç æ‰«æ")])]),e._v(" "),a("el-form",{ref:"scanForm",attrs:{model:e.scanForm,"label-width":"100%"}},[a("div",{staticClass:"section-header"},[a("i",{staticClass:"el-icon-camera"}),e._v(" "),a("span",[e._v("ç»Ÿä¸€æ‰«æåŒºåŸŸ")])]),e._v(" "),a("div",{staticClass:"scan-input-section"},[a("el-input",{ref:"scanInput",attrs:{placeholder:"è¯·æ‰«ææ¡ç ",clearable:""},on:{input:e.handleUnifiedScan,clear:e.focusInput},model:{value:e.unifiedScanInput,callback:function(t){e.unifiedScanInput=t},expression:"unifiedScanInput"}})],1),e._v(" "),a("div",{staticClass:"section-header"},[a("i",{staticClass:"el-icon-goods"}),e._v(" "),a("span",[e._v("ä¸»ç‰©æ–™")])]),e._v(" "),a("div",{staticClass:"material-section"},[a("el-form-item",{staticClass:"vertical-form-item",attrs:{label:"ç¼–å·ï¼š"+e.mainMaterialCode+"  åç§°ï¼š"+e.mainMaterialName,"label-width":"100%"}},[a("div",{staticClass:"input-with-status"},[a("el-input",{class:{"valid-input":e.validateStatus.mainBarcode},attrs:{placeholder:"è¯·æ‰«æä¸»ç‰©æ–™æ¡ç ",readonly:""},model:{value:e.scanForm.mainBarcode,callback:function(t){e.$set(e.scanForm,"mainBarcode",t)},expression:"scanForm.mainBarcode"}},[a("template",{slot:"prefix"},[a("i",{staticClass:"el-icon-full-screen"})])],2),e._v(" "),a("div",{staticClass:"status-indicator",class:{valid:e.validateStatus.mainBarcode}},[a("i",{class:e.getValidateIcon("mainBarcode")})])],1)])],1),e._v(" "),a("div",{staticClass:"section-header"},[a("i",{staticClass:"el-icon-box"}),e._v(" "),a("span",[e._v("å­ç‰©æ–™")])]),e._v(" "),a("div",{staticClass:"material-section"},[a("el-row",{attrs:{gutter:20}},e._l(e.processMaterials,(function(t){return a("el-col",{key:t._id,attrs:{span:12}},[a("el-form-item",{staticClass:"vertical-form-item",attrs:{label:"ç¼–å·ï¼š"+t.materialCode+"  åç§°ï¼š"+t.materialName+"  "}},[a("div",{staticClass:"input-with-status"},[a("el-input",{class:{"valid-input":e.validateStatus[t._id]},attrs:{placeholder:"è¯·æ‰«æå­ç‰©æ–™æ¡ç ",readonly:""},model:{value:e.scanForm.barcodes[t._id],callback:function(a){e.$set(e.scanForm.barcodes,t._id,a)},expression:"scanForm.barcodes[material._id]"}},[a("template",{slot:"prefix"},[a("i",{staticClass:"el-icon-full-screen"})]),e._v(" "),t.isBatch?a("template",{slot:"suffix"},[a("el-tag",{attrs:{type:"warning"}},[e._v("æ‰¹æ¬¡ç‰©æ–™")])],1):e._e()],2),e._v(" "),a("div",{staticClass:"status-indicator",class:{valid:e.validateStatus[t._id]}},[a("i",{class:e.getValidateIcon(t._id)})])],1)])],1)})),1)],1),e._v(" "),a("div",{staticClass:"button-group"},[a("el-button",{attrs:{plain:"",icon:"el-icon-refresh"},on:{click:e.resetScanForm}},[e._v("é‡ç½®")]),e._v(" "),a("el-button",{attrs:{type:"primary",icon:"el-icon-check"},on:{click:e.handleConfirm}},[e._v("ç¡®è®¤")])],1)])],1)]:[e._m(0)]],2)])}),[function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"init-tip"},[a("div",{staticClass:"overlay"},[a("i",{staticClass:"el-icon-warning-outline pulse"}),e._v(" "),a("p",[e._v("è¯·å…ˆåˆå§‹åŒ–å·¥åºè®¾ç½®")])])])}],!1,null,"4fe65458",null);t.default=k.exports}}]);