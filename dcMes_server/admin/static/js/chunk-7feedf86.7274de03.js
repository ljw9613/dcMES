(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-7feedf86","chunk-6919d003"],{"1a2d":function(e,r,t){"use strict";t.d(r,"a",(function(){return s})),t.d(r,"b",(function(){return o})),t.d(r,"c",(function(){return n}));var a=t("b775");function s(e){return Object(a.a)({url:"/user_login",method:"get",params:e})}function o(e){return Object(a.a)({url:"/user_login",method:"post",data:e})}function n(e){return Object(a.a)({url:"/user_login",method:"put",data:e})}},3946:function(e,r,t){"use strict";t.r(r);var a=t("c7eb"),s=(t("96cf"),t("1da1")),o=t("1a2d"),n={data:function(){var e=this;return{dialogVisible:!1,form:{password:"",newPassword:"",newPassword2:""},rules:{password:[{required:!0,message:"è¯·è¾“å…¥åŸå¯†ç ",trigger:"blur"}],newPassword:[{required:!0,message:"è¯·è®¾ç½®æ–°å¯†ç ",trigger:"blur"},{validator:function(r,t,a){t===e.form.password?a(new Error("æ–°å¯†ç ä¸èƒ½ä¸åŸå¯†ç ç›¸åŒ!")):a()},trigger:"blur"}],newPassword2:[{required:!0,message:"è¯·ç¡®è®¤æ–°å¯†ç ",trigger:"blur"},{validator:function(r,t,a){t!==e.form.newPassword?a(new Error("ä¸æ–°å¯†ç ä¸ä¸€è‡´!")):a()},trigger:"blur"}]}}},methods:{show:function(){this.dialogVisible=!0},handleCancel:function(){this.dialogVisible=!1,this.$refs.passwordForm.resetFields()},onSubmit:function(){var e=Object(s.a)(Object(a.a)().mark((function e(r){var t=this;return Object(a.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.$refs[r].validate(function(){var e=Object(s.a)(Object(a.a)().mark((function e(r){var s,n,i;return Object(a.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!r){e.next=20;break}if(!(t.form.newPassword.length<6)){e.next=4;break}return t.$message.error("å¯†ç éœ€6ä½æ•°ï¼Œè¯·é‡æ–°è¾“å…¥"),e.abrupt("return");case 4:return s=t.$store.state.user.id,n={query:{_id:s}},e.next=8,Object(o.a)(n);case 8:if(e.sent.data[0].password!==t.form.password){e.next=17;break}return i={query:{_id:s},update:{$set:{password:t.form.newPassword}}},e.next=13,Object(o.c)(i);case 13:200===e.sent.code?(t.$message.success("å¯†ç ä¿®æ”¹æˆåŠŸï¼"),t.dialogVisible=!1,t.logout()):t.$message.error("ä¿®æ”¹å¤±è´¥ï¼Œè¯·é‡è¯•!"),e.next=18;break;case 17:t.$message.error("åŸå¯†ç é”™è¯¯ï¼Œè¯·é‡æ–°è¾“å…¥ï¼");case 18:e.next=22;break;case 20:return t.$message.error("è¯·æ­£ç¡®å¡«å†™æ ¼å¼"),e.abrupt("return",!1);case 22:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}());case 1:case"end":return e.stop()}}),e,this)})));return function(r){return e.apply(this,arguments)}}(),logout:function(){var e=Object(s.a)(Object(a.a)().mark((function e(){return Object(a.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.$store.dispatch("user/logout");case 2:this.$router.push("/login");case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}},i=n,u=t("2877"),c=Object(u.a)(i,(function(){var e=this,r=e.$createElement,t=e._self._c||r;return t("el-dialog",{attrs:{title:"ä¿®æ”¹å¯†ç ",visible:e.dialogVisible,"append-to-body":"",width:"40%"},on:{"update:visible":function(r){e.dialogVisible=r}}},[t("el-form",{ref:"passwordForm",attrs:{model:e.form,rules:e.rules,"label-width":"100px"}},[t("el-form-item",{attrs:{label:"åŸå¯†ç ",prop:"password"}},[t("el-input",{attrs:{placeholder:"è¯·è¾“å…¥åŸå¯†ç ",type:"password"},model:{value:e.form.password,callback:function(r){e.$set(e.form,"password",r)},expression:"form.password"}})],1),e._v(" "),t("el-form-item",{attrs:{label:"æ–°å¯†ç ",prop:"newPassword"}},[t("el-input",{attrs:{placeholder:"è¯·è®¾ç½®æ–°å¯†ç ",type:"password"},model:{value:e.form.newPassword,callback:function(r){e.$set(e.form,"newPassword",r)},expression:"form.newPassword"}})],1),e._v(" "),t("el-form-item",{attrs:{label:"ç¡®è®¤å¯†ç ",prop:"newPassword2"}},[t("el-input",{attrs:{placeholder:"è¯·ç¡®è®¤æ–°å¯†ç ",type:"password"},model:{value:e.form.newPassword2,callback:function(r){e.$set(e.form,"newPassword2",r)},expression:"form.newPassword2"}})],1),e._v(" "),t("el-form-item",[t("el-button",{attrs:{type:"primary"},on:{click:function(r){return e.onSubmit("passwordForm")}}},[e._v("ç¡®å®šä¿®æ”¹")]),e._v(" "),t("el-button",{on:{click:e.handleCancel}},[e._v("å–æ¶ˆ")])],1)],1)],1)}),[],!1,null,null,null);r.default=c.exports},"8e18":function(e,r,t){},a2a3:function(e,r,t){"use strict";t.r(r);var a=t("ade3"),s=t("c7eb"),o=(t("96cf"),t("1da1")),n=t("1a2d"),i={components:{PasswordDialog:t("3946").default},data:function(){var e=this;return{dialogVisible:!1,uploadAvatarUrl:"http://192.168.6.250/dcMes_server/api/v1/upload/avatar",form:{avatar:"",nickName:"",password:"",newPassword:"",newPassword2:""},rules:{nickName:[{required:!0,message:"è¯·è¾“å…¥ç”¨æˆ·å",trigger:"blur"}],password:[{required:!0,message:"è¯·è¾“å…¥åŸå¯†ç ",trigger:"blur"}],newPassword:[{required:!0,message:"è¯·è®¾ç½®æ–°å¯†ç ",trigger:"blur"},{validator:function(r,t,a){t===e.form.password?a(new Error("æ–°å¯†ç ä¸èƒ½ä¸åŸå¯†ç ç›¸åŒ!")):a()},trigger:"blur"}],newPassword2:[{required:!0,message:"è¯·ç¡®è®¤æ–°å¯†ç ",trigger:"blur"},{validator:function(r,t,a){t!==e.form.newPassword?a(new Error("ä¸æ–°å¯†ç ä¸ä¸€è‡´!")):a()},trigger:"blur"}]},uploadHeaders:{Authorization:"Bearer "+this.$store.state.user.token},uploadData:{type:"avatar"}}},methods:Object(a.a)({show:function(){this.dialogVisible=!0,this.getUserInfo()},getUserInfo:function(){var e=Object(o.a)(Object(s.a)().mark((function e(){var r,t,a;return Object(s.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("è·å–ç”¨æˆ·ä¿¡æ¯",this.$store.state.user),r=this.$store.state.user.id,t={query:{_id:r}},e.next=5,Object(n.a)(t);case 5:a=e.sent,console.log("ğŸš€ ~ getUserInfo ~ res:",a),a.data&&a.data[0]&&(this.form.nickName=a.data[0].nickName,this.form.avatar=a.data[0].avatar);case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),handleAvatarSuccess:function(e,r){console.log("ä¸Šä¼ å“åº”:",e),200===e.code?(this.form.avatar="http://192.168.6.250/dcMes_server/"+e.data.url,this.$message.success("å¤´åƒä¸Šä¼ æˆåŠŸ")):this.$message.error(e.msg||"å¤´åƒä¸Šä¼ å¤±è´¥")},beforeAvatarUpload:function(e){console.log("å‡†å¤‡ä¸Šä¼ æ–‡ä»¶:",e);var r="image/jpeg"===e.type||"image/png"===e.type,t=e.size/1024/1024<2;return r?!!t||(this.$message.error("ä¸Šä¼ å¤´åƒå›¾ç‰‡å¤§å°ä¸èƒ½è¶…è¿‡ 2MB!"),!1):(this.$message.error("ä¸Šä¼ å¤´åƒå›¾ç‰‡åªèƒ½æ˜¯ JPG æˆ– PNG æ ¼å¼!"),!1)},handleCancel:function(){this.dialogVisible=!1,this.$refs.form.resetFields()},showPasswordDialog:function(){this.$refs.passwordDialog.show()},onSubmit:function(){var e=Object(o.a)(Object(s.a)().mark((function e(r){var t=this;return Object(s.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.$refs[r].validate(function(){var e=Object(o.a)(Object(s.a)().mark((function e(r){var a,o;return Object(s.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!r){e.next=9;break}return a=t.$store.state.user.id,o={query:{_id:a},update:{$set:{nickName:t.form.nickName,avatar:t.form.avatar}}},e.next=5,Object(n.c)(o);case 5:200===e.sent.code?(t.$message.success("ä¿®æ”¹æˆåŠŸï¼"),t.dialogVisible=!1,t.$router.go(0)):t.$message.error("ä¿®æ”¹å¤±è´¥ï¼Œè¯·é‡è¯•!"),e.next=11;break;case 9:return t.$message.error("è¯·æ­£ç¡®å¡«å†™æ ¼å¼"),e.abrupt("return",!1);case 11:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}());case 1:case"end":return e.stop()}}),e,this)})));return function(r){return e.apply(this,arguments)}}(),logout:function(){var e=Object(o.a)(Object(s.a)().mark((function e(){return Object(s.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.$store.dispatch("user/logout");case 2:this.$router.push("/login");case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},"showPasswordDialog",(function(){this.$refs.passwordDialog.show()}))},u=i,c=(t("bf1f"),t("2877")),l=Object(c.a)(u,(function(){var e=this,r=e.$createElement,t=e._self._c||r;return t("el-dialog",{attrs:{title:"ä¸ªäººä¿¡æ¯ä¿®æ”¹",visible:e.dialogVisible,width:"50%"},on:{"update:visible":function(r){e.dialogVisible=r}}},[t("el-form",{ref:"form",attrs:{model:e.form,rules:e.rules,"label-width":"100px"}},[t("el-form-item",{attrs:{label:"å¤´åƒ"}},[t("el-upload",{staticClass:"avatar-uploader",attrs:{action:e.uploadAvatarUrl,headers:e.uploadHeaders,name:"avatar",data:e.uploadData,"show-file-list":!1,"on-success":e.handleAvatarSuccess,"before-upload":e.beforeAvatarUpload}},[e.form.avatar?t("img",{staticClass:"avatar",attrs:{src:e.form.avatar}}):t("i",{staticClass:"el-icon-plus avatar-uploader-icon"})])],1),e._v(" "),t("el-form-item",{attrs:{label:"ç”¨æˆ·å",prop:"nickName"}},[t("el-input",{attrs:{placeholder:"è¯·è¾“å…¥ç”¨æˆ·å"},model:{value:e.form.nickName,callback:function(r){e.$set(e.form,"nickName",r)},expression:"form.nickName"}})],1),e._v(" "),t("el-form-item",[t("el-button",{attrs:{type:"warning"},on:{click:e.showPasswordDialog}},[e._v("ä¿®æ”¹å¯†ç ")]),e._v(" "),t("el-button",{attrs:{type:"primary"},on:{click:function(r){return e.onSubmit("form")}}},[e._v("ä¿å­˜ä¿¡æ¯")]),e._v(" "),t("el-button",{on:{click:e.handleCancel}},[e._v("å–æ¶ˆ")])],1)],1),e._v(" "),t("password-dialog",{ref:"passwordDialog"})],1)}),[],!1,null,"7fc85303",null);r.default=l.exports},bf1f:function(e,r,t){"use strict";t("8e18")}}]);