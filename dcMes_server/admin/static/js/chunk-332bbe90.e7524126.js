(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-332bbe90"],{3835:function(e,t,a){"use strict";var n=a("06c5");function r(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var a=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=a){var n,r,s,l,o=[],i=!0,c=!1;try{if(s=(a=a.call(e)).next,0===t){if(Object(a)!==a)return;i=!1}else for(;!(i=(n=s.call(a)).done)&&(o.push(n.value),o.length!==t);i=!0);}catch(e){c=!0,r=e}finally{try{if(!i&&null!=a.return&&(l=a.return(),Object(l)!==l))return}finally{if(c)throw r}}return o}}(e,t)||Object(n.a)(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}a.d(t,"a",(function(){return r}))},"627a":function(e,t,a){},"64e6":function(e,t,a){"use strict";a.d(t,"a",(function(){return r})),a.d(t,"b",(function(){return s})),a.d(t,"c",(function(){return l}));var n=a("b775");function r(e){return Object(n.a)({url:"/warehouse_entry/scan",method:"post",data:e})}function s(e){return Object(n.a)({url:"/warehouse_entry/scan_on",method:"post",data:e})}function l(e){return Object(n.a)({url:"/k3/sync_warehouse_entry",method:"post",data:e})}},e0c0:function(e,t,a){"use strict";a.r(t);var n=a("c7eb"),r=(a("c5f6"),a("28a5"),a("3835")),s=(a("96cf"),a("1da1")),l=a("64e6"),o={name:"ScanDialog",props:{visible:{type:Boolean,default:!1},title:{type:String,default:"托盘扫码入库"},placeholder:{type:String,default:"请扫描托盘条码"}},data:function(){return{dialogVisible:!1,scanForm:{barcode:""},rules:{barcode:[{required:!0,message:"请输入或扫描条码",trigger:"blur"}]},scanRecords:[],entryInfo:null}},watch:{visible:function(e){var t=this;this.dialogVisible=e,e&&this.$nextTick((function(){t.$refs.scanInput.focus()}))},dialogVisible:function(e){this.$emit("update:visible",e),e||this.resetForm()}},methods:{handleScanInput:function(){var e=Object(s.a)(Object(n.a)().mark((function e(){var t,a,s,o,i,c,u,d,f;return Object(n.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.$refs.scanForm.validate();case 3:return t=this.scanForm.barcode.trim(),e.next=6,this.$emit("scan",t);case 6:if(!e.sent){e.next=21;break}if(a=t.split("#"),s=Object(r.a)(a,5),o=s[0],i=s[1],c=s[2],u=s[3],d=s[4],o&&i&&c&&u){e.next=11;break}throw new Error("无效的托盘条码格式");case 11:return e.next=13,Object(l.a)({palletCode:o,userId:this.$store.state.user.id});case 13:if((f=e.sent).data&&(this.entryInfo=f.data),200===f.code){e.next=18;break}return this.$message.error(f.message),e.abrupt("return");case 18:this.$message.success("扫码入库成功"),this.scanRecords.unshift({palletCode:o,saleOrderNo:i,materialCode:c,quantity:Number(u),lineCode:d,scanTime:new Date}),this.scanForm.barcode="";case 21:e.next=26;break;case 23:e.prev=23,e.t0=e.catch(0),console.error("扫描失败:",e.t0);case 26:case"end":return e.stop()}}),e,this,[[0,23]])})));return function(){return e.apply(this,arguments)}}(),handleComplete:function(){var e=Object(s.a)(Object(n.a)().mark((function e(){return Object(n.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.$emit("complete",this.scanRecords.map((function(e){return e.palletCode})));case 3:this.dialogVisible=!1,e.next=9;break;case 6:e.prev=6,e.t0=e.catch(0),console.error("完成入库失败:",e.t0);case 9:case"end":return e.stop()}}),e,this,[[0,6]])})));return function(){return e.apply(this,arguments)}}(),handleClose:function(){this.resetForm()},resetForm:function(){this.scanForm.barcode="",this.scanRecords=[],this.entryInfo=null,this.$refs.scanForm&&this.$refs.scanForm.resetFields()},formatDateTime:function(e){return new Date(e).toLocaleString()}}},i=o,c=(a("e9e2"),a("2877")),u=Object(c.a)(i,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{attrs:{title:e.title,visible:e.dialogVisible,width:"800px"},on:{"update:visible":function(t){e.dialogVisible=t},close:e.handleClose}},[a("div",{staticClass:"scan-container"},[a("el-form",{ref:"scanForm",attrs:{model:e.scanForm,rules:e.rules}},[a("el-form-item",{attrs:{prop:"barcode"}},[a("el-input",{ref:"scanInput",attrs:{placeholder:e.placeholder,clearable:""},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleScanInput(t)}},model:{value:e.scanForm.barcode,callback:function(t){e.$set(e.scanForm,"barcode",t)},expression:"scanForm.barcode"}})],1)],1),e._v(" "),e.entryInfo?a("div",{staticClass:"entry-info"},[a("el-card",{staticClass:"box-card"},[a("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[a("span",[e._v("入库单信息")])]),e._v(" "),a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:8}},[a("div",{staticClass:"info-item"},[a("label",[e._v("入库单号：")]),e._v(" "),a("span",[e._v(e._s(e.entryInfo.entryNo))])])]),e._v(" "),a("el-col",{attrs:{span:8}},[a("div",{staticClass:"info-item"},[a("label",[e._v("生产订单：")]),e._v(" "),a("span",[e._v(e._s(e.entryInfo.productionOrderNo))])])]),e._v(" "),a("el-col",{attrs:{span:8}},[a("div",{staticClass:"info-item"},[a("label",[e._v("销售订单：")]),e._v(" "),a("span",[e._v(e._s(e.entryInfo.saleOrderNo))])])])],1),e._v(" "),a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:8}},[a("div",{staticClass:"info-item"},[a("label",[e._v("物料名称：")]),e._v(" "),a("span",[e._v(e._s(e.entryInfo.materialName))])])]),e._v(" "),a("el-col",{attrs:{span:8}},[a("div",{staticClass:"info-item"},[a("label",[e._v("规格型号：")]),e._v(" "),a("span",[e._v(e._s(e.entryInfo.materialSpec))])])]),e._v(" "),a("el-col",{attrs:{span:8}},[a("div",{staticClass:"info-item"},[a("label",[e._v("完成进度：")]),e._v(" "),a("el-progress",{attrs:{percentage:e.entryInfo.progress,status:e.entryInfo.progress>=100?"success":""}})],1)])],1),e._v(" "),a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:8}},[a("div",{staticClass:"info-item"},[a("label",[e._v("计划数量：")]),e._v(" "),a("span",[e._v(e._s(e.entryInfo.plannedQuantity))])])]),e._v(" "),a("el-col",{attrs:{span:8}},[a("div",{staticClass:"info-item"},[a("label",[e._v("实际数量：")]),e._v(" "),a("span",[e._v(e._s(e.entryInfo.actualQuantity))])])]),e._v(" "),a("el-col",{attrs:{span:8}},[a("div",{staticClass:"info-item"},[a("label",[e._v("托盘数量：")]),e._v(" "),a("span",[e._v(e._s(e.entryInfo.palletCount))])])])],1)],1)],1):e._e(),e._v(" "),a("div",{staticClass:"scan-list"},[a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.scanRecords,border:""}},[a("el-table-column",{attrs:{label:"托盘编号",prop:"palletCode",align:"center"}}),e._v(" "),a("el-table-column",{attrs:{label:"销售订单",prop:"saleOrderNo",align:"center"}}),e._v(" "),a("el-table-column",{attrs:{label:"物料编码",prop:"materialCode",align:"center"}}),e._v(" "),a("el-table-column",{attrs:{label:"数量",prop:"quantity",align:"center"}}),e._v(" "),a("el-table-column",{attrs:{label:"产线",prop:"lineCode",align:"center"}}),e._v(" "),a("el-table-column",{attrs:{label:"扫描时间",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n            "+e._s(e.formatDateTime(t.row.scanTime))+"\n          ")]}}])})],1)],1)],1),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.dialogVisible=!1}}},[e._v("取 消")]),e._v(" "),a("el-button",{attrs:{type:"primary",disabled:!e.scanRecords.length},on:{click:e.handleComplete}},[e._v("\n      完成入库\n    ")])],1)])}),[],!1,null,"8356b2d8",null);t.default=u.exports},e9e2:function(e,t,a){"use strict";a("627a")}}]);