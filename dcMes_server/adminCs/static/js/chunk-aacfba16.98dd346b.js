(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-aacfba16"],{3835:function(e,t,n){"use strict";var a=n("06c5");function r(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var a,r,o,s,l=[],i=!0,c=!1;try{if(o=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;i=!1}else for(;!(i=(a=o.call(n)).done)&&(l.push(a.value),l.length!==t);i=!0);}catch(e){c=!0,r=e}finally{try{if(!i&&null!=n.return&&(s=n.return(),Object(s)!==s))return}finally{if(c)throw r}}return l}}(e,t)||Object(a.a)(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}n.d(t,"a",(function(){return r}))},"64e6":function(e,t,n){"use strict";n.d(t,"a",(function(){return r})),n.d(t,"b",(function(){return o})),n.d(t,"c",(function(){return s})),n.d(t,"d",(function(){return l}));var a=n("b775");function r(e){return Object(a.a)({url:"/warehouse_entry/scan",method:"post",data:e})}function o(e){return Object(a.a)({url:"/warehouse_entry/scan_on",method:"post",data:e})}function s(e){return Object(a.a)({url:"/k3/sync_warehouse_entry",method:"post",data:e})}function l(e){return Object(a.a)({url:"/k3/sync_warehouse_ontry",method:"post",data:e})}},ca94:function(e,t,n){"use strict";n("de7f")},de7f:function(e,t,n){},eb6d:function(e,t,n){"use strict";n.r(t);var a=n("c7eb"),r=(n("28a5"),n("3835")),o=(n("96cf"),n("1da1")),s=n("64e6"),l=(n("b719"),{name:"ScanDialog",props:{scanData:{type:Object,default:function(){return{}}},visible:{type:Boolean,default:!1},title:{type:String,default:"托盘扫码出库"},placeholder:{type:String,default:"请扫描托盘条码"}},data:function(){return{dialogVisible:!1,scanForm:{barcode:""},rules:{barcode:[{required:!0,message:"请输入或扫描条码",trigger:"blur"}]},scanRecords:[],entryInfo:null}},watch:{visible:function(e){var t=this;this.dialogVisible=e,e&&(this.initEntryInfo(),this.$nextTick((function(){t.$refs.scanInput.focus()})))},dialogVisible:function(e){this.$emit("update:visible",e),e||this.resetForm()},scanData:{handler:function(e){this.initEntryInfo()},immediate:!0}},methods:{initEntryInfo:function(){console.log(this.scanData,"this.scanData"),this.scanData&&(this.entryInfo=this.scanData)},handleScanInput:function(){var e=Object(o.a)(Object(a.a)().mark((function e(){var t,n,o,l,i,c,u,d,f;return Object(a.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.$refs.scanForm.validate();case 3:return t=this.scanForm.barcode.trim(),console.log(t,"barcode"),e.next=7,this.$emit("scan",t);case 7:if(!e.sent){e.next=21;break}return n=t.split("#"),o=Object(r.a)(n,5),l=o[0],i=o[1],c=o[2],u=o[3],d=o[4],console.log(l,"palletCode"),e.next=13,Object(s.b)({palletCode:l,userId:this.$store.state.user.id,entryInfo:this.entryInfo});case 13:if((f=e.sent).data&&(this.entryInfo=f.data),200===f.code){e.next=18;break}return this.$message.error(f.message),e.abrupt("return");case 18:this.$message.success("扫码出库成功"),this.scanRecords.unshift({palletCode:l,saleOrderNo:i,materialCode:c,quantity:u,lineCode:d,scanTime:new Date}),this.scanForm.barcode="";case 21:e.next=26;break;case 23:e.prev=23,e.t0=e.catch(0),console.error("扫描失败:",e.t0);case 26:case"end":return e.stop()}}),e,this,[[0,23]])})));return function(){return e.apply(this,arguments)}}(),saleOrderNoInput:function(){var e=Object(o.a)(Object(a.a)().mark((function e(){var t;return Object(a.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(s.b)({palletCode:null,userId:this.$store.state.user.id,entryInfo:this.entryInfo});case 2:if((t=e.sent).data&&(this.entryInfo=t.data),200===t.code){e.next=7;break}return this.$message.error(t.message),e.abrupt("return");case 7:this.$message.success("扫码出库成功"),this.scanRecords.unshift({palletCode:palletCode,saleOrderNo:saleOrderNo,materialCode:materialCode,quantity:quantity,lineCode:lineCode,scanTime:new Date}),this.scanForm.barcode="";case 10:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),handleComplete:function(){var e=Object(o.a)(Object(a.a)().mark((function e(){return Object(a.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.$emit("complete",this.scanRecords.map((function(e){return e.palletCode})));case 3:this.dialogVisible=!1,e.next=9;break;case 6:e.prev=6,e.t0=e.catch(0),console.error("完成出库失败:",e.t0);case 9:case"end":return e.stop()}}),e,this,[[0,6]])})));return function(){return e.apply(this,arguments)}}(),handleClose:function(){this.$emit("update:visible",!1),this.resetForm()},resetForm:function(){this.scanForm.barcode="",this.scanRecords=[],this.$refs.scanForm&&this.$refs.scanForm.resetFields()},formatDateTime:function(e){return new Date(e).toLocaleString()}}}),i=l,c=(n("ca94"),n("2877")),u=Object(c.a)(i,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("el-dialog",{attrs:{title:e.title,visible:e.dialogVisible,width:"800px","close-on-click-modal":!1},on:{"update:visible":function(t){e.dialogVisible=t},close:e.handleClose}},[n("div",{staticClass:"scan-container"},[e.entryInfo?n("el-form",[n("el-row",{attrs:{gutter:20}},[n("el-col",{attrs:{span:12}},[n("el-form-item",{attrs:{label:"销售单号"}},[n("el-input",{on:{blur:e.saleOrderNoInput},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.saleOrderNoInput(t)}},model:{value:e.entryInfo.saleOrderNo,callback:function(t){e.$set(e.entryInfo,"saleOrderNo",t)},expression:"entryInfo.saleOrderNo"}})],1)],1),e._v(" "),n("el-col",{attrs:{span:12}},[n("el-form-item",{attrs:{label:"销售数量"}},[n("el-input",{attrs:{type:"number",readonly:""},model:{value:e.entryInfo.saleNumber,callback:function(t){e.$set(e.entryInfo,"saleNumber",t)},expression:"entryInfo.saleNumber"}})],1)],1)],1),e._v(" "),n("el-row",{attrs:{gutter:20}},[n("el-col",{attrs:{span:12}},[n("el-form-item",{attrs:{label:"货柜号",required:""}},[n("el-input",{attrs:{readonly:e.entryInfo._id&&e.entryInfo.HuoGuiCode},model:{value:e.entryInfo.HuoGuiCode,callback:function(t){e.$set(e.entryInfo,"HuoGuiCode",t)},expression:"entryInfo.HuoGuiCode"}})],1)],1),e._v(" "),n("el-col",{attrs:{span:12}},[n("el-form-item",{attrs:{label:"发票号",required:""}},[n("el-input",{attrs:{readonly:e.entryInfo._id&&e.entryInfo.FaQIaoNo},model:{value:e.entryInfo.FaQIaoNo,callback:function(t){e.$set(e.entryInfo,"FaQIaoNo",t)},expression:"entryInfo.FaQIaoNo"}})],1)],1)],1),e._v(" "),n("el-row",{attrs:{gutter:20}},[n("el-col",{attrs:{span:12}},[n("el-form-item",{attrs:{label:"产品名称"}},[n("el-input",{attrs:{readonly:""},model:{value:e.entryInfo.materialName,callback:function(t){e.$set(e.entryInfo,"materialName",t)},expression:"entryInfo.materialName"}})],1)],1),e._v(" "),n("el-col",{attrs:{span:12}},[n("el-form-item",{attrs:{label:"产品型号"}},[n("el-input",{attrs:{readonly:""},model:{value:e.entryInfo.materialSpec,callback:function(t){e.$set(e.entryInfo,"materialSpec",t)},expression:"entryInfo.materialSpec"}})],1)],1)],1),e._v(" "),n("el-row",{attrs:{gutter:20}},[n("el-col",{attrs:{span:12}},[n("el-form-item",{attrs:{label:"应出库数量",required:""}},[n("el-input",{attrs:{type:"number"},model:{value:e.entryInfo.outboundQuantity,callback:function(t){e.$set(e.entryInfo,"outboundQuantity",t)},expression:"entryInfo.outboundQuantity"}})],1)],1),e._v(" "),n("el-col",{attrs:{span:12}},[n("el-form-item",{attrs:{label:"已出库数量"}},[n("el-input",{attrs:{readonly:"",type:"number"},model:{value:e.entryInfo.outNumber,callback:function(t){e.$set(e.entryInfo,"outNumber",t)},expression:"entryInfo.outNumber"}})],1)],1)],1)],1):e._e(),e._v(" "),n("el-form",{ref:"scanForm",attrs:{model:e.scanForm,rules:e.rules}},[n("el-form-item",{attrs:{prop:"barcode"}},[n("el-input",{ref:"scanInput",attrs:{placeholder:e.placeholder,clearable:""},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleScanInput(t)}},model:{value:e.scanForm.barcode,callback:function(t){e.$set(e.scanForm,"barcode",t)},expression:"scanForm.barcode"}},[n("template",{slot:"append"},[n("el-button",{on:{click:e.handleScanInput}},[e._v("确认")])],1)],2)],1)],1),e._v(" "),e.entryInfo.entryNo?n("div",{staticClass:"entry-info"},[n("el-card",{staticClass:"box-card"},[n("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[n("span",[e._v("出库单信息")])]),e._v(" "),n("el-row",{attrs:{gutter:20}},[n("el-col",{attrs:{span:8}},[n("div",{staticClass:"info-item"},[n("label",[e._v("出库单号：")]),e._v(" "),n("span",[e._v(e._s(e.entryInfo.entryNo))])])]),e._v(" "),n("el-col",{attrs:{span:8}},[n("div",{staticClass:"info-item"},[n("label",[e._v("生产订单：")]),e._v(" "),n("span",[e._v(e._s(e.entryInfo.productionOrderNo))])])]),e._v(" "),n("el-col",{attrs:{span:8}},[n("div",{staticClass:"info-item"},[n("label",[e._v("销售订单：")]),e._v(" "),n("span",[e._v(e._s(e.entryInfo.saleOrderNo))])])])],1),e._v(" "),n("el-row",{attrs:{gutter:20}},[n("el-col",{attrs:{span:8}},[n("div",{staticClass:"info-item"},[n("label",[e._v("物料名称：")]),e._v(" "),n("span",[e._v(e._s(e.entryInfo.materialName))])])]),e._v(" "),n("el-col",{attrs:{span:8}},[n("div",{staticClass:"info-item"},[n("label",[e._v("规格型号：")]),e._v(" "),n("span",[e._v(e._s(e.entryInfo.materialSpec))])])]),e._v(" "),n("el-col",{attrs:{span:8}},[n("div",{staticClass:"info-item"},[n("label",[e._v("完成进度：")]),e._v(" "),n("el-progress",{attrs:{percentage:e.entryInfo.progress,status:e.entryInfo.progress>=100?"success":""}})],1)])],1),e._v(" "),n("el-row",{attrs:{gutter:20}},[n("el-col",{attrs:{span:8}},[n("div",{staticClass:"info-item"},[n("label",[e._v("应出库数量")]),e._v(" "),n("span",[e._v(e._s(e.entryInfo.outboundQuantity))])])]),e._v(" "),n("el-col",{attrs:{span:8}},[n("div",{staticClass:"info-item"},[n("label",[e._v("已出库数量：")]),e._v(" "),n("span",[e._v(e._s(e.entryInfo.outNumber))])])]),e._v(" "),n("el-col",{attrs:{span:8}},[n("div",{staticClass:"info-item"},[n("label",[e._v("托盘数量：")]),e._v(" "),n("span",[e._v(e._s(e.entryInfo.palletCount))])])])],1)],1)],1):e._e(),e._v(" "),e.entryInfo.entryItems.length>0?n("div",{staticClass:"scan-list"},[n("el-table",{staticStyle:{width:"100%"},attrs:{data:e.entryInfo.entryItems,border:""}},[n("el-table-column",{attrs:{label:"托盘编号",prop:"palletCode",align:"center"}}),e._v(" "),n("el-table-column",{attrs:{label:"销售订单",prop:"saleOrderNo",align:"center"}}),e._v(" "),n("el-table-column",{attrs:{label:"物料编码",prop:"materialCode",align:"center"}}),e._v(" "),n("el-table-column",{attrs:{label:"数量",prop:"quantity",align:"center"}}),e._v(" "),n("el-table-column",{attrs:{label:"产线",prop:"lineCode",align:"center"}}),e._v(" "),n("el-table-column",{attrs:{label:"扫描时间",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n            "+e._s(e.formatDateTime(t.row.scanTime))+"\n          ")]}}],null,!1,2045185588)})],1)],1):e._e()],1),e._v(" "),n("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{on:{click:function(t){e.dialogVisible=!1}}},[e._v("取 消")]),e._v(" "),n("el-button",{attrs:{type:"primary",disabled:!e.entryInfo.entryItems.length},on:{click:e.handleComplete}},[e._v("\n      完成出库\n    ")])],1)])}),[],!1,null,"25f26b60",null);t.default=u.exports}}]);