(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-6c39bd78"],{3835:function(t,e,a){"use strict";var n=a("06c5");function s(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var a=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=a){var n,s,r,l,o=[],i=!0,c=!1;try{if(r=(a=a.call(t)).next,0===e){if(Object(a)!==a)return;i=!1}else for(;!(i=(n=r.call(a)).done)&&(o.push(n.value),o.length!==e);i=!0);}catch(t){c=!0,s=t}finally{try{if(!i&&null!=a.return&&(l=a.return(),Object(l)!==l))return}finally{if(c)throw s}}return o}}(t,e)||Object(n.a)(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}a.d(e,"a",(function(){return s}))},"64e6":function(t,e,a){"use strict";a.d(e,"a",(function(){return s})),a.d(e,"b",(function(){return r})),a.d(e,"c",(function(){return l})),a.d(e,"d",(function(){return o}));var n=a("b775");function s(t){return Object(n.a)({url:"/warehouse_entry/scan",method:"post",data:t})}function r(t){return Object(n.a)({url:"/warehouse_entry/scan_on",method:"post",data:t})}function l(t){return Object(n.a)({url:"/k3/sync_warehouse_entry",method:"post",data:t})}function o(t){return Object(n.a)({url:"/k3/sync_warehouse_ontry",method:"post",data:t})}},b9cf:function(t,e,a){"use strict";a("eaf1")},e0c0:function(t,e,a){"use strict";a.r(e);var n=a("c7eb"),s=(a("c5f6"),a("28a5"),a("3835")),r=(a("96cf"),a("1da1")),l=a("64e6"),o={name:"ScanDialog",props:{visible:{type:Boolean,default:!1},title:{type:String,default:"托盘扫码入库"},placeholder:{type:String,default:"请扫描托盘条码"}},data:function(){return{stock_id:localStorage.getItem("lastSelectedstock_id")||null,stockId:localStorage.getItem("lastSelectedStockId")||null,dialogVisible:!1,scanForm:{barcode:"",stockId:localStorage.getItem("lastSelectedStockId")||null},rules:{barcode:[{required:!0,message:"请输入或扫描条码",trigger:"blur"}]},scanRecords:[],entryInfo:null}},watch:{visible:function(t){var e=this;this.dialogVisible=t,t&&this.$nextTick((function(){e.$refs.scanInput.focus()}))},dialogVisible:function(t){this.$emit("update:visible",t),t||this.resetForm()}},methods:{handleTemplateChange:function(t){t&&(this.stock_id=t._id,this.scanForm.stockId=t.FStockId,localStorage.setItem("lastSelectedstock_id",t._id),localStorage.setItem("lastSelectedStockId",t.FStockId))},handleScanInput:function(){var t=Object(r.a)(Object(n.a)().mark((function t(){var e,a,r,o,i,c,u,d,f;return Object(n.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,this.$refs.scanForm.validate();case 3:return e=this.scanForm.barcode.trim(),t.next=6,this.$emit("scan",e);case 6:if(!t.sent){t.next=20;break}return a=e.split("#"),r=Object(s.a)(a,5),o=r[0],i=r[1],c=r[2],u=r[3],d=r[4],t.next=11,Object(l.a)({palletCode:o,stockId:this.scanForm.stockId,userId:this.$store.state.user.id});case 11:if((f=t.sent).data&&(this.entryInfo=f.data),200===f.code){t.next=16;break}return this.$message.error(f.message),t.abrupt("return");case 16:this.$message.success("扫码入库成功"),this.scanRecords.unshift({palletCode:o,saleOrderNo:i,materialCode:c,quantity:Number(u),lineCode:d,scanTime:new Date}),this.scanForm.barcode="",this.scanForm.stockId="";case 20:t.next=25;break;case 22:t.prev=22,t.t0=t.catch(0),console.error("扫描失败:",t.t0);case 25:case"end":return t.stop()}}),t,this,[[0,22]])})));return function(){return t.apply(this,arguments)}}(),handleComplete:function(){var t=Object(r.a)(Object(n.a)().mark((function t(){return Object(n.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,this.$emit("complete",this.scanRecords.map((function(t){return t.palletCode})));case 3:this.dialogVisible=!1,t.next=9;break;case 6:t.prev=6,t.t0=t.catch(0),console.error("完成入库失败:",t.t0);case 9:case"end":return t.stop()}}),t,this,[[0,6]])})));return function(){return t.apply(this,arguments)}}(),handleClose:function(){this.resetForm()},resetForm:function(){this.scanForm.barcode="",this.scanRecords=[],this.entryInfo=null,this.$refs.scanForm&&this.$refs.scanForm.resetFields()},formatDateTime:function(t){return new Date(t).toLocaleString()}}},i=o,c=(a("b9cf"),a("2877")),u=Object(c.a)(i,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-dialog",{attrs:{title:t.title,visible:t.dialogVisible,width:"800px"},on:{"update:visible":function(e){t.dialogVisible=e},close:t.handleClose}},[a("div",{staticClass:"scan-container"},[a("el-form",{ref:"scanForm",attrs:{model:t.scanForm,rules:t.rules}},[a("el-form-item",{attrs:{prop:"barcode"}},[a("zr-select",{attrs:{collection:"k3_BD_STOCK","search-fields":["FName","FNumber"],"label-key":"FName","sub-key":"FStockId",multiple:!1,placeholder:"请选择仓库"},on:{select:t.handleTemplateChange},scopedSlots:t._u([{key:"option",fn:function(e){var n=e.item;return[a("div",{staticClass:"item-option"},[a("div",{staticClass:"item-info"},[a("span",{staticClass:"name"},[t._v(t._s(n.FName))]),t._v(" "),a("el-tag",{attrs:{size:"mini",type:"info"}},[t._v(t._s(n.FNumber))])],1),t._v(" "),a("div",{staticClass:"sub-info"},[t._v("FName\n                      "),a("small",[t._v(t._s(n.FName))])])])]}}]),model:{value:t.stock_id,callback:function(e){t.stock_id=e},expression:"stock_id"}})],1),t._v(" "),a("el-form-item",{attrs:{prop:"barcode"}},[a("el-input",{ref:"scanInput",attrs:{placeholder:t.placeholder,clearable:""},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.handleScanInput(e)}},model:{value:t.scanForm.barcode,callback:function(e){t.$set(t.scanForm,"barcode",e)},expression:"scanForm.barcode"}})],1)],1),t._v(" "),t.entryInfo?a("div",{staticClass:"entry-info"},[a("el-card",{staticClass:"box-card"},[a("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[a("span",[t._v("入库单信息")])]),t._v(" "),a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:8}},[a("div",{staticClass:"info-item"},[a("label",[t._v("入库单号：")]),t._v(" "),a("span",[t._v(t._s(t.entryInfo.entryNo))])])]),t._v(" "),a("el-col",{attrs:{span:8}},[a("div",{staticClass:"info-item"},[a("label",[t._v("生产订单：")]),t._v(" "),a("span",[t._v(t._s(t.entryInfo.productionOrderNo))])])]),t._v(" "),a("el-col",{attrs:{span:8}},[a("div",{staticClass:"info-item"},[a("label",[t._v("销售订单：")]),t._v(" "),a("span",[t._v(t._s(t.entryInfo.saleOrderNo))])])])],1),t._v(" "),a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:8}},[a("div",{staticClass:"info-item"},[a("label",[t._v("物料名称：")]),t._v(" "),a("span",[t._v(t._s(t.entryInfo.materialName))])])]),t._v(" "),a("el-col",{attrs:{span:8}},[a("div",{staticClass:"info-item"},[a("label",[t._v("规格型号：")]),t._v(" "),a("span",[t._v(t._s(t.entryInfo.materialSpec))])])]),t._v(" "),a("el-col",{attrs:{span:8}},[a("div",{staticClass:"info-item"},[a("label",[t._v("完成进度：")]),t._v(" "),a("el-progress",{attrs:{percentage:t.entryInfo.progress,status:t.entryInfo.progress>=100?"success":""}})],1)])],1),t._v(" "),a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:8}},[a("div",{staticClass:"info-item"},[a("label",[t._v("计划数量：")]),t._v(" "),a("span",[t._v(t._s(t.entryInfo.plannedQuantity))])])]),t._v(" "),a("el-col",{attrs:{span:8}},[a("div",{staticClass:"info-item"},[a("label",[t._v("实际数量：")]),t._v(" "),a("span",[t._v(t._s(t.entryInfo.actualQuantity))])])]),t._v(" "),a("el-col",{attrs:{span:8}},[a("div",{staticClass:"info-item"},[a("label",[t._v("托盘数量：")]),t._v(" "),a("span",[t._v(t._s(t.entryInfo.palletCount))])])])],1)],1)],1):t._e(),t._v(" "),a("div",{staticClass:"scan-list"},[a("el-table",{staticStyle:{width:"100%"},attrs:{data:t.scanRecords,border:""}},[a("el-table-column",{attrs:{label:"托盘编号",prop:"palletCode",align:"center"}}),t._v(" "),a("el-table-column",{attrs:{label:"销售订单",prop:"saleOrderNo",align:"center"}}),t._v(" "),a("el-table-column",{attrs:{label:"物料编码",prop:"materialCode",align:"center"}}),t._v(" "),a("el-table-column",{attrs:{label:"数量",prop:"quantity",align:"center"}}),t._v(" "),a("el-table-column",{attrs:{label:"产线",prop:"lineCode",align:"center"}}),t._v(" "),a("el-table-column",{attrs:{label:"扫描时间",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n            "+t._s(t.formatDateTime(e.row.scanTime))+"\n          ")]}}])})],1)],1)],1),t._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(e){t.dialogVisible=!1}}},[t._v("取 消")]),t._v(" "),a("el-button",{attrs:{type:"primary",disabled:!t.scanRecords.length},on:{click:t.handleComplete}},[t._v("\n      完成入库\n    ")])],1)])}),[],!1,null,"35e6b61e",null);e.default=u.exports},eaf1:function(t,e,a){}}]);