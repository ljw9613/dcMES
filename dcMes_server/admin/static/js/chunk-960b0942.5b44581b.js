(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-960b0942","chunk-2eade242","chunk-2da4d1b6","chunk-4c3a0513","chunk-288ffec8","chunk-2d222794"],{"1f24":function(t,e,a){"use strict";a.r(e);var s=a("c7eb"),r=(a("96cf"),a("1da1")),i=(a("bb50"),{dicts:["expert_platform","task_type","content_type","category"],name:"EditDialog",props:{dialogFormVisible:{type:Boolean,default:!1},dialogStatus:{type:String,default:"create"},dataForm:{type:Object,required:!0}},data:function(){var t=this;return{taskTypeOptions:[{value:"品牌宣传",label:"品牌宣传"},{value:"达人推广",label:"达人推广"},{value:"达人直播",label:"达人直播"},{value:"达人视频",label:"达人视频"},{value:"直播带货",label:"直播带货"}],platformOptions:[{value:"抖音",label:"抖音"},{value:"小红书",label:"小红书"},{value:"B站",label:"B站"},{value:"微博",label:"微博"}],contentTypeOptions:[{value:"短视频",label:"短视频"},{value:"直播",label:"直播"},{value:"图文",label:"图文"}],expertCategoryOptions:[{value:"美妆",label:"美妆"},{value:"服装",label:"服装"},{value:"美食",label:"美食"},{value:"母婴",label:"母婴"}],remarkTypeOptions:[{value:"图片",label:"图片"},{value:"视频",label:"视频"},{value:"文档",label:"文档"}],rules:{title:[{required:!0,message:"请输入任务标题",trigger:"blur"}],type:[{required:!0,message:"请选择任务类型",trigger:"change"}],description:[{required:!0,message:"请输入任务描述",trigger:"blur"}],startTime:[{required:!0,message:"请选择开始时间",trigger:"change"}],endTime:[{required:!0,message:"请选择结束时间",trigger:"change"},{validator:function(e,a,s){a&&t.dataForm.startTime&&a<t.dataForm.startTime?s(new Error("结束时间不能早于开始时间")):s()},trigger:"change"}],"cooperationDetails.brandName":[{required:!0,message:"请输入品牌名称",trigger:"blur"}],"cooperationDetails.requirements.platformType":[{required:!0,message:"请选择合作平台",trigger:"change"}],"cooperationDetails.requirements.contentType":[{required:!0,message:"请选择内容形式",trigger:"change"}],"cooperationDetails.commercialTerms.budget":[{required:!0,message:"请输入项目预算",trigger:"blur"}]}}},methods:{addMaterial:function(){this.dataForm.cooperationDetails.remarks.push({name:"",type:"",url:"",description:"",uploadTime:new Date})},removeMaterial:function(t){this.dataForm.cooperationDetails.remarks.splice(t,1)},submitForm:function(){var t=this;this.$refs.dataForm.validate(function(){var e=Object(r.a)(Object(s.a)().mark((function e(a){var r;return Object(s.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!a){e.next=7;break}r=JSON.parse(JSON.stringify(t.dataForm)),"create"===t.dialogStatus&&(r.createTime=new Date),r.updateTime=new Date,t.$emit("submit",r),e.next=8;break;case 7:return e.abrupt("return",!1);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}}}),n=i,l=(a("b7d7"),a("2877")),o=Object(l.a)(n,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-dialog",{staticClass:"task-dialog",attrs:{title:"create"===t.dialogStatus?"新建任务":"编辑任务",visible:t.dialogFormVisible,width:"70%","close-on-click-modal":!1},on:{"update:visible":function(e){t.dialogFormVisible=e}}},[a("el-form",{ref:"dataForm",attrs:{model:t.dataForm,rules:t.rules,"label-width":"120px"}},[a("el-divider",{attrs:{"content-position":"left"}},[t._v("基本信息")]),t._v(" "),a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"任务标题",prop:"title"}},[a("el-input",{attrs:{placeholder:"请输入任务标题"},model:{value:t.dataForm.title,callback:function(e){t.$set(t.dataForm,"title",e)},expression:"dataForm.title"}})],1)],1),t._v(" "),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"任务类型",prop:"type"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择任务类型"},model:{value:t.dataForm.type,callback:function(e){t.$set(t.dataForm,"type",e)},expression:"dataForm.type"}},t._l(t.dict.type.task_type,(function(t){return a("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),1)],1)],1)],1),t._v(" "),a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:24}},[a("el-form-item",{attrs:{label:"任务描述",prop:"description"}},[a("el-input",{attrs:{type:"textarea",rows:3,placeholder:"请输入任务描述"},model:{value:t.dataForm.description,callback:function(e){t.$set(t.dataForm,"description",e)},expression:"dataForm.description"}})],1)],1)],1),t._v(" "),a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"开始时间",prop:"startTime"}},[a("el-date-picker",{staticStyle:{width:"100%"},attrs:{type:"datetime",placeholder:"选择开始时间"},model:{value:t.dataForm.startTime,callback:function(e){t.$set(t.dataForm,"startTime",e)},expression:"dataForm.startTime"}})],1)],1),t._v(" "),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"结束时间",prop:"endTime"}},[a("el-date-picker",{staticStyle:{width:"100%"},attrs:{type:"datetime",placeholder:"选择结束时间"},model:{value:t.dataForm.endTime,callback:function(e){t.$set(t.dataForm,"endTime",e)},expression:"dataForm.endTime"}})],1)],1)],1),t._v(" "),a("el-divider",{attrs:{"content-position":"left"}},[t._v("品牌合作信息")]),t._v(" "),a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"品牌名称",prop:"cooperationDetails.brandName"}},[a("el-input",{attrs:{placeholder:"请输入品牌名称"},model:{value:t.dataForm.cooperationDetails.brandName,callback:function(e){t.$set(t.dataForm.cooperationDetails,"brandName",e)},expression:"dataForm.cooperationDetails.brandName"}})],1)],1)],1),t._v(" "),a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"产品名称",prop:"cooperationDetails.productName"}},[a("el-input",{attrs:{placeholder:"请输入产品名称"},model:{value:t.dataForm.cooperationDetails.productName,callback:function(e){t.$set(t.dataForm.cooperationDetails,"productName",e)},expression:"dataForm.cooperationDetails.productName"}})],1)],1),t._v(" "),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"产品品类",prop:"cooperationDetails.productCategory"}},[a("el-input",{attrs:{placeholder:"请输入产品品类"},model:{value:t.dataForm.cooperationDetails.productCategory,callback:function(e){t.$set(t.dataForm.cooperationDetails,"productCategory",e)},expression:"dataForm.cooperationDetails.productCategory"}})],1)],1)],1),t._v(" "),a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:24}},[a("el-form-item",{attrs:{label:"产品详情",prop:"cooperationDetails.productDetails"}},[a("el-input",{attrs:{type:"textarea",rows:3,placeholder:"请输入产品详情描述"},model:{value:t.dataForm.cooperationDetails.productDetails,callback:function(e){t.$set(t.dataForm.cooperationDetails,"productDetails",e)},expression:"dataForm.cooperationDetails.productDetails"}})],1)],1)],1),t._v(" "),a("el-divider",{attrs:{"content-position":"left"}},[t._v("合作要求")]),t._v(" "),a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"合作平台",prop:"cooperationDetails.requirements.platformType"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{multiple:"",placeholder:"请选择合作平台"},model:{value:t.dataForm.cooperationDetails.requirements.platformType,callback:function(e){t.$set(t.dataForm.cooperationDetails.requirements,"platformType",e)},expression:"dataForm.cooperationDetails.requirements.platformType"}},t._l(t.dict.type.expert_platform,(function(t){return a("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),1)],1)],1),t._v(" "),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"内容形式",prop:"cooperationDetails.requirements.contentType"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{multiple:"",placeholder:"请选择内容形式"},model:{value:t.dataForm.cooperationDetails.requirements.contentType,callback:function(e){t.$set(t.dataForm.cooperationDetails.requirements,"contentType",e)},expression:"dataForm.cooperationDetails.requirements.contentType"}},t._l(t.dict.type.content_type,(function(t){return a("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),1)],1)],1)],1),t._v(" "),a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"粉丝数要求",prop:"cooperationDetails.requirements.expertRequirements.fansCountMin"}},[a("el-input-number",{staticStyle:{width:"40%"},attrs:{min:0},model:{value:t.dataForm.cooperationDetails.requirements.expertRequirements.fansCountMin,callback:function(e){t.$set(t.dataForm.cooperationDetails.requirements.expertRequirements,"fansCountMin",e)},expression:"dataForm.cooperationDetails.requirements.expertRequirements.fansCountMin"}}),t._v(" "),a("span",{staticStyle:{"margin-left":"10px"}},[t._v("-")]),t._v(" "),a("el-input-number",{staticStyle:{width:"40%"},attrs:{min:0},model:{value:t.dataForm.cooperationDetails.requirements.expertRequirements.fansCountMax,callback:function(e){t.$set(t.dataForm.cooperationDetails.requirements.expertRequirements,"fansCountMax",e)},expression:"dataForm.cooperationDetails.requirements.expertRequirements.fansCountMax"}})],1)],1),t._v(" "),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"达人类目",prop:"cooperationDetails.requirements.expertRequirements.expertCategory"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{multiple:"",placeholder:"请选择达人分类",clearable:""},model:{value:t.dataForm.cooperationDetails.requirements.expertRequirements.expertCategory,callback:function(e){t.$set(t.dataForm.cooperationDetails.requirements.expertRequirements,"expertCategory",e)},expression:"dataForm.cooperationDetails.requirements.expertRequirements.expertCategory"}},t._l(t.dict.type.category,(function(t){return a("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),1)],1)],1)],1),t._v(" "),a("el-divider",{attrs:{"content-position":"left"}},[t._v("商务条款")]),t._v(" "),a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:8}},[a("el-form-item",{attrs:{label:"达人预算",prop:"cooperationDetails.commercialTerms.budget"}},[a("el-input-number",{staticStyle:{width:"100%"},attrs:{min:0},model:{value:t.dataForm.cooperationDetails.commercialTerms.budget,callback:function(e){t.$set(t.dataForm.cooperationDetails.commercialTerms,"budget",e)},expression:"dataForm.cooperationDetails.commercialTerms.budget"}})],1)],1),t._v(" "),a("el-col",{attrs:{span:8}},[a("el-form-item",{attrs:{label:"佣金比例",prop:"cooperationDetails.commercialTerms.commissionRate"}},[a("el-input-number",{staticStyle:{width:"100%"},attrs:{min:0,max:100},model:{value:t.dataForm.cooperationDetails.commercialTerms.commissionRate,callback:function(e){t.$set(t.dataForm.cooperationDetails.commercialTerms,"commissionRate",e)},expression:"dataForm.cooperationDetails.commercialTerms.commissionRate"}})],1)],1)],1),t._v(" "),a("el-divider",{attrs:{"content-position":"left"}},[t._v("KPI目标")]),t._v(" "),a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:8}},[a("el-form-item",{attrs:{label:"播放量目标",prop:"cooperationDetails.kpiTargets.viewsTarget"}},[a("el-input-number",{staticStyle:{width:"100%"},attrs:{min:0},model:{value:t.dataForm.cooperationDetails.kpiTargets.viewsTarget,callback:function(e){t.$set(t.dataForm.cooperationDetails.kpiTargets,"viewsTarget",e)},expression:"dataForm.cooperationDetails.kpiTargets.viewsTarget"}})],1)],1),t._v(" "),a("el-col",{attrs:{span:8}},[a("el-form-item",{attrs:{label:"互动量目标",prop:"cooperationDetails.kpiTargets.interactionTarget"}},[a("el-input-number",{staticStyle:{width:"100%"},attrs:{min:0},model:{value:t.dataForm.cooperationDetails.kpiTargets.interactionTarget,callback:function(e){t.$set(t.dataForm.cooperationDetails.kpiTargets,"interactionTarget",e)},expression:"dataForm.cooperationDetails.kpiTargets.interactionTarget"}})],1)],1),t._v(" "),a("el-col",{attrs:{span:8}},[a("el-form-item",{attrs:{label:"销售目标",prop:"cooperationDetails.kpiTargets.salesTarget"}},[a("el-input-number",{staticStyle:{width:"100%"},attrs:{min:0},model:{value:t.dataForm.cooperationDetails.kpiTargets.salesTarget,callback:function(e){t.$set(t.dataForm.cooperationDetails.kpiTargets,"salesTarget",e)},expression:"dataForm.cooperationDetails.kpiTargets.salesTarget"}})],1)],1)],1),t._v(" "),a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:8}},[a("el-form-item",{attrs:{label:"达人数量目标",prop:"cooperationDetails.kpiTargets.expertCount"}},[a("el-input-number",{staticStyle:{width:"100%"},attrs:{min:0},model:{value:t.dataForm.cooperationDetails.kpiTargets.expertCount,callback:function(e){t.$set(t.dataForm.cooperationDetails.kpiTargets,"expertCount",e)},expression:"dataForm.cooperationDetails.kpiTargets.expertCount"}})],1)],1),t._v(" "),a("el-col",{attrs:{span:8}},[a("el-form-item",{attrs:{label:"视频数量目标",prop:"cooperationDetails.kpiTargets.videoCount"}},[a("el-input-number",{staticStyle:{width:"100%"},attrs:{min:0},model:{value:t.dataForm.cooperationDetails.kpiTargets.videoCount,callback:function(e){t.$set(t.dataForm.cooperationDetails.kpiTargets,"videoCount",e)},expression:"dataForm.cooperationDetails.kpiTargets.videoCount"}})],1)],1),t._v(" "),a("el-col",{attrs:{span:8}},[a("el-form-item",{attrs:{label:"直播场次目标",prop:"cooperationDetails.kpiTargets.liveStreamCount"}},[a("el-input-number",{staticStyle:{width:"100%"},attrs:{min:0},model:{value:t.dataForm.cooperationDetails.kpiTargets.liveStreamCount,callback:function(e){t.$set(t.dataForm.cooperationDetails.kpiTargets,"liveStreamCount",e)},expression:"dataForm.cooperationDetails.kpiTargets.liveStreamCount"}})],1)],1)],1),t._v(" "),a("el-divider",{attrs:{"content-position":"left"}},[t._v("备注信息")]),t._v(" "),a("el-form-item",[a("el-button",{attrs:{type:"primary",size:"small"},on:{click:t.addMaterial}},[t._v("添加备注")])],1),t._v(" "),t._l(t.dataForm.cooperationDetails.remarks,(function(e,s){return a("div",{key:s,staticClass:"remark-item"},[a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"备注名称"+(s+1),prop:"cooperationDetails.remarks."+s+".name"}},[a("el-input",{attrs:{placeholder:"请输入备注名称"},model:{value:e.name,callback:function(a){t.$set(e,"name",a)},expression:"remark.name"}})],1)],1),t._v(" "),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"备注类型",prop:"cooperationDetails.remarks."+s+".type"}},[a("el-input",{attrs:{placeholder:"请输入备注类型"},model:{value:e.type,callback:function(a){t.$set(e,"type",a)},expression:"remark.type"}})],1)],1)],1),t._v(" "),a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:22}},[a("el-form-item",{attrs:{label:"备注链接",prop:"cooperationDetails.remarks."+s+".url"}},[a("el-input",{attrs:{placeholder:"请输入备注链接"},model:{value:e.url,callback:function(a){t.$set(e,"url",a)},expression:"remark.url"}})],1)],1),t._v(" "),a("el-col",{attrs:{span:2}},[a("el-button",{attrs:{type:"danger",icon:"el-icon-delete",circle:""},on:{click:function(e){return t.removeMaterial(s)}}})],1)],1)],1)}))],2),t._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(e){t.dialogFormVisible=!1}}},[t._v("取 消")]),t._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:t.submitForm}},[t._v("确 定")])],1)],1)}),[],!1,null,"88ae6a6e",null);e.default=o.exports},2268:function(t,e,a){"use strict";a("7059")},"3e48":function(t,e,a){"use strict";a.r(e);var s=a("c466"),r={name:"TaskClaimDetails",props:{visible:{type:Boolean,default:!1},details:{type:Object,default:function(){return{}}}},data:function(){return{isTimelineExpanded:!1}},methods:{handleClose:function(){this.$emit("update:visible",!1)},formatDate:function(t){return Object(s.a)(t,"yyyy-MM-dd HH:mm")},formatNumber:function(t){return Object(s.b)(t)},getClaimStatusType:function(t){return{"待审核":"warning","已通过":"success","已拒绝":"danger"}[t]||"info"},getProgressStatusType:function(t){return{"未开始":"info","沟通中":"warning","合作成功":"success","寄送样品":"primary","样品跟踪":"primary","已收货":"success","内容制作中":"primary","作品已发布":"success","数据统计中":"warning","已完成":"success","已取消":"danger","合作失败":"danger"}[t]||"info"},getTimelineItemType:function(t){return{"未开始":"info","沟通中":"warning","执行中":"primary","已完成":"success","已取消":"danger"}[t]||"info"}}},i=r,n=(a("2268"),a("2877")),l=Object(n.a)(i,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-dialog",{attrs:{title:"任务详情",visible:t.visible,width:"70%","close-on-click-modal":!1,"custom-class":"claim-details-dialog","append-to-body":""},on:{"update:visible":function(e){t.visible=e},close:t.handleClose}},[a("div",{staticClass:"claim-details"},[a("div",{staticClass:"detail-section"},[a("div",{staticClass:"section-title"},[t._v("基本信息")]),t._v(" "),a("div",{staticClass:"info-grid"},[a("div",{staticClass:"info-item"},[a("div",{staticClass:"info-label"},[t._v("经纪人")]),t._v(" "),a("div",{staticClass:"info-content"},[t._v(t._s(t.details.agentName))])]),t._v(" "),a("div",{staticClass:"info-item"},[a("div",{staticClass:"info-label"},[t._v("关联达人")]),t._v(" "),a("div",{staticClass:"info-content"},[t._v(t._s(t.details.expertName))])]),t._v(" "),a("div",{staticClass:"info-item"},[a("div",{staticClass:"info-label"},[t._v("认领状态")]),t._v(" "),a("div",{staticClass:"info-content"},[a("el-tag",{attrs:{type:t.getClaimStatusType(t.details.claimStatus)}},[t._v("\n              "+t._s(t.details.claimStatus)+"\n            ")])],1)]),t._v(" "),a("div",{staticClass:"info-item"},[a("div",{staticClass:"info-label"},[t._v("认领时间")]),t._v(" "),a("div",{staticClass:"info-content"},[t._v(t._s(t.formatDate(t.details.claimTime)))])]),t._v(" "),a("div",{staticClass:"info-item full-width"},[a("div",{staticClass:"info-label"},[t._v("认领说明")]),t._v(" "),a("div",{staticClass:"info-content"},[t._v(t._s(t.details.remark||"无"))])])])]),t._v(" "),a("div",{staticClass:"detail-section"},[a("div",{staticClass:"section-title",staticStyle:{display:"flex","justify-content":"space-between","align-items":"center"}},[a("span",[t._v("进度记录")]),t._v(" "),a("el-button",{attrs:{type:"text"},on:{click:function(e){t.isTimelineExpanded=!t.isTimelineExpanded}}},[t._v("\n          "+t._s(t.isTimelineExpanded?"收起":"展开")+"\n          "),a("i",{class:t.isTimelineExpanded?"el-icon-arrow-up":"el-icon-arrow-down"})])],1),t._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:t.isTimelineExpanded,expression:"isTimelineExpanded"}],staticClass:"progress-timeline"},[a("el-timeline",t._l(t.details.progressSteps,(function(e,s){return a("el-timeline-item",{key:s,attrs:{timestamp:t.formatDate(e.updateTime),type:t.getTimelineItemType(e.status)}},[a("div",{staticClass:"progress-item"},[a("div",{staticClass:"progress-header"},[a("el-tag",{attrs:{type:t.getProgressStatusType(e.status),size:"small"}},[t._v("\n                  "+t._s(e.status)+"\n                ")]),t._v(" "),a("span",{staticClass:"progress-step"},[t._v(t._s(e.step))])],1),t._v(" "),e.remark?a("div",{staticClass:"progress-remark"},[t._v("\n                "+t._s(e.remark)+"\n              ")]):t._e()])])})),1)],1)]),t._v(" "),t.details.result&&t.details.result.contentList?a("div",{staticClass:"detail-section"},[a("div",{staticClass:"section-title"},[t._v("执行结果")]),t._v(" "),a("div",{staticClass:"result-section"},[a("div",{staticClass:"sub-title"},[t._v("内容列表")]),t._v(" "),a("el-table",{staticStyle:{width:"100%","margin-bottom":"20px"},attrs:{data:t.details.result.contentList,border:"",size:"small"}},[a("el-table-column",{attrs:{label:"平台",prop:"platform",width:"120"}}),t._v(" "),a("el-table-column",{attrs:{label:"类型",prop:"type",width:"120"}}),t._v(" "),a("el-table-column",{attrs:{label:"发布时间",width:"160"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n              "+t._s(t.formatDate(e.row.publishTime))+"\n            ")]}}],null,!1,2436397959)}),t._v(" "),a("el-table-column",{attrs:{label:"链接"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-link",{attrs:{type:"primary",href:e.row.link,target:"_blank"}},[t._v("\n                "+t._s(e.row.link)+"\n              ")])]}}],null,!1,422598859)}),t._v(" "),a("el-table-column",{attrs:{label:"视频代码",width:"120"},scopedSlots:t._u([{key:"default",fn:function(e){return[e.row.videoCode?a("span",[t._v(t._s(e.row.videoCode))]):a("span",[t._v("-")])]}}],null,!1,2314334044)}),t._v(" "),a("el-table-column",{attrs:{label:"内容效果数据"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("div",{staticClass:"performance-data"},[a("div",{staticClass:"data-item",staticStyle:{display:"flex","align-items":"center"}},[a("i",{staticClass:"el-icon-video-play"}),t._v(" "),a("div",{staticClass:"data-label"},[t._v("播放量")]),t._v(" "),a("div",{staticClass:"data-value"},[t._v("\n                    "+t._s(t.formatNumber(e.row.performanceData.views))+"\n                  ")])]),t._v(" "),a("div",{staticClass:"data-item",staticStyle:{display:"flex","align-items":"center"}},[a("i",{staticClass:"el-icon-star-on"}),t._v(" "),a("div",{staticClass:"data-label"},[t._v("点赞数")]),t._v(" "),a("div",{staticClass:"data-value"},[t._v("\n                    "+t._s(t.formatNumber(e.row.performanceData.likes))+"\n                  ")])]),t._v(" "),a("div",{staticClass:"data-item",staticStyle:{display:"flex","align-items":"center"}},[a("i",{staticClass:"el-icon-chat-dot-round"}),t._v(" "),a("div",{staticClass:"data-label"},[t._v("评论数")]),t._v(" "),a("div",{staticClass:"data-value"},[t._v("\n                    "+t._s(t.formatNumber(e.row.performanceData.comments||0))+"\n                  ")])]),t._v(" "),a("div",{staticClass:"data-item",staticStyle:{display:"flex","align-items":"center"}},[a("i",{staticClass:"el-icon-share"}),t._v(" "),a("div",{staticClass:"data-label"},[t._v("总分享数")]),t._v(" "),a("div",{staticClass:"data-value"},[t._v("\n                    "+t._s(t.formatNumber(e.row.performanceData.shares||0))+"\n                  ")])]),t._v(" "),a("div",{staticClass:"data-item",staticStyle:{display:"flex","align-items":"center"}},[a("i",{staticClass:"el-icon-money"}),t._v(" "),a("div",{staticClass:"data-label"},[t._v("视频GMV")]),t._v(" "),a("div",{staticClass:"data-value"},[t._v("\n                    "+t._s(t.formatNumber(e.row.performanceData.videoGmv||0))+"\n                  ")])]),t._v(" "),a("div",{staticClass:"data-item",staticStyle:{display:"flex","align-items":"center"}},[a("i",{staticClass:"el-icon-money"}),t._v(" "),a("div",{staticClass:"data-label"},[t._v("直播GMV")]),t._v(" "),a("div",{staticClass:"data-value"},[t._v("\n                    "+t._s(t.formatNumber(e.row.performanceData.liveGmv||0))+"\n                  ")])])])]}}],null,!1,3232213187)})],1)],1),t._v(" "),a("div",{staticClass:"result-section"},[a("div",{staticClass:"sub-title"},[t._v("效果数据")]),t._v(" "),a("div",{staticClass:"data-grid"},[a("div",{staticClass:"data-item"},[a("i",{staticClass:"el-icon-video-play"}),t._v(" "),a("div",{staticClass:"data-label"},[t._v("总播放量:")]),t._v(" "),a("div",{staticClass:"data-value"},[t._v("\n              "+t._s(t.formatNumber(t.details.result.totalPerformance.totalViews||0))+"\n            ")])]),t._v(" "),a("div",{staticClass:"data-item"},[a("i",{staticClass:"el-icon-star-on"}),t._v(" "),a("div",{staticClass:"data-label"},[t._v("总点赞数:")]),t._v(" "),a("div",{staticClass:"data-value"},[t._v("\n              "+t._s(t.formatNumber(t.details.result.totalPerformance.totalLikes||0))+"\n            ")])]),t._v(" "),a("div",{staticClass:"data-item"},[a("i",{staticClass:"el-icon-chat-dot-round"}),t._v(" "),a("div",{staticClass:"data-label"},[t._v("总评论数:")]),t._v(" "),a("div",{staticClass:"data-value"},[t._v("\n              "+t._s(t.formatNumber(t.details.result.totalPerformance.totalComments||0))+"\n            ")])]),t._v(" "),a("div",{staticClass:"data-item"},[a("i",{staticClass:"el-icon-share"}),t._v(" "),a("div",{staticClass:"data-label"},[t._v("总分享数:")]),t._v(" "),a("div",{staticClass:"data-value"},[t._v("\n              "+t._s(t.formatNumber(t.details.result.totalPerformance.totalShares||0))+"\n            ")])]),t._v(" "),a("div",{staticClass:"data-item"},[a("i",{staticClass:"el-icon-money"}),t._v(" "),a("div",{staticClass:"data-label"},[t._v("总视频GMV:")]),t._v(" "),a("div",{staticClass:"data-value"},[t._v("\n              ¥"+t._s(t.formatNumber(t.details.result.totalPerformance.totalVideoGmv||0))+"\n            ")])]),t._v(" "),a("div",{staticClass:"data-item"},[a("i",{staticClass:"el-icon-money"}),t._v(" "),a("div",{staticClass:"data-label"},[t._v("总直播GMV:")]),t._v(" "),a("div",{staticClass:"data-value"},[t._v("\n              ¥"+t._s(t.formatNumber(t.details.result.totalPerformance.totalLiveGmv||0))+"\n            ")])])])])]):t._e()])])}),[],!1,null,"662b5f48",null);e.default=l.exports},"49e2":function(t,e,a){},"6c29b":function(t,e,a){"use strict";a.r(e);var s=a("c7eb"),r=(a("96cf"),a("1da1")),i=a("5530"),n=a("c466"),l=a("7e1e"),o={dicts:["expert_platform","task_type","content_type"],components:{TagInput:a("b5c9").a},name:"TaskResultDialog",props:{visible:{type:Boolean,default:!1},currentClaim:{type:Object,default:function(){return{}}},taskInfo:{type:Object,default:function(){return{}}}},data:function(){return{resultForm:{contentList:[],totalPerformance:{totalViews:0,totalLikes:0,totalComments:0,totalShares:0,totalGmv:0}},resultRules:{contentList:{type:"array",required:!0,message:"请至少添加一个内容",trigger:"change"}},productOptions:[{value:"产品1",label:"产品1"},{value:"产品2",label:"产品2"}]}},computed:{dialogVisible:{get:function(){return this.visible},set:function(t){this.$emit("update:visible",t)}},getTotalViews:function(){return this.resultForm.contentList.reduce((function(t,e){return t+(e.performanceData&&e.performanceData.views||0)}),0)},getTotalLikes:function(){return this.resultForm.contentList.reduce((function(t,e){return t+(e.performanceData&&e.performanceData.likes||0)}),0)},getTotalComments:function(){return this.resultForm.contentList.reduce((function(t,e){return t+(e.performanceData&&e.performanceData.comments||0)}),0)},getTotalShares:function(){return this.resultForm.contentList.reduce((function(t,e){return t+(e.performanceData&&e.performanceData.shares||0)}),0)},getTotalVideoGmv:function(){return this.resultForm.contentList.reduce((function(t,e){return t+(e.performanceData&&e.performanceData.videoGmv||0)}),0)},getTotalLiveGmv:function(){return this.resultForm.contentList.reduce((function(t,e){return t+(e.performanceData&&e.performanceData.liveGmv||0)}),0)}},watch:{visible:function(t){t&&this.initForm()}},methods:{formatNumber:n.b,initForm:function(){this.resultForm={contentList:[],totalPerformance:{totalViews:0,totalLikes:0,totalComments:0,totalShares:0,totalGmv:0}},this.currentClaim.result&&this.currentClaim.result.contentList&&(this.resultForm.contentList=this.currentClaim.result.contentList.map((function(t){return Object(i.a)(Object(i.a)({},t),{},{performanceData:Object(i.a)({views:0,likes:0,comments:0,shares:0,liveGmv:0,videoGmv:0,gmv:0},t.performanceData)})})))},addContent:function(){this.resultForm.contentList.push({platform:"",type:"",link:"",videoCode:"",adCode:"",products:[],publishTime:null,performanceData:{views:0,likes:0,comments:0,shares:0,liveGmv:0,videoGmv:0,gmv:0}})},removeContent:function(t){var e=this;this.$confirm("确定要删除该内容吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){e.resultForm.contentList.splice(t,1)})).catch((function(){}))},handleCancel:function(){this.dialogVisible=!1},handleSubmit:function(){var t=Object(r.a)(Object(s.a)().mark((function t(){var e;return Object(s.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,this.$refs.resultForm.validate();case 3:return e={totalViews:this.getTotalViews,totalLikes:this.getTotalLikes,totalComments:this.getTotalComments,totalShares:this.getTotalShares,totalGmv:this.getTotalGmv},t.next=6,Object(l.d)("taskClaim",{query:{_id:this.currentClaim._id},update:{result:{contentList:this.resultForm.contentList,totalPerformance:e},status:"数据统计中"}});case 6:return t.next=8,Object(l.d)("taskClaim",{query:{_id:this.currentClaim._id},update:{$push:{progressSteps:{step:"提交执行结果",status:"数据统计中",updateTime:new Date,updatedBy:this.$store.getters.id,remark:"提交了".concat(this.resultForm.contentList.length,"个内容的执行结果")}}}});case 8:return t.next=10,Object(l.a)("messageLog",{title:"任务结果提交通知",content:"任务【".concat(this.taskInfo.title,"】的执行结果已提交，请查看"),type:"TASK_RESULT_SUBMITTED",taskId:this.currentClaim.taskId,taskClaimId:this.currentClaim._id,sender:{userId:this.$store.state.user.id,role:"TRACKER"},receivers:[{userId:this.currentClaim.agentId._id,role:"AGENT",isRead:!1},{userId:this.taskInfo.createBy,role:"ADMIN",isRead:!1}],isSystem:!1});case 10:this.$message.success("执行结果提交成功"),this.dialogVisible=!1,this.$emit("submit-success"),t.next=19;break;case 15:t.prev=15,t.t0=t.catch(0),this.$message.error("提交执行结果失败");case 19:case"end":return t.stop()}}),t,this,[[0,15]])})));return function(){return t.apply(this,arguments)}}()}},c=o,u=(a("b695"),a("2877")),m=Object(u.a)(c,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-dialog",{attrs:{title:"提交执行结果",visible:t.dialogVisible,width:"70%","custom-class":"result-dialog","append-to-body":""},on:{"update:visible":function(e){t.dialogVisible=e}}},[a("el-form",{ref:"resultForm",attrs:{model:t.resultForm,rules:t.resultRules,"label-width":"100px"}},[a("div",{staticClass:"form-section"},[a("div",{staticClass:"section-title"},[a("i",{staticClass:"el-icon-video-camera"}),t._v("\n                内容列表\n            ")]),t._v(" "),a("div",{staticClass:"content-list"},[t._l(t.resultForm.contentList,(function(e,s){return a("div",{key:s,staticClass:"content-item"},[a("div",{staticClass:"content-header"},[a("span",{staticClass:"content-index"},[t._v("内容 #"+t._s(s+1))]),t._v(" "),a("el-button",{attrs:{type:"danger",icon:"el-icon-delete",circle:"",size:"mini"},on:{click:function(e){return t.removeContent(s)}}})],1),t._v(" "),a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:8}},[a("el-form-item",{attrs:{label:"平台",prop:"contentList."+s+".platform",rules:{required:!0,message:"请选择平台",trigger:"change"}}},[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择平台",clearable:""},model:{value:e.platform,callback:function(a){t.$set(e,"platform",a)},expression:"content.platform"}},t._l(t.dict.type.expert_platform,(function(t){return a("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),1)],1)],1),t._v(" "),a("el-col",{attrs:{span:8}},[a("el-form-item",{attrs:{label:"类型",prop:"contentList."+s+".type",rules:{required:!0,message:"请选类型",trigger:"change"}}},[a("el-select",{attrs:{placeholder:"请选择内容形式",clearable:""},model:{value:e.type,callback:function(a){t.$set(e,"type",a)},expression:"content.type"}},t._l(t.dict.type.content_type,(function(t){return a("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),1)],1)],1),t._v(" "),a("el-col",{attrs:{span:8}},[a("el-form-item",{attrs:{label:"发布时间",prop:"contentList."+s+".publishTime",rules:{required:!0,message:"请选择发布时间",trigger:"change"}}},[a("el-date-picker",{staticStyle:{width:"100%"},attrs:{type:"datetime",placeholder:"选择发布时间"},model:{value:e.publishTime,callback:function(a){t.$set(e,"publishTime",a)},expression:"content.publishTime"}})],1)],1)],1),t._v(" "),a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:8}},[a("el-form-item",{attrs:{label:"内容链接",prop:"contentList."+s+".link",rules:{required:!0,message:"请输入内容链接",trigger:"blur"}}},[a("el-input",{attrs:{placeholder:"请输入内容链接"},model:{value:e.link,callback:function(a){t.$set(e,"link",a)},expression:"content.link"}})],1)],1),t._v(" "),a("el-col",{attrs:{span:8}},[a("el-form-item",{attrs:{label:"视频代码",prop:"contentList."+s+".videoCode"}},[a("el-input",{attrs:{placeholder:"请输入视频/直播代码"},model:{value:e.videoCode,callback:function(a){t.$set(e,"videoCode",a)},expression:"content.videoCode"}})],1)],1),t._v(" "),a("el-col",{attrs:{span:8}},[a("el-form-item",{attrs:{label:"广告码",prop:"contentList."+s+".adCode"}},[a("el-input",{attrs:{placeholder:"请输入广告码"},model:{value:e.adCode,callback:function(a){t.$set(e,"adCode",a)},expression:"content.adCode"}})],1)],1)],1),t._v(" "),a("el-form-item",{attrs:{label:"带货产品",prop:"contentList."+s+".products"}},[a("TagInput",{model:{value:e.products,callback:function(a){t.$set(e,"products",a)},expression:"content.products"}})],1),t._v(" "),a("div",{staticClass:"performance-data"},[a("div",{staticClass:"sub-title"},[t._v("效果数据")]),t._v(" "),a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:8}},[a("el-form-item",{attrs:{label:"播放量",prop:"contentList."+s+".performanceData.views"}},[a("el-input-number",{attrs:{min:0,"controls-position":"right"},model:{value:e.performanceData.views,callback:function(a){t.$set(e.performanceData,"views",a)},expression:"content.performanceData.views"}})],1)],1),t._v(" "),a("el-col",{attrs:{span:8}},[a("el-form-item",{attrs:{label:"点赞数",prop:"contentList."+s+".performanceData.likes"}},[a("el-input-number",{attrs:{min:0,"controls-position":"right"},model:{value:e.performanceData.likes,callback:function(a){t.$set(e.performanceData,"likes",a)},expression:"content.performanceData.likes"}})],1)],1),t._v(" "),a("el-col",{attrs:{span:8}},[a("el-form-item",{attrs:{label:"评论数",prop:"contentList."+s+".performanceData.comments"}},[a("el-input-number",{attrs:{min:0,"controls-position":"right"},model:{value:e.performanceData.comments,callback:function(a){t.$set(e.performanceData,"comments",a)},expression:"content.performanceData.comments"}})],1)],1)],1),t._v(" "),a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:8}},[a("el-form-item",{attrs:{label:"点赞数",prop:"contentList."+s+".performanceData.likes"}},[a("el-input-number",{attrs:{min:0,"controls-position":"right"},model:{value:e.performanceData.likes,callback:function(a){t.$set(e.performanceData,"likes",a)},expression:"content.performanceData.likes"}})],1)],1),t._v(" "),a("el-col",{attrs:{span:8}},[a("el-form-item",{attrs:{label:"评论数",prop:"contentList."+s+".performanceData.comments"}},[a("el-input-number",{attrs:{min:0,"controls-position":"right"},model:{value:e.performanceData.comments,callback:function(a){t.$set(e.performanceData,"comments",a)},expression:"content.performanceData.comments"}})],1)],1),t._v(" "),a("el-col",{attrs:{span:8}},[a("el-form-item",{attrs:{label:"分享数",prop:"contentList."+s+".performanceData.shares"}},[a("el-input-number",{attrs:{min:0,"controls-position":"right"},model:{value:e.performanceData.shares,callback:function(a){t.$set(e.performanceData,"shares",a)},expression:"content.performanceData.shares"}})],1)],1)],1),t._v(" "),a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:8}},[a("el-form-item",{attrs:{label:"直播GMV",prop:"contentList."+s+".performanceData.liveGmv"}},[a("el-input-number",{attrs:{min:0,precision:2,"controls-position":"right"},model:{value:e.performanceData.liveGmv,callback:function(a){t.$set(e.performanceData,"liveGmv",a)},expression:"content.performanceData.liveGmv"}})],1)],1),t._v(" "),a("el-col",{attrs:{span:8}},[a("el-form-item",{attrs:{label:"视频GMV",prop:"contentList."+s+".performanceData.videoGmv"}},[a("el-input-number",{attrs:{min:0,precision:2,"controls-position":"right"},model:{value:e.performanceData.videoGmv,callback:function(a){t.$set(e.performanceData,"videoGmv",a)},expression:"content.performanceData.videoGmv"}})],1)],1)],1)],1)],1)})),t._v(" "),a("div",{staticClass:"add-content-btn"},[a("el-button",{attrs:{type:"primary",plain:"",icon:"el-icon-plus"},on:{click:t.addContent}},[t._v("\n                        添加内容\n                    ")])],1)],2)]),t._v(" "),a("div",{staticClass:"form-section"},[a("div",{staticClass:"section-title"},[a("i",{staticClass:"el-icon-data-analysis"}),t._v("\n                合计效果数据\n            ")]),t._v(" "),a("div",{staticClass:"total-performance"},[a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:8}},[a("div",{staticClass:"data-card"},[a("div",{staticClass:"data-icon"},[a("i",{staticClass:"el-icon-video-play"})]),t._v(" "),a("div",{staticClass:"data-content"},[a("div",{staticClass:"data-label"},[t._v("总播放量")]),t._v(" "),a("div",{staticClass:"data-value"},[t._v(t._s(t.formatNumber(t.getTotalViews)))])])])]),t._v(" "),a("el-col",{attrs:{span:8}},[a("div",{staticClass:"data-card"},[a("div",{staticClass:"data-icon"},[a("i",{staticClass:"el-icon-star-on"})]),t._v(" "),a("div",{staticClass:"data-content"},[a("div",{staticClass:"data-label"},[t._v("总点赞数")]),t._v(" "),a("div",{staticClass:"data-value"},[t._v(t._s(t.formatNumber(t.getTotalLikes)))])])])]),t._v(" "),a("el-col",{attrs:{span:8}},[a("div",{staticClass:"data-card"},[a("div",{staticClass:"data-icon"},[a("i",{staticClass:"el-icon-chat-dot-round"})]),t._v(" "),a("div",{staticClass:"data-content"},[a("div",{staticClass:"data-label"},[t._v("总评论数")]),t._v(" "),a("div",{staticClass:"data-value"},[t._v(t._s(t.formatNumber(t.getTotalComments)))])])])])],1),t._v(" "),a("el-row",{staticStyle:{"margin-top":"20px"},attrs:{gutter:20}},[a("el-col",{attrs:{span:8}},[a("div",{staticClass:"data-card"},[a("div",{staticClass:"data-icon"},[a("i",{staticClass:"el-icon-share"})]),t._v(" "),a("div",{staticClass:"data-content"},[a("div",{staticClass:"data-label"},[t._v("总分享数")]),t._v(" "),a("div",{staticClass:"data-value"},[t._v(t._s(t.formatNumber(t.getTotalShares)))])])])]),t._v(" "),a("el-col",{attrs:{span:8}},[a("div",{staticClass:"data-card"},[a("div",{staticClass:"data-icon"},[a("i",{staticClass:"el-icon-money"})]),t._v(" "),a("div",{staticClass:"data-content"},[a("div",{staticClass:"data-label"},[t._v("视频GMV")]),t._v(" "),a("div",{staticClass:"data-value"},[t._v("¥"+t._s(t.formatNumber(t.getTotalVideoGmv)))])])])]),t._v(" "),a("el-col",{attrs:{span:8}},[a("div",{staticClass:"data-card"},[a("div",{staticClass:"data-icon"},[a("i",{staticClass:"el-icon-money"})]),t._v(" "),a("div",{staticClass:"data-content"},[a("div",{staticClass:"data-label"},[t._v("直播GMV")]),t._v(" "),a("div",{staticClass:"data-value"},[t._v("¥"+t._s(t.formatNumber(t.getTotalLiveGmv)))])])])])],1)],1)])]),t._v(" "),a("div",{attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:t.handleCancel}},[t._v("取 消")]),t._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:t.handleSubmit}},[t._v("确 定")])],1)],1)}),[],!1,null,"7228cc5a",null);e.default=m.exports},7059:function(t,e,a){},"7ae7":function(t,e,a){"use strict";a.r(e);var s=(a("ac6a"),a("5df3"),a("b85c")),r=a("2909"),i=(a("6b54"),a("a481"),a("7f7f"),a("5530")),n=(a("6762"),a("2fdb"),a("c7eb")),l=(a("96cf"),a("1da1")),o=a("7e1e"),c=a("c466"),u=a("3e48"),m=a("6c29b"),d=a("cf83"),p=a("90b6"),v={dicts:["broker_task_progress","tracker_task_progress","task_progress"],name:"TaskClaim",components:{TaskClaimDetails:u.default,TaskResultDialog:m.default,TaskProgressDialog:d.default,ExpertDatabase:p.default},props:{taskId:{type:String,required:!0}},data:function(){return{currentUserId:"",isAdmin:!1,isAgent:!1,isTracker:!1,taskInfo:{},claimList:[],expertOptions:[],claimDialogVisible:!1,claimForm:{expertId:"",trackerId:"",remark:""},claimRules:{expertId:[{required:!0,message:"请选择达人",trigger:"change"}],trackerId:[{required:!0,message:"请选择任务跟踪员",trigger:"change"}]},showProgressHistory:!1,showResultDialog:!1,progressDialogVisible:!1,progressForm:{status:"",trackerId:"",step:"",remark:"",trackingInfo:{buildConnectionSource:"",cooperationDate:null,receiveTime:null,estimatedPublishTime:null,actualPublishTime:null,adCode:""}},progressRules:{status:[{required:!0,message:"请选择进度状态",trigger:"change"}]},resultDialogVisible:!1,currentClaim:null,detailsDialogVisible:!1,currentClaimDetails:{},trackerOptions:[],statusList:[],taskConfig:{requireClaimAudit:!1},batchClaimDialogVisible:!1,batchClaimForm:{experts:[],remark:""},batchClaimRules:{experts:[{required:!0,message:"请选择至少一个达人",trigger:"change"}]}}},created:function(){this.getCurrentUser(),this.fetchData(),this.loadTrackerOptions()},methods:{checkAgentPermission:function(t){return!t.progressSteps.some((function(t){return"合作成功"===t.status}))},checkTrackerPermission:function(t){return t.progressSteps.some((function(t){return"合作成功"===t.status}))},deleteClaim:function(){var t=Object(l.a)(Object(n.a)().mark((function t(e){return Object(n.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(o.d)("taskClaim",{query:{_id:e._id},update:{isDeleted:!0}});case 2:this.fetchData();case 3:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}(),getCurrentUser:function(){var t=Object(l.a)(Object(n.a)().mark((function t(){return Object(n.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:try{this.isAdmin=this.$store.getters.roles.label.includes("Admin"),this.isAgent=this.$store.getters.roles.label.includes("Agent")||this.$store.getters.roles.label.includes("Admin"),this.isTracker=this.$store.getters.roles.label.includes("Tracker")||this.$store.getters.roles.label.includes("Admin"),this.currentUserId=this.$store.getters.id}catch(t){}case 1:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}(),fetchData:function(){var t=Object(l.a)(Object(n.a)().mark((function t(){var e,a,s;return Object(n.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,Object(o.b)("task",{query:{_id:this.taskId}});case 3:return e=t.sent,this.taskInfo=e.data[0],a={taskId:this.taskId,isDeleted:!1},this.isAdmin||(this.isAgent&&(a.agentId=this.$store.state.user.id),this.isTracker&&(a.trackerId=this.$store.state.user.id)),t.next=10,Object(o.b)("taskClaim",{query:a,populate:JSON.stringify([{path:"agentId"},{path:"expertId"},{path:"trackerId"}])});case 10:s=t.sent,this.claimList=s.data.map((function(t){return Object(i.a)(Object(i.a)({},t),{},{agentName:t.agentId.nickName,expertName:t.expertId.nickname,platformId:t.expertId.platformId,trackerName:t.trackerId&&t.trackerId.nickName?t.trackerId.nickName:"未指定"})})),t.next=18;break;case 14:t.prev=14,t.t0=t.catch(0),this.$message.error("获取数据失败");case 18:case"end":return t.stop()}}),t,this,[[0,14]])})));return function(){return t.apply(this,arguments)}}(),loadExpertOptions:function(){var t=Object(l.a)(Object(n.a)().mark((function t(){var e;return Object(n.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,Object(o.b)("expert",{query:{}});case 3:e=t.sent,this.expertOptions=e.data.map((function(t){return{value:t._id,label:"".concat(t.name,"(").concat(t.platformName,")")}})),t.next=11;break;case 7:t.prev=7,t.t0=t.catch(0),this.$message.error("获取达人列表失败");case 11:case"end":return t.stop()}}),t,this,[[0,7]])})));return function(){return t.apply(this,arguments)}}(),loadTrackerOptions:function(){var t=Object(l.a)(Object(n.a)().mark((function t(){var e;return Object(n.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,Object(o.b)("user_login",{query:{role:"6734de3a55647e147063f158"}});case 3:e=t.sent,this.trackerOptions=e.data.map((function(t){return{value:t._id,label:t.nickName||t.username}})),t.next=12;break;case 8:t.prev=8,t.t0=t.catch(0),this.$message.error("获取任务跟踪员列表失败");case 12:case"end":return t.stop()}}),t,this,[[0,8]])})));return function(){return t.apply(this,arguments)}}(),handleClaim:function(){this.loadExpertOptions(),this.claimForm={expertId:"",remark:""},this.claimDialogVisible=!0},submitClaim:function(){var t=Object(l.a)(Object(n.a)().mark((function t(){var e=this;return Object(n.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:try{this.$refs.claimForm.validate(function(){var t=Object(l.a)(Object(n.a)().mark((function t(a){return Object(n.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!a){t.next=6;break}return t.next=3,Object(o.a)("taskClaim",{taskId:e.taskId,agentId:e.currentUserId,expertId:e.claimForm.expertId,claimStatus:e.taskConfig.requireClaimAudit?"待审核":"已通过",remark:e.claimForm.remark});case 3:e.$message.success(e.taskConfig.requireClaimAudit?"认领成功，请等待审核":"认领成功"),e.claimDialogVisible=!1,e.fetchData();case 6:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())}catch(t){this.$message.error("认领失败")}case 1:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}(),handleAudit:function(){var t=Object(l.a)(Object(n.a)().mark((function t(e,a){return Object(n.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,Object(o.d)("taskClaim",{query:{_id:e._id},update:{claimStatus:a,auditTime:new Date,auditRemark:"已拒绝"===a?"不符合要求":"符合要求"}});case 3:this.$message.success("审核完成"),this.fetchData(),t.next=10;break;case 7:t.prev=7,t.t0=t.catch(0),this.$message.error("审核失");case 10:case"end":return t.stop()}}),t,this,[[0,7]])})));return function(e,a){return t.apply(this,arguments)}}(),handleUpdateProgress:function(t){if(this.currentClaim=t,this.progressForm={status:t.status||"",trackerId:t.trackerId||"",step:"",remark:"",trackingInfo:{buildConnectionSource:"",cooperationDate:null,receiveTime:null,estimatedPublishTime:null,actualPublishTime:null,adCode:""}},t.progressSteps&&t.progressSteps.length>0){var e=t.progressSteps[t.progressSteps.length-1];e.trackingInfo&&(this.progressForm.trackingInfo={buildConnectionSource:e.trackingInfo.buildConnectionSource||"",cooperationDate:e.trackingInfo.cooperationDate||null,receiveTime:e.trackingInfo.receiveTime||null,estimatedPublishTime:e.trackingInfo.estimatedPublishTime||null,actualPublishTime:e.trackingInfo.actualPublishTime||null,adCode:e.trackingInfo.adCode||""})}this.progressDialogVisible=!0},handleProgressSubmit:function(){var t=Object(l.a)(Object(n.a)().mark((function t(e){var a;return Object(n.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,a={status:e.status,$push:{progressSteps:{step:e.step,status:e.status,updateTime:new Date,updatedBy:this.$store.state.user.userId,remark:e.remark,trackingInfo:e.trackingInfo}}},"合作成功"!==e.status){t.next=9;break}return a.trackerId=e.trackerId,t.next=9,Object(o.a)("messageLog",{title:"跟踪员指派通知",content:"任务【".concat(this.taskInfo.title,"】已指派跟踪员"),type:"TRACKER_ASSIGNED",taskId:this.currentClaim.taskId,taskClaimId:this.currentClaim._id,sender:{userId:this.$store.state.user.id,role:"AGENT"},receivers:[{userId:e.trackerId,role:"TRACKER",isRead:!1},{userId:this.taskInfo.createBy,role:"ADMIN",isRead:!1}],isSystem:!1});case 9:return t.next=11,Object(o.d)("taskClaim",{query:{_id:this.currentClaim._id},update:a});case 11:return t.next=13,Object(o.a)("messageLog",{title:"任务进度更新",content:"任务【".concat(this.taskInfo.title,"】的进度已更新为：").concat(e.status),type:"TASK_PROGRESS",taskId:this.currentClaim.taskId,taskClaimId:this.currentClaim._id,sender:{userId:this.$store.state.user.id,role:this.isTracker?"TRACKER":"AGENT"},receivers:[{userId:this.currentClaim.agentId&&this.currentClaim.agentId._id,role:"AGENT",isRead:!1},{userId:this.currentClaim.trackerId&&this.currentClaim.trackerId._id,role:"TRACKER",isRead:!1},{userId:this.taskInfo.createBy,role:"ADMIN",isRead:!1}],isSystem:!1});case 13:this.$message.success("进度更新成功"),this.fetchData(),t.next=21;break;case 17:t.prev=17,t.t0=t.catch(0),this.$message.error("进度更新失败");case 21:case"end":return t.stop()}}),t,this,[[0,17]])})));return function(e){return t.apply(this,arguments)}}(),handleSubmitResult:function(t){this.currentClaim=t,this.resultDialogVisible=!0},handleViewDetails:function(t){this.currentClaimDetails=Object(i.a)(Object(i.a)({},t),{},{result:t.result?Object(i.a)(Object(i.a)({},t.result),{},{performanceData:Object(i.a)({views:0,likes:0,comments:0,shares:0,gmv:0},t.result.performanceData||{})}):null}),this.detailsDialogVisible=!0},formatDate:function(t){return t?Object(c.a)(new Date(t),"yyyy-MM-dd HH:mm"):""},getClaimStatusType:function(t){return{"待审核":"warning","已通过":"success","已拒绝":"danger"}[t]||"info"},getProgressStatusType:function(t){return{"未开始":"info","沟通中":"warning","合作成功":"success","寄送样品":"primary","样品跟踪":"primary","已收货":"success","内容制作中":"primary","作品已发布":"success","数据统计中":"warning","已完成":"success","已取消":"danger","合作失败":"danger"}[t]||"info"},getTaskTypeTag:function(t){return{"品牌宣传":"primary","达人推广":"success","达人直播":"warning","达人视":"danger","直播带货":"info"}[t]||"info"},getTaskStatusTag:function(t){return{"进行中":"success","已结束":"info","已取消":"danger","待开始":"warning"}[t]||"info"},formatNumber:function(t){return t||0===t?t.toString().replace(/\B(?=(\d{3})+(?!\d))/g,","):"0"},calculateTotalViews:function(){return this.resultForm&&this.resultForm.contentList?this.resultForm.contentList.reduce((function(t,e){return t+(e&&e.performanceData&&e.performanceData.views||0)}),0):0},calculateTotalLikes:function(){return this.resultForm&&this.resultForm.contentList?this.resultForm.contentList.reduce((function(t,e){return t+(e&&e.performanceData&&e.performanceData.likes||0)}),0):0},calculateTotalComments:function(){return this.resultForm&&this.resultForm.contentList?this.resultForm.contentList.reduce((function(t,e){return t+(e&&e.performanceData&&e.performanceData.comments||0)}),0):0},calculateTotalShares:function(){return this.resultForm&&this.resultForm.contentList?this.resultForm.contentList.reduce((function(t,e){return t+(e&&e.performanceData&&e.performanceData.shares||0)}),0):0},calculateTotalGmv:function(){return this.resultForm&&this.resultForm.contentList?this.resultForm.contentList.reduce((function(t,e){return t+(e&&e.performanceData&&e.performanceData.gmv||0)}),0):0},getTimelineItemType:function(t){return{"未开始":"info","沟通中":"warning","执行中":"primary","已完成":"success","已取消":"danger"}[t]||"info"},getAvailableStatuses:function(){if(this.isAgent)return this.statusList=[].concat(Object(r.a)(this.dict.type.broker_task_progress),[{label:"合作成功",value:"合作成功",type:"success"}]);if(this.isTracker){var t=[{label:"合作成功",value:"合作成功",type:"success"}];return t=[].concat(Object(r.a)(t),Object(r.a)(this.dict.type.tracker_task_progress)),this.statusList=t}return this.statusList},openProgressDialog:function(t){this.currentClaim=t,this.progressDialogVisible=!0},calculateTotalMetric:function(t,e){return t&&Array.isArray(t)?t.reduce((function(t,a){return t+(a.performanceData&&a.performanceData[e]||0)}),0):0},calculateTotalInteractions:function(t){return t&&Array.isArray(t)?t.reduce((function(t,e){var a=e.performanceData||{};return t+(a.likes||0)+(a.comments||0)+(a.shares||0)}),0):0},getContentTimelineType:function(t){return{"短视频":"primary","直播":"success","图文":"warning"}[t.contentType]||"info"},handleBatchClaim:function(){this.batchClaimForm={experts:[],remark:""},this.batchClaimDialogVisible=!0},handleExpertSelectionChange:function(t){this.batchClaimForm.experts=t},checkExpertClaimed:function(){var t=Object(l.a)(Object(n.a)().mark((function t(e){var a;return Object(n.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,Object(o.b)("taskClaim",{query:{taskId:this.taskId,expertId:e,isDeleted:!1}});case 3:return a=t.sent,t.abrupt("return",a.data.length>0);case 7:return t.prev=7,t.t0=t.catch(0),t.abrupt("return",!1);case 11:case"end":return t.stop()}}),t,this,[[0,7]])})));return function(e){return t.apply(this,arguments)}}(),submitBatchClaim:function(){var t=Object(l.a)(Object(n.a)().mark((function t(){var e,a,r,i,l,c;return Object(n.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,this.batchClaimForm.experts.length){t.next=4;break}return this.$message.warning("请选择至少一个达人"),t.abrupt("return");case 4:e=[],a=[],r=Object(s.a)(this.batchClaimForm.experts),t.prev=7,r.s();case 9:if((i=r.n()).done){t.next=17;break}return l=i.value,t.next=13,this.checkExpertClaimed(l._id);case 13:t.sent?e.push(l.name||l.nickname):(c={taskId:this.taskId,agentId:this.currentUserId,expertId:l._id,claimStatus:this.taskConfig.requireClaimAudit?"待审核":"已通过",remark:this.batchClaimForm.remark},a.push(Object(o.a)("taskClaim",c)));case 15:t.next=9;break;case 17:t.next=22;break;case 19:t.prev=19,t.t0=t.catch(7),r.e(t.t0);case 22:return t.prev=22,r.f(),t.finish(22);case 25:if(!(e.length>0)){t.next=29;break}if(this.$message.warning("以下达人已认领过该任务: ".concat(e.join(", "))),0!==a.length){t.next=29;break}return t.abrupt("return");case 29:return t.next=31,Promise.all(a);case 31:this.$message.success(this.taskConfig.requireClaimAudit?"批量认领成功，请等待审核":"批量认领成功"),this.batchClaimDialogVisible=!1,this.fetchData(),t.next=40;break;case 36:t.prev=36,t.t1=t.catch(0),this.$message.error("批量认领失败");case 40:case"end":return t.stop()}}),t,this,[[0,36],[7,19,22,25]])})));return function(){return t.apply(this,arguments)}}(),checkExpertSelectable:function(t){return!this.claimList.some((function(e){return e.expertId._id===t._id}))},getKpiTarget:function(t){return this.taskInfo.cooperationDetails&&this.taskInfo.cooperationDetails.kpiTargets?this.taskInfo.cooperationDetails.kpiTargets[t]:null},getCommercialTerm:function(t){return this.taskInfo.cooperationDetails&&this.taskInfo.cooperationDetails.commercialTerms?this.taskInfo.cooperationDetails.commercialTerms[t]:null}},computed:{showTrackingInfo:function(){return["合作成功","寄送样品","样品跟踪","已收货","内容制作中","作品已发布"].includes(this.progressForm.status)},computedTaskStatus:function(){if(!this.taskInfo.startTime||!this.taskInfo.endTime)return"未知";var t=(new Date).getTime(),e=new Date(this.taskInfo.startTime).getTime(),a=new Date(this.taskInfo.endTime).getTime();return t<e?"待开始":t>=e&&t<=a?"进行中":t>a?"已结束":"已取消"===this.taskInfo.status?"已取消":"未知"},hasKpiTargets:function(){return this.taskInfo.cooperationDetails&&this.taskInfo.cooperationDetails.kpiTargets&&(this.taskInfo.cooperationDetails.kpiTargets.viewsTarget||this.taskInfo.cooperationDetails.kpiTargets.interactionTarget||this.taskInfo.cooperationDetails.kpiTargets.salesTarget)},hasCommercialTerms:function(){return this.taskInfo.cooperationDetails&&this.taskInfo.cooperationDetails.commercialTerms&&this.taskInfo.cooperationDetails.commercialTerms.budget}}},f=v,b=(a("f693"),a("2877")),h=Object(b.a)(f,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"task-claim"},[a("el-card",{staticClass:"task-info"},[a("div",{attrs:{slot:"header"},slot:"header"},[a("span",[t._v("任务信息")])]),t._v(" "),a("div",{staticClass:"info-section"},[a("div",{staticClass:"info-row"},[t.taskInfo.title?a("div",{staticClass:"info-item"},[a("span",{staticClass:"label"},[t._v("任务标题：")]),t._v(" "),a("span",{staticClass:"content"},[t._v(t._s(t.taskInfo.title))])]):t._e(),t._v(" "),t.taskInfo.type?a("div",{staticClass:"info-item"},[a("span",{staticClass:"label"},[t._v("任务类型：")]),t._v(" "),a("el-tag",{attrs:{type:t.getTaskTypeTag(t.taskInfo.type)}},[t._v(t._s(t.taskInfo.type))])],1):t._e(),t._v(" "),t.computedTaskStatus?a("div",{staticClass:"info-item"},[a("span",{staticClass:"label"},[t._v("任务状态：")]),t._v(" "),a("el-tag",{attrs:{type:t.getTaskStatusTag(t.computedTaskStatus)}},[t._v(t._s(t.computedTaskStatus))])],1):t._e()]),t._v(" "),a("div",{staticClass:"info-row"},[t.taskInfo.startTime?a("div",{staticClass:"info-item"},[a("span",{staticClass:"label"},[t._v("开始时间：")]),t._v(" "),a("span",{staticClass:"content"},[t._v(t._s(t.formatDate(t.taskInfo.startTime)))])]):t._e(),t._v(" "),t.taskInfo.endTime?a("div",{staticClass:"info-item"},[a("span",{staticClass:"label"},[t._v("结束时间：")]),t._v(" "),a("span",{staticClass:"content"},[t._v(t._s(t.formatDate(t.taskInfo.endTime)))])]):t._e(),t._v(" "),t.taskInfo.createTime?a("div",{staticClass:"info-item"},[a("span",{staticClass:"label"},[t._v("发布时间：")]),t._v(" "),a("span",{staticClass:"content"},[t._v(t._s(t.formatDate(t.taskInfo.createTime)))])]):t._e()])]),t._v(" "),t.taskInfo.cooperationDetails&&(t.taskInfo.cooperationDetails.brandName||t.taskInfo.cooperationDetails.productName)?a("div",{staticClass:"section-title"},[t._v("\n            品牌合作信息")]):t._e(),t._v(" "),t.taskInfo.cooperationDetails&&(t.taskInfo.cooperationDetails.brandName||t.taskInfo.cooperationDetails.productName)?a("div",{staticClass:"info-section"},[a("div",{staticClass:"info-row"},[t.taskInfo.cooperationDetails&&t.taskInfo.cooperationDetails.brandName?a("div",{staticClass:"info-item"},[a("span",{staticClass:"label"},[t._v("品牌名称：")]),t._v(" "),a("span",{staticClass:"content"},[t._v(t._s(t.taskInfo.cooperationDetails.brandName))])]):t._e(),t._v(" "),t.taskInfo.cooperationDetails&&t.taskInfo.cooperationDetails.productName?a("div",{staticClass:"info-item"},[a("span",{staticClass:"label"},[t._v("产品名称：")]),t._v(" "),a("span",{staticClass:"content"},[t._v(t._s(t.taskInfo.cooperationDetails.productName))])]):t._e()])]):t._e(),t._v(" "),a("div",{staticClass:"section-title"},[t._v("合作要求")]),t._v(" "),a("div",{staticClass:"info-section"},[a("div",{staticClass:"info-row"},[a("div",{staticClass:"info-item"},[a("span",{staticClass:"label"},[t._v("合作平台：")]),t._v(" "),t.taskInfo.cooperationDetails&&t.taskInfo.cooperationDetails.requirements&&t.taskInfo.cooperationDetails.requirements.platformType?t._l(t.taskInfo.cooperationDetails.requirements.platformType,(function(e){return a("el-tag",{key:e,staticStyle:{"margin-right":"5px"}},[t._v("\n                            "+t._s(e)+"\n                        ")])})):t._e()],2),t._v(" "),a("div",{staticClass:"info-item"},[a("span",{staticClass:"label"},[t._v("内容形式：")]),t._v(" "),t.taskInfo.cooperationDetails&&t.taskInfo.cooperationDetails.requirements&&t.taskInfo.cooperationDetails.requirements.contentType?t._l(t.taskInfo.cooperationDetails.requirements.contentType,(function(e){return a("el-tag",{key:e,staticStyle:{"margin-right":"5px"},attrs:{type:"success"}},[t._v("\n                            "+t._s(e)+"\n                        ")])})):t._e()],2)]),t._v(" "),a("div",{staticClass:"info-row"},[a("div",{staticClass:"info-item full-width"},[a("span",{staticClass:"label"},[t._v("达人要求：")]),t._v(" "),t.taskInfo.cooperationDetails&&t.taskInfo.cooperationDetails.requirements&&t.taskInfo.cooperationDetails.requirements.expertRequirements?a("div",{staticClass:"requirement-list"},[t.taskInfo.cooperationDetails.requirements.expertRequirements.fansCountMin?a("div",{staticClass:"requirement-item"},[a("i",{staticClass:"el-icon-user"}),t._v(" 粉丝数："+t._s(t.formatNumber(t.taskInfo.cooperationDetails.requirements.expertRequirements.fansCountMin))+" - "+t._s(t.formatNumber(t.taskInfo.cooperationDetails.requirements.expertRequirements.fansCountMax))+"\n                        ")]):t._e(),t._v(" "),t.taskInfo.cooperationDetails.requirements.expertRequirements.expertCategory&&t.taskInfo.cooperationDetails.requirements.expertRequirements.expertCategory.length?a("div",{staticClass:"requirement-item"},[a("i",{staticClass:"el-icon-collection-tag"}),t._v(" 达人类目：\n                            "),t._l(t.taskInfo.cooperationDetails.requirements.expertRequirements.expertCategory,(function(e){return a("el-tag",{key:e,staticStyle:{"margin-right":"5px"},attrs:{size:"small",type:"warning"}},[t._v("\n                                "+t._s(e)+"\n                            ")])}))],2):t._e(),t._v(" "),t.taskInfo.cooperationDetails.requirements.expertRequirements.otherRequirements?a("div",{staticClass:"requirement-item"},[a("i",{staticClass:"el-icon-info"}),t._v(" 其他要求："+t._s(t.taskInfo.cooperationDetails.requirements.expertRequirements.otherRequirements)+"\n                        ")]):t._e()]):t._e()])])]),t._v(" "),a("div",{staticClass:"section-title"},[t._v("任务描述")]),t._v(" "),a("div",{staticClass:"task-description"},[t._v("\n            "+t._s(t.taskInfo.description||"暂无描述")+"\n        ")]),t._v(" "),t.hasKpiTargets?a("div",{staticClass:"section-title"},[t._v("KPI目标")]):t._e(),t._v(" "),t.hasKpiTargets?a("div",{staticClass:"info-section"},[a("div",{staticClass:"info-row"},[t.getKpiTarget("viewsTarget")?a("div",{staticClass:"info-item"},[a("span",{staticClass:"label"},[t._v("播放量目标：")]),t._v(" "),a("span",{staticClass:"content"},[t._v(t._s(t.formatNumber(t.getKpiTarget("viewsTarget"))))])]):t._e(),t._v(" "),t.getKpiTarget("interactionTarget")?a("div",{staticClass:"info-item"},[a("span",{staticClass:"label"},[t._v("互动量目标：")]),t._v(" "),a("span",{staticClass:"content"},[t._v(t._s(t.formatNumber(t.getKpiTarget("interactionTarget"))))])]):t._e(),t._v(" "),t.getKpiTarget("salesTarget")?a("div",{staticClass:"info-item"},[a("span",{staticClass:"label"},[t._v("销售目标：")]),t._v(" "),a("span",{staticClass:"content"},[t._v(t._s(t.formatNumber(t.getKpiTarget("salesTarget"))))])]):t._e()])]):t._e(),t._v(" "),t.hasCommercialTerms?a("div",{staticClass:"section-title"},[t._v("商务条款")]):t._e(),t._v(" "),t.hasCommercialTerms?a("div",{staticClass:"info-section"},[a("div",{staticClass:"info-row"},[t.getCommercialTerm("budget")?a("div",{staticClass:"info-item"},[a("span",{staticClass:"label"},[t._v("达人预算：")]),t._v(" "),a("span",{staticClass:"content"},[t._v(t._s(t.getCommercialTerm("budget"))+"元")])]):t._e()])]):t._e(),t._v(" "),a("div",{staticClass:"section-title"},[t._v("备注信息")]),t._v(" "),a("div",{staticClass:"info-section"},[t.taskInfo.cooperationDetails&&t.taskInfo.cooperationDetails.remarks&&t.taskInfo.cooperationDetails.remarks.length?a("div",{staticClass:"remarks-list"},[a("el-table",{attrs:{data:t.taskInfo.cooperationDetails.remarks,border:"",size:"small"}},[a("el-table-column",{attrs:{label:"备注名称",prop:"name"}}),t._v(" "),a("el-table-column",{attrs:{label:"备注类型",prop:"type"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-tag",{attrs:{size:"small"}},[t._v(t._s(e.row.type))])]}}],null,!1,3884746098)}),t._v(" "),a("el-table-column",{attrs:{label:"备注链接","min-width":"200"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-link",{attrs:{type:"primary",href:e.row.url,target:"_blank"}},[t._v(t._s(e.row.url))])]}}],null,!1,3178991531)}),t._v(" "),a("el-table-column",{attrs:{label:"上传时间",width:"160"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n                            "+t._s(t.formatDate(e.row.uploadTime))+"\n                        ")]}}],null,!1,1630876477)})],1)],1):a("div",{staticClass:"empty-remarks"},[t._v("\n                暂无备注信息\n            ")])])]),t._v(" "),a("el-card",{staticClass:"claim-list"},[a("div",{attrs:{slot:"header"},slot:"header"},[a("span",[t._v("任务认领列表")]),t._v(" "),a("el-button",{staticStyle:{float:"right","margin-left":"10px"},attrs:{type:"warning",size:"small"},on:{click:function(e){t.showProgressHistory=!t.showProgressHistory}}},[t._v("\n                "+t._s(t.showProgressHistory?"隐藏任务进度历史":"展开任务进度历史")+"\n            ")]),t._v(" "),a("el-button",{staticStyle:{float:"right","margin-left":"10px"},attrs:{type:"warning",size:"small"},on:{click:function(e){t.showResultDialog=!t.showResultDialog}}},[t._v("\n                "+t._s(t.showResultDialog?"隐藏执行结果列表":"展开执行结果列表")+"\n            ")]),t._v(" "),t.isAgent?a("el-button",{staticStyle:{float:"right","margin-left":"10px"},attrs:{type:"success",size:"small"},on:{click:t.handleBatchClaim}},[t._v("\n                认领任务\n            ")]):t._e()],1),t._v(" "),a("el-table",{staticStyle:{width:"100%"},attrs:{data:t.claimList,border:""}},[a("el-table-column",{attrs:{label:"经纪人",prop:"agentName",width:"120"}}),t._v(" "),a("el-table-column",{attrs:{label:"关联达人",prop:"expertName",width:"120"}}),t._v(" "),a("el-table-column",{attrs:{label:"达人账号ID",prop:"platformId",width:"120"}}),t._v(" "),a("el-table-column",{attrs:{label:"任务跟踪员",prop:"trackerName",width:"120"}}),t._v(" "),t.isAdmin&&t.taskConfig.requireClaimAudit?a("el-table-column",{attrs:{label:"认领状态",width:"100"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-tag",{attrs:{type:t.getClaimStatusType(e.row.claimStatus)}},[t._v(t._s(e.row.claimStatus))])]}}],null,!1,609898553)}):t._e(),t._v(" "),a("el-table-column",{attrs:{label:"认领时间",width:"160"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n                    "+t._s(t.formatDate(e.row.claimTime))+"\n                ")]}}])}),t._v(" "),a("el-table-column",{attrs:{label:"当前任务进度",width:"120"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-tag",{attrs:{type:t.getProgressStatusType(e.row.status)}},[t._v(t._s(e.row.status))])]}}])}),t._v(" "),t.showProgressHistory?a("el-table-column",{attrs:{label:"进度历史",width:"300"},scopedSlots:t._u([{key:"default",fn:function(e){return[e.row.progressSteps&&e.row.progressSteps.length?a("el-timeline",t._l(e.row.progressSteps,(function(e,s){return a("el-timeline-item",{key:s,attrs:{type:t.getProgressStatusType(e.status),size:"small",timestamp:t.formatDate(e.updateTime)}},[a("div",{staticClass:"progress-item"},[a("div",{staticClass:"progress-header"},[a("el-tag",{attrs:{size:"mini",type:t.getProgressStatusType(e.status)}},[t._v("\n                                        "+t._s(e.status)+"\n                                    ")]),t._v(" "),a("span",{staticClass:"progress-step"},[t._v(t._s(e.step))])],1),t._v(" "),e.remark?a("div",{staticClass:"progress-remark"},[t._v("\n                                    "+t._s(e.remark)+"\n                                ")]):t._e()])])})),1):a("span",[t._v("暂无进度")])]}}],null,!1,4116868277)}):t._e(),t._v(" "),a("el-table-column",{attrs:{label:"执行结果",width:"600"},scopedSlots:t._u([{key:"default",fn:function(e){return[e.row.result&&e.row.result.contentList&&e.row.result.contentList.length?[a("div",{staticClass:"result-summary",staticStyle:{width:"150px"}},[a("div",{staticClass:"result-data-item"},[a("span",{staticClass:"label"},[t._v("总播放量：")]),t._v(" "),a("span",{staticClass:"value"},[t._v(t._s(t.formatNumber(t.calculateTotalMetric(e.row.result.contentList,"views"))))])]),t._v(" "),a("div",{staticClass:"result-data-item"},[a("span",{staticClass:"label"},[t._v("总互动量：")]),t._v(" "),a("span",{staticClass:"value"},[t._v(t._s(t.formatNumber(t.calculateTotalInteractions(e.row.result.contentList))))])]),t._v(" "),a("div",{staticClass:"result-data-item"},[a("span",{staticClass:"label"},[t._v("总视频销售额：")]),t._v(" "),a("span",{staticClass:"value highlight"},[t._v("¥"+t._s(t.formatNumber(t.calculateTotalMetric(e.row.result.contentList,"videoGmv"))))])]),t._v(" "),a("div",{staticClass:"result-data-item"},[a("span",{staticClass:"label"},[t._v("总直播销售额：")]),t._v(" "),a("span",{staticClass:"value highlight"},[t._v("¥"+t._s(t.formatNumber(t.calculateTotalMetric(e.row.result.contentList,"liveGmv"))))])])]),t._v(" "),t.showResultDialog?a("el-table",{staticClass:"content-table",attrs:{data:e.row.result.contentList,size:"mini",border:""}},[a("el-table-column",{attrs:{label:"发布平台",width:"90"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-tag",{attrs:{size:"mini",type:"primary"}},[t._v(t._s(e.row.platform))])]}}],null,!0)}),t._v(" "),a("el-table-column",{attrs:{label:"内容类型",width:"90"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-tag",{staticStyle:{"margin-top":"4px"},attrs:{size:"mini",type:"success"}},[t._v(t._s(e.row.type))])]}}],null,!0)}),t._v(" "),a("el-table-column",{attrs:{label:"视频链接",width:"90"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-link",{attrs:{type:"primary",href:e.row.link,target:"_blank"}},[t._v(t._s(e.row.link))])]}}],null,!0)}),t._v(" "),a("el-table-column",{attrs:{label:"广告码",width:"90"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n                                    "+t._s(e.row.adCode)+"\n                                ")]}}],null,!0)}),t._v(" "),a("el-table-column",{attrs:{label:"发布时间",width:"90"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("span",{staticClass:"publish-time"},[t._v(t._s(t.formatDate(e.row.publishTime)))])]}}],null,!0)}),t._v(" "),a("el-table-column",{attrs:{label:"数据表现"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("div",{staticClass:"metrics-container"},[a("div",{staticClass:"metric-item"},[a("i",{staticClass:"el-icon-video-play"}),t._v(" "),a("span",{staticClass:"metric-value"},[t._v(t._s(t.formatNumber(e.row.performanceData.views)))])]),t._v(" "),a("div",{staticClass:"metric-item"},[a("i",{staticClass:"el-icon-star-on"}),t._v(" "),a("span",{staticClass:"metric-value"},[t._v(t._s(t.formatNumber(e.row.performanceData.likes)))])]),t._v(" "),a("div",{staticClass:"metric-item"},[a("i",{staticClass:"el-icon-chat-dot-round"}),t._v(" "),a("span",{staticClass:"metric-value"},[t._v(t._s(t.formatNumber(e.row.performanceData.comments)))])]),t._v(" "),a("div",{staticClass:"metric-item"},[a("i",{staticClass:"el-icon-share"}),t._v(" "),a("span",{staticClass:"metric-value"},[t._v(t._s(t.formatNumber(e.row.performanceData.shares)))])]),t._v(" "),a("div",{staticClass:"metric-item highlight"},[t._v("\n                                            视频GMV：¥"+t._s(t.formatNumber(e.row.performanceData.videoGmv))+"\n                                        ")]),t._v(" "),a("div",{staticClass:"metric-item highlight"},[t._v("\n                                            直播GMV：¥"+t._s(t.formatNumber(e.row.performanceData.liveGmv))+"\n                                        ")])])]}}],null,!0)})],1):t._e()]:a("span",{staticClass:"no-result"},[t._v("暂无执行结果")])]}}])}),t._v(" "),a("el-table-column",{attrs:{label:"操作",width:t.isAdmin&&t.taskConfig.requireClaimAudit||t.isTracker?300:200,fixed:"right"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-button",{attrs:{size:"mini",type:"info"},on:{click:function(a){return t.handleViewDetails(e.row)}}},[t._v("\n                        查看详情\n                    ")]),t._v(" "),t.isAdmin&&t.taskConfig.requireClaimAudit?["待审核"===e.row.claimStatus?a("el-button",{attrs:{size:"mini",type:"success"},on:{click:function(a){return t.handleAudit(e.row,"已通过")}}},[t._v("\n                            通过\n                        ")]):t._e(),t._v(" "),"待审核"===e.row.claimStatus?a("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(a){return t.handleAudit(e.row,"已拒绝")}}},[t._v("\n                            拒绝\n                        ")]):t._e()]:t._e(),t._v(" "),t.isAdmin?[a("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(a){return t.deleteClaim(e.row)}}},[t._v("\n                            删除\n                        ")])]:t._e(),t._v(" "),t.isAgent&&e.row.agentId._id===t.currentUserId&&t.checkAgentPermission(e.row)?["已通过"===e.row.claimStatus?a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(a){return t.handleUpdateProgress(e.row)}}},[t._v("\n                            更新进度\n                        ")]):t._e()]:t._e(),t._v(" "),e.row.trackerId&&e.row.trackerId._id===t.currentUserId&&t.checkTrackerPermission(e.row)?["已通过"===e.row.claimStatus?a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(a){return t.handleUpdateProgress(e.row)}}},[t._v("\n                            更新进度\n                        ")]):t._e(),t._v(" "),a("el-button",{attrs:{size:"mini",type:"success"},on:{click:function(a){return t.handleSubmitResult(e.row)}}},[t._v("\n                            提交结果\n                        ")])]:t._e()]}}])})],1)],1),t._v(" "),a("el-dialog",{attrs:{title:"认领任务",visible:t.claimDialogVisible,"append-to-body":"",width:"50%"},on:{"update:visible":function(e){t.claimDialogVisible=e}}},[a("el-form",{ref:"claimForm",attrs:{model:t.claimForm,rules:t.claimRules,"label-width":"100px"}},[a("el-form-item",{attrs:{label:"选择达人",prop:"expertId"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{filterable:"",placeholder:"请选择达人"},model:{value:t.claimForm.expertId,callback:function(e){t.$set(t.claimForm,"expertId",e)},expression:"claimForm.expertId"}},t._l(t.expertOptions,(function(t){return a("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),1)],1),t._v(" "),a("el-form-item",{attrs:{label:"认领说明"}},[a("el-input",{attrs:{type:"textarea",rows:"3"},model:{value:t.claimForm.remark,callback:function(e){t.$set(t.claimForm,"remark",e)},expression:"claimForm.remark"}})],1)],1),t._v(" "),a("div",{attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(e){t.claimDialogVisible=!1}}},[t._v("取 消")]),t._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:t.submitClaim}},[t._v("确 定")])],1)],1),t._v(" "),a("task-progress-dialog",{attrs:{visible:t.progressDialogVisible,"current-claim":t.currentClaim,"status-list":t.getAvailableStatuses()},on:{"update:visible":function(e){t.progressDialogVisible=e},submit:t.handleProgressSubmit}}),t._v(" "),a("task-result-dialog",{attrs:{visible:t.resultDialogVisible,"current-claim":t.currentClaim,"task-info":t.taskInfo},on:{"update:visible":function(e){t.resultDialogVisible=e},"submit-success":t.fetchData}}),t._v(" "),a("task-claim-details",{attrs:{visible:t.detailsDialogVisible,details:t.currentClaimDetails},on:{"update:visible":function(e){t.detailsDialogVisible=e}}}),t._v(" "),a("el-dialog",{attrs:{title:"批量认领任务",visible:t.batchClaimDialogVisible,"append-to-body":"",width:"90%"},on:{"update:visible":function(e){t.batchClaimDialogVisible=e}}},[a("el-form",{ref:"batchClaimForm",attrs:{model:t.batchClaimForm,rules:t.batchClaimRules,"label-width":"100px"}},[a("expert-database",{ref:"expertSelector",attrs:{"is-select-mode":!0,multiple:!0,maxSelect:10,"check-selectable":t.checkExpertSelectable},on:{"selection-change":t.handleExpertSelectionChange}}),t._v(" "),a("el-form-item",{staticStyle:{"margin-top":"20px"},attrs:{label:"认领说明"}},[a("el-input",{attrs:{type:"textarea",rows:"3"},model:{value:t.batchClaimForm.remark,callback:function(e){t.$set(t.batchClaimForm,"remark",e)},expression:"batchClaimForm.remark"}})],1)],1),t._v(" "),a("div",{attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(e){t.batchClaimDialogVisible=!1}}},[t._v("取 消")]),t._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:t.submitBatchClaim}},[t._v("确 定")])],1)],1)],1)}),[],!1,null,null,null);e.default=h.exports},"8fe3":function(t,e,a){},a887:function(t,e,a){"use strict";a("e1e8")},b695:function(t,e,a){"use strict";a("8fe3")},b7d7:function(t,e,a){"use strict";a("49e2")},c466:function(t,e,a){"use strict";function s(t){return t?(("string"==typeof t||"number"==typeof t)&&(t=new Date(t)),t.getFullYear()+"-"+(t.getMonth()+1)+"-"+(t.getDate()<10?"0"+t.getDate():t.getDate())+" "+(t.getHours()<10?"0"+t.getHours():t.getHours())+":"+(t.getMinutes()<10?"0"+t.getMinutes():t.getMinutes())+":"+(t.getSeconds()<10?"0"+t.getSeconds():t.getSeconds())):""}function r(t){return t||0===t?t.toString().replace(/\B(?=(\d{3})+(?!\d))/g,","):"0"}a.d(e,"a",(function(){return s})),a.d(e,"b",(function(){return r})),a("6b54"),a("a481")},cf83:function(t,e,a){"use strict";a.r(e);var s=a("c7eb"),r=(a("96cf"),a("1da1")),i=(a("6762"),a("2fdb"),a("ac6a"),a("456d"),a("7e1e")),n={dicts:["tracker_task_progress"],name:"TaskProgressDialog",props:{visible:{type:Boolean,default:!1},currentClaim:{type:Object,default:function(){return{}}},statusList:{type:Array,default:function(){return[]}}},data:function(){return{isAdmin:!1,isAgent:!1,isTracker:!1,currentUserId:"",form:{status:"",trackerId:"",step:"",remark:"",trackingInfo:{buildConnectionSource:"",cooperationDate:null,receiveTime:null,estimatedPublishTime:null}},rules:{status:[{required:!0,message:"请选择进度状态",trigger:"change"}],step:[{message:"请输入进度说明",trigger:"blur"}],"trackingInfo.buildConnectionSource":[{required:!0,message:"请输入建联来源",trigger:"blur"}],"trackingInfo.cooperationDate":[{required:!0,message:"请选择确定合作日",trigger:"change"}],"trackingInfo.receiveTime":[{required:!0,message:"请选择收货时间",trigger:"change"}],"trackingInfo.estimatedPublishTime":[{required:!0,message:"请选择预计发布时间",trigger:"change"}]},trackerOptions:[]}},watch:{visible:{immediate:!0,handler:function(t){t&&(this.initForm(),this.getCurrentUser(),this.loadTrackerOptions())}},currentClaim:{immediate:!0,handler:function(t){t&&Object.keys(t).length>0&&this.initForm()}}},computed:{dialogVisible:{get:function(){return this.visible},set:function(t){this.$emit("update:visible",t)}},showTrackingInfo:function(){return this.dict.type.tracker_task_progress.map((function(t){return t.value})).includes(this.form.status)},availableStatuses:function(){return this.statusList}},methods:{handleClose:function(){this.dialogVisible=!1},getCurrentUser:function(){var t=Object(r.a)(Object(s.a)().mark((function t(){return Object(s.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:try{this.isAdmin=this.$store.getters.roles.label.includes("Admin"),this.isAgent=this.$store.getters.roles.label.includes("Agent")||this.$store.getters.roles.label.includes("Admin"),this.isTracker=this.$store.getters.roles.label.includes("Tracker")||this.$store.getters.roles.label.includes("Admin"),this.currentUserId=this.$store.state.user.id}catch(t){}case 1:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}(),initForm:function(){if(this.currentClaim){var t=this.currentClaim.progressSteps||[],e=(t.length>0?t[t.length-1]:{}).trackingInfo||{};this.form={status:this.currentClaim.status||"",trackerId:this.currentClaim.trackerId||"",step:"",remark:"",trackingInfo:{buildConnectionSource:e.buildConnectionSource||"",cooperationDate:e.cooperationDate||null,receiveTime:e.receiveTime||null,estimatedPublishTime:e.estimatedPublishTime||null}}}},loadTrackerOptions:function(){var t=Object(r.a)(Object(s.a)().mark((function t(){var e;return Object(s.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,Object(i.b)("user_login",{query:{role:"6734de3a55647e147063f158"}});case 3:(e=t.sent).data&&(this.trackerOptions=e.data.map((function(t){return{value:t._id,label:t.nickName||t.username}}))),t.next=11;break;case 7:t.prev=7,t.t0=t.catch(0),this.$message.error("获取任务跟踪员列表失败");case 11:case"end":return t.stop()}}),t,this,[[0,7]])})));return function(){return t.apply(this,arguments)}}(),handleSubmit:function(){var t=Object(r.a)(Object(s.a)().mark((function t(){return Object(s.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,this.$refs.progressForm.validate();case 3:if("合作成功"!==this.form.status){t.next=13;break}if(this.form.trackerId){t.next=7;break}return this.$message.error("请选择任务跟踪员"),t.abrupt("return");case 7:if(this.form.trackingInfo.buildConnectionSource){t.next=10;break}return this.$message.error("请输入建联来源"),t.abrupt("return");case 10:if(this.form.trackingInfo.cooperationDate){t.next=13;break}return this.$message.error("请选择确定合作日"),t.abrupt("return");case 13:if("已签收"!==this.form.status||this.form.trackingInfo.receiveTime){t.next=16;break}return this.$message.error("请选择收货时间"),t.abrupt("return");case 16:if("内容制作中"!==this.form.status||this.form.trackingInfo.estimatedPublishTime){t.next=19;break}return this.$message.error("请选择预计发布时间"),t.abrupt("return");case 19:this.$emit("submit",this.form),this.handleClose(),t.next=26;break;case 23:t.prev=23,t.t0=t.catch(0);case 26:case"end":return t.stop()}}),t,this,[[0,23]])})));return function(){return t.apply(this,arguments)}}()}},l=n,o=a("2877"),c=Object(o.a)(l,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-dialog",{attrs:{title:"更新进度",visible:t.dialogVisible,width:"60%","custom-class":"progress-dialog","append-to-body":""},on:{"update:visible":function(e){t.dialogVisible=e},close:t.handleClose}},[a("el-form",{ref:"progressForm",attrs:{model:t.form,rules:t.rules,"label-width":"120px"}},[a("el-form-item",{attrs:{label:"进度状态",prop:"status"}},[a("el-select",{staticStyle:{width:"100%"},model:{value:t.form.status,callback:function(e){t.$set(t.form,"status",e)},expression:"form.status"}},t._l(t.availableStatuses,(function(t){return a("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),1)],1),t._v(" "),"合作成功"===t.form.status?a("el-form-item",{attrs:{label:"任务跟踪员",prop:"trackerId",rules:{required:!0,message:"请选择任务跟踪员",trigger:"change"}}},[a("el-select",{staticStyle:{width:"100%"},attrs:{filterable:"",placeholder:"请选择任务跟踪员"},model:{value:t.form.trackerId,callback:function(e){t.$set(t.form,"trackerId",e)},expression:"form.trackerId"}},t._l(t.trackerOptions,(function(t){return a("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),1)],1):t._e(),t._v(" "),t.isAgent?[a("div",{staticClass:"tracking-info-section"},[["合作成功"].includes(t.form.status)?a("el-form-item",{attrs:{label:"建联来源",prop:"trackingInfo.buildConnectionSource"}},[a("el-input",{attrs:{placeholder:"请输入建联来源"},model:{value:t.form.trackingInfo.buildConnectionSource,callback:function(e){t.$set(t.form.trackingInfo,"buildConnectionSource",e)},expression:"form.trackingInfo.buildConnectionSource"}})],1):t._e(),t._v(" "),["合作成功"].includes(t.form.status)?a("el-form-item",{attrs:{label:"确定合作日",prop:"trackingInfo.cooperationDate"}},[a("el-date-picker",{staticStyle:{width:"100%"},attrs:{type:"date",placeholder:"选择确定合作日"},model:{value:t.form.trackingInfo.cooperationDate,callback:function(e){t.$set(t.form.trackingInfo,"cooperationDate",e)},expression:"form.trackingInfo.cooperationDate"}})],1):t._e()],1)]:t._e(),t._v(" "),t.isTracker?[a("div",{staticClass:"tracking-info-section"},[["已签收"].includes(t.form.status)?a("el-form-item",{attrs:{label:"收货时间",prop:"trackingInfo.receiveTime"}},[a("el-date-picker",{staticStyle:{width:"100%"},attrs:{type:"datetime",placeholder:"选择收货时间"},model:{value:t.form.trackingInfo.receiveTime,callback:function(e){t.$set(t.form.trackingInfo,"receiveTime",e)},expression:"form.trackingInfo.receiveTime"}})],1):t._e()],1)]:t._e(),t._v(" "),a("el-form-item",{attrs:{label:"进度备注",prop:"step"}},[a("el-input",{attrs:{placeholder:"进度备注"},model:{value:t.form.step,callback:function(e){t.$set(t.form,"step",e)},expression:"form.step"}})],1)],2),t._v(" "),a("div",{attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:t.handleClose}},[t._v("取 消")]),t._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:t.handleSubmit}},[t._v("确 定")])],1)],1)}),[],!1,null,null,null);e.default=c.exports},e1e8:function(t,e,a){},eccf:function(t,e,a){},f693:function(t,e,a){"use strict";a("eccf")},fc88:function(t,e,a){"use strict";a.r(e);var s=a("ade3"),r=a("5530"),i=(a("6b54"),a("a481"),a("3b2b"),a("c7eb")),n=(a("96cf"),a("1da1")),l=(a("6762"),a("2fdb"),a("7e1e")),o=a("c466"),c=a("7ae7"),u=a("1f24"),m={dicts:["expert_platform","task_type","content_type"],name:"TaskHall",components:{TaskClaim:c.default,EditDialog:u.default},data:function(){return{isAdmin:!1,searchForm:{title:"",type:"",brandName:"",platform:"",contentType:"",minBudget:null,maxBudget:null,timeRange:[]},showAdvanced:!1,taskTypeOptions:[{value:"品牌宣传",label:"品牌宣传"},{value:"达人推广",label:"达人推广"},{value:"达人直播",label:"达人直播"},{value:"达人视频",label:"达人视频"},{value:"直播带货",label:"直播带货"}],platformOptions:[{value:"抖音",label:"抖音"},{value:"小红书",label:"小红书"},{value:"B站",label:"B站"},{value:"微博",label:"微博"}],contentTypeOptions:[{value:"短视频",label:"短视频"},{value:"直播",label:"直播"},{value:"图文",label:"图文"}],loading:!1,taskList:[],currentPage:1,pageSize:10,total:0,taskDetailVisible:!1,taskDetailTitle:"",selectedTaskId:null,taskForm:{title:"",type:"",description:"",startTime:"",endTime:"",cooperationDetails:{brandName:"",brandIndustry:"",productName:"",productCategory:"",productDetails:"",requirements:{platformType:[],contentType:[],expertRequirements:{fansCountMin:0,fansCountMax:0,expertCategory:[]}},commercialTerms:{budget:0,commissionRate:0},kpiTargets:{viewsTarget:0,interactionTarget:0,salesTarget:0,expertCount:0,videoCount:0,liveStreamCount:0},remarks:[]}},taskFormVisible:!1,editTaskId:""}},created:function(){this.checkUserRole(),this.fetchData()},computed:{isAdmin:function(){return this.$store.getters.roles.some((function(t){return"Admin"===t.label}))}},methods:Object(s.a)({checkUserRole:function(){this.isAdmin=this.$store.getters.roles.label.includes("Admin")},fetchData:function(){var t=Object(n.a)(Object(i.a)().mark((function t(){var e,a;return Object(i.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.loading=!0,t.prev=1,e=this.buildQuery(),t.next=5,Object(l.b)("task",{query:e,page:this.currentPage,limit:this.pageSize,sort:{createTime:-1}});case 5:a=t.sent,this.taskList=a.data,this.total=a.total,t.next=14;break;case 10:t.prev=10,t.t0=t.catch(1),this.$message.error("获取任务列表失败");case 14:this.loading=!1;case 15:case"end":return t.stop()}}),t,this,[[1,10]])})));return function(){return t.apply(this,arguments)}}(),buildQuery:function(){var t={isDeleted:!1};return this.searchForm.title&&(t.title={$regex:this.searchForm.title,$options:"i"}),this.searchForm.type&&(t.type=this.searchForm.type),this.searchForm.brandName&&(t["cooperationDetails.brandName"]=new RegExp(this.searchForm.brandName,"i")),this.searchForm.platform&&(t["cooperationDetails.requirements.platformType"]=this.searchForm.platform),this.searchForm.contentType&&(t["cooperationDetails.requirements.contentType"]=this.searchForm.contentType),(this.searchForm.minBudget||this.searchForm.maxBudget)&&(t["cooperationDetails.commercialTerms.budget"]={},this.searchForm.minBudget&&(t["cooperationDetails.commercialTerms.budget"].$gte=this.searchForm.minBudget),this.searchForm.maxBudget&&(t["cooperationDetails.commercialTerms.budget"].$lte=this.searchForm.maxBudget)),this.searchForm.timeRange&&2===this.searchForm.timeRange.length&&(t.createTime={$gte:this.searchForm.timeRange[0],$lte:this.searchForm.timeRange[1]}),t},handleSearch:function(){this.currentPage=1,this.fetchData()},resetSearch:function(){this.$refs.searchForm.resetFields(),this.currentPage=1,this.fetchData()},toggleAdvanced:function(){this.showAdvanced=!this.showAdvanced},handleSizeChange:function(t){this.pageSize=t,this.fetchData()},handleCurrentChange:function(t){this.currentPage=t,this.fetchData()},handleViewTask:function(t){this.selectedTaskId=t._id,this.taskDetailTitle=t.title,this.taskDetailVisible=!0,this.taskFormVisible=!1},handleCreate:function(){this.editTaskId="",this.resetTaskForm(),this.taskFormVisible=!0},handleEdit:function(){var t=Object(n.a)(Object(i.a)().mark((function t(e){return Object(i.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:this.editTaskId=e._id,this.taskForm=JSON.parse(JSON.stringify(e)),this.taskFormVisible=!0,this.taskDetailVisible=!1;case 4:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}(),resetTaskForm:function(){this.taskForm={title:"",type:"",description:"",startTime:"",endTime:"",cooperationDetails:{brandName:"",brandIndustry:"",productName:"",productCategory:"",productDetails:"",requirements:{platformType:[],contentType:[],expertRequirements:{fansCountMin:0,fansCountMax:0,expertCategory:[]}},commercialTerms:{budget:0,commissionRate:0},kpiTargets:{viewsTarget:0,interactionTarget:0,salesTarget:0,expertCount:0,videoCount:0,liveStreamCount:0},remarks:[]}}},handleDelete:function(){var t=Object(n.a)(Object(i.a)().mark((function t(e){return Object(i.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,this.$confirm("确认删除该任务?","提示",{type:"warning"});case 3:return t.next=5,Object(l.c)("task",{query:{_id:e._id}});case 5:this.$message.success("删除成功"),this.fetchData(),t.next=12;break;case 9:t.prev=9,t.t0=t.catch(0),"cancel"!==t.t0&&this.$message.error("删除失败");case 12:case"end":return t.stop()}}),t,this,[[0,9]])})));return function(e){return t.apply(this,arguments)}}(),formatDate:function(t){return Object(o.a)(new Date(t),"yyyy-MM-dd HH:mm")},formatNumber:function(t){return t?t.toString().replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1,"):"0"},getTaskTypeTag:function(t){return{"品牌宣传":"primary","达人推广":"success","达人直播":"warning","达人视频":"danger","直播带货":"info"}[t]||"info"},getAgentUsers:function(){var t=Object(n.a)(Object(i.a)().mark((function t(){var e;return Object(i.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,Object(l.b)("user_login",{query:{role:"6734ddfc55647e147063f152"}});case 3:return e=t.sent,t.abrupt("return",e.data||[]);case 8:return t.prev=8,t.t0=t.catch(0),t.abrupt("return",[]);case 12:case"end":return t.stop()}}),t,null,[[0,8]])})));return function(){return t.apply(this,arguments)}}(),createMessageLog:function(){var t=Object(n.a)(Object(i.a)().mark((function t(e){var a,s;return Object(i.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,this.getAgentUsers();case 3:return a=t.sent,s=Object(r.a)(Object(r.a)({},e),{},{receivers:a.map((function(t){return{userId:t._id,role:"AGENT",isRead:!1}}))}),t.next=8,Object(l.a)("messageLog",s);case 8:t.next=13;break;case 10:t.prev=10,t.t0=t.catch(0);case 13:case"end":return t.stop()}}),t,this,[[0,10]])})));return function(e){return t.apply(this,arguments)}}(),handleSubmitTask:function(){var t=Object(n.a)(Object(i.a)().mark((function t(e){var a;return Object(i.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,!this.editTaskId){t.next=12;break}return e.updateBy=this.$store.state.user.id,e.createAt=new Date,e.updateAt=new Date,t.next=7,Object(l.d)("task",{query:{_id:this.editTaskId},update:e});case 7:return this.$message.success("更新任务成功"),t.next=10,this.createMessageLog({title:"任务更新通知",content:"任务【".concat(e.title,"】已更新"),type:"TASK_UPDATED",taskId:this.editTaskId,sender:{userId:this.$store.state.user.id,role:"ADMIN"},isSystem:!0});case 10:t.next=21;break;case 12:return e.createBy=this.$store.state.user.id,e.createAt=new Date,e.updateAt=new Date,t.next=17,Object(l.a)("task",e);case 17:return a=t.sent,this.$message.success("创建任务成功"),t.next=21,this.createMessageLog({title:"新任务发布通知",content:"新任务【".concat(e.title,"】已发布，快来查看吧！"),type:"TASK_PUBLISHED",taskId:a.data._id,sender:{userId:this.$store.state.user.id,role:"ADMIN"},isSystem:!0});case 21:this.taskFormVisible=!1,this.fetchData(),t.next=29;break;case 25:t.prev=25,t.t0=t.catch(0),this.$message.error("保存任务失败");case 29:case"end":return t.stop()}}),t,this,[[0,25]])})));return function(e){return t.apply(this,arguments)}}()},"handleDelete",function(){var t=Object(n.a)(Object(i.a)().mark((function t(e){return Object(i.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,this.$confirm("确认删除该任务?","提示",{type:"warning"});case 3:return t.next=5,Object(l.d)("task",{query:{_id:e._id},update:{isDeleted:!0}});case 5:return t.next=7,this.createMessageLog({title:"任务删除通知",content:"任务【".concat(e.title,"】已被删除"),type:"TASK_DELETED",taskId:e._id,sender:{userId:this.$store.state.user.id,role:"ADMIN"},isSystem:!0});case 7:this.$message.success("删除成功"),this.fetchData(),t.next=14;break;case 11:t.prev=11,t.t0=t.catch(0),"cancel"!==t.t0&&this.$message.error("删除失败");case 14:case"end":return t.stop()}}),t,this,[[0,11]])})));return function(e){return t.apply(this,arguments)}}())},d=m,p=(a("a887"),a("2877")),v=Object(p.a)(d,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"task-hall"},[a("el-card",{staticClass:"filter-container"},[a("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[a("span",[t._v("筛选搜索")]),t._v(" "),a("el-button",{staticStyle:{float:"right",padding:"3px 0"},attrs:{type:"text"},on:{click:t.toggleAdvanced}},[t._v("\n                "+t._s(t.showAdvanced?"收起":"展开")+"高级搜索\n            ")])],1),t._v(" "),a("el-form",{ref:"searchForm",staticClass:"search-form",attrs:{model:t.searchForm}},[a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:6}},[a("el-form-item",{attrs:{label:"任务标题"}},[a("el-input",{attrs:{placeholder:"请输入任务标题",clearable:""},model:{value:t.searchForm.title,callback:function(e){t.$set(t.searchForm,"title",e)},expression:"searchForm.title"}})],1)],1),t._v(" "),a("el-col",{attrs:{span:6}},[a("el-form-item",{attrs:{label:"任务类型"}},[a("el-select",{attrs:{placeholder:"请选择任务类型",clearable:""},model:{value:t.searchForm.type,callback:function(e){t.$set(t.searchForm,"type",e)},expression:"searchForm.type"}},t._l(t.dict.type.task_type,(function(t){return a("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),1)],1)],1),t._v(" "),a("el-col",{attrs:{span:6}},[a("el-form-item",{attrs:{label:"品牌名称"}},[a("el-input",{attrs:{placeholder:"请输入品牌名称",clearable:""},model:{value:t.searchForm.brandName,callback:function(e){t.$set(t.searchForm,"brandName",e)},expression:"searchForm.brandName"}})],1)],1),t._v(" "),a("el-col",{attrs:{span:6}},[a("el-form-item",{attrs:{label:"合作平台"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择平台",clearable:""},model:{value:t.searchForm.platformName,callback:function(e){t.$set(t.searchForm,"platformName",e)},expression:"searchForm.platformName"}},t._l(t.dict.type.expert_platform,(function(t){return a("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),1)],1)],1)],1),t._v(" "),a("el-collapse-transition",[a("div",{directives:[{name:"show",rawName:"v-show",value:t.showAdvanced,expression:"showAdvanced"}]},[a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:6}},[a("el-form-item",{attrs:{label:"内容形式"}},[a("el-select",{attrs:{placeholder:"请选择内容形式",clearable:""},model:{value:t.searchForm.contentType,callback:function(e){t.$set(t.searchForm,"contentType",e)},expression:"searchForm.contentType"}},t._l(t.dict.type.content_type,(function(t){return a("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),1)],1)],1),t._v(" "),a("el-col",{attrs:{span:6}},[a("el-form-item",{attrs:{label:"预算范围"}},[a("el-input-number",{staticStyle:{width:"110px"},attrs:{placeholder:"最小预算"},model:{value:t.searchForm.minBudget,callback:function(e){t.$set(t.searchForm,"minBudget",e)},expression:"searchForm.minBudget"}}),t._v(" "),a("span",{staticStyle:{margin:"0 5px"}},[t._v("-")]),t._v(" "),a("el-input-number",{staticStyle:{width:"110px"},attrs:{placeholder:"最大预算"},model:{value:t.searchForm.maxBudget,callback:function(e){t.$set(t.searchForm,"maxBudget",e)},expression:"searchForm.maxBudget"}})],1)],1),t._v(" "),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"发布时间"}},[a("el-date-picker",{staticStyle:{width:"100%"},attrs:{type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期"},model:{value:t.searchForm.timeRange,callback:function(e){t.$set(t.searchForm,"timeRange",e)},expression:"searchForm.timeRange"}})],1)],1)],1)],1)]),t._v(" "),a("el-row",[a("el-col",{staticStyle:{"text-align":"right"},attrs:{span:24}},[a("el-button",{attrs:{type:"primary"},on:{click:t.handleSearch}},[t._v("查询")]),t._v(" "),a("el-button",{on:{click:t.resetSearch}},[t._v("重置")])],1)],1)],1)],1),t._v(" "),a("el-card",{staticClass:"task-list"},[a("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[a("span",[t._v("任务列表")]),t._v(" "),t.isAdmin?a("el-button",{staticStyle:{float:"right"},attrs:{type:"primary",size:"small"},on:{click:t.handleCreate}},[t._v("\n                发布任务\n            ")]):t._e()],1),t._v(" "),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticStyle:{width:"100%"},attrs:{data:t.taskList,border:""}},[a("el-table-column",{attrs:{label:"任务标题","min-width":"200"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-button",{attrs:{type:"text"},on:{click:function(a){return t.handleViewTask(e.row)}}},[t._v(t._s(e.row.title))])]}}])}),t._v(" "),a("el-table-column",{attrs:{label:"任务类型",prop:"type",width:"120"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-tag",{attrs:{type:t.getTaskTypeTag(e.row.type)}},[t._v(t._s(e.row.type))])]}}])}),t._v(" "),a("el-table-column",{attrs:{label:"品牌信息","min-width":"180"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("div",[t._v("品牌："+t._s(e.row.cooperationDetails.brandName))]),t._v(" "),a("div",[t._v("产品："+t._s(e.row.cooperationDetails.productName))])]}}])}),t._v(" "),a("el-table-column",{attrs:{label:"合作要求","min-width":"200"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("div",t._l(e.row.cooperationDetails.requirements.platformType,(function(e){return a("el-tag",{key:e,staticStyle:{"margin-right":"5px"},attrs:{size:"small"}},[t._v("\n                            "+t._s(e)+"\n                        ")])})),1),t._v(" "),a("div",{staticStyle:{"margin-top":"5px"}},t._l(e.row.cooperationDetails.requirements.contentType,(function(e){return a("el-tag",{key:e,staticStyle:{"margin-right":"5px"},attrs:{type:"success",size:"small"}},[t._v("\n                            "+t._s(e)+"\n                        ")])})),1)]}}])}),t._v(" "),a("el-table-column",{attrs:{label:"预算",width:"120"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n                    ¥"+t._s(t.formatNumber(e.row.cooperationDetails.commercialTerms.budget))+"\n                ")]}}])}),t._v(" "),a("el-table-column",{attrs:{label:"发布时间",width:"160"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n                    "+t._s(t.formatDate(e.row.createTime))+"\n                ")]}}])}),t._v(" "),a("el-table-column",{attrs:{label:"操作",width:"150",fixed:"right"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-button",{attrs:{type:"text",size:"small"},on:{click:function(a){return t.handleViewTask(e.row)}}},[t._v("查看")]),t._v(" "),t.isAdmin?a("el-button",{attrs:{type:"text",size:"small"},on:{click:function(a){return t.handleEdit(e.row)}}},[t._v("编辑")]):t._e(),t._v(" "),t.isAdmin?a("el-button",{staticClass:"delete-btn",attrs:{type:"text",size:"small"},on:{click:function(a){return t.handleDelete(e.row)}}},[t._v("删除")]):t._e()]}}])})],1),t._v(" "),a("div",{staticClass:"pagination-container"},[a("el-pagination",{attrs:{background:"","current-page":t.currentPage,"page-sizes":[10,20,30,50],"page-size":t.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:t.total},on:{"size-change":t.handleSizeChange,"current-change":t.handleCurrentChange}})],1)],1),t._v(" "),a("el-dialog",{staticClass:"task-detail-dialog",attrs:{title:t.taskDetailTitle,visible:t.taskDetailVisible,width:"80%","destroy-on-close":""},on:{"update:visible":function(e){t.taskDetailVisible=e}}},[t.taskDetailVisible?a("task-claim",{key:t.selectedTaskId,attrs:{taskId:t.selectedTaskId}}):t._e()],1),t._v(" "),a("edit-dialog",{attrs:{"dialog-form-visible":t.taskFormVisible,"dialog-status":t.editTaskId?"edit":"create","data-form":t.taskForm},on:{"update:dialogFormVisible":function(e){t.taskFormVisible=e},"update:dialog-form-visible":function(e){t.taskFormVisible=e},submit:t.handleSubmitTask}})],1)}),[],!1,null,"1a12ef4b",null);e.default=v.exports}}]);