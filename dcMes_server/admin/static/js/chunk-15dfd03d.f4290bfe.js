(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-15dfd03d","chunk-f82bca12"],{2212:function(t,e,a){"use strict";a.r(e);var r=(a("f576"),a("6b54"),a("5530")),n=a("c7eb"),o=(a("96cf"),a("1da1")),i=a("7e1e"),s=a("6ace"),l=a("3b8b"),c=a("ed91"),u={name:"EditDialog",dicts:["work_order_status"],components:{ZrSelect:s.a,workDialog:l.a},props:{visible:{type:Boolean,default:!1},dialogStatus:{type:String,default:"create"},rowData:{type:Object,default:function(){return{}}}},data:function(){return{form:{workOrderNo:"",status:"PENDING",saleOrderId:"",saleOrderNo:"",productionOrderId:"",productionOrderNo:"",materialId:"",productModel:"",productName:"",productionLineId:"",lineName:"",businessType:"NORMAL",planQuantity:0,planProductionQuantity:0,inputQuantity:0,outputQuantity:0,planStartTime:"",planEndTime:"",remark:""},rules:{workOrderNo:[{required:!0,message:"请输入工单号",trigger:"blur"}],status:[{required:!0,message:"请选择工单状态",trigger:"change"}],saleOrderId:[{required:!0,message:"请选择销售单号",trigger:"change"}],productionOrderId:[{required:!0,message:"请选择生产单号",trigger:"change"}],materialId:[{required:!0,message:"请选择产品",trigger:"change"}],productionLineId:[{required:!0,message:"请选择产线",trigger:"change"}],businessType:[{required:!0,message:"请选择业务类型",trigger:"change"}],planQuantity:[{required:!0,message:"请输入计划数量",trigger:"blur"}],planProductionQuantity:[{required:!0,message:"请输入计划生产数量",trigger:"blur"}],planStartTime:[{required:!0,message:"请选择计划开始时间",trigger:"change"}],planEndTime:[{required:!0,message:"请选择计划结束时间",trigger:"change"}]},submitLoading:!1,workDialogVisible:!1,workTableData:[]}},computed:{dialogTitle:function(){return"create"===this.dialogStatus?"新增生产计划工单":"编辑生产计划工单"},productionOrderQuery:function(){return this.form.saleOrderNo?{FSaleOrderNo:this.form.saleOrderNo}:{}},materialQuery:function(){return this.form.materialId?{FMaterialId:this.form.materialId}:{}},canStart:function(){return"PENDING"===this.form.status||"PAUSED"===this.form.status}},watch:{visible:function(t){t&&this.initFormData()},rowData:{handler:function(t){t&&this.visible&&this.initFormData()},deep:!0}},methods:{handleOneKeyProduction:function(){var t=Object(o.a)(Object(n.a)().mark((function t(){var e,a;return Object(n.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,this.form.productionLineId){t.next=4;break}return this.$message.error("请先选择产线"),t.abrupt("return");case 4:return t.next=6,Object(c.b)(this.form.materialId);case 6:if(e=t.sent,a=e.data,console.log("获取到的工序:",a),0!==a.length){t.next=12;break}return this.$message.error("该物料没有对应的工艺"),t.abrupt("return");case 12:this.workTableData=a,console.log(this.workTableData,"this.workTableData"),this.workDialogVisible=!0,t.next=20;break;case 17:t.prev=17,t.t0=t.catch(0),this.$message.error("获取工序数据失败");case 20:case"end":return t.stop()}}),t,this,[[0,17]])})));return function(){return t.apply(this,arguments)}}(),initFormData:function(){"edit"===this.dialogStatus?this.form=Object(r.a)({},this.rowData):this.form={workOrderNo:"P"+(new Date).getFullYear().toString()+((new Date).getMonth()+1).toString().padStart(2,"0")+(new Date).getDate().toString().padStart(2,"0")+Date.now().toString(),status:"PENDING",saleOrderId:"",saleOrderNo:"",productionOrderId:"",productionOrderNo:"",materialId:"",materialNumber:"",materialName:"",fSpecification:"",FMATERIALID:"",productionLineId:"",lineName:"",businessType:"NORMAL",planQuantity:0,planProductionQuantity:0,inputQuantity:0,outputQuantity:0,planStartTime:"",planEndTime:"",remark:""}},handleSaleOrderSelect:function(t){var e=this;this.form.saleOrderId=null,this.form.productionOrderId=null,t&&(console.log(t),this.$nextTick((function(){e.form.saleOrderId=t._id,e.form.saleOrderNo=t.FBillNo,e.form.productionOrderId="",e.form.productionOrderNo=""})))},handleProductionOrderSelect:function(){var t=Object(o.a)(Object(n.a)().mark((function t(e){var a=this;return Object(n.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:this.form.productionOrderId=null,this.form.materialId=null,e&&(console.log(e),this.$nextTick(Object(o.a)(Object(n.a)().mark((function t(){var r,o;return Object(n.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a.form.productionOrderId=e._id,a.form.productionOrderNo=e.FBillNo,a.form.fSpecification=e.FSpecification||"",a.form.materialName=e.FMaterialName||"",a.form.planQuantity=e.FQty||0,a.form.materialCode=e.FNumber||"",t.next=8,Object(i.b)("k3_BD_MATERIAL",{query:{FMATERIALID:e.FMaterialId}});case 8:r=t.sent,o=r.data,console.log(o),o.length&&(a.form.materialId=o[0]._id);case 12:case"end":return t.stop()}}),t)})))));case 3:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}(),handleMaterialSelect:function(t){t&&(this.form.materialId=t._id,this.form.materialNumber=t.FNumber,this.form.materialName=t.FName,this.form.fSpecification=t.FSpecification,this.form.FMATERIALID=t.FMATERIALID)},handleProductionLineSelect:function(t){t&&(this.form.lineName=t.lineName)},handleClose:function(){this.$emit("update:visible",!1),this.$refs.form&&this.$refs.form.resetFields()},handleSubmit:function(){var t=this;this.$refs.form.validate(function(){var e=Object(o.a)(Object(n.a)().mark((function e(a){var o;return Object(n.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a){t.submitLoading=!0;try{o=Object(r.a)({},t.form),t.$emit("submit",o),t.handleClose()}catch(e){console.error("提交失败:",e),t.$message.error("提交失败")}finally{t.submitLoading=!1}}case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())},handleStartProduction:function(){var t=Object(o.a)(Object(n.a)().mark((function t(){var e,a,r=this;return Object(n.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(this.form.planProductionQuantity<=0||this.form.planProductionQuantity>this.form.planQuantity)){t.next=3;break}return this.$message.error("计划生产数量不正确"),t.abrupt("return");case 3:return t.next=5,Object(i.b)("production_plan_work_order",{query:{productionLineId:this.form.productionLineId,status:"IN_PROGRESS"}});case 5:if(e=t.sent,a=e.data,!(this.form.planProductionQuantity<=0||this.form.planProductionQuantity>this.form.planQuantity)){t.next=10;break}return this.$message.error("计划生产数量不正确"),t.abrupt("return");case 10:if(!a.length){t.next=13;break}return this.$message.error("当前产线存在进行中的工单，无法开始新的工单"),t.abrupt("return");case 13:this.$confirm("确认开始生产该工单?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){r.form.status="IN_PROGRESS",r.handleSubmit()})).catch((function(){}));case 14:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}(),handlePauseProduction:function(){var t=this;this.$confirm("确认暂停生产该工单?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){t.form.status="PAUSED",t.handleSubmit()})).catch((function(){}))},handleCancelProduction:function(){var t=this;this.$confirm("确认取消生产该工单?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){t.form.status="CANCELLED",t.handleSubmit()})).catch((function(){}))}}},d=u,m=(a("8c8c"),a("2877")),p=Object(m.a)(d,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-dialog",{attrs:{title:t.dialogTitle,visible:t.visible,width:"60%"},on:{"update:visible":function(e){t.visible=e},close:t.handleClose}},[a("el-form",{ref:"form",attrs:{model:t.form,rules:t.rules,"label-width":"120px",size:"small"}},[a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"工单号",prop:"workOrderNo"}},[a("el-input",{attrs:{placeholder:"请输入工单号",disabled:"edit"===t.dialogStatus},model:{value:t.form.workOrderNo,callback:function(e){t.$set(t.form,"workOrderNo",e)},expression:"form.workOrderNo"}})],1)],1),t._v(" "),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"工单状态",prop:"status"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{disabled:"",placeholder:"请选择工单状态"},model:{value:t.form.status,callback:function(e){t.$set(t.form,"status",e)},expression:"form.status"}},t._l(t.dict.type.work_order_status,(function(t){return a("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),1)],1)],1)],1),t._v(" "),a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"销售单号",prop:"saleOrderId"}},[a("zr-select",{attrs:{collection:"k3_SAL_SaleOrder","search-fields":["FBillNo"],"label-key":"FBillNo","sub-key":"FCustId",multiple:!1,placeholder:"请输入销售单号搜索"},on:{select:t.handleSaleOrderSelect},scopedSlots:t._u([{key:"option",fn:function(e){var r=e.item;return[a("div",{staticClass:"item-option"},[a("div",{staticClass:"item-info"},[a("span",{staticClass:"name"},[t._v(t._s(r.FBillNo))]),t._v(" "),a("el-tag",{attrs:{size:"mini",type:"info"}},[t._v(t._s(r.FCustId))])],1),t._v(" "),a("div",{staticClass:"sub-info"},[a("small",[t._v(t._s(r.FDate))])])])]}}]),model:{value:t.form.saleOrderId,callback:function(e){t.$set(t.form,"saleOrderId",e)},expression:"form.saleOrderId"}})],1)],1),t._v(" "),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"生产单号",prop:"productionOrderId"}},[t.form.saleOrderId?a("zr-select",{attrs:{collection:"k3_PRD_MO","search-fields":["FBillNo"],"label-key":"FBillNo","sub-key":"FMaterialName",multiple:!1,"additional-query":t.productionOrderQuery,placeholder:"请输入生产单号搜索"},on:{select:t.handleProductionOrderSelect},scopedSlots:t._u([{key:"option",fn:function(e){var r=e.item;return[a("div",{staticClass:"item-option"},[a("div",{staticClass:"item-info"},[a("span",{staticClass:"name"},[t._v(t._s(r.FBillNo))]),t._v(" "),a("el-tag",{attrs:{size:"mini",type:"info"}},[t._v(t._s(r.FMaterialName))])],1),t._v(" "),a("div",{staticClass:"sub-info"},[a("small",[t._v("计划数量: "+t._s(r.FQty))])])])]}}],null,!1,2920372338),model:{value:t.form.productionOrderId,callback:function(e){t.$set(t.form,"productionOrderId",e)},expression:"form.productionOrderId"}}):a("el-input",{attrs:{disabled:!0,placeholder:"请先选择销售单号"},model:{value:t.form.productionOrderNo,callback:function(e){t.$set(t.form,"productionOrderNo",e)},expression:"form.productionOrderNo"}})],1)],1)],1),t._v(" "),a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"产品",prop:"materialId"}},[t.form.productionOrderId?a("zr-select",{attrs:{collection:"k3_BD_MATERIAL","search-fields":["FNumber","FName","FSpecification"],"label-key":"FName","sub-key":"FMATERIALID",multiple:!1,"additional-query":t.materialQuery,placeholder:"请输入物料编码/名称搜索"},on:{select:t.handleMaterialSelect},scopedSlots:t._u([{key:"option",fn:function(e){var r=e.item;return[a("div",{staticClass:"select-option"},[a("div",{staticClass:"option-main"},[a("span",{staticClass:"option-label"},[t._v(t._s(r.FNumber)+" - "+t._s(r.FName))]),t._v(" "),a("el-tag",{staticClass:"option-tag",attrs:{size:"mini",type:"info"}},[t._v("\n                                        "+t._s(r.FMATERIALID)+" - "+t._s(r.FUseOrgId)+"\n                                    ")])],1),t._v(" "),r.FSpecification?a("div",{staticClass:"option-sub"},[a("small",[t._v("规格: "+t._s(r.FSpecification))])]):t._e()])]}}],null,!1,546627704),model:{value:t.form.materialId,callback:function(e){t.$set(t.form,"materialId",e)},expression:"form.materialId"}}):a("el-input",{attrs:{disabled:!0,placeholder:"请先选择生产单号"},model:{value:t.form.materialName,callback:function(e){t.$set(t.form,"materialName",e)},expression:"form.materialName"}})],1)],1),t._v(" "),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"产线",prop:"productionLineId"}},[a("zr-select",{attrs:{collection:"production_line","search-fields":["lineCode","lineName"],"label-key":"lineName","tag-key":"lineCode","sub-key":"workshop",multiple:!1,placeholder:"请输入产线信息搜索"},on:{select:t.handleProductionLineSelect},model:{value:t.form.productionLineId,callback:function(e){t.$set(t.form,"productionLineId",e)},expression:"form.productionLineId"}})],1)],1)],1),t._v(" "),a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"生产数量",prop:"planQuantity"}},[a("el-input-number",{staticStyle:{width:"100%"},attrs:{min:0,"controls-position":"right"},model:{value:t.form.planQuantity,callback:function(e){t.$set(t.form,"planQuantity",e)},expression:"form.planQuantity"}})],1)],1),t._v(" "),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"工单数量",prop:"planProductionQuantity"}},[a("el-input-number",{staticStyle:{width:"100%"},attrs:{min:0,"controls-position":"right"},model:{value:t.form.planProductionQuantity,callback:function(e){t.$set(t.form,"planProductionQuantity",e)},expression:"form.planProductionQuantity"}})],1)],1)],1),t._v(" "),a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"投入数量",prop:"inputQuantity"}},[a("el-input-number",{staticStyle:{width:"100%"},attrs:{disabled:"",min:0,"controls-position":"right"},model:{value:t.form.inputQuantity,callback:function(e){t.$set(t.form,"inputQuantity",e)},expression:"form.inputQuantity"}})],1)],1),t._v(" "),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"产出数量",prop:"outputQuantity"}},[a("el-input-number",{staticStyle:{width:"100%"},attrs:{disabled:"",min:0,"controls-position":"right"},model:{value:t.form.outputQuantity,callback:function(e){t.$set(t.form,"outputQuantity",e)},expression:"form.outputQuantity"}})],1)],1)],1),t._v(" "),a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"计划开始时间",prop:"planStartTime"}},[a("el-date-picker",{staticStyle:{width:"100%"},attrs:{type:"datetime",placeholder:"选择计划开始时间"},model:{value:t.form.planStartTime,callback:function(e){t.$set(t.form,"planStartTime",e)},expression:"form.planStartTime"}})],1)],1),t._v(" "),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"计划结束时间",prop:"planEndTime"}},[a("el-date-picker",{staticStyle:{width:"100%"},attrs:{type:"datetime",placeholder:"选择计划结束时间"},model:{value:t.form.planEndTime,callback:function(e){t.$set(t.form,"planEndTime",e)},expression:"form.planEndTime"}})],1)],1)],1),t._v(" "),a("el-form-item",{attrs:{label:"备注",prop:"remark"}},[a("el-input",{attrs:{type:"textarea",placeholder:"请输入备注信息"},model:{value:t.form.remark,callback:function(e){t.$set(t.form,"remark",e)},expression:"form.remark"}})],1)],1),t._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},["edit"===t.dialogStatus?[a("el-button",{attrs:{type:"info"},on:{click:t.handleOneKeyProduction}},[t._v("\n                一键生产\n            ")]),t._v(" "),"PENDING"===t.form.status||"PAUSED"===t.form.status?a("el-button",{attrs:{type:"success",disabled:!t.canStart},on:{click:t.handleStartProduction}},[t._v("\n                开始生产\n            ")]):t._e(),t._v(" "),"IN_PROGRESS"===t.form.status?a("el-button",{attrs:{type:"warning",disabled:"IN_PROGRESS"!==t.form.status},on:{click:t.handlePauseProduction}},[t._v("\n                暂停生产\n            ")]):t._e(),t._v(" "),"IN_PROGRESS"===t.form.status?a("el-button",{attrs:{type:"danger",disabled:"IN_PROGRESS"!==t.form.status},on:{click:t.handleCancelProduction}},[t._v("\n                取消生产\n            ")]):t._e()]:t._e(),t._v(" "),a("el-button",{on:{click:t.handleClose}},[t._v("取 消")]),t._v(" "),a("el-button",{attrs:{type:"primary",loading:t.submitLoading},on:{click:t.handleSubmit}},[t._v("确 定")])],2),t._v(" "),t.workDialogVisible&&"edit"===t.dialogStatus?a("work-dialog",{attrs:{"line-id":t.form.productionLineId,visible:t.workDialogVisible,"material-id":t.form.materialId,productionPlanWorkOrderId:t.form._id,"work-table-data":t.workTableData},on:{"update:visible":function(e){t.workDialogVisible=e}}}):t._e()],1)}),[],!1,null,"54271703",null);e.default=p.exports},2470:function(t,e,a){"use strict";a("b498")},"77d2":function(t,e,a){"use strict";a.d(e,"a",(function(){return n})),a.d(e,"b",(function(){return o}));var r=a("b775");function n(t){return Object(r.a)({url:"/machine/progress",method:"get",params:t})}function o(t){return Object(r.a)({url:"/machine/refresh",method:"post",data:t})}},"8c8c":function(t,e,a){"use strict";a("c474")},ab03:function(t,e,a){"use strict";a.r(e);var r=a("ade3"),n=(a("6b54"),a("a481"),a("f576"),a("8615"),a("6762"),a("2fdb"),a("456d"),a("ac6a"),a("c7eb")),o=(a("96cf"),a("1da1")),i=a("7e1e"),s={name:"ProductionOrder",dicts:["product_type","businessType","work_order_status"],components:{EditDialog:a("2212").default},data:function(){return{searchForm:{workOrderNo:"",status:"",saleOrderNo:"",productionOrderNo:"",materialName:"",lineName:"",businessType:"",dateRange:[]},tableList:[],total:0,currentPage:1,pageSize:10,listLoading:!0,showAdvanced:!1,dialogFormVisible:!1,dialogStatus:"",detailDialogVisible:!1,selection:[],dataForm:{}}},methods:Object(r.a)(Object(r.a)(Object(r.a)(Object(r.a)(Object(r.a)(Object(r.a)({getStatusType:function(t){return{PENDING:"info",IN_PROGRESS:"warning",COMPLETED:"success",CANCELLED:"danger"}[t]||"info"},getStatusText:function(t){return{PENDING:"待生产",IN_PROGRESS:"生产中",COMPLETED:"已完成",CANCELLED:"已取消"}[t]||t},searchData:function(){var t={query:{$and:[]}};return this.searchForm.workOrderNo&&t.query.$and.push({workOrderNo:{$regex:this.searchForm.workOrderNo,$options:"i"}}),this.searchForm.status&&t.query.$and.push({status:this.searchForm.status}),this.searchForm.saleOrderNo&&t.query.$and.push({saleOrderNo:{$regex:this.searchForm.saleOrderNo,$options:"i"}}),this.searchForm.productionOrderNo&&t.query.$and.push({productionOrderNo:{$regex:this.searchForm.productionOrderNo,$options:"i"}}),this.searchForm.productModel&&t.query.$and.push({productModel:{$regex:this.searchForm.productModel,$options:"i"}}),this.searchForm.lineName&&t.query.$and.push({lineName:{$regex:this.searchForm.lineName,$options:"i"}}),this.searchForm.businessType&&t.query.$and.push({businessType:this.searchForm.businessType}),this.searchForm.dateRange&&2===this.searchForm.dateRange.length&&t.query.$and.push({planStartTime:{$gte:new Date(this.searchForm.dateRange[0]),$lte:new Date(this.searchForm.dateRange[1])}}),t.query.$and.length||delete t.query.$and,t},resetForm:function(){this.$refs.searchForm.resetFields(),this.searchForm={workOrderNo:"",status:"",saleOrderNo:"",productionOrderNo:"",productModel:"",lineName:"",businessType:"",dateRange:[]},this.currentPage=1,this.fetchData()},fetchData:function(){var t=Object(o.a)(Object(n.a)().mark((function t(){var e,a;return Object(n.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.listLoading=!0,t.prev=1,(e=this.searchData()).page=this.currentPage,e.skip=(this.currentPage-1)*this.pageSize,e.limit=this.pageSize,e.count=!0,t.next=9,Object(i.b)("production_plan_work_order",e);case 9:a=t.sent,this.tableList=a.data,this.total=a.countnum,t.next=18;break;case 14:t.prev=14,t.t0=t.catch(1),console.error("获取数据失败:",t.t0),this.$message.error("获取数据失败");case 18:return t.prev=18,this.listLoading=!1,t.finish(18);case 21:case"end":return t.stop()}}),t,this,[[1,14,18,21]])})));return function(){return t.apply(this,arguments)}}(),exportData:function(){var t=Object(o.a)(Object(n.a)().mark((function t(){var e,a,r,o,s,l,c,u,d=this;return Object(n.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,this.$message({message:"正在导出数据,请稍候...",type:"info"}),e=this.$loading({lock:!0,text:"导出中...",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"}),(a=this.searchData()).limit=1e6,t.next=7,Object(i.b)("k3_PRD_MO",a);case 7:if((r=t.sent).data&&0!==r.data.length){t.next=12;break}return this.$message.warning("没有数据可供导出"),e.close(),t.abrupt("return");case 12:o={FBillNo:"单据编号",FDocumentStatus:"单据状态",FDate:"单据日期",FWorkShopID_FName:"生产车间",FMaterialId:"物料编码",FMaterialName:"物料名称",FSpecification:"规格型号",FProductType:"产品类型",FUnitId:"单位",FQty:"数量",FPlanStartDate:"计划开工时间",FPlanFinishDate:"计划完工时间"},s=r.data.map((function(t){var e={};return Object.keys(o).forEach((function(a){a.includes("Date")?e[o[a]]=d.formatDate(t[a]):e[o[a]]=t[a]})),e})),l=XLSX.utils.book_new(),c=XLSX.utils.json_to_sheet(s),u=Object.values(o).map((function(t){return{wch:Math.max(2*t.length,15)}})),c["!cols"]=u,XLSX.utils.book_append_sheet(l,c,"生产订单数据"),XLSX.writeFile(l,"生产订单数据.xlsx"),e.close(),this.$message.success("导出成功"),t.next=28;break;case 24:t.prev=24,t.t0=t.catch(0),console.error("导出失败:",t.t0),this.$message.error("导出失败");case 28:case"end":return t.stop()}}),t,this,[[0,24]])})));return function(){return t.apply(this,arguments)}}(),baseTableHandleCurrentChange:function(t){this.currentPage=t,this.fetchData()},baseTableHandleSizeChange:function(t){this.pageSize=t,this.fetchData()},toggleAdvanced:function(){this.showAdvanced=!this.showAdvanced},formatDate:function(t){if(!t)return"暂无数据";var e=new Date(t);if(isNaN(e.getTime()))return"无效日期";var a=e.getFullYear(),r=String(e.getMonth()+1).padStart(2,"0"),n=String(e.getDate()).padStart(2,"0");return"".concat(a,"-").concat(r,"-").concat(n)},formatNumber:function(t){return t||0===t?t.toString().replace(/\B(?=(\d{3})+(?!\d))/g,","):"0"},search:function(){this.currentPage=1,this.fetchData()},handleSelectionChange:function(t){this.selection=t},handleView:function(t){this.dataForm=JSON.parse(JSON.stringify(t)),this.dialogStatus="view",this.dialogFormVisible=!0},handleEdit:function(t){var e=this;this.dialogStatus="edit",this.dataForm=JSON.parse(JSON.stringify(t)),this.$nextTick((function(){console.log(e.dataForm),e.dialogFormVisible=!0}))},handleDelete:function(t){var e=this;this.$confirm("确认要删除该生产订单吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(Object(o.a)(Object(n.a)().mark((function a(){return Object(n.a)().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.prev=0,a.next=3,Object(i.c)("production_plan_work_order",{query:{_id:t._id}});case 3:e.$message.success("删除成功"),e.fetchData(),a.next=11;break;case 7:a.prev=7,a.t0=a.catch(0),console.error("删除失败:",a.t0),e.$message.error("删除失败");case 11:case"end":return a.stop()}}),a,null,[[0,7]])})))).catch((function(){e.$message.info("已取消删除")}))},handleSubmit:function(){var t=Object(o.a)(Object(n.a)().mark((function t(e){return Object(n.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,"create"!==this.dialogStatus){t.next=7;break}return t.next=4,Object(i.a)("production_plan_work_order",e);case 4:this.$message.success("添加成功"),t.next=10;break;case 7:return t.next=9,Object(i.d)("production_plan_work_order",{query:{_id:e._id},update:e});case 9:this.$message.success("更新成功");case 10:this.fetchData(),t.next=17;break;case 13:t.prev=13,t.t0=t.catch(0),console.error("操作失败:",t.t0),this.$message.error("操作失败");case 17:case"end":return t.stop()}}),t,this,[[0,13]])})));return function(e){return t.apply(this,arguments)}}(),handleAdd:function(){this.dialogStatus="create",this.dataForm={},this.dialogFormVisible=!0}},"handleEdit",(function(t){this.dialogStatus="edit",this.dataForm=JSON.parse(JSON.stringify(t)),this.dialogFormVisible=!0})),"handleView",(function(t){this.$message.info("查看详情功能待实现")})),"handleDelete",(function(t){var e=this;this.$confirm("确认删除该工单吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(Object(o.a)(Object(n.a)().mark((function a(){return Object(n.a)().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.prev=0,a.next=3,Object(i.c)("production_plan_work_order",{query:{_id:t._id}});case 3:e.$message.success("删除成功"),e.fetchData(),a.next=11;break;case 7:a.prev=7,a.t0=a.catch(0),console.error("删除失败:",a.t0),e.$message.error("删除失败");case 11:case"end":return a.stop()}}),a,null,[[0,7]])})))).catch((function(){}))})),"handleBatchDelete",(function(){var t=this;this.selection.length?this.$confirm("确认删除选中的 ".concat(this.selection.length," 条记录吗？"),"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(Object(o.a)(Object(n.a)().mark((function e(){var a;return Object(n.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,a=t.selection.map((function(t){return t._id})),e.next=4,Object(i.c)("production_plan_work_order",{query:{_id:{$in:a}}});case 4:t.$message.success("批量删除成功"),t.fetchData(),e.next=12;break;case 8:e.prev=8,e.t0=e.catch(0),console.error("批量删除失败:",e.t0),t.$message.error("批量删除失败");case 12:case"end":return e.stop()}}),e,null,[[0,8]])})))).catch((function(){})):this.$message.warning("请选择要删除的记录")})),"handleSelectionChange",(function(t){this.selection=t})),"handleSubmit",function(){var t=Object(o.a)(Object(n.a)().mark((function t(e){return Object(n.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,"create"!==this.dialogStatus){t.next=7;break}return t.next=4,Object(i.a)("production_plan_work_order",e);case 4:this.$message.success("新增成功"),t.next=10;break;case 7:return t.next=9,Object(i.d)("production_plan_work_order",{query:{_id:e._id},update:e});case 9:this.$message.success("更新成功");case 10:this.fetchData(),t.next=17;break;case 13:t.prev=13,t.t0=t.catch(0),console.error("操作失败:",t.t0),this.$message.error("操作失败");case 17:case"end":return t.stop()}}),t,this,[[0,13]])})));return function(e){return t.apply(this,arguments)}}()),created:function(){this.fetchData()}},l=s,c=(a("2470"),a("2877")),u=Object(c.a)(l,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"app-container"},[a("el-card",{staticClass:"filter-container"},[a("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[a("span",[t._v("筛选搜索")]),t._v(" "),a("el-button",{staticStyle:{float:"right",padding:"3px 0"},attrs:{type:"text"},on:{click:t.toggleAdvanced}},[t._v("\n                "+t._s(t.showAdvanced?"收起":"展开")+"高级搜索\n            ")])],1),t._v(" "),a("el-form",{ref:"searchForm",staticClass:"demo-form-inline",attrs:{model:t.searchForm}},[a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:6}},[a("el-form-item",{attrs:{label:"工单号"}},[a("el-input",{attrs:{placeholder:"请输入工单号",clearable:""},model:{value:t.searchForm.workOrderNo,callback:function(e){t.$set(t.searchForm,"workOrderNo",e)},expression:"searchForm.workOrderNo"}})],1)],1),t._v(" "),a("el-col",{attrs:{span:6}},[a("el-form-item",{attrs:{label:"工单状态"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择工单状态",clearable:""},model:{value:t.searchForm.status,callback:function(e){t.$set(t.searchForm,"status",e)},expression:"searchForm.status"}},t._l(t.dict.type.work_order_status,(function(t){return a("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),1)],1)],1),t._v(" "),a("el-col",{attrs:{span:6}},[a("el-form-item",{attrs:{label:"销售单号"}},[a("zr-select",{staticStyle:{width:"100%"},attrs:{collection:"k3_SAL_SaleOrder","search-fields":["FBillNo"],"label-key":"FBillNo","sub-key":"FBillNo",multiple:!1,placeholder:"请输入销售单号",clearable:""},scopedSlots:t._u([{key:"option",fn:function(e){var r=e.item;return[a("div",{staticClass:"select-option"},[a("div",{staticClass:"option-main"},[a("span",{staticClass:"option-label"},[t._v(t._s(r.FBillNo))]),t._v(" "),a("el-tag",{staticClass:"option-tag",attrs:{size:"mini",type:"info"}},[t._v("\n                                            "+t._s(r.FBillNo)+" - "+t._s(r.FSaleOrgId)+"\n                                        ")])],1)])]}}]),model:{value:t.searchForm.saleOrderNo,callback:function(e){t.$set(t.searchForm,"saleOrderNo",e)},expression:"searchForm.saleOrderNo"}})],1)],1),t._v(" "),a("el-col",{attrs:{span:6}},[a("el-form-item",{attrs:{label:"生产单号"}},[a("zr-select",{staticStyle:{width:"100%"},attrs:{collection:"k3_PRD_MO","search-fields":["FBillNo"],"label-key":"FBillNo","sub-key":"FBillNo",multiple:!1,placeholder:"请输入生产单号",clearable:""},scopedSlots:t._u([{key:"option",fn:function(e){var r=e.item;return[a("div",{staticClass:"select-option"},[a("div",{staticClass:"option-main"},[a("span",{staticClass:"option-label"},[t._v(t._s(r.FBillNo))]),t._v(" "),a("el-tag",{staticClass:"option-tag",attrs:{size:"mini",type:"info"}},[t._v("\n                                            "+t._s(r.FBillNo)+" - "+t._s(r.FUseOrgId)+"\n                                        ")])],1)])]}}]),model:{value:t.searchForm.productionOrderNo,callback:function(e){t.$set(t.searchForm,"productionOrderNo",e)},expression:"searchForm.productionOrderNo"}})],1)],1)],1),t._v(" "),a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:6}},[a("el-form-item",{attrs:{label:"产品名称"}},[a("zr-select",{staticStyle:{width:"100%"},attrs:{collection:"k3_BD_MATERIAL","search-fields":["FNumber","FName"],"label-key":"FName","sub-key":"FMATERIALID",multiple:!1,placeholder:"请输入物料编码/名称搜索",clearable:""},scopedSlots:t._u([{key:"option",fn:function(e){var r=e.item;return[a("div",{staticClass:"select-option"},[a("div",{staticClass:"option-main"},[a("span",{staticClass:"option-label"},[t._v(t._s(r.FNumber)+" - "+t._s(r.FName))]),t._v(" "),a("el-tag",{staticClass:"option-tag",attrs:{size:"mini",type:"info"}},[t._v("\n                                            "+t._s(r.FMATERIALID)+" - "+t._s(r.FUseOrgId)+"\n                                        ")])],1),t._v(" "),r.FSpecification?a("div",{staticClass:"option-sub"},[a("small",[t._v("规格: "+t._s(r.FSpecification))])]):t._e()])]}}]),model:{value:t.searchForm.materialName,callback:function(e){t.$set(t.searchForm,"materialName",e)},expression:"searchForm.materialName"}})],1)],1),t._v(" "),a("el-col",{attrs:{span:6}},[a("el-form-item",{attrs:{label:"产线名称"}},[a("zr-select",{staticStyle:{width:"100%"},attrs:{collection:"production_line","search-fields":["lineCode","lineName"],"label-key":"lineName","sub-key":"lineCode",multiple:!1,placeholder:"请输入产线编码/名称搜索",clearable:""},scopedSlots:t._u([{key:"option",fn:function(e){var r=e.item;return[a("div",{staticClass:"select-option"},[a("div",{staticClass:"option-main"},[a("span",{staticClass:"option-label"},[t._v(t._s(r.lineCode)+" - "+t._s(r.lineName))]),t._v(" "),a("el-tag",{staticClass:"option-tag",attrs:{size:"mini",type:"info"}},[t._v("\n                                            "+t._s(r.lineCode)+" - "+t._s(r.lineNum)+"\n                                        ")])],1)])]}}]),model:{value:t.searchForm.lineName,callback:function(e){t.$set(t.searchForm,"lineName",e)},expression:"searchForm.lineName"}})],1)],1),t._v(" "),a("el-col",{attrs:{span:6}},[a("el-form-item",{attrs:{label:"业务类型"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择业务类型",clearable:""},model:{value:t.searchForm.businessType,callback:function(e){t.$set(t.searchForm,"businessType",e)},expression:"searchForm.businessType"}},t._l(t.dict.type.businessType,(function(t){return a("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),1)],1)],1),t._v(" "),a("el-col",{attrs:{span:6}},[a("el-form-item",{attrs:{label:"计划时间"}},[a("el-date-picker",{staticStyle:{width:"100%"},attrs:{type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","value-format":"yyyy-MM-dd"},model:{value:t.searchForm.dateRange,callback:function(e){t.$set(t.searchForm,"dateRange",e)},expression:"searchForm.dateRange"}})],1)],1)],1),t._v(" "),a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:t.search}},[t._v("查询搜索")]),t._v(" "),a("el-button",{on:{click:t.resetForm}},[t._v("重置")]),t._v(" "),a("el-button",{attrs:{type:"success"},on:{click:t.exportData}},[t._v("导出数据")]),t._v(" "),a("el-button",{attrs:{type:"primary",icon:"el-icon-plus"},on:{click:t.handleAdd}},[t._v("新增工单")]),t._v(" "),a("el-button",{attrs:{type:"danger",icon:"el-icon-delete",disabled:!t.selection.length},on:{click:t.handleBatchDelete}},[t._v("\n                    批量删除\n                ")])],1)],1)],1),t._v(" "),t._m(0),t._v(" "),a("base-table",{ref:"baseTable",attrs:{currentPage:t.currentPage,"highlight-current-row":!0,pageSize:t.pageSize,tableData:t.tableList,tableDataloading:t.listLoading,total:t.total},on:{"selection-change":t.handleSelectionChange,handleCurrentChange:t.baseTableHandleCurrentChange,handleSizeChange:t.baseTableHandleSizeChange}},[a("template",{slot:"law"},[a("el-table-column",{attrs:{type:"selection",width:"55"}}),t._v(" "),a("el-table-column",{attrs:{label:"工单号",width:"150"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-link",{attrs:{type:"primary"},on:{click:function(a){return t.handleView(e.row)}}},[t._v(t._s(e.row.workOrderNo))])]}}])}),t._v(" "),a("el-table-column",{attrs:{label:"工单状态",width:"100"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-tag",{attrs:{type:t.getStatusType(e.row.status)}},[t._v("\n                        "+t._s(t.getStatusText(e.row.status))+"\n                    ")])]}}])}),t._v(" "),a("el-table-column",{attrs:{label:"销售单号",width:"150"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n                    "+t._s(e.row.saleOrderNo)+"\n                ")]}}])}),t._v(" "),a("el-table-column",{attrs:{label:"生产单号",width:"150"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n                    "+t._s(e.row.productionOrderNo)+"\n                ")]}}])}),t._v(" "),a("el-table-column",{attrs:{label:"产品名称",width:"200"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n                    "+t._s(e.row.materialName)+"\n                ")]}}])}),t._v(" "),a("el-table-column",{attrs:{label:"产品规格",width:"120"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n                    "+t._s(e.row.fSpecification)+"\n                ")]}}])}),t._v(" "),a("el-table-column",{attrs:{label:"产品编码",width:"200"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n                    "+t._s(e.row.materialCode)+"\n                ")]}}])}),t._v(" "),a("el-table-column",{attrs:{label:"产线名称",width:"120"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n                    "+t._s(e.row.lineName)+"\n                ")]}}])}),t._v(" "),a("el-table-column",{attrs:{label:"业务类型",width:"100"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n                    "+t._s(e.row.businessType)+"\n                ")]}}])}),t._v(" "),a("el-table-column",{attrs:{label:"计划数量",width:"100"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n                    "+t._s(e.row.planQuantity)+"\n                ")]}}])}),t._v(" "),a("el-table-column",{attrs:{label:"计划生产数量",width:"100"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n                    "+t._s(e.row.planProductionQuantity)+"\n                ")]}}])}),t._v(" "),a("el-table-column",{attrs:{label:"投入数量",width:"100"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n                    "+t._s(e.row.inputQuantity)+"\n                ")]}}])}),t._v(" "),a("el-table-column",{attrs:{label:"产出数量",width:"100"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n                    "+t._s(e.row.outputQuantity)+"\n                ")]}}])}),t._v(" "),a("el-table-column",{attrs:{label:"计划状态",width:"100"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n                    "+t._s(e.row.status)+"\n                ")]}}])}),t._v(" "),a("el-table-column",{attrs:{label:"计划开始时间",width:"150"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n                    "+t._s(t.formatDate(e.row.planStartTime))+"\n                ")]}}])}),t._v(" "),a("el-table-column",{attrs:{label:"计划结束时间",width:"150"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n                    "+t._s(t.formatDate(e.row.planEndTime))+"\n                ")]}}])}),t._v(" "),a("el-table-column",{attrs:{label:"操作",width:"180",fixed:"right"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-button",{attrs:{type:"text",size:"small"},on:{click:function(a){return t.handleEdit(e.row)}}},[a("i",{staticClass:"el-icon-edit"}),t._v(" 编辑\n                    ")]),t._v(" "),a("el-button",{staticClass:"delete-btn",attrs:{type:"text",size:"small"},on:{click:function(a){return t.handleDelete(e.row)}}},[a("i",{staticClass:"el-icon-delete"}),t._v(" 删除\n                    ")])]}}])})],1)],2),t._v(" "),a("edit-dialog",{attrs:{visible:t.dialogFormVisible,"dialog-status":t.dialogStatus,"row-data":t.dataForm},on:{"update:visible":function(e){t.dialogFormVisible=e},submit:t.handleSubmit}})],1)}),[function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"screen1"},[a("div",{staticClass:"screen_content"},[a("div",{staticClass:"screen_content_first"},[a("i",{staticClass:"el-icon-tickets"},[t._v("生产管理列表")])])])])}],!1,null,"ad3cb8a4",null);e.default=u.exports},b498:function(t,e,a){},c474:function(t,e,a){},ed91:function(t,e,a){"use strict";a.d(e,"a",(function(){return n})),a.d(e,"c",(function(){return o})),a.d(e,"d",(function(){return i})),a.d(e,"e",(function(){return s})),a.d(e,"b",(function(){return l}));var r=a("b775");function n(t){return Object(r.a)({url:"/create-flow",method:"post",data:t})}function o(t){return Object(r.a)({url:"/scan-components",method:"post",data:t})}function i(t){return Object(r.a)({url:"/unbind-components",method:"post",data:t})}function s(t){return Object(r.a)({url:"/update-flow-nodes",method:"post",data:t})}function l(t){return Object(r.a)({url:"/all-process-steps/".concat(t),method:"get"})}}}]);