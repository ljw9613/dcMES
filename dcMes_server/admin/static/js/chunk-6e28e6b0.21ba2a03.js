(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-6e28e6b0"],{"46e0":function(e,t,a){},e76f:function(e,t,a){"use strict";a.r(t);var r=(a("ac6a"),a("5df3"),a("386d"),a("2909")),s=(a("55dd"),a("28a5"),a("6b54"),a("f576"),a("4917"),a("7f7f"),a("5530")),l=a("c7eb"),i=(a("96cf"),a("1da1")),o=a("ade3"),c=a("7e1e"),n=a("6ace"),p=a("aa47"),u={components:{ZrSelect:n.a},name:"CraftManagement",dicts:["product_type","craftType","processType","processStage","businessType","processStatus"],data:function(){var e=this;return Object(o.a)(Object(o.a)(Object(o.a)(Object(o.a)(Object(o.a)({tempCraftId:"",tempProcessId:"",craftForm:{_id:"",businessType:"",craftCode:"",craftName:"",craftVersion:"",productId:"",craftType:"",craftDesc:"",materialId:"",craftParams:[],processSteps:[],productStage:"",attachments:[],remark:"",status:"CREATE",isStandard:"0",selectedMaterial:"",componentName:"",productName:"",materialCode:""},rules:{craftCode:[{required:!0,message:"请输入工艺编号",trigger:"blur"}],craftName:[{required:!0,message:"请输入工艺名称",trigger:"blur"}],craftType:[{required:!0,message:"请选择工艺类型",trigger:"change"}]},processForm:{_id:"",craftId:"",processCode:"",processName:"",processDesc:"",processStage:"",processType:"",businessType:"",machineId:"",status:"CREATE",materials:[],remark:"",sort:1},processRules:{processName:[{required:!0,message:"请输入工序名称",trigger:"blur"}],processCode:[{required:!0,message:"请输入工序编码",trigger:"blur"}],processStage:[{required:!0,message:"请选择生产阶级",trigger:"change"}],processType:[{required:!0,message:"请选择工序类型",trigger:"change"}],sort:[{required:!0,message:"请输入工序次序",trigger:"blur"},{type:"number",min:1,message:"工序次序必须大于0",trigger:"blur"}]},materialForm:{craftId:"",processStepId:"",materialId:"",materialCode:"",materialName:"",specification:"",quantity:null,unit:"",isKey:"0",remark:"",scanOperation:!1,isComponent:"0"},materialRules:{materialCode:[{required:!0,message:"请输入物料编码",trigger:"blur"}],materialName:[{required:!0,message:"请输入物料名称",trigger:"blur"}],specification:[{required:!0,message:"请输入规格型号",trigger:"blur"}]},craftTableData:{tableList:[],total:0,currentPage:1,pageSize:10,listLoading:!1},processTableData:{tableList:[],listLoading:!1,height:"400px"},materialTableData:{tableList:[],total:0,currentPage:1,pageSize:10,listLoading:!1},dialogFormVisible:!1,processDialogVisible:!1,materialDialogVisible:!1,dialogStatus:"create",materialDialogStatus:"create",editingMaterialId:null,searchForm:{craftName:"",craftCode:"",dateRange:[],craftType:"",status:"",productName:"",productStage:"",isStandard:"",selectedMaterial:"",materialCode:"",materialName:""},showAdvanced:!1,materialOptions:[],materialLoading:!1,materialDialog:{visible:!1,title:"新增物料",loading:!1,beforeClose:function(t){e.materialForm={materialId:"",materialCode:"",materialName:"",specification:"",quantity:1,unit:"个",scanOperation:!1,isComponent:!1},e.materialOptions=[],e.$refs.materialForm&&e.$refs.materialForm.resetFields(),t()}}},"materialForm",{materialId:"",materialCode:"",materialName:"",specification:"",quantity:1,unit:"个",scanOperation:!1,isComponent:!1}),"materialOptions",[]),"materialRules",{materialId:[{required:!0,message:"请选择物料",trigger:"change"}],quantity:[{required:!0,message:"请输入用量",trigger:"blur"},{type:"number",min:0,message:"用量必须大于0",trigger:"blur"}]}),"searchDebounce",null),"processOperationType","create")},methods:{fetchCraftData:function(){var e=Object(i.a)(Object(l.a)().mark((function e(){var t,a;return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.craftTableData.listLoading=!0,e.prev=1,(t=this.searchData()).page=this.craftTableData.currentPage,t.skip=(this.craftTableData.currentPage-1)*this.craftTableData.pageSize,t.limit=this.craftTableData.pageSize,t.sort={_id:-1},t.populate=JSON.stringify([{path:"materialId",select:"FNumber"}]),t.count=!0,e.next=11,Object(c.b)("craft",t);case 11:a=e.sent,this.craftTableData.tableList=a.data,this.craftTableData.total=a.countnum,e.next=20;break;case 16:e.prev=16,e.t0=e.catch(1),console.error("获取工艺数据失败:",e.t0),this.$message.error("获取工艺数据失败");case 20:return e.prev=20,this.craftTableData.listLoading=!1,e.finish(20);case 23:case"end":return e.stop()}}),e,this,[[1,16,20,23]])})));return function(){return e.apply(this,arguments)}}(),handleAdd:function(){this.tempCraftId=this.ObjectId(),this.dialogStatus="create",this.dialogFormVisible=!0,this.craftForm={_id:this.tempCraftId,businessType:"",craftCode:"",craftName:"",craftVersion:"",productId:"",craftType:"",craftDesc:"",materialId:"",craftParams:[],processSteps:[],productStage:"",attachments:[],remark:"",status:"CREATE",isStandard:"0",selectedMaterial:""},this.processTableData.tableList=[],this.processTableData.total=0},handleEdit:function(){var e=Object(i.a)(Object(l.a)().mark((function e(t){var a,r,s;return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.dialogStatus="edit",this.dialogFormVisible=!0,this.tempCraftId=t._id,e.prev=3,e.next=6,Object(c.b)("craft",{query:{_id:this.tempCraftId}});case 6:if(a=e.sent,this.craftForm=JSON.parse(JSON.stringify(a.data[0])),!this.craftForm.materialId){e.next=20;break}return e.prev=9,e.next=12,Object(c.b)("k3_BD_MATERIAL",{query:{_id:this.craftForm.materialId}});case 12:(r=e.sent).data&&r.data.length>0&&(s=r.data[0],this.materialOptions=r.data,this.craftForm.selectedMaterial=this.craftForm.materialId,this.craftForm.materialCode=s.FNumber||"",this.craftForm.componentName=s.FName||"",this.craftForm.productName=s.FSpecification||""),e.next=20;break;case 16:e.prev=16,e.t0=e.catch(9),console.error("获取物料数据失败:",e.t0),this.$message.warning("获取物料数据失败，但可以继续编辑其他信息");case 20:return e.next=22,this.fetchProcessData();case 22:e.next=28;break;case 24:e.prev=24,e.t1=e.catch(3),console.error("初始化编辑数据失败:",e.t1),this.$message.error("初始化编辑数据失败");case 28:case"end":return e.stop()}}),e,this,[[3,24],[9,16]])})));return function(t){return e.apply(this,arguments)}}(),handleDelete:function(e){var t=this;this.$confirm("删除工艺将同时删除所有相关工序和物料数据，是否确认删除?","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(Object(i.a)(Object(l.a)().mark((function a(){var r,s;return Object(l.a)().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.prev=0,a.next=3,Object(c.b)("processStep",{query:{craftId:e._id}});case 3:if(r=a.sent,s=r.data.map((function(e){return e._id})),!(s.length>0)){a.next=8;break}return a.next=8,Object(c.c)("processMaterials",{query:{processStepId:{$in:s}}});case 8:return a.next=10,Object(c.c)("processStep",{query:{craftId:e._id}});case 10:return a.next=12,Object(c.c)("craft",{query:{_id:e._id}});case 12:t.$message.success("删除成功"),t.fetchCraftData(),a.next=20;break;case 16:a.prev=16,a.t0=a.catch(0),console.error("删除失败:",a.t0),t.$message.error("删除失败: "+a.t0.message);case 20:case"end":return a.stop()}}),a,null,[[0,16]])})))).catch((function(){t.$message.info("已取消删除")}))},handleCraftTableCurrentChange:function(e){this.craftTableData.currentPage=e,this.fetchCraftData()},handleCraftTableSizeChange:function(e){this.craftTableData.pageSize=e,this.craftTableData.currentPage=1,this.fetchCraftData()},submitForm:function(){var e=this;this.$refs.craftForm.validate(function(){var t=Object(i.a)(Object(l.a)().mark((function t(a){var r,i,o,n,p;return Object(l.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!a){t.next=37;break}if(t.prev=1,e.craftForm.selectedMaterial){t.next=5;break}return e.$message.warning("请选择物料"),t.abrupt("return");case 5:return t.next=7,Object(c.b)("craft",{query:{materialId:e.craftForm.selectedMaterial,_id:{$ne:e.tempCraftId},status:{$ne:"VOID"}}});case 7:if(!((r=t.sent).data&&r.data.length>0)){t.next=11;break}return e.$message.warning("该物料已被其他工艺使用，工艺名称:".concat(r.data[0].craftName)),t.abrupt("return");case 11:return t.next=13,Object(c.b)("processStep",{query:{craftId:e.tempCraftId},sort:{_id:-1},select:{_id:1}});case 13:if(i=t.sent,o=i.data.map((function(e){return e._id})),delete(n=Object(s.a)(Object(s.a)({},e.craftForm),{},{materialId:e.craftForm.selectedMaterial,processSteps:o})).selectedMaterial,"create"!==e.dialogStatus){t.next=24;break}return n.createBy=e.$store.getters.name,t.next=21,Object(c.a)("craft",n);case 21:e.$message.success("添加成功"),t.next=29;break;case 24:return n.updateBy=e.$store.getters.name,p={query:{_id:e.tempCraftId},update:n},t.next=28,Object(c.d)("craft",p);case 28:e.$message.success("更新成功");case 29:e.dialogFormVisible=!1,e.fetchCraftData(),t.next=37;break;case 33:t.prev=33,t.t0=t.catch(1),console.error("操作失败:",t.t0),e.$message.error("操作失败");case 37:case"end":return t.stop()}}),t,null,[[1,33]])})));return function(e){return t.apply(this,arguments)}}())},fetchProcessData:function(){var e=Object(i.a)(Object(l.a)().mark((function e(){var t,a,r;return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.processTableData.listLoading=!0,e.prev=1,t=this.craftForm._id){e.next=5;break}return e.abrupt("return");case 5:return a={query:{craftId:t},sort:{sort:1}},e.next=8,Object(c.b)("processStep",a);case 8:r=e.sent,this.processTableData.tableList=r.data,e.next=16;break;case 12:e.prev=12,e.t0=e.catch(1),console.error("获取工序数据失败:",e.t0),this.$message.error("获取工序数据失败");case 16:return e.prev=16,this.processTableData.listLoading=!1,e.finish(16);case 19:case"end":return e.stop()}}),e,this,[[1,12,16,19]])})));return function(){return e.apply(this,arguments)}}(),generateProcessCode:function(){var e=Object(i.a)(Object(l.a)().mark((function e(){var t,a,r,s,i;return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Object(c.b)("processStep",{query:{},sort:{processCode:-1},limit:1});case 3:return t=e.sent,a="0001",t.data&&t.data.length>0&&(r=t.data[0].processCode,(s=r.match(/\d{4}/))&&(i=parseInt(s[0]),a=(i+1).toString().padStart(4,"0"))),e.abrupt("return",this.generateUnifiedCode(this.craftForm.craftType,"",a,""));case 9:return e.prev=9,e.t0=e.catch(0),console.error("生成工序编码失败:",e.t0),e.abrupt("return","ERROR_GENERATING_CODE");case 13:case"end":return e.stop()}}),e,this,[[0,9]])})));return function(){return e.apply(this,arguments)}}(),generateUnifiedCode:function(e,t,a,r){var s=e||"";return t&&(s+="_".concat(t)),s+="_".concat(a),r&&(s+="_".concat(r)),s},handleProcessTypeChange:function(){var e=Object(i.a)(Object(l.a)().mark((function e(t){var a,r,s,i;return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.processForm.processCode){e.next=2;break}return e.abrupt("return");case 2:a=this.processForm.processCode.split("_"),r=a[0],s=a[a.length-1],i=a.length>3?a[3]:"",this.processForm.processCode=this.generateUnifiedCode(r,t,s,i);case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),handleBusinessTypeChange:function(){var e=Object(i.a)(Object(l.a)().mark((function e(t){var a,r,s,i;return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.processForm.processCode){e.next=2;break}return e.abrupt("return");case 2:a=this.processForm.processCode.split("_"),r=a[0],s=a.length>1?a[1]:"",i=a[2],this.processForm.processCode=this.generateUnifiedCode(r,s,i,t);case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),handleAddProcess:function(){var e=Object(i.a)(Object(l.a)().mark((function e(){var t,a,r;return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.tempCraftId){e.next=3;break}return this.$message.warning("工艺ID不存在"),e.abrupt("return");case 3:return e.prev=3,e.next=6,Object(c.b)("processStep",{query:{craftId:this.tempCraftId},sort:{sort:-1},limit:1});case 6:return t=e.sent,a=1,t.data&&t.data.length>0&&(a=t.data[0].sort+1),e.next=11,this.generateProcessCode();case 11:r=e.sent,this.processOperationType="create",this.tempProcessId=this.ObjectId(),this.processDialogVisible=!0,this.processForm={_id:this.tempProcessId,craftId:this.tempCraftId,processCode:r,processName:"",processDesc:"",processStage:"",processType:"",businessType:"",status:"CREATE",materials:[],remark:"",sort:a},this.materialTableData.tableList=[],this.materialTableData.total=0,e.next=24;break;case 20:e.prev=20,e.t0=e.catch(3),console.error("初始化工序失败:",e.t0),this.$message.error("初始化工序失败");case 24:case"end":return e.stop()}}),e,this,[[3,20]])})));return function(){return e.apply(this,arguments)}}(),handleEditProcess:function(e){e&&e._id?(this.processOperationType="edit",this.processDialogVisible=!0,this.tempProcessId=e._id,this.processForm=JSON.parse(JSON.stringify(e)),this.fetchMaterialData()):this.$message.error("无效的工序数据")},handleDeleteProcess:function(e){var t=this;this.$confirm("删除工序将同时删除所有相关物料数据，是否确认删除?","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(Object(i.a)(Object(l.a)().mark((function a(){return Object(l.a)().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.prev=0,a.next=3,Object(c.c)("processMaterials",{query:{processStepId:e._id}});case 3:return a.next=5,Object(c.c)("processStep",{query:{_id:e._id}});case 5:return t.$message.success("删除成功"),t.fetchProcessData(),a.next=9,t.reorderProcessSteps();case 9:a.next=15;break;case 11:a.prev=11,a.t0=a.catch(0),console.error("删除失败:",a.t0),t.$message.error("删除失败: "+a.t0.message);case 15:case"end":return a.stop()}}),a,null,[[0,11]])})))).catch((function(){t.$message.info("已取消删除")}))},handleProcessTableCurrentChange:function(e){this.processTableData.currentPage=e,this.fetchProcessData()},handleProcessTableSizeChange:function(e){this.processTableData.pageSize=e,this.processTableData.currentPage=1,this.fetchProcessData()},submitProcessForm:function(){var e=this;this.$refs.processForm.validate(function(){var t=Object(i.a)(Object(l.a)().mark((function t(a){var r,i,o,n,p;return Object(l.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!a){t.next=44;break}return t.prev=1,t.next=4,Object(c.b)("processStep",{query:{craftId:e.tempCraftId,sort:e.processForm.sort,_id:{$ne:e.tempProcessId}}});case 4:if(!((r=t.sent).data&&r.data.length>0)){t.next=11;break}return e.$message.warning("工序次序重复，系统将自动调整序号"),t.next=9,Object(c.b)("processStep",{query:{craftId:e.tempCraftId},sort:{sort:-1},limit:1});case 9:i=t.sent,e.processForm.sort=i.data.length>0?i.data[0].sort+1:1;case 11:if(o=e.materialTableData.tableList.map((function(e){return e._id.toString()})),"P_INSPECTION"===e.processForm.processType||0!==o.length){t.next=15;break}return e.$message.warning("请先添加物料"),t.abrupt("return");case 15:if(n=Object(s.a)(Object(s.a)({},e.processForm),{},{craftId:e.tempCraftId,materials:o}),"create"!==e.processOperationType){t.next=25;break}return n._id=e.tempProcessId,n.createBy=e.$store.getters.name,n.createAt=new Date,t.next=22,Object(c.a)("processStep",n);case 22:e.$message.success("添加成功"),t.next=31;break;case 25:return n.updateBy=e.$store.getters.name,n.updateAt=new Date,p={query:{_id:e.tempProcessId},update:n},t.next=30,Object(c.d)("processStep",p);case 30:e.$message.success("更新成功");case 31:return e.processDialogVisible=!1,t.next=34,e.fetchProcessData();case 34:return t.next=36,e.reorderProcessSteps();case 36:t.next=42;break;case 38:t.prev=38,t.t0=t.catch(1),console.error("操作失败:",t.t0),e.$message.error("操作失败: "+t.t0.message);case 42:t.next=46;break;case 44:return e.$message.warning("请填写必填项"),t.abrupt("return",!1);case 46:case"end":return t.stop()}}),t,null,[[1,38]])})));return function(e){return t.apply(this,arguments)}}())},fetchMaterialData:function(){var e=Object(i.a)(Object(l.a)().mark((function e(){var t,a,r;return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.materialTableData.listLoading=!0,e.prev=1,t=this.processForm._id){e.next=5;break}return e.abrupt("return");case 5:return a={query:{processStepId:t},page:this.materialTableData.currentPage,limit:this.materialTableData.pageSize,count:!0},e.next=8,Object(c.b)("processMaterials",a);case 8:r=e.sent,this.materialTableData.tableList=r.data,this.materialTableData.total=r.countnum,e.next=17;break;case 13:e.prev=13,e.t0=e.catch(1),console.error("获取物料数据失败:",e.t0),this.$message.error("获取物料数据失败");case 17:return e.prev=17,this.materialTableData.listLoading=!1,e.finish(17);case 20:case"end":return e.stop()}}),e,this,[[1,13,17,20]])})));return function(){return e.apply(this,arguments)}}(),handleAddMaterial:function(){var e=this;this.materialDialog.title="新增物料",this.materialDialog.visible=!0,this.$nextTick((function(){e.$refs.materialForm.resetFields()}))},handleEditMaterial:function(){var e=Object(i.a)(Object(l.a)().mark((function e(t){var a,r,s;return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t&&t._id){e.next=3;break}return this.$message.error("无效的物料数据"),e.abrupt("return");case 3:return e.prev=3,e.next=6,Object(c.b)("processMaterials",{query:{_id:t._id}});case 6:if((a=e.sent).data&&0!==a.data.length){e.next=10;break}return this.$message.error("未找到物料数据"),e.abrupt("return");case 10:return r=a.data[0],this.materialDialog.title="编辑物料",this.materialDialog.visible=!0,this.editingMaterialId=r._id,this.materialForm={materialId:r.materialId,materialCode:r.materialCode,materialName:r.materialName,specification:r.specification,quantity:r.quantity||1,unit:r.unit||"个",scanOperation:Boolean(r.scanOperation),isComponent:Boolean(r.isComponent),isBatch:Boolean(r.isBatch),isKey:Boolean(r.isKey)},e.next=17,Object(c.b)("k3_BD_MATERIAL",{query:{_id:r.materialId}});case 17:(s=e.sent).data&&s.data.length>0&&(this.materialOptions=[s.data[0]]),e.next=25;break;case 21:e.prev=21,e.t0=e.catch(3),console.error("加载物料数据失败:",e.t0),this.$message.error("加载物料数据失败");case 25:case"end":return e.stop()}}),e,this,[[3,21]])})));return function(t){return e.apply(this,arguments)}}(),handleDeleteMaterial:function(e){var t=this;console.log("row",e),e&&e._id?this.$confirm("确认要删除该物料吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(Object(i.a)(Object(l.a)().mark((function a(){return Object(l.a)().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.prev=0,a.next=3,Object(c.c)("processMaterials",{query:{_id:e._id}});case 3:t.$message.success("删除成功"),t.fetchMaterialData(),a.next=11;break;case 7:a.prev=7,a.t0=a.catch(0),console.error("删除失败:",a.t0),t.$message.error("删除失败: "+a.t0.message);case 11:case"end":return a.stop()}}),a,null,[[0,7]])})))):this.$message.error("无效���物料数据")},handleMaterialTableCurrentChange:function(e){this.materialTableData.currentPage=e,this.fetchMaterialData()},handleMaterialTableSizeChange:function(e){this.materialTableData.pageSize=e,this.materialTableData.currentPage=1,this.fetchMaterialData()},submitMaterialForm:function(){var e=this;this.$refs.materialForm.validate(function(){var t=Object(i.a)(Object(l.a)().mark((function t(a){var r,s,i;return Object(l.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(console.log("valid",a),!a){t.next=34;break}if(t.prev=2,r=e.materialTableData.tableList.some((function(t){return t.materialId===e.materialForm.materialId&&t._id!==e.editingMaterialId})),!r){t.next=7;break}return e.$message.warning("该物料已经被选择，请选择其他物料"),t.abrupt("return");case 7:if(e.materialForm.materialId!==e.craftForm.materialId){t.next=11;break}return e.$message.warning("不能选择与工艺相同的物料"),e.materialForm.materialId="",t.abrupt("return");case 11:if(e.materialDialog.loading=!0,s={craftId:e.tempCraftId,processStepId:e.tempProcessId,materialId:e.materialForm.materialId,materialCode:e.materialForm.materialCode,materialName:e.materialForm.materialName,specification:e.materialForm.specification,quantity:e.materialForm.quantity,unit:e.materialForm.unit,scanOperation:e.materialForm.scanOperation,isComponent:e.materialForm.isComponent,isBatch:e.materialForm.isBatch,isKey:e.materialForm.isKey,createBy:e.$store.getters.name},"新增物料"!==e.materialDialog.title){t.next=19;break}return s._id=e.ObjectId(),t.next=17,Object(c.a)("processMaterials",s);case 17:t.next=22;break;case 19:return i={query:{_id:e.editingMaterialId},update:s},t.next=22,Object(c.d)("processMaterials",i);case 22:e.$message.success("操作成功"),e.materialDialog.visible=!1,e.fetchMaterialData(),t.next=31;break;case 27:t.prev=27,t.t0=t.catch(2),console.error("提交失败:",t.t0),e.$message.error("提交失败");case 31:return t.prev=31,e.materialDialog.loading=!1,t.finish(31);case 34:case"end":return t.stop()}}),t,null,[[2,27,31,34]])})));return function(e){return t.apply(this,arguments)}}())},toggleAdvanced:function(){this.showAdvanced=!this.showAdvanced},resetForm:function(){this.searchForm={craftName:"",craftCode:"",dateRange:[],craftType:"",status:"",productName:"",productStage:"",isStandard:"",selectedMaterial:"",materialCode:"",materialName:""},this.$refs.searchForm.resetFields(),this.craftTableData.currentPage=1,this.fetchCraftData()},search:function(){this.craftTableData.currentPage=1,this.fetchCraftData()},searchData:function(){var e={};return this.searchForm.craftName&&(e.craftName={$regex:this.searchForm.craftName,$options:"i"}),this.searchForm.craftCode&&(e.craftCode={$regex:this.searchForm.craftCode,$options:"i"}),this.searchForm.craftType&&(e.craftType=this.searchForm.craftType),this.searchForm.status&&(e.status=this.searchForm.status),this.searchForm.productName&&(e.productName={$regex:this.searchForm.productName,$options:"i"}),this.searchForm.productStage&&(e.productStage=this.searchForm.productStage),""!==this.searchForm.isStandard&&(e.isStandard=this.searchForm.isStandard),this.searchForm.dateRange&&2===this.searchForm.dateRange.length&&(e.createAt={$gte:new Date(this.searchForm.dateRange[0]),$lte:new Date(this.searchForm.dateRange[1]+" 23:59:59")}),this.searchForm.selectedMaterial&&(e.materialId=this.searchForm.selectedMaterial),this.searchForm.materialCode&&(e.materialCode={$regex:this.searchForm.materialCode,$options:"i"}),this.searchForm.materialName&&(e.materialName={$regex:this.searchForm.materialName,$options:"i"}),{query:e}},getStatusType:function(e){return{CREATE:"info",ENABLE:"success",VOID:"danger"}[e]||"info"},getStatusText:function(e){return{CREATE:"创建",ENABLE:"启用",VOID:"作废"}[e]||"未知"},ObjectId:function(){return(Math.floor((new Date).getTime()/1e3).toString(16)+Math.floor(16777216*Math.random()).toString(16).padStart(6,"0")+Math.floor(65536*Math.random()).toString(16).padStart(4,"0")+Math.floor(16777216*Math.random()).toString(16).padStart(6,"0")).substring(0,24)},handleMachineSelect:function(){},getMaterialList:function(){var e=Object(i.a)(Object(l.a)().mark((function e(t){var a,s,i;return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.materialLoading=!0,e.prev=1,a={},""!==t||!this.craftForm.selectedMaterial){e.next=7;break}a={_id:this.craftForm.selectedMaterial},e.next=13;break;case 7:if(""===t){e.next=11;break}a={$or:[{FNumber:{$regex:t,$options:"i"}},{FName:{$regex:t,$options:"i"}}]},e.next=13;break;case 11:return this.materialOptions=[],e.abrupt("return");case 13:return s=[],this.craftForm.materialId&&s.push(this.craftForm.materialId),this.materialTableData.tableList&&this.materialTableData.tableList.length>0&&s.push.apply(s,Object(r.a)(this.materialTableData.tableList.map((function(e){return e.materialId})))),s.length>0&&(a._id={$nin:s}),e.next=19,Object(c.b)("k3_BD_MATERIAL",{query:a,page:1,limit:20});case 19:i=e.sent,this.materialOptions=i.data,e.next=27;break;case 23:e.prev=23,e.t0=e.catch(1),console.error("获取物料列表失败:",e.t0),this.$message.error("获取物料列表失败");case 27:return e.prev=27,this.materialLoading=!1,e.finish(27);case 30:case"end":return e.stop()}}),e,this,[[1,23,27,30]])})));return function(t){return e.apply(this,arguments)}}(),handleCraftMaterialChange:function(e){console.log(e,"material"),e&&(this.craftForm.materialId=e._id,this.craftForm.componentName=e.FName||"",this.craftForm.productName=e.FSpecification||"",this.craftForm.materialCode=e.FNumber||"",this.craftForm.selectedMaterial=e._id)},handleMaterialChange:function(e){var t=this;return console.log("material",e),this.materialTableData.tableList.some((function(a){return a.materialId===e.FMATERIALID&&a._id!==t.editingMaterialId}))?(this.$message.warning("该物料已经被选择，请选择其他物料"),void(this.materialForm.materialId="")):e.FMATERIALID===this.craftForm.materialId?(this.$message.warning("不能选择与工艺相同的物料"),void(this.materialForm.materialId="")):(this.materialForm.materialCode=e.FNumber,this.materialForm.materialName=e.FName,void(this.materialForm.specification=e.FSpecification||""))},handleRemoteSearch:function(e){var t=this;this.searchDebounce&&clearTimeout(this.searchDebounce),this.searchDebounce=setTimeout((function(){t.getMaterialList(e)}),300)},handleSearchMaterialChange:function(e){e&&this.search()},reorderProcessSteps:function(){var e=Object(i.a)(Object(l.a)().mark((function e(){var t,a,r,s=this;return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Object(c.b)("processStep",{query:{craftId:this.tempCraftId},sort:{sort:1}});case 3:if((t=e.sent).data&&0!==t.data.length){e.next=6;break}return e.abrupt("return");case 6:return a=t.data.map((function(e,t){var a=t+1;return e.sort!==a?Object(c.d)("processStep",{query:{_id:e._id},update:{sort:a,updateBy:s.$store.getters.name,updateAt:new Date}}):Promise.resolve()})),e.next=9,Promise.all(a);case 9:return r=t.data.map((function(e){return e._id})),e.next=12,Object(c.d)("craft",{query:{_id:this.tempCraftId},update:{processSteps:r,updateBy:this.$store.getters.name,updateAt:new Date}});case 12:e.next=18;break;case 14:e.prev=14,e.t0=e.catch(0),console.error("重新排序失败:",e.t0),this.$message.warning("工序重新排序失败");case 18:case"end":return e.stop()}}),e,this,[[0,14]])})));return function(){return e.apply(this,arguments)}}(),initSortable:function(){var e=this,t=document.querySelector(".el-table__body-wrapper tbody");t&&p.a.create(t,{handle:"[v-drag-handler]",animation:150,onEnd:function(){var t=Object(i.a)(Object(l.a)().mark((function t(a){var s,i,o,n,p,u;return Object(l.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return s=a.newIndex,i=a.oldIndex,o=Object(r.a)(e.processTableData.tableList),n=o.splice(i,1)[0],o.splice(s,0,n),t.prev=4,p=o.map((function(t,a){var r=a+1;return t.sort!==r?Object(c.d)("processStep",{query:{_id:t._id},update:{sort:r,updateBy:e.$store.getters.name,updateAt:new Date}}):Promise.resolve()})),t.next=8,Promise.all(p);case 8:return u=o.map((function(e){return e._id})),t.next=11,Object(c.d)("craft",{query:{_id:e.tempCraftId},update:{processSteps:u,updateBy:e.$store.getters.name,updateAt:new Date}});case 11:return e.$message.success("排序更新成功"),t.next=14,e.fetchProcessData();case 14:t.next=22;break;case 16:return t.prev=16,t.t0=t.catch(4),console.error("更新排序失败:",t.t0),e.$message.error("更新排序失败"),t.next=22,e.fetchProcessData();case 22:case"end":return t.stop()}}),t,null,[[4,16]])})));return function(e){return t.apply(this,arguments)}}()})},handleMoveUp:function(){var e=Object(i.a)(Object(l.a)().mark((function e(t,a){var r,s,i;return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==a){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,r=this.processTableData.tableList[a],s=this.processTableData.tableList[a-1],i=r.sort,e.next=8,Promise.all([Object(c.d)("processStep",{query:{_id:r._id},update:{sort:s.sort,updateBy:this.$store.getters.name,updateAt:new Date}}),Object(c.d)("processStep",{query:{_id:s._id},update:{sort:i,updateBy:this.$store.getters.name,updateAt:new Date}})]);case 8:return this.$message.success("上移成功"),e.next=11,this.fetchProcessData();case 11:e.next=17;break;case 13:e.prev=13,e.t0=e.catch(2),console.error("上移失败:",e.t0),this.$message.error("上移失败");case 17:case"end":return e.stop()}}),e,this,[[2,13]])})));return function(t,a){return e.apply(this,arguments)}}(),handleMoveDown:function(){var e=Object(i.a)(Object(l.a)().mark((function e(t,a){var r,s,i;return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a!==this.processTableData.tableList.length-1){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,r=this.processTableData.tableList[a],s=this.processTableData.tableList[a+1],i=r.sort,e.next=8,Promise.all([Object(c.d)("processStep",{query:{_id:r._id},update:{sort:s.sort,updateBy:this.$store.getters.name,updateAt:new Date}}),Object(c.d)("processStep",{query:{_id:s._id},update:{sort:i,updateBy:this.$store.getters.name,updateAt:new Date}})]);case 8:return this.$message.success("下移成功"),e.next=11,this.fetchProcessData();case 11:e.next=17;break;case 13:e.prev=13,e.t0=e.catch(2),console.error("下移失败:",e.t0),this.$message.error("下移失败");case 17:case"end":return e.stop()}}),e,this,[[2,13]])})));return function(t,a){return e.apply(this,arguments)}}()},created:function(){this.fetchCraftData()},mounted:function(){this.initSortable()}},m=u,d=(a("f211"),a("2877")),f=Object(d.a)(m,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"app-container"},[a("el-card",{staticClass:"filter-container"},[a("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[a("span",[e._v("筛选搜索")]),e._v(" "),a("el-button",{staticStyle:{float:"right",padding:"3px 0"},attrs:{type:"text"},on:{click:e.toggleAdvanced}},[e._v("\n                "+e._s(e.showAdvanced?"收起":"展开")+"高级搜索\n            ")])],1),e._v(" "),a("el-form",{ref:"searchForm",staticClass:"demo-form-inline",attrs:{model:e.searchForm}},[a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:6}},[a("el-form-item",{attrs:{label:"工艺名称"}},[a("el-input",{attrs:{placeholder:"请输入工艺名称",clearable:""},model:{value:e.searchForm.craftName,callback:function(t){e.$set(e.searchForm,"craftName",t)},expression:"searchForm.craftName"}})],1)],1),e._v(" "),a("el-col",{attrs:{span:6}},[a("el-form-item",{attrs:{label:"工艺编码"}},[a("el-input",{attrs:{placeholder:"请输入工艺编码",clearable:""},model:{value:e.searchForm.craftCode,callback:function(t){e.$set(e.searchForm,"craftCode",t)},expression:"searchForm.craftCode"}})],1)],1),e._v(" "),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"创建日期"}},[a("el-date-picker",{staticStyle:{width:"100%"},attrs:{type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","value-format":"yyyy-MM-dd"},model:{value:e.searchForm.dateRange,callback:function(t){e.$set(e.searchForm,"dateRange",t)},expression:"searchForm.dateRange"}})],1)],1)],1),e._v(" "),a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:4}},[a("el-form-item",{attrs:{label:"工艺类型"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择工艺类型",clearable:""},model:{value:e.searchForm.craftType,callback:function(t){e.$set(e.searchForm,"craftType",t)},expression:"searchForm.craftType"}},e._l(e.dict.type.craftType,(function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)],1),e._v(" "),a("el-col",{attrs:{span:4}},[a("el-form-item",{attrs:{label:"工艺状态"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择工艺状态",clearable:""},model:{value:e.searchForm.status,callback:function(t){e.$set(e.searchForm,"status",t)},expression:"searchForm.status"}},[a("el-option",{attrs:{label:"创建",value:"CREATE"}}),e._v(" "),a("el-option",{attrs:{label:"启用",value:"ENABLE"}}),e._v(" "),a("el-option",{attrs:{label:"作废",value:"VOID"}})],1)],1)],1),e._v(" "),a("el-col",{attrs:{span:4}},[a("el-form-item",{attrs:{label:"生产阶级"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择生产阶级",clearable:""},model:{value:e.searchForm.productStage,callback:function(t){e.$set(e.searchForm,"productStage",t)},expression:"searchForm.productStage"}},[a("el-option",{attrs:{label:"SMT",value:"SMT"}}),e._v(" "),a("el-option",{attrs:{label:"DIP",value:"DIP"}}),e._v(" "),a("el-option",{attrs:{label:"ASSEMPLY",value:"ASSEMPLY"}}),e._v(" "),a("el-option",{attrs:{label:"PACK",value:"PACK"}})],1)],1)],1),e._v(" "),a("el-col",{attrs:{span:4}},[a("el-form-item",{attrs:{label:"是否标准"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择是否标准",clearable:""},model:{value:e.searchForm.isStandard,callback:function(t){e.$set(e.searchForm,"isStandard",t)},expression:"searchForm.isStandard"}},[a("el-option",{attrs:{label:"是",value:!0}}),e._v(" "),a("el-option",{attrs:{label:"否",value:!1}})],1)],1)],1),e._v(" "),a("el-col",{attrs:{span:4}},[a("el-form-item",{attrs:{label:"物料信息"}},[a("zr-select",{staticStyle:{width:"100%"},attrs:{collection:"k3_BD_MATERIAL","search-fields":["FNumber","FName"],"label-key":"FName","sub-key":"FMATERIALID",multiple:!1,placeholder:"请输入物料编码/名称搜索",clearable:""},on:{select:e.handleSearchMaterialChange},scopedSlots:e._u([{key:"option",fn:function(t){var r=t.item;return[a("div",{staticClass:"select-option"},[a("div",{staticClass:"option-main"},[a("span",{staticClass:"option-label"},[e._v(e._s(r.FNumber)+" - "+e._s(r.FName))]),e._v(" "),a("el-tag",{staticClass:"option-tag",attrs:{size:"mini",type:"info"}},[e._v("\n                                            "+e._s(r.FMATERIALID)+" - "+e._s(r.FUseOrgId)+"\n                                        ")])],1),e._v(" "),r.FSpecification?a("div",{staticClass:"option-sub"},[a("small",[e._v("规格: "+e._s(r.FSpecification))])]):e._e()])]}}]),model:{value:e.searchForm.selectedMaterial,callback:function(t){e.$set(e.searchForm,"selectedMaterial",t)},expression:"searchForm.selectedMaterial"}})],1)],1)],1),e._v(" "),a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:e.search}},[e._v("查询搜索")]),e._v(" "),a("el-button",{on:{click:e.resetForm}},[e._v("重置")])],1)],1)],1),e._v(" "),a("div",{staticClass:"screen1"},[a("div",{staticClass:"screen_content_first"},[a("i",{staticClass:"el-icon-tickets"},[e._v("工艺管理列表")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:e.handleAdd}},[e._v("新增工艺")])],1)]),e._v(" "),a("base-table",{ref:"craftTable",attrs:{currentPage:e.craftTableData.currentPage,pageSize:e.craftTableData.pageSize,tableData:e.craftTableData.tableList,tableDataloading:e.craftTableData.listLoading,total:e.craftTableData.total,"cell-style":{textAlign:"center"}},on:{handleCurrentChange:e.handleCraftTableCurrentChange,handleSizeChange:e.handleCraftTableSizeChange}},[a("template",{slot:"law"},[a("el-table-column",{attrs:{label:"工艺名称",prop:"craftName"}}),e._v(" "),a("el-table-column",{attrs:{label:"工艺编码",prop:"craftCode"}}),e._v(" "),a("el-table-column",{attrs:{label:"工艺描述",prop:"craftDesc"}}),e._v(" "),a("el-table-column",{attrs:{label:"工艺类型",prop:"craftType"}}),e._v(" "),a("el-table-column",{attrs:{label:"产品型号",prop:"productName"}}),e._v(" "),a("el-table-column",{attrs:{label:"物料编号",prop:"materialCode"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                    "+e._s(t.row.materialCode||t.row.materialId&&t.row.materialId.FNumber)+"\n                ")]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"创建人",prop:"createBy"}}),e._v(" "),a("el-table-column",{attrs:{label:"创建时间",prop:"createAt"}}),e._v(" "),a("el-table-column",{attrs:{label:"状态"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-tag",{attrs:{type:e.getStatusType(t.row.status)}},[e._v("\n                        "+e._s(e.getStatusText(t.row.status))+"\n                    ")])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"操作",fixed:"right",width:"150"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"text",size:"small"},on:{click:function(a){return e.handleEdit(t.row)}}},[e._v("编辑")]),e._v(" "),a("el-button",{attrs:{type:"text",size:"small"},on:{click:function(a){return e.handleDelete(t.row)}}},[e._v("删除")])]}}])})],1)],2),e._v(" "),e.dialogFormVisible?a("el-dialog",{attrs:{"close-on-click-modal":!1,title:"create"===e.dialogStatus?"新增工艺":"编辑工艺",visible:e.dialogFormVisible,width:"70%"},on:{"update:visible":function(t){e.dialogFormVisible=t}}},[a("el-form",{ref:"craftForm",attrs:{model:e.craftForm,rules:e.rules,"label-width":"100px"}},[a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"生产阶级",prop:"productStage"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择生产阶级"},model:{value:e.craftForm.productStage,callback:function(t){e.$set(e.craftForm,"productStage",t)},expression:"craftForm.productStage"}},[a("el-option",{attrs:{label:"SMT",value:"SMT"}}),e._v(" "),a("el-option",{attrs:{label:"DIP",value:"DIP"}}),e._v(" "),a("el-option",{attrs:{label:"ASSEMPLY",value:"ASSEMPLY"}}),e._v(" "),a("el-option",{attrs:{label:"PACK",value:"PACK"}})],1)],1)],1),e._v(" "),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"工艺类型",prop:"craftType"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择工艺类型",clearable:""},model:{value:e.craftForm.craftType,callback:function(t){e.$set(e.craftForm,"craftType",t)},expression:"craftForm.craftType"}},e._l(e.dict.type.craftType,(function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)],1)],1),e._v(" "),a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"工艺名称",prop:"craftName"}},[a("el-input",{attrs:{placeholder:"请输入工艺名称"},model:{value:e.craftForm.craftName,callback:function(t){e.$set(e.craftForm,"craftName",t)},expression:"craftForm.craftName"}})],1)],1),e._v(" "),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"工艺编码",prop:"craftCode"}},[a("el-input",{attrs:{placeholder:"请输入工艺编码"},model:{value:e.craftForm.craftCode,callback:function(t){e.$set(e.craftForm,"craftCode",t)},expression:"craftForm.craftCode"}})],1)],1)],1),e._v(" "),a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"选择物料",prop:"selectedMaterial"}},[a("zr-select",{attrs:{collection:"k3_BD_MATERIAL","search-fields":["FNumber","FName"],"label-key":"FName","sub-key":"FMATERIALID",multiple:!1,placeholder:"请输入物料编码/名称搜索"},on:{select:e.handleCraftMaterialChange},scopedSlots:e._u([{key:"option",fn:function(t){var r=t.item;return[a("div",{staticClass:"select-option"},[a("div",{staticClass:"option-main"},[a("span",{staticClass:"option-label"},[e._v(e._s(r.FNumber)+" - "+e._s(r.FName))]),e._v(" "),a("el-tag",{staticClass:"option-tag",attrs:{size:"mini",type:"info"}},[e._v("\n                                            "+e._s(r.FMATERIALID)+" - "+e._s(r.FUseOrgId)+"\n                                        ")])],1),e._v(" "),r.FSpecification?a("div",{staticClass:"option-sub"},[a("small",[e._v("规格: "+e._s(r.FSpecification))])]):e._e()])]}}],null,!1,2320740216),model:{value:e.craftForm.selectedMaterial,callback:function(t){e.$set(e.craftForm,"selectedMaterial",t)},expression:"craftForm.selectedMaterial"}})],1)],1),e._v(" "),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"组件名称",prop:"componentName"}},[a("el-input",{attrs:{placeholder:"组件名称",disabled:""},model:{value:e.craftForm.componentName,callback:function(t){e.$set(e.craftForm,"componentName",t)},expression:"craftForm.componentName"}})],1)],1)],1),e._v(" "),a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"工艺描述",prop:"craftDesc"}},[a("el-input",{attrs:{placeholder:"请输入工艺描述"},model:{value:e.craftForm.craftDesc,callback:function(t){e.$set(e.craftForm,"craftDesc",t)},expression:"craftForm.craftDesc"}})],1)],1),e._v(" "),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"产品型号",prop:"productName"}},[a("el-input",{attrs:{placeholder:"产品型号",disabled:""},model:{value:e.craftForm.productName,callback:function(t){e.$set(e.craftForm,"productName",t)},expression:"craftForm.productName"}})],1)],1)],1),e._v(" "),a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"业务类型",prop:"businessType"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择业务类型",clearable:""},model:{value:e.craftForm.businessType,callback:function(t){e.$set(e.craftForm,"businessType",t)},expression:"craftForm.businessType"}},e._l(e.dict.type.businessType,(function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)],1),e._v(" "),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"物料代码",prop:"materialCode"}},[a("el-input",{attrs:{placeholder:"物料代码",disabled:""},model:{value:e.craftForm.materialCode,callback:function(t){e.$set(e.craftForm,"materialCode",t)},expression:"craftForm.materialCode"}})],1)],1)],1)],1),e._v(" "),a("div",{staticClass:"screen1"},[a("div",{staticClass:"screen_content_first"},[a("i",{staticClass:"el-icon-tickets"},[e._v("工序管理列表")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:e.handleAddProcess}},[e._v("新增工序")])],1)]),e._v(" "),a("base-table",{ref:"processTable",attrs:{tableData:e.processTableData.tableList,tableDataloading:e.processTableData.listLoading,height:e.processTableData.height,"cell-style":{textAlign:"center"}}},[a("template",{slot:"law"},[a("el-table-column",{attrs:{width:"50"},scopedSlots:e._u([{key:"default",fn:function(e){return[a("i",{directives:[{name:"drag-handler",rawName:"v-drag-handler"}],staticClass:"el-icon-rank",staticStyle:{cursor:"move"}})]}}],null,!1,2309039297)}),e._v(" "),a("el-table-column",{attrs:{label:"工序编码",prop:"processCode",width:"150",align:"center"}}),e._v(" "),a("el-table-column",{attrs:{label:"工序名称",prop:"processName",align:"center"}}),e._v(" "),a("el-table-column",{attrs:{label:"工序描述",prop:"processDesc",align:"center"}}),e._v(" "),a("el-table-column",{attrs:{label:"工序次序",prop:"sort",width:"150",align:"center"}}),e._v(" "),a("el-table-column",{attrs:{label:"工序类型",prop:"processType",width:"150",align:"center"}}),e._v(" "),a("el-table-column",{attrs:{label:"状态",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-tag",{attrs:{type:e.getStatusType(t.row.status)}},[e._v("\n                            "+e._s(e.getStatusText(t.row.status))+"\n                        ")])]}}],null,!1,2878904077)}),e._v(" "),a("el-table-column",{attrs:{label:"操作",fixed:"right",width:"280"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"text",size:"small",disabled:0===t.$index},on:{click:function(a){return e.handleMoveUp(t.row,t.$index)}}},[e._v("\n                            上移\n                        ")]),e._v(" "),a("el-button",{attrs:{type:"text",size:"small",disabled:t.$index===e.processTableData.tableList.length-1},on:{click:function(a){return e.handleMoveDown(t.row,t.$index)}}},[e._v("\n                            下移\n                        ")]),e._v(" "),a("el-button",{attrs:{type:"text",size:"small"},on:{click:function(a){return e.handleEditProcess(t.row)}}},[e._v("编辑")]),e._v(" "),a("el-button",{attrs:{type:"text",size:"small"},on:{click:function(a){return e.handleDeleteProcess(t.row)}}},[e._v("删除")])]}}],null,!1,2947266505)})],1)],2),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.dialogFormVisible=!1}}},[e._v("取 消")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:e.submitForm}},[e._v("确 定")])],1)],1):e._e(),e._v(" "),a("el-dialog",{attrs:{"close-on-click-modal":!1,title:"add"===e.processOperationType?"新增工序":"编辑工序",visible:e.processDialogVisible,width:"60%","append-to-body":""},on:{"update:visible":function(t){e.processDialogVisible=t}}},[a("el-form",{ref:"processForm",attrs:{model:e.processForm,rules:e.processRules,"label-width":"100px"}},[a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"生产阶级",prop:"processStage"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择生产阶级"},model:{value:e.processForm.processStage,callback:function(t){e.$set(e.processForm,"processStage",t)},expression:"processForm.processStage"}},e._l(e.dict.type.processStage,(function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)],1),e._v(" "),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"工序类型",prop:"processType"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择工序类型"},on:{change:e.handleProcessTypeChange},model:{value:e.processForm.processType,callback:function(t){e.$set(e.processForm,"processType",t)},expression:"processForm.processType"}},e._l(e.dict.type.processType,(function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)],1)],1),e._v(" "),a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"工序名称",prop:"processName"}},[a("el-input",{attrs:{placeholder:"请输入工序名称"},model:{value:e.processForm.processName,callback:function(t){e.$set(e.processForm,"processName",t)},expression:"processForm.processName"}})],1)],1),e._v(" "),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"工序编码",prop:"processCode"}},[a("el-input",{attrs:{placeholder:"请输入工序编码"},model:{value:e.processForm.processCode,callback:function(t){e.$set(e.processForm,"processCode",t)},expression:"processForm.processCode"}})],1)],1)],1),e._v(" "),a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"工序描述",prop:"processDesc"}},[a("el-input",{attrs:{placeholder:"请输入工序描述"},model:{value:e.processForm.processDesc,callback:function(t){e.$set(e.processForm,"processDesc",t)},expression:"processForm.processDesc"}})],1)],1),e._v(" "),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"业务类型",prop:"businessType"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择业务类型",clearable:""},on:{change:e.handleBusinessTypeChange},model:{value:e.processForm.businessType,callback:function(t){e.$set(e.processForm,"businessType",t)},expression:"processForm.businessType"}},e._l(e.dict.type.businessType,(function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)],1)],1),e._v(" "),a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"工序状态",prop:"status"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择工序状态"},model:{value:e.processForm.status,callback:function(t){e.$set(e.processForm,"status",t)},expression:"processForm.status"}},e._l(e.dict.type.processStatus,(function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)],1),e._v(" "),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"工序次序",prop:"sort"}},[a("el-input-number",{staticStyle:{width:"100%"},attrs:{min:1,placeholder:"请输入工序次序"},model:{value:e.processForm.sort,callback:function(t){e.$set(e.processForm,"sort",t)},expression:"processForm.sort"}})],1)],1)],1),e._v(" "),a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"选择设备",prop:"machineId"}},[a("zr-select",{attrs:{collection:"machine","search-fields":["machineCode","machineName"],"label-key":"machineName","sub-key":"machineCode",multiple:!1,placeholder:"请输入设备编号/名称搜索"},on:{select:e.handleMachineSelect},scopedSlots:e._u([{key:"option",fn:function(t){var r=t.item;return[a("div",{staticClass:"item-option"},[a("div",{staticClass:"item-info"},[a("span",{staticClass:"name"},[e._v(e._s(r.machineName))]),e._v(" "),a("el-tag",{attrs:{size:"mini",type:"info"}},[e._v(e._s(r.machineCode||"--"))])],1),e._v(" "),a("div",{staticClass:"sub-info"},[a("small",[e._v(e._s(r.principal))])])])]}}]),model:{value:e.processForm.machineId,callback:function(t){e.$set(e.processForm,"machineId",t)},expression:"processForm.machineId"}})],1)],1)],1)],1),e._v(" "),a("div",{staticClass:"screen1"},[a("div",{staticClass:"screen_content_first"},[a("i",{staticClass:"el-icon-tickets"},[e._v("物料管理列表")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:e.handleAddMaterial}},[e._v("新增物料")])],1)]),e._v(" "),a("base-table",{ref:"materialTable",attrs:{tableData:e.materialTableData.tableList,tableDataloading:e.materialTableData.listLoading,height:e.materialTableData.height,"cell-style":{textAlign:"center"}}},[a("template",{slot:"law"},[a("el-table-column",{attrs:{label:"物料编码",prop:"materialCode"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",{staticStyle:{color:"#ff4949"}},[e._v("*")]),e._v("\n                        "+e._s(t.row.materialCode)+"\n                    ")]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"物料名称",prop:"materialName"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",{staticStyle:{color:"#ff4949"}},[e._v("*")]),e._v("\n                        "+e._s(t.row.materialName)+"\n                    ")]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"规格型号",prop:"specification"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",{staticStyle:{color:"#ff4949"}},[e._v("*")]),e._v("\n                        "+e._s(t.row.specification)+"\n                    ")]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"物料用量",prop:"quantity"}}),e._v(" "),a("el-table-column",{attrs:{label:"单位",prop:"unit"}}),e._v(" "),a("el-table-column",{attrs:{label:"扫码操作",prop:"scanOperation"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-switch",{attrs:{"active-value":!0,"inactive-value":!1,disabled:""},model:{value:t.row.scanOperation,callback:function(a){e.$set(t.row,"scanOperation",a)},expression:"scope.row.scanOperation"}})]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"是否组件",prop:"isComponent"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-switch",{attrs:{"active-value":!0,"inactive-value":!1,disabled:""},model:{value:t.row.isComponent,callback:function(a){e.$set(t.row,"isComponent",a)},expression:"scope.row.isComponent"}})]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"批次物料",prop:"isBatch"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-switch",{attrs:{"active-value":!0,"inactive-value":!1,disabled:""},model:{value:t.row.isBatch,callback:function(a){e.$set(t.row,"isBatch",a)},expression:"scope.row.isBatch"}})]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"关键物料",prop:"isKey"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-switch",{attrs:{"active-value":!0,"inactive-value":!1,disabled:""},model:{value:t.row.isKey,callback:function(a){e.$set(t.row,"isKey",a)},expression:"scope.row.isKey"}})]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"操作",fixed:"right",width:"150"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"text",size:"small"},on:{click:function(a){return e.handleEditMaterial(t.row)}}},[e._v("编辑")]),e._v(" "),a("el-button",{attrs:{type:"text",size:"small"},on:{click:function(a){return e.handleDeleteMaterial(t.row)}}},[e._v("删除")])]}}])})],1)],2),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.processDialogVisible=!1}}},[e._v("取 消")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:e.submitProcessForm}},[e._v("确 定")])],1)],1),e._v(" "),a("el-dialog",{attrs:{"close-on-click-modal":!1,title:e.materialDialog.title,visible:e.materialDialog.visible,"before-close":e.materialDialog.beforeClose,width:"50%","append-to-body":""},on:{"update:visible":function(t){return e.$set(e.materialDialog,"visible",t)}}},[a("el-form",{ref:"materialForm",attrs:{model:e.materialForm,rules:e.materialRules,"label-width":"100px"}},[a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:24}},[a("el-form-item",{attrs:{label:"选择物料",prop:"materialId"}},[a("zr-select",{attrs:{collection:"k3_BD_MATERIAL","search-fields":["FNumber","FName"],"label-key":"FName","sub-key":"FMATERIALID",multiple:!1,placeholder:"请输入物料编码/名称搜索"},on:{select:e.handleMaterialChange},scopedSlots:e._u([{key:"option",fn:function(t){var r=t.item;return[a("div",{staticClass:"select-option"},[a("div",{staticClass:"option-main"},[a("span",{staticClass:"option-label"},[e._v(e._s(r.FNumber)+" - "+e._s(r.FName))]),e._v(" "),a("el-tag",{staticClass:"option-tag",attrs:{size:"mini",type:"info"}},[e._v("\n                                            "+e._s(r.FMATERIALID)+" - "+e._s(r.FUseOrgId)+"\n                                        ")])],1),e._v(" "),r.FSpecification?a("div",{staticClass:"option-sub"},[a("small",[e._v("规格: "+e._s(r.FSpecification))])]):e._e()])]}}]),model:{value:e.materialForm.materialId,callback:function(t){e.$set(e.materialForm,"materialId",t)},expression:"materialForm.materialId"}})],1)],1)],1),e._v(" "),a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"物料编码",prop:"materialCode"}},[a("el-input",{attrs:{disabled:"",placeholder:"请输入物料编码"},model:{value:e.materialForm.materialCode,callback:function(t){e.$set(e.materialForm,"materialCode",t)},expression:"materialForm.materialCode"}})],1)],1),e._v(" "),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"物料名称",prop:"materialName"}},[a("el-input",{attrs:{disabled:"",placeholder:"请输入物料名称"},model:{value:e.materialForm.materialName,callback:function(t){e.$set(e.materialForm,"materialName",t)},expression:"materialForm.materialName"}})],1)],1)],1),e._v(" "),a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"规格型号",prop:"specification"}},[a("el-input",{attrs:{disabled:"",placeholder:"请输入规格型号"},model:{value:e.materialForm.specification,callback:function(t){e.$set(e.materialForm,"specification",t)},expression:"materialForm.specification"}})],1)],1),e._v(" "),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"物料用量",prop:"quantity"}},[a("el-input-number",{staticStyle:{width:"100%"},attrs:{min:0,precision:2,step:1},model:{value:e.materialForm.quantity,callback:function(t){e.$set(e.materialForm,"quantity",t)},expression:"materialForm.quantity"}})],1)],1)],1),e._v(" "),a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"单位"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择单位"},model:{value:e.materialForm.unit,callback:function(t){e.$set(e.materialForm,"unit",t)},expression:"materialForm.unit"}},[a("el-option",{attrs:{label:"个",value:"个"}}),e._v(" "),a("el-option",{attrs:{label:"件",value:"件"}}),e._v(" "),a("el-option",{attrs:{label:"套",value:"套"}}),e._v(" "),a("el-option",{attrs:{label:"米",value:"米"}}),e._v(" "),a("el-option",{attrs:{label:"千克",value:"千克"}})],1)],1)],1),e._v(" "),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"扫码操作"}},[a("el-switch",{attrs:{"active-value":!0,"inactive-value":!1},model:{value:e.materialForm.scanOperation,callback:function(t){e.$set(e.materialForm,"scanOperation",t)},expression:"materialForm.scanOperation"}})],1)],1)],1),e._v(" "),a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"是否组件"}},[a("el-switch",{model:{value:e.materialForm.isComponent,callback:function(t){e.$set(e.materialForm,"isComponent",t)},expression:"materialForm.isComponent"}})],1)],1),e._v(" "),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"批次物料"}},[a("el-switch",{model:{value:e.materialForm.isBatch,callback:function(t){e.$set(e.materialForm,"isBatch",t)},expression:"materialForm.isBatch"}})],1)],1),e._v(" "),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"关键物料"}},[a("el-switch",{model:{value:e.materialForm.isKey,callback:function(t){e.$set(e.materialForm,"isKey",t)},expression:"materialForm.isKey"}})],1)],1)],1)],1),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.materialDialog.visible=!1}}},[e._v("取 消")]),e._v(" "),a("el-button",{attrs:{type:"primary",loading:e.materialDialog.loading},on:{click:e.submitMaterialForm}},[e._v("确 定")])],1)],1)],1)}),[],!1,null,"e0b23b18",null);t.default=f.exports},f211:function(e,t,a){"use strict";a("46e0")}}]);