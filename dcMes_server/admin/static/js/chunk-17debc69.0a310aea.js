(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-17debc69","chunk-2616ba89","chunk-ce46be46"],{"1fef":function(e,t,a){},"4e86":function(e,t,a){"use strict";a.r(t);var r={name:"MaterialFlowChart",components:{FlowNode:a("af3b").default},props:{visible:{type:Boolean,default:!1},loading:{type:Boolean,default:!1},flowData:{type:Array,default:function(){return[]}}},computed:{dialogVisible:{get:function(){return this.visible},set:function(e){this.$emit("update:visible",e)}}}},s=r,n=(a("9775"),a("2877")),c=Object(n.a)(s,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{staticClass:"flow-chart-dialog",attrs:{title:"物料工艺流程图",visible:e.dialogVisible,width:"95%","append-to-body":!1,"modal-append-to-body":!1,"custom-class":"material-flow-dialog"},on:{"update:visible":function(t){e.dialogVisible=t}}},[a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"flow-container"},[e.flowData&&0!==e.flowData.length?[a("flow-node",{attrs:{node:e.flowData[0]}})]:a("div",{staticClass:"empty-data"},[e._v("\n            暂无流程图数据\n        ")])],2)])}),[],!1,null,null,null);t.default=c.exports},"75e4":function(e,t,a){},"7a56a":function(e,t,a){"use strict";a("1fef")},9775:function(e,t,a){"use strict";a("75e4")},af3b:function(e,t,a){"use strict";a.r(t);var r={name:"FlowNode",props:{node:{type:Object,required:!0}}},s=(a("7a56a"),a("2877")),n=Object(s.a)(r,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"flow-level"},[a("div",{staticClass:"node-container"},[a("div",{staticClass:"material-node",class:{"root-node":!e.node.materialQuantity}},[a("div",{staticClass:"node-title"},[e._v(e._s(e.node.materialName))]),e._v(" "),e.node.craftName?a("div",{staticClass:"node-subtitle"},[e._v("\n                工艺："+e._s(e.node.craftName)+"\n            ")]):e._e(),e._v(" "),e.node.materialCode?a("div",{staticClass:"node-info"},[e._v("\n                编码："+e._s(e.node.materialCode)+"\n            ")]):e._e(),e._v(" "),e.node.scanOperation?a("div",{staticClass:"node-info"},[e._v("\n                扫码操作："+e._s(e.node.scanOperation?"需要扫码":"不需要扫码")+"\n            ")]):e._e(),e._v(" "),e.node.isComponent?a("div",{staticClass:"node-info"},[e._v("\n                是否组件："+e._s(e.node.isComponent?"是":"否")+"\n            ")]):e._e(),e._v(" "),e.node.materialQuantity?a("div",{staticClass:"node-info"},[e._v("\n                用量："+e._s(e.node.materialQuantity)+e._s(e.node.unit||"个")+"\n            ")]):e._e()])]),e._v(" "),e.node.children&&e.node.children.length?[e._m(0),e._v(" "),a("div",{staticClass:"process-level"},e._l(e.node.children,(function(t){return a("div",{key:t._id,staticClass:"process-container"},[a("div",{staticClass:"process-node"},[a("div",{staticClass:"node-title"},[e._v(e._s(t.sort)+"."+e._s(t.processName))]),e._v(" "),a("div",{staticClass:"node-content"},[t.children&&t.children.length?e._l(t.children,(function(e){return a("div",{key:e._id,staticClass:"sub-material"},[a("flow-node",{attrs:{node:e}})],1)})):a("div",{staticClass:"no-materials"},[e._v("\n                            暂无关联物料\n                        ")])],2)])])})),0)]:e._e()],2)}),[function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"arrow-container"},[t("div",{staticClass:"arrow-right"})])}],!1,null,"d061e8cc",null);t.default=n.exports},c0dd:function(e,t,a){},e3d2:function(e,t,a){"use strict";a("c0dd")},e9f7:function(e,t,a){"use strict";a.r(t);var r=(a("55dd"),a("5df3"),a("4f7f"),a("7f7f"),a("5530")),s=(a("6b54"),a("a481"),a("f576"),a("8615"),a("6762"),a("2fdb"),a("456d"),a("c7eb")),n=(a("96cf"),a("1da1")),c=a("ade3"),i=a("3835"),o=(a("ffc1"),a("ac6a"),a("7e1e")),l=a("b810"),u={name:"MaterialManagement",dicts:["product_type"],components:{MaterialFlowChart:a("4e86").default},data:function(){return{searchForm:{FNumber:"",FName:"",FSpecification:"",FDocumentStatus:"",FForbidStatus:"",FOldNumber:"",FBaseUnitId_FNumber:"",FStockId_FNumber:"",F_TFQJ_CheckBox:"",FNameEn:"",FCreateOrgId:"",FUseOrgId:""},tableList:[],total:0,currentPage:1,pageSize:10,listLoading:!0,showAdvanced:!1,dialogFormVisible:!1,dialogStatus:"",detailDialogVisible:!1,selection:[],dataForm:{FNumber:"",FName:"",FSpecification:"",FDocumentStatus:"",FForbidStatus:"",FOldNumber:"",FBaseUnitId_FNumber:"",FBaseUnitId_FName:"",FStockId_FNumber:"",FStockId_FName:"",F_TFQJ_CheckBox:"",FNameEn:"",FCreateOrgId:"",FUseOrgId:"",FDescription:"",FMnemonicCode:"",FMaterialGroup:"",FCreatorId:"",FCreateDate:null,FModifierId:"",FModifyDate:null,diNum:""},DINum:"",rules:{FName:[{required:!0,message:"请输入物料名称",trigger:"blur"}],FBaseUnitId_FNumber:[{required:!0,message:"请选择基本单位",trigger:"change"}],FStockId_FNumber:[{required:!0,message:"请选择仓库",trigger:"change"}],FCreateOrgId:[{required:!0,message:"请选择创建组织",trigger:"change"}],FUseOrgId:[{required:!0,message:"请选择使用组织",trigger:"change"}],diNum:[{max:100,message:"DI码长度不能超过100个字符",trigger:"blur"}]},flowChartDialogVisible:!1,flowChartLoading:!1,flowChartData:[],defaultProps:{children:"children",label:"label"},processedFlowChartData:[],productDiNumId:null,syncProgressTimer:null}},methods:{getStatusType:function(e){return{DRAFT:"info",APPROVED:"success",PROCESSING:"warning"}[e]||"info"},getStatusText:function(e){return{DRAFT:"草稿",APPROVED:"已审核",PROCESSING:"审核中"}[e]||e},searchData:function(){var e={query:{$and:[]}};return Object.entries(this.searchForm).forEach((function(t){var a=Object(i.a)(t,2),r=a[0],s=a[1];if(s)switch(r){case"FNumber":case"FName":case"FSpecification":case"FOldNumber":case"FNameEn":e.query.$and.push(Object(c.a)({},r,{$regex:s,$options:"i"}));break;case"FDocumentStatus":case"FForbidStatus":case"FBaseUnitId_FNumber":case"FStockId_FNumber":case"F_TFQJ_CheckBox":case"FBOMCATEGORY":case"FBOMUSE":case"FITEMPPROPERTY":e.query.$and.push(Object(c.a)({},r,s))}})),e.query.$and.length||delete e.query.$and,e},resetForm:function(){this.$refs.searchForm.resetFields(),this.searchForm={FNumber:"",FName:"",FSpecification:"",FDocumentStatus:"",FForbidStatus:"",FOldNumber:"",FBaseUnitId_FNumber:"",FStockId_FNumber:"",F_TFQJ_CheckBox:"",FNameEn:"",FCreateOrgId:"",FUseOrgId:"",FBOMCATEGORY:"",FBOMUSE:"",FITEMPPROPERTY:""},this.showAdvanced=!1,this.currentPage=1,this.pageSize=10,this.fetchData(),this.$message.success("重置成功")},fetchData:function(){var e=Object(n.a)(Object(s.a)().mark((function e(){var t,a;return Object(s.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.listLoading=!0,e.prev=1,(t=this.searchData()).page=this.currentPage,t.skip=(this.currentPage-1)*this.pageSize,t.limit=this.pageSize,t.count=!0,t.sort={FNumber:1},e.next=10,Object(o.b)("k3_BD_MATERIAL",t);case 10:200===(a=e.sent).code?(this.tableList=a.data,this.total=a.countnum):this.$message.error(a.msg||"获取数据失败"),e.next=18;break;case 14:e.prev=14,e.t0=e.catch(1),this.$message.error("获取数据失败: "+e.t0.message);case 18:return e.prev=18,this.listLoading=!1,e.finish(18);case 21:case"end":return e.stop()}}),e,this,[[1,14,18,21]])})));return function(){return e.apply(this,arguments)}}(),exportData:function(){var e=Object(n.a)(Object(s.a)().mark((function e(){var t,a,r,n,c,i,l,u,d=this;return Object(s.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,this.$message({message:"正在导出数据,请稍候...",type:"info"}),t=this.$loading({lock:!0,text:"导出中...",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"}),(a=this.searchData()).limit=1e6,e.next=7,Object(o.b)("k3_PRD_MO",a);case 7:if((r=e.sent).data&&0!==r.data.length){e.next=12;break}return this.$message.warning("没有数据可供导出"),t.close(),e.abrupt("return");case 12:n={FNumber:"物料编码",FName:"物料名称",FSpecification:"规格型号",FDocumentStatus:"数据状态",FBOMCATEGORY:"BOM分类",FBOMUSE:"BOM用途",FITEMPPROPERTY:"物料属性",FForbidStatus:"禁用状态"},c=r.data.map((function(e){var t={};return Object.keys(n).forEach((function(a){a.includes("Date")?t[n[a]]=d.formatDate(e[a]):t[n[a]]=e[a]})),t})),i=XLSX.utils.book_new(),l=XLSX.utils.json_to_sheet(c),u=Object.values(n).map((function(e){return{wch:Math.max(2*e.length,15)}})),l["!cols"]=u,XLSX.utils.book_append_sheet(i,l,"物料管理数据"),XLSX.writeFile(i,"物料管理数据.xlsx"),t.close(),this.$message.success("导出成功"),e.next=28;break;case 24:e.prev=24,e.t0=e.catch(0),this.$message.error("导出失败");case 28:case"end":return e.stop()}}),e,this,[[0,24]])})));return function(){return e.apply(this,arguments)}}(),baseTableHandleCurrentChange:function(e){this.currentPage=e,this.fetchData()},baseTableHandleSizeChange:function(e){this.pageSize=e,this.fetchData()},toggleAdvanced:function(){this.showAdvanced=!this.showAdvanced},formatDate:function(e){if(!e)return"暂无数据";var t=new Date(e);if(isNaN(t.getTime()))return"无效日期";var a=t.getFullYear(),r=String(t.getMonth()+1).padStart(2,"0"),s=String(t.getDate()).padStart(2,"0");return"".concat(a,"-").concat(r,"-").concat(s)},formatNumber:function(e){return e||0===e?e.toString().replace(/\B(?=(\d{3})+(?!\d))/g,","):"0"},search:function(){var e=this;this.$refs.searchForm.validate((function(t){if(!t)return e.$message.warning("请检查输入项是否正确"),!1;e.currentPage=1,e.fetchData()}))},handleSelectionChange:function(e){this.selection=e},handleView:function(){var e=Object(n.a)(Object(s.a)().mark((function e(t){return Object(s.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.dataForm=JSON.parse(JSON.stringify(t)),e.next=3,this.fetchDiNum(t._id);case 3:this.dialogStatus="view",this.dialogFormVisible=!0;case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),handleEdit:function(){var e=Object(n.a)(Object(s.a)().mark((function e(t){return Object(s.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.dataForm=JSON.parse(JSON.stringify(t)),e.next=3,this.fetchDiNum(t._id);case 3:this.dialogStatus="edit",this.dialogFormVisible=!0;case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),handleDelete:function(e){var t=this;this.$confirm("确认要删除该物料吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(Object(n.a)(Object(s.a)().mark((function a(){return Object(s.a)().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.prev=0,a.next=3,Object(o.c)("k3_PRD_MO",e._id);case 3:t.$message.success("删除成功"),t.fetchData(),a.next=11;break;case 7:a.prev=7,a.t0=a.catch(0),t.$message.error("删除失败");case 11:case"end":return a.stop()}}),a,null,[[0,7]])})))).catch((function(){t.$message.info("已取消删除")}))},submitForm:function(){var e=Object(n.a)(Object(s.a)().mark((function e(){var t=this;return Object(s.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.$refs.dataForm.validate(function(){var e=Object(n.a)(Object(s.a)().mark((function e(a){var n;return Object(s.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!a){e.next=20;break}if(e.prev=1,n={productId:t.dataForm._id,diNum:t.DINum,updateBy:t.$store.state.user.id},!t.productDiNumId){e.next=8;break}return e.next=6,Object(o.d)("productDiNum",{query:{_id:t.productDiNumId},update:n});case 6:e.next=11;break;case 8:if(!t.DINum){e.next=11;break}return e.next=11,Object(o.a)("productDiNum",Object(r.a)(Object(r.a)({},n),{},{createBy:t.$store.state.user.id}));case 11:t.$message.success("edit"===t.dialogStatus?"更新成功":"添加成功"),t.dialogFormVisible=!1,t.fetchData(),e.next=20;break;case 16:e.prev=16,e.t0=e.catch(1),t.$message.error("保存失败");case 20:case"end":return e.stop()}}),e,null,[[1,16]])})));return function(t){return e.apply(this,arguments)}}());case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),handleToggleStatus:function(){var e=Object(n.a)(Object(s.a)().mark((function e(t){var a;return Object(s.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.$confirm("确认要".concat("DISABLE"===t.FForbidStatus?"启用":"禁用","该物料吗？"),"提示",{type:"warning"});case 3:return a="DISABLE"===t.FForbidStatus?"ENABLE":"DISABLE",e.next=6,Object(o.d)("BD_MATERIAL",t._id,Object(r.a)(Object(r.a)({},t),{},{FForbidStatus:a,FForbidderId:this.$store.state.user.name,FForbidDate:new Date}));case 6:this.$message.success("".concat("DISABLE"===a?"禁用":"启用","成功")),this.fetchData(),e.next=14;break;case 10:e.prev=10,e.t0=e.catch(0),this.$message.error("操作失败");case 14:case"end":return e.stop()}}),e,this,[[0,10]])})));return function(t){return e.apply(this,arguments)}}(),handleViewFlowChart:function(){var e=Object(n.a)(Object(s.a)().mark((function e(t){var a,r;return Object(s.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.flowChartLoading=!0,e.prev=1,e.next=5,this.getCraftByMaterialId(t._id);case 5:if(a=e.sent){e.next=10;break}return this.$message.info("该物料未关联工艺，无流程图"),e.abrupt("return");case 10:if(a.processSteps&&0!==a.processSteps.length){e.next=13;break}return this.$message.info("该物料工艺下无工序，无流程图"),e.abrupt("return");case 13:return this.flowChartDialogVisible=!0,e.next=16,this.buildFlowChartData(t._id,new Set);case 16:r=e.sent,this.processedFlowChartData=[r],e.next=26;break;case 22:e.prev=22,e.t0=e.catch(1),this.$message.error("获取流程图数据失败");case 26:return e.prev=26,this.flowChartLoading=!1,e.finish(26);case 29:case"end":return e.stop()}}),e,this,[[1,22,26,29]])})));return function(t){return e.apply(this,arguments)}}(),buildFlowChartData:function(){var e=Object(n.a)(Object(s.a)().mark((function e(t){var a,r,c,i,o,l=this,u=arguments;return Object(s.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(a=u.length>1&&void 0!==u[1]?u[1]:new Set).has(t)){e.next=3;break}return e.abrupt("return",null);case 3:return a.add(t),e.prev=4,e.next=7,this.getMaterialById(t);case 7:if(r=e.sent){e.next=10;break}return e.abrupt("return",null);case 10:return c={_id:t,label:r.FName,materialName:r.FName,materialCode:r.FNumber,children:[]},e.next=13,this.getCraftByMaterialId(t);case 13:if(i=e.sent){e.next=16;break}return e.abrupt("return",c);case 16:if(c.craftName=i.craftName,!(i.processSteps&&i.processSteps.length>0)){e.next=22;break}return e.next=20,Promise.all(i.processSteps.map(function(){var e=Object(n.a)(Object(s.a)().mark((function e(t){var r,c,i;return Object(s.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,l.getProcessStepById(t);case 2:if(r=e.sent){e.next=5;break}return e.abrupt("return",null);case 5:if(c={_id:t,label:r.processName,sort:r.sort,processName:r.processName,children:[]},!(r.materials&&r.materials.length>0)){e.next=11;break}return e.next=9,Promise.all(r.materials.map(function(){var e=Object(n.a)(Object(s.a)().mark((function e(t){var r,n;return Object(s.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,l.getProcessMaterialById(t);case 2:if(r=e.sent){e.next=5;break}return e.abrupt("return",null);case 5:return e.next=7,l.buildFlowChartData(r.materialId,a);case 7:return(n=e.sent)&&(n.materialRelationType=r.relationType,n.isComponent=r.isComponent,n.scanOperation=r.scanOperation,n.materialQuantity=r.quantity),e.abrupt("return",n);case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 9:i=e.sent,c.children=i.filter(Boolean);case 11:return e.abrupt("return",c);case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 20:o=e.sent,c.children=o.filter(Boolean);case 22:return e.abrupt("return",c);case 25:return e.prev=25,e.t0=e.catch(4),this.$message.error("构建流程图数据失败"),e.abrupt("return",null);case 30:case"end":return e.stop()}}),e,this,[[4,25]])})));return function(t){return e.apply(this,arguments)}}(),getMaterialById:function(){var e=Object(n.a)(Object(s.a)().mark((function e(t){var a;return Object(s.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(o.b)("k3_BD_MATERIAL",{query:{_id:t}});case 2:return a=e.sent,e.abrupt("return",a.data[0]);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),getCraftByMaterialId:function(){var e=Object(n.a)(Object(s.a)().mark((function e(t){var a;return Object(s.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(o.b)("craft",{query:{materialId:t}});case 2:return a=e.sent,e.abrupt("return",a.data[0]);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),getProcessStepById:function(){var e=Object(n.a)(Object(s.a)().mark((function e(t){var a;return Object(s.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(o.b)("processStep",{query:{_id:t},sort:{sort:1}});case 2:return a=e.sent,e.abrupt("return",a.data[0]);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),getProcessMaterialById:function(){var e=Object(n.a)(Object(s.a)().mark((function e(t){var a;return Object(s.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(o.b)("processMaterials",{query:{_id:t}});case 2:return a=e.sent,e.abrupt("return",a.data[0]);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),processFlowChartData:function(e){var t=[],a=function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;e&&0!==e.length&&(t[r]||(t[r]=[]),e.forEach((function(e){var s={_id:e._id,label:e.label,craftName:e.craftName||"",processName:e.processName||"",materialName:e.materialName||"",materialRelationType:e.materialRelationType||"",materialQuantity:e.materialQuantity||"",children:e.children||[]};t[r].push(s),s.children&&s.children.length>0&&a(s.children,r+1)})))};return a(e),t},getProcessMaterialByMaterialId:function(){var e=Object(n.a)(Object(s.a)().mark((function e(t){var a;return Object(s.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(o.b)("processMaterials",{query:{materialId:t}});case 2:return a=e.sent,e.abrupt("return",a.data[0]);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),fetchDiNum:function(){var e=Object(n.a)(Object(s.a)().mark((function e(t){var a;return Object(s.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Object(o.b)("productDiNum",{query:{productId:t}});case 3:(a=e.sent).data&&a.data.length>0?(this.DINum=a.data[0].diNum,this.productDiNumId=a.data[0]._id):(this.DINum="",this.productDiNumId=null),e.next=11;break;case 7:e.prev=7,e.t0=e.catch(0),this.$message.error("获取DI码信息失败");case 11:case"end":return e.stop()}}),e,this,[[0,7]])})));return function(t){return e.apply(this,arguments)}}(),handleSync:function(){var e=Object(n.a)(Object(s.a)().mark((function e(){var t,a;return Object(s.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.$confirm("确认要同步物料数据吗？此操作可能需要一些时间","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});case 3:return t=this.$loading({lock:!0,text:"正在启动同步任务...",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"}),e.prev=4,e.next=7,Object(l.c)();case 7:200===(a=e.sent).code?(t.close(),a.taskStatus?(this.startSyncProgressCheck(),this.$message.success("同步中：当前".concat(a.taskStatus.processedRecords,"条数据同步完成，耗时").concat(a.taskStatus.elapsedTime,"秒"))):this.$message.success("同步任务已启动")):(t.close(),this.$message.error(a.message||"物料同步失败")),e.next=16;break;case 11:e.prev=11,e.t0=e.catch(4),t.close(),this.$message.error("物料同步失败: "+e.t0.message);case 16:e.next=22;break;case 18:e.prev=18,e.t1=e.catch(0),this.$message.error("操作失败");case 22:case"end":return e.stop()}}),e,this,[[0,18],[4,11]])})));return function(){return e.apply(this,arguments)}}(),startSyncProgressCheck:function(){var e=this;this.syncProgressTimer&&clearInterval(this.syncProgressTimer),this.syncProgressTimer=setInterval(Object(n.a)(Object(s.a)().mark((function t(){var a,r;return Object(s.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,Object(l.a)("k3_BD_MATERIAL");case 3:if(200!==(a=t.sent).code){t.next=23;break}if(!(r=a.taskStatus)){t.next=21;break}t.t0=r.status,t.next="running"===t.t0?11:"no_task"===t.t0?13:17;break;case 11:return e.$notify({type:"info",message:"同步中：当前".concat(r.processedRecords,"条数据同步完成，耗时").concat(r.elapsedTime,"秒"),duration:5e3}),t.abrupt("break",19);case 13:return e.$message.success("同步完成！"),e.stopSyncProgressCheck(),e.fetchData(),t.abrupt("break",19);case 17:e.$message.warning("未知的同步状态"),e.stopSyncProgressCheck();case 19:t.next=23;break;case 21:e.$message.warning("未找到物料同步任务"),e.stopSyncProgressCheck();case 23:t.next=30;break;case 25:t.prev=25,t.t1=t.catch(0),e.$message.error("查询同步进度失败"),e.stopSyncProgressCheck();case 30:case"end":return t.stop()}}),t,null,[[0,25]])}))),1e4)},stopSyncProgressCheck:function(){this.syncProgressTimer&&(clearInterval(this.syncProgressTimer),this.syncProgressTimer=null)},beforeDestroy:function(){this.stopSyncProgressCheck()}},created:function(){this.fetchData()}},d=u,m=(a("e3d2"),a("2877")),p=Object(m.a)(d,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"app-container"},[a("el-card",{staticClass:"filter-container"},[a("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[a("span",[e._v("筛选搜索")]),e._v(" "),a("el-button",{staticStyle:{float:"right",padding:"3px 0"},attrs:{type:"text"},on:{click:e.toggleAdvanced}},[e._v("\n                "+e._s(e.showAdvanced?"收起":"展开")+"高级搜索\n            ")])],1),e._v(" "),a("el-form",{ref:"searchForm",staticClass:"demo-form-inline",attrs:{model:e.searchForm}},[a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:6}},[a("el-form-item",{attrs:{label:"物料编码"}},[a("el-input",{attrs:{placeholder:"请输入物料编码",clearable:""},model:{value:e.searchForm.FNumber,callback:function(t){e.$set(e.searchForm,"FNumber",t)},expression:"searchForm.FNumber"}})],1)],1),e._v(" "),a("el-col",{attrs:{span:6}},[a("el-form-item",{attrs:{label:"物料名称"}},[a("el-input",{attrs:{placeholder:"请输入物料名称",clearable:""},model:{value:e.searchForm.FName,callback:function(t){e.$set(e.searchForm,"FName",t)},expression:"searchForm.FName"}})],1)],1),e._v(" "),a("el-col",{attrs:{span:6}},[a("el-form-item",{attrs:{label:"规格型号"}},[a("el-input",{attrs:{placeholder:"请输入规格型号",clearable:""},model:{value:e.searchForm.FSpecification,callback:function(t){e.$set(e.searchForm,"FSpecification",t)},expression:"searchForm.FSpecification"}})],1)],1),e._v(" "),a("el-col",{attrs:{span:6}},[a("el-form-item",{attrs:{label:"数据状态"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择数据状态",clearable:""},model:{value:e.searchForm.FDocumentStatus,callback:function(t){e.$set(e.searchForm,"FDocumentStatus",t)},expression:"searchForm.FDocumentStatus"}},[a("el-option",{attrs:{label:"草稿",value:"DRAFT"}}),e._v(" "),a("el-option",{attrs:{label:"已审核",value:"APPROVED"}}),e._v(" "),a("el-option",{attrs:{label:"审核中",value:"PROCESSING"}})],1)],1)],1)],1),e._v(" "),a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:6}},[a("el-form-item",{attrs:{label:"旧物料编码"}},[a("el-input",{attrs:{placeholder:"请输入旧物料编码",clearable:""},model:{value:e.searchForm.FOldNumber,callback:function(t){e.$set(e.searchForm,"FOldNumber",t)},expression:"searchForm.FOldNumber"}})],1)],1),e._v(" "),a("el-col",{attrs:{span:6}},[a("el-form-item",{attrs:{label:"基本单位"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择基本单位",clearable:""},model:{value:e.searchForm.FBaseUnitId_FNumber,callback:function(t){e.$set(e.searchForm,"FBaseUnitId_FNumber",t)},expression:"searchForm.FBaseUnitId_FNumber"}})],1)],1),e._v(" "),a("el-col",{attrs:{span:6}},[a("el-form-item",{attrs:{label:"仓库"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择仓库",clearable:""},model:{value:e.searchForm.FStockId_FNumber,callback:function(t){e.$set(e.searchForm,"FStockId_FNumber",t)},expression:"searchForm.FStockId_FNumber"}})],1)],1),e._v(" "),a("el-col",{attrs:{span:6}},[a("el-form-item",{attrs:{label:"是否长新物料"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择",clearable:""},model:{value:e.searchForm.F_TFQJ_CheckBox,callback:function(t){e.$set(e.searchForm,"F_TFQJ_CheckBox",t)},expression:"searchForm.F_TFQJ_CheckBox"}},[a("el-option",{attrs:{label:"是",value:"1"}}),e._v(" "),a("el-option",{attrs:{label:"否",value:"0"}})],1)],1)],1)],1),e._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:e.showAdvanced,expression:"showAdvanced"}]},[a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:6}},[a("el-form-item",{attrs:{label:"BOM分类"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择BOM分类",clearable:""},model:{value:e.searchForm.FBOMCATEGORY,callback:function(t){e.$set(e.searchForm,"FBOMCATEGORY",t)},expression:"searchForm.FBOMCATEGORY"}},[a("el-option",{attrs:{label:"标准BOM",value:"STANDARD"}}),e._v(" "),a("el-option",{attrs:{label:"工程BOM",value:"ENGINEERING"}})],1)],1)],1),e._v(" "),a("el-col",{attrs:{span:6}},[a("el-form-item",{attrs:{label:"BOM用途"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择BOM用途",clearable:""},model:{value:e.searchForm.FBOMUSE,callback:function(t){e.$set(e.searchForm,"FBOMUSE",t)},expression:"searchForm.FBOMUSE"}},[a("el-option",{attrs:{label:"生产用",value:"PRODUCTION"}}),e._v(" "),a("el-option",{attrs:{label:"设计用",value:"DESIGN"}})],1)],1)],1),e._v(" "),a("el-col",{attrs:{span:6}},[a("el-form-item",{attrs:{label:"物料属性"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择物料属性",clearable:""},model:{value:e.searchForm.FITEMPPROPERTY,callback:function(t){e.$set(e.searchForm,"FITEMPPROPERTY",t)},expression:"searchForm.FITEMPPROPERTY"}},[a("el-option",{attrs:{label:"外购",value:"PURCHASE"}}),e._v(" "),a("el-option",{attrs:{label:"自制",value:"SELF_MADE"}}),e._v(" "),a("el-option",{attrs:{label:"委外",value:"OUTSOURCE"}})],1)],1)],1),e._v(" "),a("el-col",{attrs:{span:6}},[a("el-form-item",{attrs:{label:"禁用状态"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择禁用状态",clearable:""},model:{value:e.searchForm.FForbidStatus,callback:function(t){e.$set(e.searchForm,"FForbidStatus",t)},expression:"searchForm.FForbidStatus"}},[a("el-option",{attrs:{label:"启用",value:"ENABLE"}}),e._v(" "),a("el-option",{attrs:{label:"禁用",value:"DISABLE"}})],1)],1)],1)],1)],1),e._v(" "),a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:e.search}},[e._v("查询搜索")]),e._v(" "),a("el-button",{on:{click:e.resetForm}},[e._v("重置")]),e._v(" "),a("el-button",{attrs:{type:"success"},on:{click:e.exportData}},[e._v("导出数据")]),e._v(" "),a("el-button",{attrs:{type:"warning"},on:{click:e.handleSync}},[e._v("同步物料")])],1)],1)],1),e._v(" "),e._m(0),e._v(" "),a("base-table",{ref:"baseTable",attrs:{currentPage:e.currentPage,"highlight-current-row":!0,pageSize:e.pageSize,tableData:e.tableList,tableDataloading:e.listLoading,total:e.total,"cell-style":{textAlign:"center"}},on:{"selection-change":e.handleSelectionChange,handleCurrentChange:e.baseTableHandleCurrentChange,handleSizeChange:e.baseTableHandleSizeChange}},[a("template",{slot:"law"},[a("el-table-column",{attrs:{label:"使用组织",prop:"FUseOrgId",width:"150"}}),e._v(" "),a("el-table-column",{attrs:{label:"物料编码",prop:"FNumber",width:"120"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-link",{attrs:{type:"primary"},on:{click:function(a){return e.handleView(t.row)}}},[e._v(e._s(t.row.FNumber))])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"物料名称",prop:"FName"}}),e._v(" "),a("el-table-column",{attrs:{label:"规格型号",prop:"FSpecification",width:"120"}}),e._v(" "),a("el-table-column",{attrs:{label:"基本单位",prop:"FBaseUnitId_FName",width:"100"}}),e._v(" "),a("el-table-column",{attrs:{label:"仓库",prop:"FStockId_FName",width:"120"}}),e._v(" "),a("el-table-column",{attrs:{label:"英文名称",prop:"FNameEn",width:"150"}}),e._v(" "),a("el-table-column",{attrs:{label:"数据状态",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-tag",{attrs:{type:e.getStatusType(t.row.FDocumentStatus)}},[e._v("\n                        "+e._s(e.getStatusText(t.row.FDocumentStatus))+"\n                    ")])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"禁用状态",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-tag",{attrs:{type:"DISABLE"===t.row.FForbidStatus?"danger":"success"}},[e._v("\n                        "+e._s("DISABLE"===t.row.FForbidStatus?"禁用":"启用")+"\n                    ")])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"操作",fixed:"right",width:"150"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"text",size:"small"},on:{click:function(a){return e.handleViewFlowChart(t.row)}}},[e._v("查看流程图")]),e._v(" "),a("el-button",{attrs:{type:"text",size:"small"},on:{click:function(a){return e.handleEdit(t.row)}}},[e._v("DI码管理")])]}}])})],1)],2),e._v(" "),a("el-dialog",{attrs:{title:"create"===e.dialogStatus?"新增物料":"编辑物料",visible:e.dialogFormVisible,width:"60%"},on:{"update:visible":function(t){e.dialogFormVisible=t}}},[a("el-form",{ref:"dataForm",attrs:{model:e.dataForm,rules:e.rules,"label-width":"100px"}},[a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"物料编码",prop:"FNumber"}},[a("el-input",{attrs:{readonly:"",disabled:"view"===e.dialogStatus,placeholder:"请输入物料编码"},model:{value:e.dataForm.FNumber,callback:function(t){e.$set(e.dataForm,"FNumber",t)},expression:"dataForm.FNumber"}})],1)],1),e._v(" "),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"物料名称",prop:"FName"}},[a("el-input",{attrs:{readonly:"",disabled:"view"===e.dialogStatus,placeholder:"请输入物料名称"},model:{value:e.dataForm.FName,callback:function(t){e.$set(e.dataForm,"FName",t)},expression:"dataForm.FName"}})],1)],1)],1),e._v(" "),a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"DI码",prop:"diNum"}},[a("el-input",{attrs:{placeholder:"请输入DI码",clearable:""},model:{value:e.DINum,callback:function(t){e.DINum=t},expression:"DINum"}})],1)],1)],1)],1),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.dialogFormVisible=!1}}},[e._v("取 消")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:e.submitForm}},[e._v("确 定")])],1)],1),e._v(" "),a("material-flow-chart",{attrs:{visible:e.flowChartDialogVisible,loading:e.flowChartLoading,"flow-data":e.processedFlowChartData},on:{"update:visible":function(t){e.flowChartDialogVisible=t}}})],1)}),[function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"screen1"},[a("div",{staticClass:"screen_content"},[a("div",{staticClass:"screen_content_first"},[a("i",{staticClass:"el-icon-tickets"},[e._v("物料管理列表")])])])])}],!1,null,"f62f48a2",null);t.default=p.exports}}]);