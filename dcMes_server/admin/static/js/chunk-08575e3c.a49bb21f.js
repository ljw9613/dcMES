(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-08575e3c"],{"33f6":function(e,t,a){"use strict";a("ae21")},ae21:function(e,t,a){},de6b:function(e,t,a){e.exports=a.p+"static/media/smcg.fe637541.mp3"},f783:function(e,t,a){"use strict";a.r(t);var r=(a("8615"),a("7514"),a("28a5"),a("1c4c"),a("b85c")),s=(a("ac6a"),a("5df3"),a("4f7f"),a("c7eb")),n=(a("96cf"),a("1da1")),i=a("7e1e"),c=a("b775");function o(e){return Object(c.a)({url:"/create-flow",method:"post",data:e})}function u(e){return Object(c.a)({url:"/scan-components",method:"post",data:e})}var l=a("6ace");function d(e){new Audio(e).play().catch((function(e){}))}var p=a("de6b"),m=a.n(p),h={name:"ScanBarCode",components:{ZrSelect:l.a},data:function(){return{formData:{productModel:"",productLine:"",processStep:"",componentName:""},productOptions:[],processStepOptions:[],materialOptions:[],materialLoading:!1,mainMaterialName:"",mainMaterialCode:"",processMaterials:[],scanForm:{mainBarcode:"",barcodes:{}},productLineOptions:[{_id:"1",FNumber:"1",FName:"产线1"},{_id:"2",FNumber:"2",FName:"产线2"}],validateStatus:{mainBarcode:!1},loading:!1,unifiedScanInput:""}},computed:{mainMaterialId:{get:function(){return localStorage.getItem("mainMaterialId")||""},set:function(e){localStorage.setItem("mainMaterialId",e)}},processStepId:{get:function(){return localStorage.getItem("processStepId")||""},set:function(e){localStorage.setItem("processStepId",e)}},materialName:{get:function(){return localStorage.getItem("materialName")||""},set:function(e){localStorage.setItem("materialName",e)}},processName:{get:function(){return localStorage.getItem("processName")||""},set:function(e){localStorage.setItem("processName",e)}},productLineId:{get:function(){return localStorage.getItem("productLineId")||""},set:function(e){localStorage.setItem("productLineId",e)}},productLineName:{get:function(){return localStorage.getItem("productLineName")||""},set:function(e){localStorage.setItem("productLineName",e)}}},watch:{mainMaterialId:function(){var e=Object(n.a)(Object(s.a)().mark((function e(t){return Object(s.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t){e.next=5;break}return e.next=3,this.getMainMaterialInfo();case 3:e.next=6;break;case 5:this.mainMaterialName="";case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),processStepId:function(){var e=Object(n.a)(Object(s.a)().mark((function e(t){return Object(s.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t){e.next=5;break}return e.next=3,this.getProcessMaterials();case 3:e.next=8;break;case 5:this.processMaterials=[],this.scanForm.barcodes={},this.validateStatus={mainBarcode:!1};case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),validateStatus:{handler:function(e){},deep:!0}},methods:{handleProductionLineSelect:function(e){e&&(this.formData.lineName=e.lineName,this.productLineId=e._id,this.productLineName=e.lineName)},getMaterialById:function(){var e=Object(n.a)(Object(s.a)().mark((function e(t){var a;return Object(s.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(i.b)("k3_BD_MATERIAL",{query:{_id:t}});case 2:return a=e.sent,e.abrupt("return",a.data[0]);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),getCraftByMaterialId:function(){var e=Object(n.a)(Object(s.a)().mark((function e(t){var a;return Object(s.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(i.b)("craft",{query:{materialId:t}});case 2:return a=e.sent,e.abrupt("return",a.data[0]);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),getProcessStepById:function(){var e=Object(n.a)(Object(s.a)().mark((function e(t){var a;return Object(s.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(i.b)("processStep",{query:{_id:t}});case 2:return a=e.sent,e.abrupt("return",a.data[0]);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),getProcessMaterialById:function(){var e=Object(n.a)(Object(s.a)().mark((function e(t){var a;return Object(s.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(i.b)("processMaterials",{query:{_id:t}});case 2:return a=e.sent,e.abrupt("return",a.data[0]);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),getMaterialList:function(){var e=Object(n.a)(Object(s.a)().mark((function e(t){var a;return Object(s.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(""===t){e.next=18;break}return this.materialLoading=!0,e.prev=2,e.next=5,Object(i.b)("k3_BD_MATERIAL",{query:{$or:[{FNumber:{$regex:t,$options:"i"}},{FName:{$regex:t,$options:"i"}}]},page:1,limit:20});case 5:a=e.sent,this.productOptions=a.data,e.next=13;break;case 9:e.prev=9,e.t0=e.catch(2),this.$message.error("获取产品型号失败");case 13:return e.prev=13,this.materialLoading=!1,e.finish(13);case 16:e.next=19;break;case 18:this.productOptions=[];case 19:case"end":return e.stop()}}),e,this,[[2,9,13,16]])})));return function(t){return e.apply(this,arguments)}}(),getAllProcessSteps:function(){var e=Object(n.a)(Object(s.a)().mark((function e(t){var a,n,c,o,u,l,d,p,m,h,f=arguments;return Object(s.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=f.length>1&&void 0!==f[1]?f[1]:new Set,e.prev=1,e.next=4,this.getCraftByMaterialId(t);case 4:if((n=e.sent)&&n.processSteps){e.next=7;break}return e.abrupt("return",a);case 7:c=Object(r.a)(n.processSteps),e.prev=8,c.s();case 10:if((o=c.n()).done){e.next=40;break}return u=o.value,e.next=14,this.getProcessStepById(u);case 14:if(!(l=e.sent)){e.next=38;break}return a.add(l),e.next=19,Object(i.b)("processMaterials",{query:{processStepId:u}});case 19:if(!(d=e.sent).data){e.next=38;break}p=Object(r.a)(d.data),e.prev=22,p.s();case 24:if((m=p.n()).done){e.next=30;break}return h=m.value,e.next=28,this.getAllProcessSteps(h.materialId,a);case 28:e.next=24;break;case 30:e.next=35;break;case 32:e.prev=32,e.t0=e.catch(22),p.e(e.t0);case 35:return e.prev=35,p.f(),e.finish(35);case 38:e.next=10;break;case 40:e.next=45;break;case 42:e.prev=42,e.t1=e.catch(8),c.e(e.t1);case 45:return e.prev=45,c.f(),e.finish(45);case 48:return e.abrupt("return",a);case 51:return e.prev=51,e.t2=e.catch(1),e.abrupt("return",a);case 55:case"end":return e.stop()}}),e,this,[[1,51],[8,42,45,48],[22,32,35,38]])})));return function(t){return e.apply(this,arguments)}}(),handleProductChange:function(){var e=Object(n.a)(Object(s.a)().mark((function e(t){var a;return Object(s.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.processStepOptions=[],this.formData.processStep="",this.mainMaterialId="",t){e.next=5;break}return e.abrupt("return");case 5:return e.prev=5,e.next=8,this.getAllProcessSteps(t);case 8:a=e.sent,this.processStepOptions=Array.from(a),this.mainMaterialId=t,e.next=17;break;case 13:e.prev=13,e.t0=e.catch(5),this.$message.error("获取工序列表失败");case 17:case"end":return e.stop()}}),e,this,[[5,13]])})));return function(t){return e.apply(this,arguments)}}(),handleProcessChange:function(e){this.processStepId=e||""},handleSave:function(){var e=Object(n.a)(Object(s.a)().mark((function e(){var t,a,r;return Object(s.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.formData.productModel&&this.formData.processStep&&this.formData.productLine){e.next=3;break}return this.$message.warning("请选择产品型号、工序和产线"),e.abrupt("return");case 3:return t=this.$loading({lock:!0,text:"保存中...",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"}),e.prev=4,this.resetScanForm(),this.mainMaterialId=this.formData.productModel,this.processStepId=this.formData.processStep,this.productLineId=this.formData.productLine,e.next=11,this.getMaterialById(this.formData.productModel);case 11:return(a=e.sent)&&(this.materialName="".concat(a.FNumber," - ").concat(a.FName)),e.next=15,this.getProcessStepById(this.formData.processStep);case 15:(r=e.sent)&&(this.processName=r.processName),this.$message.success("保存成功"),setTimeout((function(){t.close(),window.location.reload()}),500),e.next=26;break;case 21:e.prev=21,e.t0=e.catch(4),this.$message.error("保存失败"),t.close();case 26:case"end":return e.stop()}}),e,this,[[4,21]])})));return function(){return e.apply(this,arguments)}}(),getMainMaterialInfo:function(){var e=Object(n.a)(Object(s.a)().mark((function e(){var t;return Object(s.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=4,Object(i.b)("k3_BD_MATERIAL",{query:{_id:this.mainMaterialId},page:1,limit:1});case 4:(t=e.sent).data&&t.data[0]?(this.mainMaterialName=t.data[0].FName,this.mainMaterialCode=t.data[0].FNumber):(this.mainMaterialName="",this.mainMaterialCode=""),e.next=14;break;case 8:e.prev=8,e.t0=e.catch(0),this.$message.error("获取主物料信息失败"),this.mainMaterialName="",this.mainMaterialCode="";case 14:case"end":return e.stop()}}),e,this,[[0,8]])})));return function(){return e.apply(this,arguments)}}(),getProcessMaterials:function(){var e=Object(n.a)(Object(s.a)().mark((function e(){var t,a,r,n,c,o,u,l=this;return Object(s.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=4,Object(i.b)("processStep",{query:{_id:this.processStepId},page:1,limit:1});case 4:if((t=e.sent).data&&0!==!t.data.length){e.next=7;break}throw new Error("未找到工序信息");case 7:return a=t.data[0],e.next=10,Object(i.b)("craft",{query:{processSteps:this.processStepId},page:1,limit:1});case 10:if((r=e.sent).data&&0!==!r.data.length){e.next=13;break}throw new Error("未找到工艺信息");case 13:return n=r.data[0],e.next=16,this.getMaterialById(n.materialId);case 16:if(c=e.sent){e.next=19;break}throw new Error("未找到物料信息");case 19:if(this.mainMaterialName=c.FName,this.mainMaterialCode=c.FNumber,!(a.materials&&a.materials.length>0)){e.next=32;break}return o=a.materials.map((function(e){return Object(i.b)("processMaterials",{query:{_id:e},page:1,limit:1})})),e.next=25,Promise.all(o);case 25:u=e.sent,this.processMaterials=u.map((function(e){return e.data[0]})).filter((function(e){return e})),this.validateStatus={mainBarcode:!1},this.scanForm.barcodes={},this.processMaterials.forEach((function(e){l.validateStatus[e._id]=!1,l.$set(l.scanForm.barcodes,e._id,"")})),e.next=35;break;case 32:this.processMaterials=[],this.validateStatus={mainBarcode:!1},this.scanForm.barcodes={};case 35:e.next=44;break;case 37:e.prev=37,e.t0=e.catch(0),this.$message.error(e.t0.message||"获取工序物料失败"),this.processMaterials=[],this.validateStatus={mainBarcode:!1},this.scanForm.barcodes={};case 44:case"end":return e.stop()}}),e,this,[[0,37]])})));return function(){return e.apply(this,arguments)}}(),validateDICode:function(){var e=Object(n.a)(Object(s.a)().mark((function e(t){var a;return Object(s.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Object(i.b)("productDiNum",{query:{diNum:t},populate:JSON.stringify([{path:"productId",model:"k3_BD_MATERIAL"}])});case 3:if(0!==(a=e.sent).data.length){e.next=7;break}return this.$message.error("该DI编码不存在本系统"),e.abrupt("return",{isValid:!1});case 7:return e.abrupt("return",{isValid:!0,materialCode:a.data[0].productId.FNumber});case 10:return e.prev=10,e.t0=e.catch(0),this.$message.error("DI码验证失败"),e.abrupt("return",{isValid:!1});case 15:case"end":return e.stop()}}),e,this,[[0,10]])})));return function(t){return e.apply(this,arguments)}}(),validateBarcode:function(){var e=Object(n.a)(Object(s.a)().mark((function e(t){var a,r,n,i,c,o,u,l,d,p,m,h;return Object(s.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return",!1);case 2:e.t0=t.length,e.next=47===e.t0?5:34===e.t0?13:48===e.t0?21:32===e.t0?29:20===e.t0?37:45;break;case 5:return r=t.substring(4,18),e.next=8,this.validateDICode(r);case 8:if((n=e.sent).isValid){e.next=11;break}return e.abrupt("return",!1);case 11:return a=n.materialCode,e.abrupt("break",50);case 13:return i=t.substring(7,19),e.next=16,this.validateDICode(i);case 16:if((c=e.sent).isValid){e.next=19;break}return e.abrupt("return",!1);case 19:return a=c.materialCode,e.abrupt("break",50);case 21:return o=t.substring(0,5),e.next=24,this.validateDICode(o);case 24:if((u=e.sent).isValid){e.next=27;break}return e.abrupt("return",!1);case 27:return a=u.materialCode,e.abrupt("break",50);case 29:return l=t.substring(0,8),e.next=32,this.validateDICode(l);case 32:if((d=e.sent).isValid){e.next=35;break}return e.abrupt("return",!1);case 35:return a=d.materialCode,e.abrupt("break",50);case 37:return p=t.substring(0,11),e.next=40,this.validateDICode(p);case 40:if((m=e.sent).isValid){e.next=43;break}return e.abrupt("return",!1);case 43:return a=m.materialCode,e.abrupt("break",50);case 45:if(/^[A-Za-z0-9]+-[0-9]+$/.test(t)){e.next=49;break}return this.$message.error("条码格式不正确，应为：物料编号-序号"),e.abrupt("return",!1);case 49:a=t.split("-")[0];case 50:if(a!==this.mainMaterialCode){e.next=52;break}return e.abrupt("return",{materialCode:a,isValid:!0});case 52:if(h=this.processMaterials.find((function(e){return e.materialCode===a})),!h){e.next=55;break}return e.abrupt("return",{materialCode:a,isValid:!0});case 55:return this.$message.error("该条码对应的物料与当前工序所需物料不匹配"),e.abrupt("return",{materialCode:a,isValid:!1});case 57:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),handleMainBarcode:function(){var e=Object(n.a)(Object(s.a)().mark((function e(t){var a,r,n;return Object(s.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Object(i.b)("material_process_flow",{query:{barcode:t}});case 3:if(!((a=e.sent).data&&a.data.length>0)){e.next=9;break}a.data[0],this.$message.success("扫描成功"),e.next=18;break;case 9:return r=this.mainMaterialCode,e.next=12,o({materialCode:r,barcode:t});case 12:if(200!==(n=e.sent).code){e.next=17;break}this.$message.success("成品条码追溯记录创建成功"),e.next=18;break;case 17:throw new Error(n.msg||"创建成品条码追溯记录失败");case 18:e.next=24;break;case 20:throw e.prev=20,e.t0=e.catch(0),e.t0;case 24:case"end":return e.stop()}}),e,this,[[0,20]])})));return function(t){return e.apply(this,arguments)}}(),handleSubBarcode:function(){var e=Object(n.a)(Object(s.a)().mark((function e(t,a){var r;return Object(s.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,r=this.processMaterials.find((function(e){return e._id===t})),r){e.next=4;break}throw new Error("未找到对应的物料信息");case 4:if(r.materialCode===a){e.next=6;break}throw new Error("物料编码不一致");case 6:this.validateStatus[t]=!0,this.$message.success("扫码成功"),e.next=14;break;case 10:throw e.prev=10,e.t0=e.catch(0),e.t0;case 14:case"end":return e.stop()}}),e,this,[[0,10]])})));return function(t,a){return e.apply(this,arguments)}}(),fillFormData:function(){var e=Object(n.a)(Object(s.a)().mark((function e(){return Object(s.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.mainMaterialId&&this.materialName&&(this.formData.productModel=this.materialName),this.processStepId&&this.processName&&(this.formData.processStep=this.processName),this.productLineId&&(this.formData.productLine=this.productLineId);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),handleCancelSave:function(){var e=Object(n.a)(Object(s.a)().mark((function e(){var t;return Object(s.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.$confirm("确认取消当前工序设置？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});case 3:t=this.$loading({lock:!0,text:"取消设置中...",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"}),localStorage.removeItem("mainMaterialId"),localStorage.removeItem("processStepId"),localStorage.removeItem("materialName"),localStorage.removeItem("processName"),localStorage.removeItem("productLineId"),localStorage.removeItem("productLineName"),this.formData={productModel:"",productLine:"",processStep:"",componentName:""},this.$message.success("已取消工序设置"),setTimeout((function(){t.close(),window.location.reload()}),500),e.next=18;break;case 15:e.prev=15,e.t0=e.catch(0),"cancel"!==e.t0&&this.$message.error("取消设置失败");case 18:case"end":return e.stop()}}),e,this,[[0,15]])})));return function(){return e.apply(this,arguments)}}(),getValidateIcon:function(e){return this.validateStatus[e]?"el-icon-check success-icon":"el-icon-close error-icon"},resetScanForm:function(){var e=this;this.scanForm.mainBarcode="";var t={};this.processMaterials.forEach((function(a){a.isBatch&&e.scanForm.barcodes[a._id]?(t[a._id]=e.scanForm.barcodes[a._id],e.$set(e.validateStatus,a._id,!0)):(t[a._id]="",e.$set(e.validateStatus,a._id,!1))})),this.scanForm.barcodes=t,this.$set(this.validateStatus,"mainBarcode",!1),this.currentFlowId=null},handleConfirm:function(){var e=Object(n.a)(Object(s.a)().mark((function e(){var t,a,r,n,c,o=this;return Object(s.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,t=Object.values(this.validateStatus).every((function(e){return!0===e})),t){e.next=5;break}return this.$message.warning("请完成所有条码扫描"),e.abrupt("return");case 5:return e.next=7,Object(i.b)("material_process_flow",{query:{barcode:this.scanForm.mainBarcode}});case 7:if((a=e.sent).data&&0!==!a.data.length){e.next=10;break}throw new Error("未找到对应的工艺流程记录");case 10:return r=[],this.processMaterials.forEach((function(e){r.push({materialId:e.materialId,barcode:o.scanForm.barcodes[e._id]})})),n={mainBarcode:this.scanForm.mainBarcode,processStepId:this.processStepId,componentScans:r,userId:this.$store.getters.id},e.next=17,u(n);case 17:if(200===(c=e.sent).code){e.next=20;break}throw new Error(c.message||"扫码失败");case 20:d(m.a),this.resetScanForm(),e.next=28;break;case 24:e.prev=24,e.t0=e.catch(0),this.$message.error("确认失败: "+e.t0.message);case 28:case"end":return e.stop()}}),e,this,[[0,24]])})));return function(){return e.apply(this,arguments)}}(),handleUnifiedScan:function(){var e=Object(n.a)(Object(s.a)().mark((function e(t){var a,n,i,c,o,u,l;return Object(s.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,e.next=5,this.validateBarcode(t);case 5:if((a=e.sent).isValid){e.next=10;break}return this.unifiedScanInput="",this.$refs.scanInput.focus(),e.abrupt("return");case 10:if(n=a.materialCode,i=!1,n!==this.mainMaterialCode){e.next=19;break}return this.scanForm.mainBarcode=t,e.next=16,this.handleMainBarcode(t);case 16:this.validateStatus.mainBarcode=!0,this.$message.success("主物料扫描成功"),i=!0;case 19:if(i){e.next=42;break}c=Object(r.a)(this.processMaterials),e.prev=21,c.s();case 23:if((o=c.n()).done){e.next=34;break}if((u=o.value).materialCode!==n){e.next=32;break}return this.$set(this.scanForm.barcodes,u._id,t),e.next=29,this.handleSubBarcode(u._id,n);case 29:return this.$message.success("".concat(u.materialName," 扫描成功")),i=!0,e.abrupt("break",34);case 32:e.next=23;break;case 34:e.next=39;break;case 36:e.prev=36,e.t0=e.catch(21),c.e(e.t0);case 39:return e.prev=39,c.f(),e.finish(39);case 42:i||this.$message.warning("未找到匹配的物料"),l=Object.values(this.validateStatus).every((function(e){return!0===e})),l&&(this.$notify({title:"扫描完成",message:"正在发起确认提交",type:"success",duration:3e3,position:"top-right"}),this.handleConfirm()),e.next=51;break;case 47:e.prev=47,e.t1=e.catch(2),this.$message.error(e.t1.message||"扫描处理失败");case 51:return e.prev=51,this.unifiedScanInput="",this.$refs.scanInput.focus(),e.finish(51);case 55:case"end":return e.stop()}}),e,this,[[2,47,51,55],[21,36,39,42]])})));return function(t){return e.apply(this,arguments)}}(),focusInput:function(){this.$refs.scanInput.focus()}},created:function(){var e=Object(n.a)(Object(s.a)().mark((function e(){return Object(s.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.mainMaterialId){e.next=3;break}return e.next=3,this.getMainMaterialInfo();case 3:if(!this.processStepId){e.next=6;break}return e.next=6,this.getProcessMaterials();case 6:return e.next=8,this.fillFormData();case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),mounted:function(){this.$refs.scanInput.focus()}},f=h,b=(a("33f6"),a("2877")),v=Object(b.a)(f,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"scan-container"},[a("div",{staticClass:"left-form"},[a("el-card",{staticClass:"init-card"},[a("div",{staticClass:"card-header"},[a("i",{staticClass:"el-icon-setting"}),e._v(" "),a("span",[e._v("工序初始化设置")])]),e._v(" "),a("el-form",{attrs:{model:e.formData,"label-width":"100px"}},[a("div",{staticClass:"form-section"},[a("div",{staticClass:"section-header"},[a("i",{staticClass:"el-icon-goods"}),e._v(" "),a("span",[e._v("基础信息")])]),e._v(" "),a("el-form-item",{attrs:{label:"产品型号"}},[a("el-select",{staticClass:"custom-select",attrs:{placeholder:"请选择产品型号",filterable:"",remote:"","remote-method":e.getMaterialList,loading:e.materialLoading,disabled:!!e.mainMaterialId&&!!e.processStepId},on:{change:e.handleProductChange},model:{value:e.formData.productModel,callback:function(t){e.$set(e.formData,"productModel",t)},expression:"formData.productModel"}},e._l(e.productOptions,(function(t){return a("el-option",{key:t._id,attrs:{label:t.FNumber+" - "+t.FName,value:t._id}},[a("div",{staticClass:"option-content"},[a("span",{staticClass:"option-main"},[e._v(e._s(t.FNumber)+" - "+e._s(t.FName))]),e._v(" "),a("span",{staticClass:"option-sub"},[e._v(e._s(t.FSpecification||"无规格"))])])])})),1)],1),e._v(" "),a("el-form-item",{attrs:{label:"产品工序"}},[a("el-select",{staticClass:"custom-select",attrs:{placeholder:"请选择产品工序",disabled:!!e.mainMaterialId&&!!e.processStepId},on:{change:e.handleProcessChange},model:{value:e.formData.processStep,callback:function(t){e.$set(e.formData,"processStep",t)},expression:"formData.processStep"}},e._l(e.processStepOptions,(function(t){return a("el-option",{key:t._id,attrs:{label:t.processName,value:t._id}},[a("div",{staticClass:"option-content"},[a("span",{staticClass:"option-main"},[e._v(e._s(t.sort+"."+t.processName))]),e._v(" "),a("span",{staticClass:"option-sub"},[e._v(e._s(t.processCode))])])])})),1)],1),e._v(" "),a("el-form-item",{attrs:{label:"产线编码"}},[a("zr-select",{attrs:{disabled:!!e.mainMaterialId&&!!e.processStepId,collection:"production_line","search-fields":["lineCode","lineName"],"label-key":"lineName","tag-key":"lineCode","sub-key":"workshop",multiple:!1,placeholder:"请输入产线信息搜索"},on:{select:e.handleProductionLineSelect},model:{value:e.formData.productLine,callback:function(t){e.$set(e.formData,"productLine",t)},expression:"formData.productLine"}})],1)],1),e._v(" "),a("div",{staticClass:"button-group"},[e.mainMaterialId&&e.processStepId?a("el-button",{attrs:{type:"danger",icon:"el-icon-close"},on:{click:e.handleCancelSave}},[e._v("\n                        取消设置\n                    ")]):a("el-button",{attrs:{type:"primary",icon:"el-icon-check"},on:{click:e.handleSave}},[e._v("\n                        保存设置\n                    ")])],1)])],1)],1),e._v(" "),a("div",{staticClass:"right-content"},[e.mainMaterialId&&e.processStepId?[a("el-card",{staticClass:"scan-card"},[a("div",{staticClass:"card-header"},[a("i",{staticClass:"el-icon-scan"}),e._v(" "),a("span",[e._v("条码扫描")])]),e._v(" "),a("el-form",{ref:"scanForm",attrs:{model:e.scanForm,"label-width":"100%"}},[a("div",{staticClass:"section-header"},[a("i",{staticClass:"el-icon-camera"}),e._v(" "),a("span",[e._v("统一扫描区域")])]),e._v(" "),a("div",{staticClass:"scan-input-section"},[a("el-input",{ref:"scanInput",attrs:{placeholder:"请扫描条码",clearable:""},on:{input:e.handleUnifiedScan,clear:e.focusInput},model:{value:e.unifiedScanInput,callback:function(t){e.unifiedScanInput=t},expression:"unifiedScanInput"}})],1),e._v(" "),a("div",{staticClass:"section-header"},[a("i",{staticClass:"el-icon-goods"}),e._v(" "),a("span",[e._v("主物料")])]),e._v(" "),a("div",{staticClass:"material-section"},[a("el-form-item",{staticClass:"vertical-form-item",attrs:{label:"编号："+e.mainMaterialCode+"  名称："+e.mainMaterialName,"label-width":"100%"}},[a("div",{staticClass:"input-with-status"},[a("el-input",{class:{"valid-input":e.validateStatus.mainBarcode},attrs:{placeholder:"请扫描主物料条码",readonly:""},model:{value:e.scanForm.mainBarcode,callback:function(t){e.$set(e.scanForm,"mainBarcode",t)},expression:"scanForm.mainBarcode"}},[a("template",{slot:"prefix"},[a("i",{staticClass:"el-icon-full-screen"})])],2),e._v(" "),a("div",{staticClass:"status-indicator",class:{valid:e.validateStatus.mainBarcode}},[a("i",{class:e.getValidateIcon("mainBarcode")})])],1)])],1),e._v(" "),a("div",{staticClass:"section-header"},[a("i",{staticClass:"el-icon-box"}),e._v(" "),a("span",[e._v("子物料")])]),e._v(" "),a("div",{staticClass:"material-section"},e._l(e.processMaterials,(function(t){return a("el-form-item",{key:t._id,staticClass:"vertical-form-item",attrs:{label:"编号："+t.materialCode+"  名称："+t.materialName+"  "}},[a("div",{staticClass:"input-with-status"},[a("el-input",{class:{"valid-input":e.validateStatus[t._id]},attrs:{placeholder:"请扫描子物料条码",readonly:""},model:{value:e.scanForm.barcodes[t._id],callback:function(a){e.$set(e.scanForm.barcodes,t._id,a)},expression:"scanForm.barcodes[material._id]"}},[a("template",{slot:"prefix"},[a("i",{staticClass:"el-icon-full-screen"})]),e._v(" "),t.isBatch?a("template",{slot:"suffix"},[a("el-tag",{attrs:{type:"warning"}},[e._v("批次物料")])],1):e._e()],2),e._v(" "),a("div",{staticClass:"status-indicator",class:{valid:e.validateStatus[t._id]}},[a("i",{class:e.getValidateIcon(t._id)})])],1)])})),1),e._v(" "),a("div",{staticClass:"button-group"},[a("el-button",{attrs:{plain:"",icon:"el-icon-refresh"},on:{click:e.resetScanForm}},[e._v("重置")]),e._v(" "),a("el-button",{attrs:{type:"primary",icon:"el-icon-check"},on:{click:e.handleConfirm}},[e._v("确认")])],1)])],1)]:[e._m(0)]],2)])}),[function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"init-tip"},[a("div",{staticClass:"overlay"},[a("i",{staticClass:"el-icon-warning-outline pulse"}),e._v(" "),a("p",[e._v("请先初始化工序设置")])])])}],!1,null,"4183e47a",null);t.default=v.exports}}]);