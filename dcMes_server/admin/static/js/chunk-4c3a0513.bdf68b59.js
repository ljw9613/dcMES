(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-4c3a0513"],{"6c29b":function(t,e,a){"use strict";a.r(e);var s=a("c7eb"),n=(a("96cf"),a("1da1")),r=a("5530"),i=a("c466"),o=a("7e1e"),l={dicts:["expert_platform","task_type","content_type"],components:{TagInput:a("b5c9").a},name:"TaskResultDialog",props:{visible:{type:Boolean,default:!1},currentClaim:{type:Object,default:function(){return{}}},taskInfo:{type:Object,default:function(){return{}}}},data:function(){return{resultForm:{contentList:[],totalPerformance:{totalViews:0,totalLikes:0,totalComments:0,totalShares:0,totalGmv:0}},resultRules:{contentList:{type:"array",required:!0,message:"请至少添加一个内容",trigger:"change"}},productOptions:[{value:"产品1",label:"产品1"},{value:"产品2",label:"产品2"}]}},computed:{dialogVisible:{get:function(){return this.visible},set:function(t){this.$emit("update:visible",t)}},getTotalViews:function(){return this.resultForm.contentList.reduce((function(t,e){return t+(e.performanceData&&e.performanceData.views||0)}),0)},getTotalLikes:function(){return this.resultForm.contentList.reduce((function(t,e){return t+(e.performanceData&&e.performanceData.likes||0)}),0)},getTotalComments:function(){return this.resultForm.contentList.reduce((function(t,e){return t+(e.performanceData&&e.performanceData.comments||0)}),0)},getTotalShares:function(){return this.resultForm.contentList.reduce((function(t,e){return t+(e.performanceData&&e.performanceData.shares||0)}),0)},getTotalVideoGmv:function(){return this.resultForm.contentList.reduce((function(t,e){return t+(e.performanceData&&e.performanceData.videoGmv||0)}),0)},getTotalLiveGmv:function(){return this.resultForm.contentList.reduce((function(t,e){return t+(e.performanceData&&e.performanceData.liveGmv||0)}),0)}},watch:{visible:function(t){t&&this.initForm()}},methods:{formatNumber:i.b,initForm:function(){this.resultForm={contentList:[],totalPerformance:{totalViews:0,totalLikes:0,totalComments:0,totalShares:0,totalGmv:0}},this.currentClaim.result&&this.currentClaim.result.contentList&&(this.resultForm.contentList=this.currentClaim.result.contentList.map((function(t){return Object(r.a)(Object(r.a)({},t),{},{performanceData:Object(r.a)({views:0,likes:0,comments:0,shares:0,liveGmv:0,videoGmv:0,gmv:0},t.performanceData)})})))},addContent:function(){this.resultForm.contentList.push({platform:"",type:"",link:"",videoCode:"",adCode:"",products:[],publishTime:null,performanceData:{views:0,likes:0,comments:0,shares:0,liveGmv:0,videoGmv:0,gmv:0}})},removeContent:function(t){var e=this;this.$confirm("确定要删除该内容吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){e.resultForm.contentList.splice(t,1)})).catch((function(){}))},handleCancel:function(){this.dialogVisible=!1},handleSubmit:function(){var t=Object(n.a)(Object(s.a)().mark((function t(){var e;return Object(s.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,this.$refs.resultForm.validate();case 3:return e={totalViews:this.getTotalViews,totalLikes:this.getTotalLikes,totalComments:this.getTotalComments,totalShares:this.getTotalShares,totalGmv:this.getTotalGmv},t.next=6,Object(o.d)("taskClaim",{query:{_id:this.currentClaim._id},update:{result:{contentList:this.resultForm.contentList,totalPerformance:e},status:"数据统计中"}});case 6:return t.next=8,Object(o.d)("taskClaim",{query:{_id:this.currentClaim._id},update:{$push:{progressSteps:{step:"提交执行结果",status:"数据统计中",updateTime:new Date,updatedBy:this.$store.getters.id,remark:"提交了".concat(this.resultForm.contentList.length,"个内容的执行结果")}}}});case 8:return t.next=10,Object(o.a)("messageLog",{title:"任务结果提交通知",content:"任务【".concat(this.taskInfo.title,"】的执行结果已提交，请查看"),type:"TASK_RESULT_SUBMITTED",taskId:this.currentClaim.taskId,taskClaimId:this.currentClaim._id,sender:{userId:this.$store.state.user.id,role:"TRACKER"},receivers:[{userId:this.currentClaim.agentId._id,role:"AGENT",isRead:!1},{userId:this.taskInfo.createBy,role:"ADMIN",isRead:!1}],isSystem:!1});case 10:this.$message.success("执行结果提交成功"),this.dialogVisible=!1,this.$emit("submit-success"),t.next=19;break;case 15:t.prev=15,t.t0=t.catch(0),this.$message.error("提交执行结果失败");case 19:case"end":return t.stop()}}),t,this,[[0,15]])})));return function(){return t.apply(this,arguments)}}()}},c=l,u=(a("b695"),a("2877")),m=Object(u.a)(c,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-dialog",{attrs:{title:"提交执行结果",visible:t.dialogVisible,width:"70%","custom-class":"result-dialog","append-to-body":""},on:{"update:visible":function(e){t.dialogVisible=e}}},[a("el-form",{ref:"resultForm",attrs:{model:t.resultForm,rules:t.resultRules,"label-width":"100px"}},[a("div",{staticClass:"form-section"},[a("div",{staticClass:"section-title"},[a("i",{staticClass:"el-icon-video-camera"}),t._v("\n                内容列表\n            ")]),t._v(" "),a("div",{staticClass:"content-list"},[t._l(t.resultForm.contentList,(function(e,s){return a("div",{key:s,staticClass:"content-item"},[a("div",{staticClass:"content-header"},[a("span",{staticClass:"content-index"},[t._v("内容 #"+t._s(s+1))]),t._v(" "),a("el-button",{attrs:{type:"danger",icon:"el-icon-delete",circle:"",size:"mini"},on:{click:function(e){return t.removeContent(s)}}})],1),t._v(" "),a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:8}},[a("el-form-item",{attrs:{label:"平台",prop:"contentList."+s+".platform",rules:{required:!0,message:"请选择平台",trigger:"change"}}},[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择平台",clearable:""},model:{value:e.platform,callback:function(a){t.$set(e,"platform",a)},expression:"content.platform"}},t._l(t.dict.type.expert_platform,(function(t){return a("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),1)],1)],1),t._v(" "),a("el-col",{attrs:{span:8}},[a("el-form-item",{attrs:{label:"类型",prop:"contentList."+s+".type",rules:{required:!0,message:"请选类型",trigger:"change"}}},[a("el-select",{attrs:{placeholder:"请选择内容形式",clearable:""},model:{value:e.type,callback:function(a){t.$set(e,"type",a)},expression:"content.type"}},t._l(t.dict.type.content_type,(function(t){return a("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),1)],1)],1),t._v(" "),a("el-col",{attrs:{span:8}},[a("el-form-item",{attrs:{label:"发布时间",prop:"contentList."+s+".publishTime",rules:{required:!0,message:"请选择发布时间",trigger:"change"}}},[a("el-date-picker",{staticStyle:{width:"100%"},attrs:{type:"datetime",placeholder:"选择发布时间"},model:{value:e.publishTime,callback:function(a){t.$set(e,"publishTime",a)},expression:"content.publishTime"}})],1)],1)],1),t._v(" "),a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:8}},[a("el-form-item",{attrs:{label:"内容链接",prop:"contentList."+s+".link",rules:{required:!0,message:"请输入内容链接",trigger:"blur"}}},[a("el-input",{attrs:{placeholder:"请输入内容链接"},model:{value:e.link,callback:function(a){t.$set(e,"link",a)},expression:"content.link"}})],1)],1),t._v(" "),a("el-col",{attrs:{span:8}},[a("el-form-item",{attrs:{label:"视频代码",prop:"contentList."+s+".videoCode"}},[a("el-input",{attrs:{placeholder:"请输入视频/直播代码"},model:{value:e.videoCode,callback:function(a){t.$set(e,"videoCode",a)},expression:"content.videoCode"}})],1)],1),t._v(" "),a("el-col",{attrs:{span:8}},[a("el-form-item",{attrs:{label:"广告码",prop:"contentList."+s+".adCode"}},[a("el-input",{attrs:{placeholder:"请输入广告码"},model:{value:e.adCode,callback:function(a){t.$set(e,"adCode",a)},expression:"content.adCode"}})],1)],1)],1),t._v(" "),a("el-form-item",{attrs:{label:"带货产品",prop:"contentList."+s+".products"}},[a("TagInput",{model:{value:e.products,callback:function(a){t.$set(e,"products",a)},expression:"content.products"}})],1),t._v(" "),a("div",{staticClass:"performance-data"},[a("div",{staticClass:"sub-title"},[t._v("效果数据")]),t._v(" "),a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:8}},[a("el-form-item",{attrs:{label:"播放量",prop:"contentList."+s+".performanceData.views"}},[a("el-input-number",{attrs:{min:0,"controls-position":"right"},model:{value:e.performanceData.views,callback:function(a){t.$set(e.performanceData,"views",a)},expression:"content.performanceData.views"}})],1)],1),t._v(" "),a("el-col",{attrs:{span:8}},[a("el-form-item",{attrs:{label:"点赞数",prop:"contentList."+s+".performanceData.likes"}},[a("el-input-number",{attrs:{min:0,"controls-position":"right"},model:{value:e.performanceData.likes,callback:function(a){t.$set(e.performanceData,"likes",a)},expression:"content.performanceData.likes"}})],1)],1),t._v(" "),a("el-col",{attrs:{span:8}},[a("el-form-item",{attrs:{label:"评论数",prop:"contentList."+s+".performanceData.comments"}},[a("el-input-number",{attrs:{min:0,"controls-position":"right"},model:{value:e.performanceData.comments,callback:function(a){t.$set(e.performanceData,"comments",a)},expression:"content.performanceData.comments"}})],1)],1)],1),t._v(" "),a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:8}},[a("el-form-item",{attrs:{label:"点赞数",prop:"contentList."+s+".performanceData.likes"}},[a("el-input-number",{attrs:{min:0,"controls-position":"right"},model:{value:e.performanceData.likes,callback:function(a){t.$set(e.performanceData,"likes",a)},expression:"content.performanceData.likes"}})],1)],1),t._v(" "),a("el-col",{attrs:{span:8}},[a("el-form-item",{attrs:{label:"评论数",prop:"contentList."+s+".performanceData.comments"}},[a("el-input-number",{attrs:{min:0,"controls-position":"right"},model:{value:e.performanceData.comments,callback:function(a){t.$set(e.performanceData,"comments",a)},expression:"content.performanceData.comments"}})],1)],1),t._v(" "),a("el-col",{attrs:{span:8}},[a("el-form-item",{attrs:{label:"分享数",prop:"contentList."+s+".performanceData.shares"}},[a("el-input-number",{attrs:{min:0,"controls-position":"right"},model:{value:e.performanceData.shares,callback:function(a){t.$set(e.performanceData,"shares",a)},expression:"content.performanceData.shares"}})],1)],1)],1),t._v(" "),a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:8}},[a("el-form-item",{attrs:{label:"直播GMV",prop:"contentList."+s+".performanceData.liveGmv"}},[a("el-input-number",{attrs:{min:0,precision:2,"controls-position":"right"},model:{value:e.performanceData.liveGmv,callback:function(a){t.$set(e.performanceData,"liveGmv",a)},expression:"content.performanceData.liveGmv"}})],1)],1),t._v(" "),a("el-col",{attrs:{span:8}},[a("el-form-item",{attrs:{label:"视频GMV",prop:"contentList."+s+".performanceData.videoGmv"}},[a("el-input-number",{attrs:{min:0,precision:2,"controls-position":"right"},model:{value:e.performanceData.videoGmv,callback:function(a){t.$set(e.performanceData,"videoGmv",a)},expression:"content.performanceData.videoGmv"}})],1)],1)],1)],1)],1)})),t._v(" "),a("div",{staticClass:"add-content-btn"},[a("el-button",{attrs:{type:"primary",plain:"",icon:"el-icon-plus"},on:{click:t.addContent}},[t._v("\n                        添加内容\n                    ")])],1)],2)]),t._v(" "),a("div",{staticClass:"form-section"},[a("div",{staticClass:"section-title"},[a("i",{staticClass:"el-icon-data-analysis"}),t._v("\n                合计效果数据\n            ")]),t._v(" "),a("div",{staticClass:"total-performance"},[a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:8}},[a("div",{staticClass:"data-card"},[a("div",{staticClass:"data-icon"},[a("i",{staticClass:"el-icon-video-play"})]),t._v(" "),a("div",{staticClass:"data-content"},[a("div",{staticClass:"data-label"},[t._v("总播放量")]),t._v(" "),a("div",{staticClass:"data-value"},[t._v(t._s(t.formatNumber(t.getTotalViews)))])])])]),t._v(" "),a("el-col",{attrs:{span:8}},[a("div",{staticClass:"data-card"},[a("div",{staticClass:"data-icon"},[a("i",{staticClass:"el-icon-star-on"})]),t._v(" "),a("div",{staticClass:"data-content"},[a("div",{staticClass:"data-label"},[t._v("总点赞数")]),t._v(" "),a("div",{staticClass:"data-value"},[t._v(t._s(t.formatNumber(t.getTotalLikes)))])])])]),t._v(" "),a("el-col",{attrs:{span:8}},[a("div",{staticClass:"data-card"},[a("div",{staticClass:"data-icon"},[a("i",{staticClass:"el-icon-chat-dot-round"})]),t._v(" "),a("div",{staticClass:"data-content"},[a("div",{staticClass:"data-label"},[t._v("总评论数")]),t._v(" "),a("div",{staticClass:"data-value"},[t._v(t._s(t.formatNumber(t.getTotalComments)))])])])])],1),t._v(" "),a("el-row",{staticStyle:{"margin-top":"20px"},attrs:{gutter:20}},[a("el-col",{attrs:{span:8}},[a("div",{staticClass:"data-card"},[a("div",{staticClass:"data-icon"},[a("i",{staticClass:"el-icon-share"})]),t._v(" "),a("div",{staticClass:"data-content"},[a("div",{staticClass:"data-label"},[t._v("总分享数")]),t._v(" "),a("div",{staticClass:"data-value"},[t._v(t._s(t.formatNumber(t.getTotalShares)))])])])]),t._v(" "),a("el-col",{attrs:{span:8}},[a("div",{staticClass:"data-card"},[a("div",{staticClass:"data-icon"},[a("i",{staticClass:"el-icon-money"})]),t._v(" "),a("div",{staticClass:"data-content"},[a("div",{staticClass:"data-label"},[t._v("视频GMV")]),t._v(" "),a("div",{staticClass:"data-value"},[t._v("¥"+t._s(t.formatNumber(t.getTotalVideoGmv)))])])])]),t._v(" "),a("el-col",{attrs:{span:8}},[a("div",{staticClass:"data-card"},[a("div",{staticClass:"data-icon"},[a("i",{staticClass:"el-icon-money"})]),t._v(" "),a("div",{staticClass:"data-content"},[a("div",{staticClass:"data-label"},[t._v("直播GMV")]),t._v(" "),a("div",{staticClass:"data-value"},[t._v("¥"+t._s(t.formatNumber(t.getTotalLiveGmv)))])])])])],1)],1)])]),t._v(" "),a("div",{attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:t.handleCancel}},[t._v("取 消")]),t._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:t.handleSubmit}},[t._v("确 定")])],1)],1)}),[],!1,null,"7228cc5a",null);e.default=m.exports},"8fe3":function(t,e,a){},b695:function(t,e,a){"use strict";a("8fe3")},c466:function(t,e,a){"use strict";function s(t){return t?(("string"==typeof t||"number"==typeof t)&&(t=new Date(t)),t.getFullYear()+"-"+(t.getMonth()+1)+"-"+(t.getDate()<10?"0"+t.getDate():t.getDate())+" "+(t.getHours()<10?"0"+t.getHours():t.getHours())+":"+(t.getMinutes()<10?"0"+t.getMinutes():t.getMinutes())+":"+(t.getSeconds()<10?"0"+t.getSeconds():t.getSeconds())):""}function n(t){return t||0===t?t.toString().replace(/\B(?=(\d{3})+(?!\d))/g,","):"0"}a.d(e,"a",(function(){return s})),a.d(e,"b",(function(){return n})),a("6b54"),a("a481")}}]);