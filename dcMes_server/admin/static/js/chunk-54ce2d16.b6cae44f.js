(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-54ce2d16"],{5:function(e,t){},5887:function(e,t,n){},"8d35":function(e,t,n){"use strict";n("5887")},"9ed6":function(e,t,n){"use strict";n.r(t);var r=(n("ac6a"),n("456d"),n("c7eb")),o=(n("96cf"),n("1da1")),s=(n("6b54"),n("61f7")),a=n("3452"),i=n.n(a),c={name:"Login",directives:{focus:{inserted:function(e){e.querySelector("input").focus()}}},watch:{$route:{handler:function(e){var t=e.query;t&&(this.redirect=t.redirect,this.otherQuery=this.getOtherQuery(t))},immediate:!0},loginType:function(e){var t=this;"qrcode"===e&&this.$nextTick((function(){t.focusScanInput()}))},"loginForm.encryptedId":{handler:function(e){e&&"qrcode"===this.loginType&&this.handleLogin()}}},data:function(){return{title:"德昌MES系统",loginForm:{userName:"",password:"",encryptedId:""},loginRules:{userName:[{required:!0,trigger:"blur",validator:function(e,t,n){""==t?n(new Error("用户名不能为空")):n()}}],password:[{required:!0,trigger:"blur",validator:function(e,t,n){Object(s.b)(t)?n():n(new Error("密码不能少于6位"))}}]},loading:!1,passwordType:"password",redirect:void 0,loginType:"account",encryptionKey:"your-secure-encryption-key"}},created:function(){},methods:{showPwd:function(){var e=this;"password"===this.passwordType?this.passwordType="":this.passwordType="password",this.$nextTick((function(){e.$refs.password.focus()}))},decryptId:function(e){try{return i.a.AES.decrypt(e,"your-secret-key").toString(i.a.enc.Utf8)}catch(e){return null}},decryptLoginData:function(e){try{var t=i.a.AES.decrypt(e,this.encryptionKey);return JSON.parse(t.toString(i.a.enc.Utf8))}catch(e){return null}},handleLogin:function(){var e=this;this.$refs.loginForm.validate(function(){var t=Object(o.a)(Object(r.a)().mark((function t(n){var o,s,a;return Object(r.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!n){t.next=29;break}if(t.prev=1,e.loading=!0,"account"!==e.loginType){t.next=7;break}o={userName:(e.loginForm.userName||"").trim(),password:(e.loginForm.password||"").trim()},t.next=16;break;case 7:if(s=e.loginForm.encryptedId){t.next=11;break}return e.$message.error("请扫描二维码"),t.abrupt("return");case 11:if(a=e.decryptLoginData(s)){t.next=15;break}return e.$message.error("二维码无效或已过期"),t.abrupt("return");case 15:o={userName:a.userName,password:a.password,id:a.id};case 16:return t.next=18,e.$store.dispatch("user/login",o);case 18:t.sent,e.$router.push({path:e.redirect||"/"}),t.next=26;break;case 22:t.prev=22,t.t0=t.catch(1),e.$message.error(t.t0&&t.t0.message||"登录失败，请重试");case 26:return t.prev=26,e.loading=!1,t.finish(26);case 29:case"end":return t.stop()}}),t,null,[[1,22,26,29]])})));return function(e){return t.apply(this,arguments)}}())},getOtherQuery:function(e){return Object.keys(e).reduce((function(t,n){return"redirect"!==n&&(t[n]=e[n]),t}),{})},focusScanInput:function(){"qrcode"===this.loginType&&this.$refs.scanInput&&this.$refs.scanInput.focus()}},mounted:function(){"qrcode"===this.loginType&&this.focusScanInput()}},l=c,u=(n("8d35"),n("2877")),p=Object(u.a)(l,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"login-container"},[n("div",{staticClass:"login-logo-bysj"}),e._v(" "),n("el-row",[n("el-col",{attrs:{lg:8,md:24,sm:24,xl:8,xs:24}},[n("el-form",{ref:"loginForm",staticClass:"login-form",attrs:{model:e.loginForm,rules:e.loginRules,"auto-complete":"off","label-position":"left"}},[n("div",{staticClass:"title"},[e._v("\n          hello !\n        ")]),e._v(" "),n("div",{staticClass:"title-tips"},[e._v("欢迎来到"+e._s(e.title)+"！")]),e._v(" "),n("el-tabs",{model:{value:e.loginType,callback:function(t){e.loginType=t},expression:"loginType"}},[n("el-tab-pane",{attrs:{label:"账号密码登录",name:"account"}},[n("el-form-item",{staticClass:"login-form-admin",staticStyle:{"margin-top":"49px"},attrs:{prop:"userName"}},[n("span",{staticClass:"svg-container svg-container-admin"},[n("byui-icon",{attrs:{icon:["fas","user"]}})],1),e._v(" "),n("el-input",{directives:[{name:"focus",rawName:"v-focus"}],attrs:{"auto-complete":"off",placeholder:"请输入用户名",tabindex:"1",type:"text"},on:{input:function(t){return e.loginForm.userName=t?t.trim():""}},model:{value:e.loginForm.userName,callback:function(t){e.$set(e.loginForm,"userName",t)},expression:"loginForm.userName"}})],1),e._v(" "),n("el-form-item",{staticClass:"login-form-pass",attrs:{prop:"password"}},[n("span",{staticClass:"svg-container svg-container-pass"},[n("byui-icon",{attrs:{icon:["fas","lock"]}})],1),e._v(" "),n("el-input",{key:e.passwordType,ref:"password",attrs:{type:e.passwordType,"auto-complete":"on",placeholder:"请输入密码",tabindex:"2"},on:{input:function(t){return e.loginForm.password=t?t.trim():""}},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleLogin(t)}},model:{value:e.loginForm.password,callback:function(t){e.$set(e.loginForm,"password",t)},expression:"loginForm.password"}}),e._v(" "),"password"===e.passwordType?n("span",{staticClass:"show-pwd",on:{click:e.showPwd}},[n("byui-icon",{attrs:{icon:["fas","eye-slash"]}})],1):n("span",{staticClass:"show-pwd",on:{click:e.showPwd}},[n("byui-icon",{attrs:{icon:["fas","eye"]}})],1)],1)],1),e._v(" "),n("el-tab-pane",{attrs:{label:"扫码登录",name:"qrcode"}},[n("el-form-item",{attrs:{prop:"encryptedId"}},[n("span",{staticClass:"svg-container"},[n("byui-icon",{attrs:{icon:["fas","qrcode"]}})],1),e._v(" "),n("el-input",{ref:"scanInput",attrs:{placeholder:"请使用扫描枪扫描二维码"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleLogin(t)}},model:{value:e.loginForm.encryptedId,callback:function(t){e.$set(e.loginForm,"encryptedId",t)},expression:"loginForm.encryptedId"}})],1)],1)],1),e._v(" "),n("el-button",{staticClass:"login-btn",attrs:{loading:e.loading,type:"primary"},nativeOn:{click:function(t){return t.preventDefault(),e.handleLogin(t)}}},[e._v("登录\n        ")])],1)],1)],1)],1)}),[],!1,null,"415a410d",null);t.default=p.exports}}]);