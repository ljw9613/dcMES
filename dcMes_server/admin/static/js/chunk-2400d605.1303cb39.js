(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-2400d605","chunk-3812708e"],{"0ecf":function(e,t,a){},"1d6d":function(e,t,a){"use strict";a("a549")},3835:function(e,t,a){"use strict";var r=a("06c5");function n(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var a=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=a){var r,n,l,o,s=[],i=!0,c=!1;try{if(l=(a=a.call(e)).next,0===t){if(Object(a)!==a)return;i=!1}else for(;!(i=(r=l.call(a)).done)&&(s.push(r.value),s.length!==t);i=!0);}catch(e){c=!0,n=e}finally{try{if(!i&&null!=a.return&&(o=a.return(),Object(o)!==o))return}finally{if(c)throw n}}return s}}(e,t)||Object(r.a)(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}a.d(t,"a",(function(){return n}))},"64e6":function(e,t,a){"use strict";a.d(t,"a",(function(){return n})),a.d(t,"b",(function(){return l})),a.d(t,"c",(function(){return o})),a.d(t,"d",(function(){return s}));var r=a("b775");function n(e){return Object(r.a)({url:"/warehouse_entry/scan",method:"post",data:e})}function l(e){return Object(r.a)({url:"/warehouse_entry/scan_on",method:"post",data:e})}function o(e){return Object(r.a)({url:"/k3/sync_warehouse_entry",method:"post",data:e})}function s(e){return Object(r.a)({url:"/k3/sync_warehouse_ontry",method:"post",data:e})}},"7da1":function(e,t,a){"use strict";a("0ecf")},a549:function(e,t,a){},cc73:function(e,t,a){"use strict";a.r(t);var r=(a("386d"),a("3835")),n=a("c7eb"),l=a("5530"),o=(a("96cf"),a("1da1")),s=a("7e1e"),i=a("64e6"),c=a("eb6d"),u=(a("9339"),{name:"WarehouseEntry",components:{ScanDialog:c.default},data:function(){return{scanData:{FBillNo:null,FaQIaoNo:null,HuoGuiCode:null,materialSpec:null,materialName:null,outboundQuantity:0,FQty:0},palletList:[],searchForm:{entryNo:"",productionOrderNo:"",saleOrderNo:"",palletCode:"",status:"",dateRange:[]},tableList:[],total:0,currentPage:1,pageSize:10,listLoading:!1,dialogFormVisible:!1,dialogStatus:"",dataForm:{},rules:{productionOrderNo:[{required:!0,message:"请输入生产订单号",trigger:"blur"}]},scanDialogVisible:!1,scanForm:{palletCode:""},scanRules:{palletCode:[{required:!0,message:"请扫描托盘编号",trigger:"blur"}]},exportLoading:!1,exportProgress:0,outboundQuantityDialog:!1,outboundQuantity:"",scanPalletDialog:!1,palletBarcode:""}},methods:{handlePalletBarcodeOpen:function(){this.scanData={FBillNo:null,FaQIaoNo:null,HuoGuiCode:null,materialSpec:null,materialName:null,outboundQuantity:0,FQty:0},this.outboundQuantityDialog=!0},confirmOutboundQuantity:function(){this.scanData.outboundQuantity?(this.outboundQuantityDialog=!1,this.scanDialogVisible=!0):this.$message.warning("请输入应出库数量")},handlePalletScan:function(){var e=Object(o.a)(Object(n.a)().mark((function e(){var t;return Object(n.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("palletBarcode",this.palletBarcode),e.next=3,Object(s.b)("material_palletizing",{query:{palletCode:this.palletBarcode},populate:JSON.stringify([{path:"saleOrderId"}])});case 3:t=e.sent,console.log("result",t),t.data.length>0&&(this.scanData.FBillNo=t.data[0].saleOrderId.FBillNo,this.scanData.FQty=t.data[0].saleOrderId.FQty,this.scanData.palletCode=t.data[0].palletCode,this.scanData.materialName=t.data[0].materialName,this.scanData.materialSpec=t.data[0].materialSpec,this.palletList.push(Object(l.a)(Object(l.a)({},t.data[0]),{},{scanTime:new Date})));case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),searchData:function(){var e={query:{$and:[]}};if(this.searchForm.entryNo&&e.query.$and.push({entryNo:{$regex:this.escapeRegex(this.searchForm.entryNo),$options:"i"}}),this.searchForm.productionOrderNo&&e.query.$and.push({productionOrderNo:{$regex:this.escapeRegex(this.searchForm.productionOrderNo),$options:"i"}}),this.searchForm.saleOrderNo&&e.query.$and.push({saleOrderNo:{$regex:this.escapeRegex(this.searchForm.saleOrderNo),$options:"i"}}),this.searchForm.palletCode&&e.query.$and.push({"entryItems.palletCode":{$regex:this.escapeRegex(this.searchForm.palletCode),$options:"i"}}),this.searchForm.status&&e.query.$and.push({status:this.searchForm.status}),this.searchForm.dateRange&&2===this.searchForm.dateRange.length){var t=Object(r.a)(this.searchForm.dateRange,2),a=t[0],n=t[1];e.query.$and.push({createAt:{$gte:new Date(a).toISOString(),$lte:new Date(n+" 23:59:59.999").toISOString()}})}return e.query.$and.length||delete e.query.$and,e},fetchData:function(){var e=Object(o.a)(Object(n.a)().mark((function e(){var t,a;return Object(n.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.listLoading=!0,e.prev=1,(t=this.searchData()).page=this.currentPage,t.skip=(this.currentPage-1)*this.pageSize,t.limit=this.pageSize,t.sort={createAt:-1},t.count=!0,e.next=10,Object(s.b)("warehouse_ontry",t);case 10:a=e.sent,this.tableList=a.data,this.total=a.countnum,e.next=19;break;case 15:e.prev=15,e.t0=e.catch(1),console.error("获取数据失败:",e.t0),this.$message.error("获取数据失败");case 19:return e.prev=19,this.listLoading=!1,e.finish(19);case 22:case"end":return e.stop()}}),e,this,[[1,15,19,22]])})));return function(){return e.apply(this,arguments)}}(),handleOrderNoBlur:function(){var e=Object(o.a)(Object(n.a)().mark((function e(){var t,a;return Object(n.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.dataForm.productionOrderNo){e.next=11;break}return e.prev=1,e.next=4,Object(s.b)("k3_PRD_MO",{query:{FBillNo:this.dataForm.productionOrderNo}});case 4:(t=e.sent).data&&t.data.length>0?(a=t.data[0],this.dataForm=Object(l.a)(Object(l.a)({},this.dataForm),{},{saleOrderNo:a.FSaleOrderNo,materialName:a.FMaterialName,materialSpec:a.FSpecification,plannedQuantity:a.FQty})):this.$message.warning("未找到生产订单信息"),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(1),this.$message.error("获取订单信息失败");case 11:case"end":return e.stop()}}),e,this,[[1,8]])})));return function(){return e.apply(this,arguments)}}(),handleScan:function(){var e=Object(o.a)(Object(n.a)().mark((function e(){return Object(n.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.prev=0,this.fetchData(),e.next=8;break;case 4:throw e.prev=4,e.t0=e.catch(0),this.$message.error(e.t0.message||"扫描失败"),e.t0;case 8:case"end":return e.stop()}}),e,this,[[0,4]])})));return function(){return e.apply(this,arguments)}}(),handleScanComplete:function(){var e=Object(o.a)(Object(n.a)().mark((function e(t){return Object(n.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.fetchData();case 3:this.$message.success("成功出库 ".concat(t.length," 个托盘")),e.next=9;break;case 6:e.prev=6,e.t0=e.catch(0),this.$message.error("完成出库失败");case 9:case"end":return e.stop()}}),e,this,[[0,6]])})));return function(t){return e.apply(this,arguments)}}(),handleScanDelete:function(){var e=Object(o.a)(Object(n.a)().mark((function e(t){return Object(n.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,deletePallet(t);case 3:this.$message.success("删除成功"),e.next=9;break;case 6:e.prev=6,e.t0=e.catch(0),this.$message.error("删除失败");case 9:case"end":return e.stop()}}),e,this,[[0,6]])})));return function(t){return e.apply(this,arguments)}}(),handleComplete:function(){var e=Object(o.a)(Object(n.a)().mark((function e(t){var a=this;return Object(n.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.$confirm("确认完成出库？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(Object(o.a)(Object(n.a)().mark((function e(){return Object(n.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Object(s.d)("warehouse_ontry",{query:{entryNo:t.entryNo},update:{status:"COMPLETED",endTime:new Date}});case 3:a.$message.success("出库完成"),a.fetchData(),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),a.$message.error("操作失败");case 10:case"end":return e.stop()}}),e,null,[[0,7]])}))));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),handleSync:function(e){var t=this,a={entryId:e._id};Object(i.d)(a).then((function(e){200==e.code?t.$message.success("同步成功"):t.$message.error(e.message)})).catch((function(e){t.$message.error("同步失败")}))},handleDelete:function(){var e=Object(o.a)(Object(n.a)().mark((function e(t){var a=this;return Object(n.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.$confirm("确认删除该出库单？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(Object(o.a)(Object(n.a)().mark((function e(){return Object(n.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Object(s.c)("warehouse_ontry",{query:{_id:t._id}});case 3:a.$message.success("删除成功"),a.fetchData(),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),a.$message.error("删除失败");case 10:case"end":return e.stop()}}),e,null,[[0,7]])}))));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),handleDeletePallet:function(){var e=Object(o.a)(Object(n.a)().mark((function e(t,a){var r=this;return Object(n.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.$confirm("确认删除该托盘记录？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(Object(o.a)(Object(n.a)().mark((function e(){return Object(n.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Object(s.c)("warehouse_ontry/pallet",{query:{entryNo:t,palletCode:a}});case 3:r.$message.success("删除成功"),r.fetchData(),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),r.$message.error("删除失败");case 10:case"end":return e.stop()}}),e,null,[[0,7]])}))));case 1:case"end":return e.stop()}}),e,this)})));return function(t,a){return e.apply(this,arguments)}}(),getStatusType:function(e){return{PENDING:"info",IN_PROGRESS:"warning",COMPLETED:"success"}[e]||"info"},getStatusText:function(e){return{PENDING:"待出库",IN_PROGRESS:"出库中",COMPLETED:"已完成"}[e]||e},formatDate:function(e){return e?new Date(e).toLocaleString():"暂无数据"},search:function(){this.currentPage=1,this.fetchData()},resetForm:function(){this.$refs.searchForm.resetFields(),this.search()},handleAdd:function(){this.dialogStatus="create",this.dataForm={},this.dialogFormVisible=!0},baseTableHandleCurrentChange:function(e){this.currentPage=e,this.fetchData()},baseTableHandleSizeChange:function(e){this.pageSize=e,this.fetchData()}},created:function(){this.fetchData()}}),d=u,p=(a("1d6d"),a("2877")),m=Object(p.a)(d,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"app-container"},[a("el-card",{staticClass:"filter-container"},[a("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[a("span",[e._v("筛选搜索")])]),e._v(" "),a("el-form",{ref:"searchForm",staticClass:"demo-form-inline",attrs:{model:e.searchForm}},[a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:6}},[a("el-form-item",{attrs:{label:"出库单号"}},[a("el-input",{attrs:{placeholder:"请输入出库单号",clearable:""},model:{value:e.searchForm.entryNo,callback:function(t){e.$set(e.searchForm,"entryNo",t)},expression:"searchForm.entryNo"}})],1)],1),e._v(" "),a("el-col",{attrs:{span:6}},[a("el-form-item",{attrs:{label:"生产订单号"}},[a("el-input",{attrs:{placeholder:"请输入生产订单号",clearable:""},model:{value:e.searchForm.productionOrderNo,callback:function(t){e.$set(e.searchForm,"productionOrderNo",t)},expression:"searchForm.productionOrderNo"}})],1)],1),e._v(" "),a("el-col",{attrs:{span:6}},[a("el-form-item",{attrs:{label:"销售订单号"}},[a("el-input",{attrs:{placeholder:"请输入销售订单号",clearable:""},model:{value:e.searchForm.saleOrderNo,callback:function(t){e.$set(e.searchForm,"saleOrderNo",t)},expression:"searchForm.saleOrderNo"}})],1)],1),e._v(" "),a("el-col",{attrs:{span:6}},[a("el-form-item",{attrs:{label:"托盘编号"}},[a("el-input",{attrs:{placeholder:"请输入托盘编号",clearable:""},model:{value:e.searchForm.palletCode,callback:function(t){e.$set(e.searchForm,"palletCode",t)},expression:"searchForm.palletCode"}})],1)],1)],1),e._v(" "),a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:6}},[a("el-form-item",{attrs:{label:"出库状态"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择状态",clearable:""},model:{value:e.searchForm.status,callback:function(t){e.$set(e.searchForm,"status",t)},expression:"searchForm.status"}},[a("el-option",{attrs:{label:"待出库",value:"PENDING"}}),e._v(" "),a("el-option",{attrs:{label:"出库中",value:"IN_PROGRESS"}}),e._v(" "),a("el-option",{attrs:{label:"已完成",value:"COMPLETED"}})],1)],1)],1),e._v(" "),a("el-col",{attrs:{span:6}},[a("el-form-item",{attrs:{label:"创建时间"}},[a("el-date-picker",{staticStyle:{width:"100%"},attrs:{type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","value-format":"yyyy-MM-dd"},model:{value:e.searchForm.dateRange,callback:function(t){e.$set(e.searchForm,"dateRange",t)},expression:"searchForm.dateRange"}})],1)],1)],1),e._v(" "),a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:e.search}},[e._v("查询搜索")]),e._v(" "),a("el-button",{on:{click:e.resetForm}},[e._v("重置")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:e.handlePalletBarcodeOpen}},[e._v("扫描单据出库")])],1)],1)],1),e._v(" "),a("base-table",{ref:"baseTable",attrs:{currentPage:e.currentPage,"highlight-current-row":!0,pageSize:e.pageSize,tableData:e.tableList,tableDataloading:e.listLoading,total:e.total},on:{handleCurrentChange:e.baseTableHandleCurrentChange,handleSizeChange:e.baseTableHandleSizeChange}},[a("template",{slot:"law"},[a("el-table-column",{attrs:{type:"expand"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-form",{staticClass:"table-expand",attrs:{"label-position":"left",inline:""}},[a("el-card",{staticClass:"box-card",staticStyle:{width:"100%"}},[a("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[a("span",[e._v("托盘出库明细")])]),e._v(" "),a("el-table",{staticStyle:{width:"100%"},attrs:{data:t.row.entryItems,border:""}},[a("el-table-column",{attrs:{label:"托盘编号",prop:"palletCode",align:"center"}}),e._v(" "),a("el-table-column",{attrs:{label:"出库数量",prop:"quantity",align:"center"}}),e._v(" "),a("el-table-column",{attrs:{label:"扫描时间",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                                        "+e._s(e.formatDate(t.row.scanTime))+"\n                                    ")]}}],null,!0)})],1)],1)],1)]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"出库单号",prop:"entryNo",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-link",{attrs:{type:"primary"},on:{click:function(a){return e.handleView(t.row)}}},[e._v(e._s(t.row.entryNo))])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"订单信息",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",[e._v("生产单号: "+e._s(t.row.productionOrderNo))]),e._v(" "),a("div",[e._v("销售单号: "+e._s(t.row.saleOrderNo))])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"物料信息",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                    "+e._s(t.row.materialName)+"\n                    "),t.row.materialSpec?a("el-tag",{attrs:{size:"mini"}},[e._v(e._s(t.row.materialSpec))]):e._e()]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"数量信息",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",[e._v("计划: "+e._s(t.row.plannedQuantity))]),e._v(" "),a("div",[e._v("实际: "+e._s(t.row.actualQuantity))]),e._v(" "),a("div",[e._v("托盘数: "+e._s(t.row.palletCount))])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"出库状态",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-tag",{attrs:{type:e.getStatusType(t.row.status)}},[e._v("\n                        "+e._s(e.getStatusText(t.row.status))+"\n                    ")])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"时间信息",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",[e._v("创建: "+e._s(e.formatDate(t.row.createAt)))]),e._v(" "),t.row.startTime?a("div",[e._v("开始: "+e._s(e.formatDate(t.row.startTime)))]):e._e(),e._v(" "),t.row.endTime?a("div",[e._v("完成: "+e._s(e.formatDate(t.row.endTime)))]):e._e()]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"操作",align:"center",width:"200"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{staticStyle:{color:"red"},attrs:{type:"text"},on:{click:function(a){return e.handleDelete(t.row)}}},[e._v("删除")]),e._v(" "),a("el-button",{attrs:{type:"text"},on:{click:function(a){return e.handleSync(t.row)}}},[e._v("同步金蝶云")])]}}])})],1)],2),e._v(" "),a("el-dialog",{attrs:{title:"create"===e.dialogStatus?"新增出库单":"查看出库单",visible:e.dialogFormVisible},on:{"update:visible":function(t){e.dialogFormVisible=t}}},[a("el-form",{ref:"dataForm",attrs:{model:e.dataForm,rules:e.rules,"label-width":"120px"}},[a("el-form-item",{attrs:{label:"生产订单号",prop:"productionOrderNo"}},[a("el-input",{attrs:{placeholder:"请输入生产订单号",disabled:"view"===e.dialogStatus},on:{blur:e.handleOrderNoBlur},model:{value:e.dataForm.productionOrderNo,callback:function(t){e.$set(e.dataForm,"productionOrderNo",t)},expression:"dataForm.productionOrderNo"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"销售订单号"}},[a("el-input",{attrs:{disabled:""},model:{value:e.dataForm.saleOrderNo,callback:function(t){e.$set(e.dataForm,"saleOrderNo",t)},expression:"dataForm.saleOrderNo"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"物料信息"}},[a("el-input",{attrs:{disabled:""},model:{value:e.dataForm.materialName,callback:function(t){e.$set(e.dataForm,"materialName",t)},expression:"dataForm.materialName"}},[a("template",{slot:"append"},[e._v(e._s(e.dataForm.materialSpec))])],2)],1),e._v(" "),a("el-form-item",{attrs:{label:"计划出库数量"}},[a("el-input",{attrs:{disabled:""},model:{value:e.dataForm.plannedQuantity,callback:function(t){e.$set(e.dataForm,"plannedQuantity",t)},expression:"dataForm.plannedQuantity"}})],1)],1),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.dialogFormVisible=!1}}},[e._v("取 消")]),e._v(" "),"create"===e.dialogStatus?a("el-button",{attrs:{type:"primary"},on:{click:e.handleSubmit}},[e._v("确 定")]):e._e()],1)],1),e._v(" "),a("el-dialog",{attrs:{title:"基础信息",visible:e.outboundQuantityDialog,width:"30%","close-on-click-modal":!1},on:{"update:visible":function(t){e.outboundQuantityDialog=t}}},[a("el-form",[a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"货柜号"}},[a("el-input",{model:{value:e.scanData.HuoGuiCode,callback:function(t){e.$set(e.scanData,"HuoGuiCode",t)},expression:"scanData.HuoGuiCode"}})],1)],1),e._v(" "),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"发票号"}},[a("el-input",{model:{value:e.scanData.FaQIaoNo,callback:function(t){e.$set(e.scanData,"FaQIaoNo",t)},expression:"scanData.FaQIaoNo"}})],1)],1)],1),e._v(" "),a("el-form-item",{attrs:{label:"应收数量"}},[a("el-input",{attrs:{type:"number"},model:{value:e.scanData.outboundQuantity,callback:function(t){e.$set(e.scanData,"outboundQuantity",t)},expression:"scanData.outboundQuantity"}})],1)],1),e._v(" "),a("span",{attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.outboundQuantityDialog=!1}}},[e._v("取消")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:e.confirmOutboundQuantity}},[e._v("确定")])],1)],1),e._v(" "),a("el-dialog",{attrs:{title:"扫描托盘",visible:e.scanPalletDialog,width:"80%","close-on-click-modal":!1},on:{"update:visible":function(t){e.scanPalletDialog=t}}},[a("el-form",[a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"销售单号"}},[a("el-input",{attrs:{readonly:""},model:{value:e.scanData.FBillNo,callback:function(t){e.$set(e.scanData,"FBillNo",t)},expression:"scanData.FBillNo"}})],1)],1),e._v(" "),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"销售数量"}},[a("el-input",{attrs:{type:"number",readonly:""},model:{value:e.scanData.FQty,callback:function(t){e.$set(e.scanData,"FQty",t)},expression:"scanData.FQty"}})],1)],1)],1),e._v(" "),a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"货柜号"}},[a("el-input",{attrs:{readonly:""},model:{value:e.scanData.HuoGuiCode,callback:function(t){e.$set(e.scanData,"HuoGuiCode",t)},expression:"scanData.HuoGuiCode"}})],1)],1),e._v(" "),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"发票号"}},[a("el-input",{attrs:{readonly:""},model:{value:e.scanData.FaQIaoNo,callback:function(t){e.$set(e.scanData,"FaQIaoNo",t)},expression:"scanData.FaQIaoNo"}})],1)],1)],1),e._v(" "),a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"产品名称"}},[a("el-input",{attrs:{readonly:""},model:{value:e.scanData.materialName,callback:function(t){e.$set(e.scanData,"materialName",t)},expression:"scanData.materialName"}})],1)],1),e._v(" "),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"产品型号"}},[a("el-input",{attrs:{readonly:""},model:{value:e.scanData.materialSpec,callback:function(t){e.$set(e.scanData,"materialSpec",t)},expression:"scanData.materialSpec"}})],1)],1)],1),e._v(" "),a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"应收数量"}},[a("el-input",{attrs:{type:"number"},model:{value:e.scanData.outboundQuantity,callback:function(t){e.$set(e.scanData,"outboundQuantity",t)},expression:"scanData.outboundQuantity"}})],1)],1),e._v(" "),a("el-col",{attrs:{span:24}},[a("el-form-item",{attrs:{label:"请扫描托盘条码"}},[a("el-input",{nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handlePalletScan(t)}},model:{value:e.palletBarcode,callback:function(t){e.palletBarcode=t},expression:"palletBarcode"}},[a("el-button",{attrs:{slot:"append"},on:{click:e.handlePalletScan},slot:"append"},[e._v("确认")])],1)],1)],1)],1)],1),e._v(" "),a("el-table",{attrs:{data:e.palletList}},[a("el-table-column",{attrs:{prop:"palletCode",label:"托盘编号"}}),e._v(" "),a("el-table-column",{attrs:{prop:"saleOrderId.FBillNo",label:"销售订单"}}),e._v(" "),a("el-table-column",{attrs:{prop:"materialCode",label:"物料编码"}}),e._v(" "),a("el-table-column",{attrs:{prop:"totalQuantity",label:"数量"}}),e._v(" "),a("el-table-column",{attrs:{prop:"productLineName",label:"产线"}}),e._v(" "),a("el-table-column",{attrs:{prop:"scanTime",label:"扫描时间"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",[e._v(e._s(e.formatDate(t.row.scanTime)))])]}}])})],1)],1),e._v(" "),a("scan-dialog",{attrs:{visible:e.scanDialogVisible,title:"托盘扫码出库",placeholder:"请扫描托盘条码",scanData:e.scanData},on:{"update:visible":function(t){e.scanDialogVisible=t},scan:e.handleScan,complete:e.handleScanComplete,delete:e.handleScanDelete}})],1)}),[],!1,null,"230cd51e",null);t.default=m.exports},eb6d:function(e,t,a){"use strict";a.r(t);var r=a("c7eb"),n=(a("c5f6"),a("28a5"),a("3835")),l=(a("96cf"),a("1da1")),o=a("64e6"),s={name:"ScanDialog",props:{scanData:{type:Object,default:function(){return{}}},visible:{type:Boolean,default:!1},title:{type:String,default:"托盘扫码出库"},placeholder:{type:String,default:"请扫描托盘条码"}},data:function(){return{dialogVisible:!1,scanForm:{barcode:""},rules:{barcode:[{required:!0,message:"请输入或扫描条码",trigger:"blur"}]},scanRecords:[],entryInfo:null}},watch:{visible:function(e){var t=this;this.dialogVisible=e,e&&(this.initEntryInfo(),this.$nextTick((function(){t.$refs.scanInput.focus()})))},dialogVisible:function(e){this.$emit("update:visible",e),e||this.resetForm()},scanData:{handler:function(e){this.initEntryInfo()},immediate:!0}},methods:{initEntryInfo:function(){this.scanData&&(this.entryInfo={FBillNo:this.scanData.FBillNo,HuoGuiCode:this.scanData.HuoGuiCode,FaQIaoNo:this.scanData.FaQIaoNo,materialName:this.scanData.materialName,materialSpec:this.scanData.materialSpec,plannedQuantity:this.scanData.FQty,outboundQuantity:this.scanData.outboundQuantity,actualQuantity:0,palletCount:0,progress:0})},handleScanInput:function(){var e=Object(l.a)(Object(r.a)().mark((function e(){var t,a,l,s,i,c,u,d,p;return Object(r.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.$refs.scanForm.validate();case 3:return t=this.scanForm.barcode.trim(),console.log(t,"barcode"),e.next=7,this.$emit("scan",t);case 7:if(!e.sent){e.next=23;break}if(a=t.split("#"),l=Object(n.a)(a,5),s=l[0],i=l[1],c=l[2],u=l[3],d=l[4],console.log(s,"palletCode"),s&&i&&c&&u){e.next=13;break}throw new Error("无效的托盘条码格式");case 13:return e.next=15,Object(o.b)({palletCode:s,userId:this.$store.state.user.id,entryInfo:this.entryInfo});case 15:if((p=e.sent).data&&(this.entryInfo=p.data),200===p.code){e.next=20;break}return this.$message.error(p.message),e.abrupt("return");case 20:this.$message.success("扫码出库成功"),this.scanRecords.unshift({palletCode:s,saleOrderNo:i,materialCode:c,quantity:Number(u),lineCode:d,scanTime:new Date}),this.scanForm.barcode="";case 23:e.next=28;break;case 25:e.prev=25,e.t0=e.catch(0),console.error("扫描失败:",e.t0);case 28:case"end":return e.stop()}}),e,this,[[0,25]])})));return function(){return e.apply(this,arguments)}}(),handleComplete:function(){var e=Object(l.a)(Object(r.a)().mark((function e(){return Object(r.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.$emit("complete",this.scanRecords.map((function(e){return e.palletCode})));case 3:this.dialogVisible=!1,e.next=9;break;case 6:e.prev=6,e.t0=e.catch(0),console.error("完成出库失败:",e.t0);case 9:case"end":return e.stop()}}),e,this,[[0,6]])})));return function(){return e.apply(this,arguments)}}(),handleClose:function(){this.resetForm()},resetForm:function(){this.scanForm.barcode="",this.scanRecords=[],this.entryInfo=null,this.$refs.scanForm&&this.$refs.scanForm.resetFields()},formatDateTime:function(e){return new Date(e).toLocaleString()}}},i=s,c=(a("7da1"),a("2877")),u=Object(c.a)(i,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{attrs:{title:e.title,visible:e.dialogVisible,width:"800px"},on:{"update:visible":function(t){e.dialogVisible=t},close:e.handleClose}},[a("div",{staticClass:"scan-container"},[a("el-form",[a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"销售单号"}},[a("el-input",{attrs:{readonly:""},model:{value:e.entryInfo.saleOrderNo,callback:function(t){e.$set(e.entryInfo,"saleOrderNo",t)},expression:"entryInfo.saleOrderNo"}})],1)],1),e._v(" "),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"销售数量"}},[a("el-input",{attrs:{type:"number",readonly:""},model:{value:e.entryInfo.plannedQuantity,callback:function(t){e.$set(e.entryInfo,"plannedQuantity",t)},expression:"entryInfo.plannedQuantity"}})],1)],1)],1),e._v(" "),a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"货柜号"}},[a("el-input",{attrs:{readonly:""},model:{value:e.entryInfo.HuoGuiCode,callback:function(t){e.$set(e.entryInfo,"HuoGuiCode",t)},expression:"entryInfo.HuoGuiCode"}})],1)],1),e._v(" "),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"发票号"}},[a("el-input",{attrs:{readonly:""},model:{value:e.entryInfo.FaQIaoNo,callback:function(t){e.$set(e.entryInfo,"FaQIaoNo",t)},expression:"entryInfo.FaQIaoNo"}})],1)],1)],1),e._v(" "),a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"产品名称"}},[a("el-input",{attrs:{readonly:""},model:{value:e.entryInfo.materialName,callback:function(t){e.$set(e.entryInfo,"materialName",t)},expression:"entryInfo.materialName"}})],1)],1),e._v(" "),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"产品型号"}},[a("el-input",{attrs:{readonly:""},model:{value:e.entryInfo.materialSpec,callback:function(t){e.$set(e.entryInfo,"materialSpec",t)},expression:"entryInfo.materialSpec"}})],1)],1)],1),e._v(" "),a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"应收数量"}},[a("el-input",{attrs:{type:"number"},model:{value:e.entryInfo.outboundQuantity,callback:function(t){e.$set(e.entryInfo,"outboundQuantity",t)},expression:"entryInfo.outboundQuantity"}})],1)],1)],1)],1),e._v(" "),a("el-form",{ref:"scanForm",attrs:{model:e.scanForm,rules:e.rules}},[a("el-form-item",{attrs:{prop:"barcode"}},[a("el-input",{ref:"scanInput",attrs:{placeholder:e.placeholder,clearable:""},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleScanInput(t)}},model:{value:e.scanForm.barcode,callback:function(t){e.$set(e.scanForm,"barcode",t)},expression:"scanForm.barcode"}},[a("template",{slot:"append"},[a("el-button",{on:{click:e.handleScanInput}},[e._v("确认")])],1)],2)],1)],1),e._v(" "),e.entryInfo?a("div",{staticClass:"entry-info"},[a("el-card",{staticClass:"box-card"},[a("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[a("span",[e._v("出库单信息")])]),e._v(" "),a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:8}},[a("div",{staticClass:"info-item"},[a("label",[e._v("出库单号：")]),e._v(" "),a("span",[e._v(e._s(e.entryInfo.entryNo))])])]),e._v(" "),a("el-col",{attrs:{span:8}},[a("div",{staticClass:"info-item"},[a("label",[e._v("生产订单：")]),e._v(" "),a("span",[e._v(e._s(e.entryInfo.productionOrderNo))])])]),e._v(" "),a("el-col",{attrs:{span:8}},[a("div",{staticClass:"info-item"},[a("label",[e._v("销售订单：")]),e._v(" "),a("span",[e._v(e._s(e.entryInfo.saleOrderNo))])])])],1),e._v(" "),a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:8}},[a("div",{staticClass:"info-item"},[a("label",[e._v("物料名称：")]),e._v(" "),a("span",[e._v(e._s(e.entryInfo.materialName))])])]),e._v(" "),a("el-col",{attrs:{span:8}},[a("div",{staticClass:"info-item"},[a("label",[e._v("规格型号：")]),e._v(" "),a("span",[e._v(e._s(e.entryInfo.materialSpec))])])]),e._v(" "),a("el-col",{attrs:{span:8}},[a("div",{staticClass:"info-item"},[a("label",[e._v("完成进度：")]),e._v(" "),a("el-progress",{attrs:{percentage:e.entryInfo.progress,status:e.entryInfo.progress>=100?"success":""}})],1)])],1),e._v(" "),a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:8}},[a("div",{staticClass:"info-item"},[a("label",[e._v("销售数量：")]),e._v(" "),a("span",[e._v(e._s(e.entryInfo.plannedQuantity))])])]),e._v(" "),a("el-col",{attrs:{span:8}},[a("div",{staticClass:"info-item"},[a("label",[e._v("实际数量：")]),e._v(" "),a("span",[e._v(e._s(e.entryInfo.actualQuantity))])])]),e._v(" "),a("el-col",{attrs:{span:8}},[a("div",{staticClass:"info-item"},[a("label",[e._v("托盘数量：")]),e._v(" "),a("span",[e._v(e._s(e.entryInfo.palletCount))])])])],1)],1)],1):e._e(),e._v(" "),a("div",{staticClass:"scan-list"},[a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.scanRecords,border:""}},[a("el-table-column",{attrs:{label:"托盘编号",prop:"palletCode",align:"center"}}),e._v(" "),a("el-table-column",{attrs:{label:"销售订单",prop:"saleOrderNo",align:"center"}}),e._v(" "),a("el-table-column",{attrs:{label:"物料编码",prop:"materialCode",align:"center"}}),e._v(" "),a("el-table-column",{attrs:{label:"数量",prop:"quantity",align:"center"}}),e._v(" "),a("el-table-column",{attrs:{label:"产线",prop:"lineCode",align:"center"}}),e._v(" "),a("el-table-column",{attrs:{label:"扫描时间",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n            "+e._s(e.formatDateTime(t.row.scanTime))+"\n          ")]}}])})],1)],1)],1),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.dialogVisible=!1}}},[e._v("取 消")]),e._v(" "),a("el-button",{attrs:{type:"primary",disabled:!e.scanRecords.length},on:{click:e.handleComplete}},[e._v("\n      完成出库\n    ")])],1)])}),[],!1,null,"3182c0c0",null);t.default=u.exports}}]);