# å¿«é€Ÿæ“ä½œæŒ‡å—

## ğŸš€ ç«‹å³ä¿®å¤å½“å‰é—®é¢˜

### ä¸€é”®ä¿®å¤ï¼ˆæ¨èï¼‰

```bash
cd /Users/laijiwei/Documents/é¡¹ç›®/å¾·æ˜Œé¡¹ç›®/dcmes/dechang-mes/dcMes_server

# ä¿®å¤è¿™ä¸ªå‡ºåº“å•
node scripts/fixWarehouseEntryQuantity.js --entryNo SCCK-MES-20251102-0001
```

### ä½¿ç”¨ API ä¿®å¤

```bash
# æ–¹æ³•1ï¼šä¿®å¤æ•°é‡è®¡ç®—
curl -X POST http://localhost:3000/api/v1/warehouse_entry/fix_quantities \
  -H "Content-Type: application/json" \
  -d '{"entryId": "6906baeb95cbf563ec914213"}'

# æ–¹æ³•2ï¼šæ¸…ç†é‡å¤æ‰˜ç›˜ï¼ˆå¦‚æœæœ‰ï¼‰
curl -X POST http://localhost:3000/api/v1/warehouse_entry/clean_duplicate_pallets \
  -H "Content-Type: application/json" \
  -d '{"entryId": "6906baeb95cbf563ec914213"}'
```

---

## ğŸ” æ£€æŸ¥æ‰€æœ‰å‡ºåº“å•

### æ£€æŸ¥æ˜¯å¦æœ‰å…¶ä»–é—®é¢˜

```bash
# æ£€æŸ¥æ‰€æœ‰è¶…å‡ºæ•°é‡çš„å‡ºåº“å•
node scripts/checkWarehouseEntryQuantity.js --exceeded

# æ£€æŸ¥æ‰€æœ‰è¿›è¡Œä¸­å’Œå·²å®Œæˆçš„å‡ºåº“å•
node scripts/checkWarehouseEntryQuantity.js

# æ£€æŸ¥ç‰¹å®šå‡ºåº“å•
node scripts/checkWarehouseEntryQuantity.js SCCK-MES-20251102-0001
```

### æ‰¹é‡ä¿®å¤

```bash
# ä¿®å¤æ‰€æœ‰è¶…å‡ºæ•°é‡çš„å‡ºåº“å•
node scripts/fixWarehouseEntryQuantity.js --exceeded

# æ ¹æ®æ£€æŸ¥æŠ¥å‘Šä¿®å¤
node scripts/fixWarehouseEntryQuantity.js --report warehouse_entry_check_report_xxxxx.json
```

---

## ğŸ”„ åº”ç”¨ä»£ç ä¿®å¤

### é‡å¯æœåŠ¡

```bash
# å¦‚æœä½¿ç”¨ PM2
pm2 restart dcMes_server

# å¦‚æœä½¿ç”¨ npm
cd /Users/laijiwei/Documents/é¡¹ç›®/å¾·æ˜Œé¡¹ç›®/dcmes/dechang-mes/dcMes_server
npm restart

# å¦‚æœç›´æ¥è¿è¡Œ
# åœæ­¢å½“å‰è¿›ç¨‹ï¼Œç„¶åï¼š
npm start
```

### éªŒè¯ä¿®å¤æ˜¯å¦ç”Ÿæ•ˆ

```bash
# æŸ¥çœ‹ä»£ç æ˜¯å¦åŒ…å«æ–°çš„æ£€æŸ¥
grep -n "æ£€æŸ¥å‡ºåº“å•çŠ¶æ€" routes/wareHouseOntry.js

# åº”è¯¥çœ‹åˆ°ä¸¤å¤„ï¼š
# ç¬¬623è¡Œï¼šscan_on æ¥å£
# ç¬¬1626è¡Œï¼šsubmit_product æ¥å£
```

---

## âœ… æµ‹è¯•éªŒè¯

### æµ‹è¯•1ï¼šå·²å®Œæˆå‡ºåº“å•æ— æ³•ç»§ç»­æ·»åŠ 

1. æ‰¾ä¸€ä¸ªå·²å®Œæˆçš„å‡ºåº“å•
2. å°è¯•æ‰«æäº§å“æˆ–æ‰˜ç›˜
3. **é¢„æœŸç»“æœ**ï¼šè¿”å› 403 é”™è¯¯ï¼Œæç¤º"å‡ºåº“å•å·²å®Œæˆ"

### æµ‹è¯•2ï¼šæ— æ³•è¶…å‡ºåº”å‡ºåº“æ•°é‡

1. åˆ›å»ºä¸€ä¸ªåº”å‡ºåº“æ•°é‡ä¸º10çš„å‡ºåº“å•
2. æ‰«æ10ä¸ªäº§å“
3. å°è¯•å†æ‰«æç¬¬11ä¸ªäº§å“
4. **é¢„æœŸç»“æœ**ï¼šè¿”å› 403 é”™è¯¯ï¼Œæç¤º"å·²è¾¾åˆ°åº”å‡ºåº“æ•°é‡"

### æµ‹è¯•3ï¼šæ­£å¸¸å®Œæˆ

1. åˆ›å»ºä¸€ä¸ªåº”å‡ºåº“æ•°é‡ä¸º5çš„å‡ºåº“å•
2. æ‰«æ5ä¸ªäº§å“
3. **é¢„æœŸç»“æœ**ï¼š
   - å‡ºåº“å•çŠ¶æ€å˜ä¸º COMPLETED
   - outNumber = 5
   - æ— é”™è¯¯æ—¥å¿—

---

## ğŸ“Š æŸ¥çœ‹ä¿®å¤ç»“æœ

### æ£€æŸ¥ä¿®å¤åçš„å‡ºåº“å•

```bash
# ä½¿ç”¨ MongoDB å‘½ä»¤
mongo dcmes

db.warehouseontries.findOne({ entryNo: "SCCK-MES-20251102-0001" }, {
  entryNo: 1,
  outboundQuantity: 1,
  outNumber: 1,
  actualQuantity: 1,
  palletCount: 1,
  status: 1
})
```

### é¢„æœŸç»“æœ

```json
{
  "entryNo": "SCCK-MES-20251102-0001",
  "outboundQuantity": 1000,
  "outNumber": 1000,        // åº”è¯¥ä¿®å¤ä¸º1000
  "actualQuantity": 1000,   // åº”è¯¥ä¿®å¤ä¸º1000
  "palletCount": 44,        // åº”è¯¥ä¿®å¤ä¸º44
  "status": "COMPLETED"
}
```

---

## ğŸ†˜ å¸¸è§é—®é¢˜

### Q1: ä¿®å¤è„šæœ¬è¿è¡Œå¤±è´¥ï¼Ÿ

**å¯èƒ½åŸå› **ï¼š
- æ•°æ®åº“è¿æ¥å¤±è´¥
- æƒé™ä¸è¶³
- å‡ºåº“å•ä¸å­˜åœ¨

**è§£å†³æ–¹æ³•**ï¼š
```bash
# æ£€æŸ¥æ•°æ®åº“è¿æ¥
mongo dcmes --eval "db.runCommand({ping:1})"

# æ£€æŸ¥ç¯å¢ƒå˜é‡
echo $DB_HOST
echo $DB_NAME
```

### Q2: ä¿®å¤åæ•°é‡è¿˜æ˜¯ä¸å¯¹ï¼Ÿ

**è§£å†³æ–¹æ³•**ï¼š
```bash
# é‡æ–°è¿è¡Œæ£€æŸ¥
node scripts/checkWarehouseEntryQuantity.js SCCK-MES-20251102-0001

# æŸ¥çœ‹è¯¦ç»†æŠ¥å‘Š
cat warehouse_entry_check_report_*.json

# å¦‚æœè¿˜æœ‰é—®é¢˜ï¼Œè”ç³»å¼€å‘è€…
```

### Q3: ä»£ç ä¿®æ”¹åæœåŠ¡æ— æ³•å¯åŠ¨ï¼Ÿ

**å¯èƒ½åŸå› **ï¼š
- è¯­æ³•é”™è¯¯
- ä¾èµ–ç¼ºå¤±

**è§£å†³æ–¹æ³•**ï¼š
```bash
# æ£€æŸ¥è¯­æ³•é”™è¯¯
node -c routes/wareHouseOntry.js

# æŸ¥çœ‹é”™è¯¯æ—¥å¿—
pm2 logs dcMes_server

# å›æ»šä»£ç ï¼ˆå¦‚æœéœ€è¦ï¼‰
git checkout routes/wareHouseOntry.js
```

### Q4: å¦‚ä½•å¤„ç†çœŸçš„éœ€è¦å‡ºåº“1001ä¸ªï¼Ÿ

å¦‚æœç¡®å®éœ€è¦å‡ºåº“1001ä¸ªäº§å“ï¼š

**æ–¹æ³•1ï¼šä¿®æ”¹åº”å‡ºåº“æ•°é‡**
```bash
mongo dcmes

db.warehouseontries.updateOne(
  { entryNo: "SCCK-MES-20251102-0001" },
  { 
    $set: { 
      outboundQuantity: 1001,
      updateAt: new Date()
    } 
  }
)
```

**æ–¹æ³•2ï¼šåˆ›å»ºæ–°çš„å‡ºåº“å•**
- åˆ é™¤å½“å‰å‡ºåº“å•ï¼ˆä½¿ç”¨ delete_entry APIï¼‰
- é‡æ–°åˆ›å»ºï¼Œåº”å‡ºåº“æ•°é‡è®¾ç½®ä¸º1001
- é‡æ–°æ‰«ææ‰€æœ‰æ‰˜ç›˜

---

## ğŸ“ æ“ä½œæ£€æŸ¥æ¸…å•

### ä¿®å¤å‰
- [ ] å¤‡ä»½æ•°æ®åº“
- [ ] è¿è¡Œæ£€æŸ¥è„šæœ¬
- [ ] æŸ¥çœ‹æ£€æŸ¥æŠ¥å‘Š
- [ ] ç¡®è®¤é—®é¢˜åŸå› 

### ä¿®å¤ä¸­
- [ ] åœæ­¢æœåŠ¡
- [ ] åº”ç”¨ä»£ç ä¿®å¤
- [ ] è¿è¡Œæ•°æ®ä¿®å¤è„šæœ¬
- [ ] å¯åŠ¨æœåŠ¡

### ä¿®å¤å
- [ ] é‡æ–°è¿è¡Œæ£€æŸ¥è„šæœ¬
- [ ] éªŒè¯æ•°æ®æ˜¯å¦æ­£ç¡®
- [ ] æµ‹è¯•æ–°çš„é™åˆ¶æ˜¯å¦ç”Ÿæ•ˆ
- [ ] ç›‘æ§é”™è¯¯æ—¥å¿—
- [ ] é€šçŸ¥ç›¸å…³äººå‘˜

---

## ğŸ“ è·å–å¸®åŠ©

### æŸ¥çœ‹è¯¦ç»†æ–‡æ¡£

```bash
cd scripts

# é—®é¢˜æ€»ç»“
cat é—®é¢˜æ€»ç»“.md

# å®Œæ•´è§£å†³æ–¹æ¡ˆ
cat SOLUTION_SUMMARY.md

# æ·±åº¦åˆ†æ
cat ISSUE_ANALYSIS_warehouse.md

# ä½¿ç”¨è¯´æ˜
cat README_warehouse_check.md
```

### è”ç³»å¼€å‘è€…

- **é‚®ç®±**ï¼š1798245303@qq.com
- **æä¾›ä¿¡æ¯**ï¼š
  1. å‡ºåº“å•å·
  2. æ£€æŸ¥æŠ¥å‘Šæ–‡ä»¶
  3. é”™è¯¯æ—¥å¿—
  4. æ“ä½œæ­¥éª¤

---

## ğŸ¯ ä¸€é”®å‘½ä»¤æ±‡æ€»

```bash
# 1. æ£€æŸ¥é—®é¢˜
node scripts/checkWarehouseEntryQuantity.js SCCK-MES-20251102-0001

# 2. ä¿®å¤é—®é¢˜
node scripts/fixWarehouseEntryQuantity.js --entryNo SCCK-MES-20251102-0001

# 3. é‡å¯æœåŠ¡
pm2 restart dcMes_server

# 4. éªŒè¯ä¿®å¤
node scripts/checkWarehouseEntryQuantity.js SCCK-MES-20251102-0001

# 5. æ£€æŸ¥æ‰€æœ‰
node scripts/checkWarehouseEntryQuantity.js --exceeded

# 6. æ‰¹é‡ä¿®å¤
node scripts/fixWarehouseEntryQuantity.js --exceeded
```

---

**é¢„è®¡æ“ä½œæ—¶é—´**ï¼š5-10åˆ†é’Ÿ  
**é£é™©ç­‰çº§**ï¼šä½ï¼ˆæœ‰å¤‡ä»½å’Œå›æ»šæœºåˆ¶ï¼‰  
**å½±å“èŒƒå›´**ï¼šå•ä¸ªæˆ–å¤šä¸ªå‡ºåº“å•

