(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-2d222794"],{cf83:function(e,t,r){"use strict";r.r(t);var i=r("c7eb"),s=(r("96cf"),r("1da1")),a=(r("6762"),r("2fdb"),r("ac6a"),r("456d"),r("7e1e")),n={dicts:["tracker_task_progress"],name:"TaskProgressDialog",props:{visible:{type:Boolean,default:!1},currentClaim:{type:Object,default:function(){return{}}},statusList:{type:Array,default:function(){return[]}}},data:function(){return{isAdmin:!1,isAgent:!1,isTracker:!1,currentUserId:"",form:{status:"",trackerId:"",step:"",remark:"",trackingInfo:{buildConnectionSource:"",cooperationDate:null,receiveTime:null,estimatedPublishTime:null}},rules:{status:[{required:!0,message:"请选择进度状态",trigger:"change"}],step:[{message:"请输入进度说明",trigger:"blur"}],"trackingInfo.buildConnectionSource":[{required:!0,message:"请输入建联来源",trigger:"blur"}],"trackingInfo.cooperationDate":[{required:!0,message:"请选择确定合作日",trigger:"change"}],"trackingInfo.receiveTime":[{required:!0,message:"请选择收货时间",trigger:"change"}],"trackingInfo.estimatedPublishTime":[{required:!0,message:"请选择预计发布时间",trigger:"change"}]},trackerOptions:[]}},watch:{visible:{immediate:!0,handler:function(e){e&&(this.initForm(),this.getCurrentUser(),this.loadTrackerOptions())}},currentClaim:{immediate:!0,handler:function(e){e&&Object.keys(e).length>0&&this.initForm()}}},computed:{dialogVisible:{get:function(){return this.visible},set:function(e){this.$emit("update:visible",e)}},showTrackingInfo:function(){return console.log(this.dict.type),this.dict.type.tracker_task_progress.map((function(e){return e.value})).includes(this.form.status)},availableStatuses:function(){return this.statusList}},methods:{handleClose:function(){this.dialogVisible=!1},getCurrentUser:function(){var e=Object(s.a)(Object(i.a)().mark((function e(){return Object(i.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:try{this.isAdmin=this.$store.getters.roles.label.includes("Admin"),this.isAgent=this.$store.getters.roles.label.includes("Agent")||this.$store.getters.roles.label.includes("Admin"),this.isTracker=this.$store.getters.roles.label.includes("Tracker")||this.$store.getters.roles.label.includes("Admin"),this.currentUserId=this.$store.state.user.id}catch(e){console.error("获取用户信息失败:",e)}case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),initForm:function(){if(this.currentClaim){var e=this.currentClaim.progressSteps||[],t=(e.length>0?e[e.length-1]:{}).trackingInfo||{};this.form={status:this.currentClaim.status||"",trackerId:this.currentClaim.trackerId||"",step:"",remark:"",trackingInfo:{buildConnectionSource:t.buildConnectionSource||"",cooperationDate:t.cooperationDate||null,receiveTime:t.receiveTime||null,estimatedPublishTime:t.estimatedPublishTime||null}}}},loadTrackerOptions:function(){var e=Object(s.a)(Object(i.a)().mark((function e(){var t;return Object(i.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Object(a.b)("user_login",{query:{role:"6734de3a55647e147063f158"}});case 3:(t=e.sent).data&&(this.trackerOptions=t.data.map((function(e){return{value:e._id,label:e.nickName||e.username}}))),e.next=11;break;case 7:e.prev=7,e.t0=e.catch(0),console.error("获取任务跟踪员列表失败:",e.t0),this.$message.error("获取任务跟踪员列表失败");case 11:case"end":return e.stop()}}),e,this,[[0,7]])})));return function(){return e.apply(this,arguments)}}(),handleSubmit:function(){var e=Object(s.a)(Object(i.a)().mark((function e(){return Object(i.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.$refs.progressForm.validate();case 3:if("合作成功"!==this.form.status){e.next=13;break}if(this.form.trackerId){e.next=7;break}return this.$message.error("请选择任务跟踪员"),e.abrupt("return");case 7:if(this.form.trackingInfo.buildConnectionSource){e.next=10;break}return this.$message.error("请输入建联来源"),e.abrupt("return");case 10:if(this.form.trackingInfo.cooperationDate){e.next=13;break}return this.$message.error("请选择确定合作日"),e.abrupt("return");case 13:if("已签收"!==this.form.status||this.form.trackingInfo.receiveTime){e.next=16;break}return this.$message.error("请选择收货时间"),e.abrupt("return");case 16:if("内容制作中"!==this.form.status||this.form.trackingInfo.estimatedPublishTime){e.next=19;break}return this.$message.error("请选择预计发布时间"),e.abrupt("return");case 19:this.$emit("submit",this.form),this.handleClose(),e.next=26;break;case 23:e.prev=23,e.t0=e.catch(0),console.error("表单验证失败:",e.t0);case 26:case"end":return e.stop()}}),e,this,[[0,23]])})));return function(){return e.apply(this,arguments)}}()}},o=n,c=r("2877"),l=Object(c.a)(o,(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("el-dialog",{attrs:{title:"更新进度",visible:e.dialogVisible,width:"60%","custom-class":"progress-dialog","append-to-body":""},on:{"update:visible":function(t){e.dialogVisible=t},close:e.handleClose}},[r("el-form",{ref:"progressForm",attrs:{model:e.form,rules:e.rules,"label-width":"120px"}},[r("el-form-item",{attrs:{label:"进度状态",prop:"status"}},[r("el-select",{staticStyle:{width:"100%"},model:{value:e.form.status,callback:function(t){e.$set(e.form,"status",t)},expression:"form.status"}},e._l(e.availableStatuses,(function(e){return r("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),e._v(" "),"合作成功"===e.form.status?r("el-form-item",{attrs:{label:"任务跟踪员",prop:"trackerId",rules:{required:!0,message:"请选择任务跟踪员",trigger:"change"}}},[r("el-select",{staticStyle:{width:"100%"},attrs:{filterable:"",placeholder:"请选择任务跟踪员"},model:{value:e.form.trackerId,callback:function(t){e.$set(e.form,"trackerId",t)},expression:"form.trackerId"}},e._l(e.trackerOptions,(function(e){return r("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1):e._e(),e._v(" "),e.isAgent?[r("div",{staticClass:"tracking-info-section"},[["合作成功"].includes(e.form.status)?r("el-form-item",{attrs:{label:"建联来源",prop:"trackingInfo.buildConnectionSource"}},[r("el-input",{attrs:{placeholder:"请输入建联来源"},model:{value:e.form.trackingInfo.buildConnectionSource,callback:function(t){e.$set(e.form.trackingInfo,"buildConnectionSource",t)},expression:"form.trackingInfo.buildConnectionSource"}})],1):e._e(),e._v(" "),["合作成功"].includes(e.form.status)?r("el-form-item",{attrs:{label:"确定合作日",prop:"trackingInfo.cooperationDate"}},[r("el-date-picker",{staticStyle:{width:"100%"},attrs:{type:"date",placeholder:"选择确定合作日"},model:{value:e.form.trackingInfo.cooperationDate,callback:function(t){e.$set(e.form.trackingInfo,"cooperationDate",t)},expression:"form.trackingInfo.cooperationDate"}})],1):e._e()],1)]:e._e(),e._v(" "),e.isTracker?[r("div",{staticClass:"tracking-info-section"},[["已签收"].includes(e.form.status)?r("el-form-item",{attrs:{label:"收货时间",prop:"trackingInfo.receiveTime"}},[r("el-date-picker",{staticStyle:{width:"100%"},attrs:{type:"datetime",placeholder:"选择收货时间"},model:{value:e.form.trackingInfo.receiveTime,callback:function(t){e.$set(e.form.trackingInfo,"receiveTime",t)},expression:"form.trackingInfo.receiveTime"}})],1):e._e()],1)]:e._e(),e._v(" "),r("el-form-item",{attrs:{label:"进度备注",prop:"step"}},[r("el-input",{attrs:{placeholder:"进度备注"},model:{value:e.form.step,callback:function(t){e.$set(e.form,"step",t)},expression:"form.step"}})],1)],2),e._v(" "),r("div",{attrs:{slot:"footer"},slot:"footer"},[r("el-button",{on:{click:e.handleClose}},[e._v("取 消")]),e._v(" "),r("el-button",{attrs:{type:"primary"},on:{click:e.handleSubmit}},[e._v("确 定")])],1)],1)}),[],!1,null,null,null);t.default=l.exports}}]);