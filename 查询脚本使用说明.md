# 工单产品条码托盘信息查询脚本使用说明

## 脚本简介

`check_missing_barcodes_in_pallet.js` 是一个用于查询工单已完成产品条码流程记录中哪些没在托盘信息中的查询脚本。

## 主要功能

1. **工单查询模式**: 根据工单ID查询该工单下所有已完成的产品条码流程记录，检查哪些条码未在托盘中
2. **条码查询模式**: 检查特定产品条码是否在任何托盘中，以及在哪个托盘中

## 使用方法

### 1. 查询工单中未在托盘的条码

```bash
node check_missing_barcodes_in_pallet.js [工单ID]
```

**示例:**
```bash
node check_missing_barcodes_in_pallet.js 507f1f77bcf86cd799439011
```

### 2. 查询特定条码在托盘中的情况

```bash
node check_missing_barcodes_in_pallet.js --barcode [产品条码]
```

**示例:**
```bash
node check_missing_barcodes_in_pallet.js --barcode ABC123456789
```

## 输出结果说明

### 工单查询模式输出

脚本会显示以下信息：

1. **查询结果统计**
   - 已完成产品条码总数
   - 已在托盘中的条码数量
   - 未在托盘中的条码数量

2. **已在托盘中的条码列表**
   - 序号、条码、物料编码、物料名称、完成时间、托盘编号、托盘状态

3. **未在托盘中的条码列表** 
   - 序号、条码、物料编码、物料名称、完成时间、创建时间

### 条码查询模式输出

显示指定条码在托盘中的详细信息：
- 托盘编号
- 托盘状态
- 扫码时间
- 托盘容量信息

## 应用场景

1. **质量检查**: 检查已完成的产品是否都正确组托
2. **数据校验**: 验证工单完成情况与托盘信息的一致性
3. **问题排查**: 找出未正确组托的产品条码，便于后续处理
4. **生产追溯**: 查看特定条码的托盘归属情况

## 技术特点

- 基于MongoDB数据库查询
- 支持大批量数据处理
- 友好的中文输出格式
- 完善的错误处理机制
- 详细的查询统计信息

## 注意事项

1. 确保数据库连接正常
2. 工单ID必须是有效的MongoDB ObjectId格式
3. 脚本会自动处理空条码的情况
4. 查询仅包含状态为"COMPLETED"的流程记录

## 相关模型

- `MaterialProcessFlow`: 物料工艺流程记录
- `MaterialPalletizing`: 托盘信息记录

## 维护说明

如需修改数据库连接配置，请编辑脚本中的 `mongodbUrl` 和 `connectOptions` 参数。 