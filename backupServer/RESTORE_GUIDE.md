# å¾·æ˜ŒMESå¤‡ä»½è¿˜åŸæ“ä½œæŒ‡å—

## ğŸ“‹ ç›®å½•ç»“æ„è¯´æ˜

### ğŸ—‚ï¸ æ–°ç‰ˆç›®å½•ç»“æ„ï¼ˆæ—¥æœŸ+ç±»å‹åˆ†ç±»ï¼‰
```
E:/backupServer/incrementalBackups/
â”œâ”€â”€ 2024-09-20/                      # æŒ‰æ—¥æœŸåˆ†ç»„
â”‚   â”œâ”€â”€ hot/                         # é«˜é¢‘æ•°æ®å¤‡ä»½
â”‚   â”‚   â”œâ”€â”€ daily_2024-09-20_14-30-00_warehouse_entries.archive.gz
â”‚   â”‚   â””â”€â”€ daily_2024-09-20_14-30-00_material_palletizings.archive.gz
â”‚   â”œâ”€â”€ daily/                       # æ—¥å¸¸æ•°æ®å¤‡ä»½
â”‚   â”‚   â”œâ”€â”€ daily_2024-09-20_14-30-00_api_logs.archive.gz
â”‚   â”‚   â””â”€â”€ daily_2024-09-20_14-30-00_system_log.archive.gz
â”‚   â”œâ”€â”€ full/                        # å…¨è¡¨å¤‡ä»½
â”‚   â”‚   â”œâ”€â”€ full_2024-09-20_14-30-00_warehouse_entries.archive.gz
â”‚   â”‚   â””â”€â”€ full_2024-09-20_14-30-00_roles.archive.gz
â”‚   â””â”€â”€ history/                     # å†å²æ•°æ®å¤‡ä»½
â”‚       â””â”€â”€ 30d_2024-09-20_14-30-00_api_logs.archive.gz
â”œâ”€â”€ 2024-09-21/                      # ç¬¬äºŒå¤©çš„å¤‡ä»½
â”‚   â””â”€â”€ ...
â”œâ”€â”€ logs/                            # ç³»ç»Ÿæ—¥å¿—
â”‚   â”œâ”€â”€ incremental_backup.log
â”‚   â”œâ”€â”€ restore.log
â”‚   â””â”€â”€ alerts.log
â””â”€â”€ safety_backups/                  # å®‰å…¨å¤‡ä»½ï¼ˆè¿˜åŸå‰è‡ªåŠ¨åˆ›å»ºï¼‰
    â””â”€â”€ 2024-09-20T15-30-00/
        â””â”€â”€ users.archive
```

### ğŸ“ å¤‡ä»½æ–‡ä»¶å‘½åè§„åˆ™

| å‰ç¼€ | å«ä¹‰ | ç¤ºä¾‹ |
|------|------|------|
| `full_` | å…¨è¡¨å¤‡ä»½ï¼ˆæ— æ—¶é—´é™åˆ¶ï¼‰ | `full_2024-09-20_14-30-00_users.archive.gz` |
| `daily_` | å½“å¤©æ•°æ®å¤‡ä»½ | `daily_2024-09-20_14-30-00_orders.archive.gz` |
| `24h_` | æœ€è¿‘24å°æ—¶æ•°æ® | `24h_2024-09-20_14-30-00_logs.archive.gz` |
| `30d_` | æœ€è¿‘30å¤©æ•°æ® | `30d_2024-09-20_14-30-00_warehouse.archive.gz` |
| `custom_` | è‡ªå®šä¹‰æ—¶é—´èŒƒå›´ | `custom_2024-09-20_14-30-00_reports.archive.gz` |

## ğŸ›¡ï¸ å®‰å…¨æ£€æŸ¥æ¸…å•ï¼ˆå¿…è¯»ï¼‰

åœ¨æ‰§è¡Œä»»ä½•è¿˜åŸæ“ä½œå‰ï¼Œè¯·ç¡®è®¤ï¼š

- [ ] **âœ… å·²äº†è§£è¿˜åŸæ¨¡å¼**ï¼šé»˜è®¤ä¸ºåˆå¹¶æ¨¡å¼ï¼ˆå®‰å…¨ï¼‰ï¼Œä¸ä¼šæ¸…é™¤ç°æœ‰æ•°æ®
- [ ] **âœ… å¯ç”¨å®‰å…¨å¤‡ä»½**ï¼šç³»ç»Ÿä¼šè‡ªåŠ¨å¤‡ä»½å½“å‰æ•°æ®åˆ° `safety_backups/` ç›®å½•
- [ ] **âœ… å…ˆè¯•è¿è¡Œ**ï¼šä½¿ç”¨ `--dry-run` å‚æ•°éªŒè¯è¿˜åŸè¿‡ç¨‹
- [ ] **âœ… é€‰æ‹©æ­£ç¡®å¤‡ä»½**ï¼šç¡®è®¤å¤‡ä»½æ–‡ä»¶çš„æ—¥æœŸã€ç±»å‹å’Œé›†åˆ
- [ ] **âœ… ä¸šåŠ¡ä½å³°æœŸ**ï¼šåœ¨åˆé€‚çš„æ—¶é—´æ‰§è¡Œè¿˜åŸæ“ä½œ

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. æŸ¥çœ‹å¯ç”¨å¤‡ä»½

```bash
# åˆ—å‡ºæ‰€æœ‰å¯ç”¨çš„å¤‡ä»½æ–‡ä»¶
node restore_manager.js --list
```

**è¾“å‡ºç¤ºä¾‹ï¼š**
```
ğŸ“ æ‰¾åˆ° 15 ä¸ªå¤‡ä»½æ–‡ä»¶:

åºå· | æ—¥æœŸ       | ç±»å‹   | å¤‡ä»½ç±»å‹   | é›†åˆåç§°            | å¤‡ä»½æ—¶é—´            | æ–‡ä»¶å¤§å°   
-----|------------|--------|------------|---------------------|---------------------|------------|
   1 | 2024-09-20 | full   | å…¨è¡¨å¤‡ä»½   | warehouse_entries   | 2024/9/20 14:30:00  | 2.5 MB     
   2 | 2024-09-20 | hot    | å½“å¤©å¤‡ä»½   | material_palletizings| 2024/9/20 14:00:00  | 1.8 MB     
   3 | 2024-09-20 | daily  | å½“å¤©å¤‡ä»½   | api_logs            | 2024/9/20 13:00:00  | 856 KB     
```

### 2. äº¤äº’å¼è¿˜åŸï¼ˆæ¨èæ–°æ‰‹ä½¿ç”¨ï¼‰

```bash
# å¯åŠ¨äº¤äº’å¼è¿˜åŸæ¨¡å¼
node restore_manager.js --interactive
```

**äº¤äº’æµç¨‹ï¼š**
1. ç³»ç»Ÿæ˜¾ç¤ºæ‰€æœ‰å¯ç”¨å¤‡ä»½æ–‡ä»¶
2. è¾“å…¥è¦è¿˜åŸçš„æ–‡ä»¶åºå·
3. ç¡®è®¤æ–‡ä»¶ä¿¡æ¯
4. é€‰æ‹©æ˜¯å¦åˆ›å»ºå®‰å…¨å¤‡ä»½
5. é€‰æ‹©æ˜¯å¦è¯•è¿è¡Œæ¨¡å¼
6. æ‰§è¡Œè¿˜åŸæ“ä½œ

### 3. å‘½ä»¤è¡Œè¿˜åŸï¼ˆé«˜çº§ç”¨æˆ·ï¼‰

```bash
# è¿˜åŸæŒ‡å®šå¤‡ä»½æ–‡ä»¶
node restore_manager.js --restore --file="E:/backupServer/incrementalBackups/2024-09-20/full/full_2024-09-20_14-30-00_users.archive.gz"

# è¿˜åŸæŒ‡å®šæ—¥æœŸçš„æ‰€æœ‰å¤‡ä»½
node restore_manager.js --restore --date=2024-09-20

# è¿˜åŸæŒ‡å®šé›†åˆçš„æœ€æ–°å¤‡ä»½
node restore_manager.js --restore --collection=warehouse_entries

# éªŒè¯å¤‡ä»½æ–‡ä»¶å®Œæ•´æ€§
node restore_manager.js --verify --file="path/to/backup.archive.gz"
```

## ğŸ”§ è¿˜åŸé€‰é¡¹è¯¦è§£

### åŸºç¡€é€‰é¡¹

| é€‰é¡¹ | è¯´æ˜ | ç¤ºä¾‹ |
|------|------|------|
| `--list` | åˆ—å‡ºæ‰€æœ‰å¯ç”¨å¤‡ä»½æ–‡ä»¶ | `node restore_manager.js --list` |
| `--interactive` | äº¤äº’å¼è¿˜åŸæ¨¡å¼ | `node restore_manager.js --interactive` |
| `--restore` | æ‰§è¡Œè¿˜åŸæ“ä½œ | `node restore_manager.js --restore --file=backup.archive` |
| `--verify` | éªŒè¯å¤‡ä»½æ–‡ä»¶å®Œæ•´æ€§ | `node restore_manager.js --verify --file=backup.archive` |

### è¿˜åŸç›®æ ‡é€‰æ‹©

| é€‰é¡¹ | è¯´æ˜ | ç¤ºä¾‹ |
|------|------|------|
| `--file=<è·¯å¾„>` | è¿˜åŸæŒ‡å®šå¤‡ä»½æ–‡ä»¶ | `--file=2024-09-20/full/users.archive.gz` |
| `--date=<æ—¥æœŸ>` | è¿˜åŸæŒ‡å®šæ—¥æœŸçš„å¤‡ä»½ | `--date=2024-09-20` |
| `--collection=<é›†åˆå>` | è¿˜åŸæŒ‡å®šé›†åˆ | `--collection=warehouse_entries` |

### å®‰å…¨å’Œæµ‹è¯•é€‰é¡¹

| é€‰é¡¹ | è¯´æ˜ | é»˜è®¤å€¼ |
|------|------|--------|
| `--dry-run` | è¯•è¿è¡Œæ¨¡å¼ï¼ˆä¸å®é™…è¿˜åŸï¼‰ | false |
| `--skip-safety` | è·³è¿‡å®‰å…¨å¤‡ä»½åˆ›å»º | false |

### ç¯å¢ƒå˜é‡é…ç½®

```bash
# è®¾ç½®ç›®æ ‡æ•°æ®åº“ï¼ˆè¿˜åŸåˆ°ä¸åŒæ•°æ®åº“ï¼‰
export RESTORE_TARGET_DB=dcMes_test

# å¯ç”¨è¯•è¿è¡Œæ¨¡å¼
export RESTORE_DRY_RUN=true

# ç¦ç”¨å®‰å…¨å¤‡ä»½
export RESTORE_SAFETY_BACKUP=false

# è®¾ç½®è¿˜åŸæ¨¡å¼ï¼ˆé‡è¦ï¼ï¼‰
export RESTORE_MODE=merge-skip    # merge-skip(è·³è¿‡é‡å¤ï¼Œæœ€å®‰å…¨) | merge-upsert(æ›´æ–°é‡å¤) | replace(æ›¿æ¢âš ï¸)
```

## âš ï¸ é‡è¦å®‰å…¨æé†’

### é»˜è®¤è¿˜åŸè¡Œä¸ºå·²ä¼˜åŒ–ä¸ºåˆå¹¶æ¨¡å¼

| æ¨¡å¼ | è¡Œä¸º | ç›¸åŒ_idå¤„ç† | æ•°æ®å®‰å…¨æ€§ | ä½¿ç”¨åœºæ™¯ |
|------|------|------------|-----------|----------|
| `merge-skip` âœ… | ä¿ç•™åŸæ•°æ®ï¼Œæ·»åŠ æ–°æ•°æ® | è·³è¿‡é‡å¤ | ğŸ”’ æœ€å®‰å…¨ | æ—¥å¸¸è¿˜åŸã€æ•°æ®æ¢å¤ |
| `merge-upsert` ğŸ”„ | æ›´æ–°åŸæ•°æ®ï¼Œæ·»åŠ æ–°æ•°æ® | æ›´æ–°é‡å¤ | ğŸ”’ å®‰å…¨ | æ•°æ®åŒæ­¥ã€ä¿®å¤ä¸ä¸€è‡´ |
| `replace` âš ï¸ | æ¸…é™¤åŸæ•°æ®åå¯¼å…¥ | å®Œå…¨æ›¿æ¢ | âš ï¸ ä¼šä¸¢å¤±æ•°æ® | å…¨é‡é‡å»ºã€æµ‹è¯•ç¯å¢ƒ |

**è¯¦ç»†è¯´æ˜ï¼š**

### ğŸŸ¢ merge-skip æ¨¡å¼ï¼ˆé»˜è®¤æ¨èï¼‰
- **åŸç†**ï¼šMongoDBé»˜è®¤è¡Œä¸ºï¼Œè·³è¿‡ç›¸åŒ_idçš„æ–‡æ¡£
- **ç»“æœ**ï¼šä¿ç•™æ‰€æœ‰ç°æœ‰æ•°æ®ï¼Œåªæ·»åŠ å¤‡ä»½ä¸­æ–°çš„_idæ–‡æ¡£
- **é€‚ç”¨**ï¼šæ—¥å¸¸æ•°æ®æ¢å¤ï¼Œä¿æŠ¤ç°æœ‰æ•°æ®ä¸è¢«æ„å¤–è¦†ç›–

### ğŸ”µ merge-upsert æ¨¡å¼  
- **åŸç†**ï¼šä½¿ç”¨mongorestoreçš„--upsertå‚æ•°
- **ç»“æœ**ï¼šæ›´æ–°ç›¸åŒ_idçš„æ–‡æ¡£ä¸ºå¤‡ä»½ç‰ˆæœ¬ï¼Œæ·»åŠ æ–°_idæ–‡æ¡£
- **é€‚ç”¨**ï¼šæ•°æ®åŒæ­¥ï¼Œä¿®å¤æ•°æ®ä¸ä¸€è‡´é—®é¢˜

### ğŸ”´ replace æ¨¡å¼
- **åŸç†**ï¼šä½¿ç”¨mongorestoreçš„--dropå‚æ•°
- **ç»“æœ**ï¼šå®Œå…¨æ¸…é™¤é›†åˆåå¯¼å…¥å¤‡ä»½æ•°æ®
- **é€‚ç”¨**ï¼šæµ‹è¯•ç¯å¢ƒé‡å»ºï¼Œç¡®éœ€å®Œå…¨æ›¿æ¢æ—¶

## ğŸ“š ä½¿ç”¨åœºæ™¯ç¤ºä¾‹

### åœºæ™¯1ï¼šç³»ç»Ÿæ•°æ®æŸåï¼Œéœ€è¦ç´§æ€¥è¿˜åŸ

```bash
# 1. æŸ¥çœ‹ä»Šå¤©çš„å¤‡ä»½
node restore_manager.js --restore --date=$(date +%Y-%m-%d)

# 2. æˆ–è€…ä½¿ç”¨äº¤äº’æ¨¡å¼é€‰æ‹©å…·ä½“å¤‡ä»½
node restore_manager.js --interactive
```

### åœºæ™¯2ï¼šå¼€å‘æµ‹è¯•ï¼Œéœ€è¦è¿˜åŸç‰¹å®šé›†åˆ

```bash
# è¿˜åŸç”¨æˆ·è¡¨åˆ°æµ‹è¯•æ•°æ®åº“
export RESTORE_TARGET_DB=dcMes_test
node restore_manager.js --restore --collection=users --skip-safety
```

### åœºæ™¯3ï¼šéªŒè¯å¤‡ä»½æ–‡ä»¶å®Œæ•´æ€§

```bash
# éªŒè¯æœ€æ–°çš„å…¨è¡¨å¤‡ä»½
node restore_manager.js --verify --file="2024-09-20/full/full_2024-09-20_14-30-00_users.archive.gz"
```

### åœºæ™¯4ï¼šæ‰¹é‡è¿˜åŸæŸä¸ªæ—¶é—´æ®µçš„æ•°æ®

```bash
# è¿˜åŸæŒ‡å®šæ—¥æœŸçš„æ‰€æœ‰å¤‡ä»½
node restore_manager.js --restore --date=2024-09-20

# é€ä¸ªéªŒè¯å¤‡ä»½æ–‡ä»¶
for file in 2024-09-20/*/*.archive.gz; do
    node restore_manager.js --verify --file="$file"
done
```

### åœºæ™¯5ï¼šå¤„ç†ç›¸åŒæ•°æ®çš„ä¸åŒç­–ç•¥

å‡è®¾æ•°æ®åº“ä¸­å·²å­˜åœ¨ç”¨æˆ·æ•°æ®ï¼Œå¤‡ä»½æ–‡ä»¶åŒ…å«éƒ¨åˆ†ç›¸åŒç”¨æˆ·çš„æ›´æ–°ä¿¡æ¯ï¼š

```bash
# æ–¹æ¡ˆ1ï¼šå®‰å…¨åˆå¹¶ï¼ˆè·³è¿‡å·²å­˜åœ¨çš„ç”¨æˆ·ï¼Œåªæ·»åŠ æ–°ç”¨æˆ·ï¼‰
export RESTORE_MODE=merge-skip
node restore_manager.js --restore --collection=users

# æ–¹æ¡ˆ2ï¼šæ•°æ®åŒæ­¥ï¼ˆæ›´æ–°å·²å­˜åœ¨çš„ç”¨æˆ·ä¿¡æ¯ï¼Œæ·»åŠ æ–°ç”¨æˆ·ï¼‰ 
export RESTORE_MODE=merge-upsert
node restore_manager.js --restore --collection=users

# æ–¹æ¡ˆ3ï¼šå®Œå…¨æ›¿æ¢ï¼ˆæ¸…é™¤æ‰€æœ‰ç”¨æˆ·ï¼Œä½¿ç”¨å¤‡ä»½æ•°æ®ï¼‰
export RESTORE_MODE=replace
node restore_manager.js --restore --collection=users --dry-run  # å…ˆè¯•è¿è¡Œï¼
```

## ğŸ›¡ï¸ å®‰å…¨æ³¨æ„äº‹é¡¹

### 1. è¿˜åŸå‰è‡ªåŠ¨å®‰å…¨å¤‡ä»½

ç³»ç»Ÿä¼šåœ¨è¿˜åŸå‰è‡ªåŠ¨åˆ›å»ºå½“å‰æ•°æ®çš„å®‰å…¨å¤‡ä»½ï¼š

```
safety_backups/
â””â”€â”€ 2024-09-20T15-30-00/    # è‡ªåŠ¨ç”Ÿæˆçš„æ—¶é—´æˆ³ç›®å½•
    â”œâ”€â”€ users.archive        # è¿˜åŸå‰çš„å®‰å…¨å¤‡ä»½
    â”œâ”€â”€ orders.archive
    â””â”€â”€ ...
```

### 2. è¯•è¿è¡Œæ¨¡å¼

åœ¨ç”Ÿäº§ç¯å¢ƒæ‰§è¡Œè¿˜åŸå‰ï¼Œå¼ºçƒˆå»ºè®®å…ˆä½¿ç”¨è¯•è¿è¡Œæ¨¡å¼ï¼š

```bash
# è¯•è¿è¡ŒéªŒè¯
node restore_manager.js --restore --file=backup.archive --dry-run
```

### 3. ç›®æ ‡æ•°æ®åº“éš”ç¦»

å¯¹äºæµ‹è¯•å’Œå¼€å‘ï¼Œå»ºè®®è¿˜åŸåˆ°ç‹¬ç«‹çš„æ•°æ®åº“ï¼š

```bash
export RESTORE_TARGET_DB=dcMes_test
node restore_manager.js --restore --collection=users
```

## ğŸš¨ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

#### 1. "MongoDBå·¥å…·ä¸å¯ç”¨"
**è§£å†³æ–¹æ¡ˆï¼š**
```bash
# æ£€æŸ¥å·¥å…·æ˜¯å¦å®‰è£…
mongorestore --version

# å¦‚æœæœªå®‰è£…ï¼Œä¸‹è½½MongoDB Database Tools
# https://www.mongodb.com/try/download/database-tools
```

#### 2. "å¤‡ä»½æ–‡ä»¶ä¸å­˜åœ¨"
**è§£å†³æ–¹æ¡ˆï¼š**
```bash
# æ£€æŸ¥è·¯å¾„æ˜¯å¦æ­£ç¡®
ls -la "E:/backupServer/incrementalBackups/2024-09-20/"

# ä½¿ç”¨ --list æŸ¥çœ‹å¯ç”¨å¤‡ä»½
node restore_manager.js --list
```

#### 3. "æ•°æ®åº“è¿æ¥å¤±è´¥"
**è§£å†³æ–¹æ¡ˆï¼š**
```bash
# æ£€æŸ¥æ•°æ®åº“æœåŠ¡çŠ¶æ€
mongo --host 192.168.6.250:27017 --username dcMesCsManage

# æ£€æŸ¥config.jsä¸­çš„è¿æ¥é…ç½®
```

#### 4. "æƒé™ä¸è¶³"
**è§£å†³æ–¹æ¡ˆï¼š**
```bash
# ç¡®ä¿MongoDBç”¨æˆ·æœ‰è¶³å¤Ÿæƒé™
# åœ¨MongoDBä¸­æ‰§è¡Œï¼š
db.grantRolesToUser("dcMesCsManage", [
    { role: "readWrite", db: "dcMesCsManage" },
    { role: "restore", db: "dcMesCsManage" }
])
```

### æ—¥å¿—æŸ¥çœ‹

```bash
# æŸ¥çœ‹è¿˜åŸæ—¥å¿—
tail -f logs/restore.log

# æŸ¥çœ‹å¤‡ä»½æ—¥å¿—
tail -f logs/incremental_backup.log

# æŸ¥çœ‹å‘Šè­¦æ—¥å¿—
tail -f logs/alerts.log
```

## ğŸ“Š æ€§èƒ½ä¼˜åŒ–

### 1. å¹¶è¡Œè¿˜åŸé™åˆ¶

```bash
# è®¾ç½®å¹¶è¡Œè¿˜åŸæ•°é‡ï¼ˆé»˜è®¤2ï¼‰
export RESTORE_PARALLEL=1  # é™ä½å¹¶å‘ï¼Œå‡å°‘æ•°æ®åº“å‹åŠ›
```

### 2. å¤§æ–‡ä»¶è¿˜åŸ

å¯¹äºå¤§å‹å¤‡ä»½æ–‡ä»¶ï¼š
- é€‰æ‹©ä¸šåŠ¡ä½å³°æœŸæ‰§è¡Œ
- ç›‘æ§ç£ç›˜ç©ºé—´ä½¿ç”¨
- è€ƒè™‘åˆ†æ‰¹è¿˜åŸ

### 3. ç½‘ç»œä¼˜åŒ–

- ç¡®ä¿å¤‡ä»½æœåŠ¡å™¨ä¸æ•°æ®åº“æœåŠ¡å™¨ä¹‹é—´ç½‘ç»œç¨³å®š
- è€ƒè™‘ä½¿ç”¨æœ¬åœ°å¤‡ä»½æ–‡ä»¶å‡å°‘ç½‘ç»œä¼ è¾“

## ğŸ” ç›‘æ§å’ŒéªŒè¯

### è¿˜åŸçŠ¶æ€æ£€æŸ¥

```bash
# æ£€æŸ¥è¿˜åŸè¿›åº¦ï¼ˆåœ¨å¦ä¸€ä¸ªç»ˆç«¯ï¼‰
ps aux | grep mongorestore

# æ£€æŸ¥æ•°æ®åº“è¿æ¥æ•°
mongo --eval "db.serverStatus().connections"
```

### æ•°æ®å®Œæ•´æ€§éªŒè¯

è¿˜åŸå®Œæˆåï¼Œå»ºè®®æ‰§è¡Œæ•°æ®å®Œæ•´æ€§æ£€æŸ¥ï¼š

```bash
# è¿æ¥æ•°æ®åº“æ£€æŸ¥è®°å½•æ•°
mongo dcMesCsManage --eval "
  db.warehouse_entries.count();
  db.material_palletizings.count();
  db.api_logs.count();
"
```

## ğŸ”„ æœ€ä½³å®è·µ

### 1. è¿˜åŸæµç¨‹å»ºè®®

1. **è¯„ä¼°éœ€æ±‚** - ç¡®å®šéœ€è¦è¿˜åŸçš„å…·ä½“æ•°æ®èŒƒå›´
2. **é€‰æ‹©å¤‡ä»½** - æ ¹æ®æ—¶é—´å’Œç±»å‹é€‰æ‹©åˆé€‚çš„å¤‡ä»½æ–‡ä»¶
3. **ç¯å¢ƒå‡†å¤‡** - è®¾ç½®ç›®æ ‡æ•°æ®åº“ã€æƒé™ç­‰
4. **è¯•è¿è¡Œ** - ä½¿ç”¨ `--dry-run` éªŒè¯è¿˜åŸè¿‡ç¨‹
5. **åˆ›å»ºå®‰å…¨å¤‡ä»½** - ç¡®ä¿è¿˜åŸå‰æ•°æ®å®‰å…¨
6. **æ‰§è¡Œè¿˜åŸ** - åœ¨ä¸šåŠ¡ä½å³°æœŸæ‰§è¡Œ
7. **éªŒè¯ç»“æœ** - æ£€æŸ¥æ•°æ®å®Œæ•´æ€§å’Œä¸šåŠ¡åŠŸèƒ½
8. **æ–‡æ¡£è®°å½•** - è®°å½•è¿˜åŸæ“ä½œå’Œç»“æœ

### 2. å®šæœŸéªŒè¯

```bash
# æ¯å‘¨éªŒè¯å¤‡ä»½æ–‡ä»¶å®Œæ•´æ€§ï¼ˆç¤ºä¾‹è„šæœ¬ï¼‰
#!/bin/bash
for file in $(find backupPath -name "*.archive.gz" -mtime -7); do
    echo "éªŒè¯: $file"
    node restore_manager.js --verify --file="$file"
done
```

### 3. è‡ªåŠ¨åŒ–è„šæœ¬

åˆ›å»ºå¸¸ç”¨è¿˜åŸæ“ä½œçš„è„šæœ¬ï¼š

```bash
#!/bin/bash
# quick_restore.sh - å¿«é€Ÿè¿˜åŸè„šæœ¬

DATE=${1:-$(date +%Y-%m-%d)}
COLLECTION=${2:-""}

if [ -n "$COLLECTION" ]; then
    echo "è¿˜åŸé›†åˆ: $COLLECTION"
    node restore_manager.js --restore --collection="$COLLECTION" --dry-run
else
    echo "è¿˜åŸæ—¥æœŸ: $DATE çš„æ‰€æœ‰å¤‡ä»½"
    node restore_manager.js --restore --date="$DATE" --dry-run
fi
```

## ğŸ“ æŠ€æœ¯æ”¯æŒ

é‡åˆ°é—®é¢˜æ—¶ï¼š

1. **æŸ¥çœ‹æ—¥å¿—** - æ£€æŸ¥ `logs/` ç›®å½•ä¸‹çš„ç›¸å…³æ—¥å¿—
2. **éªŒè¯é…ç½®** - ç¡®è®¤ `config.js` é…ç½®æ­£ç¡®
3. **æ£€æŸ¥ç¯å¢ƒ** - éªŒè¯MongoDBå·¥å…·å’Œæƒé™
4. **è”ç³»ç®¡ç†å‘˜** - æä¾›è¯¦ç»†çš„é”™è¯¯æ—¥å¿—å’Œæ“ä½œæ­¥éª¤

---

**æ³¨æ„ï¼š** åœ¨ç”Ÿäº§ç¯å¢ƒä¸­æ‰§è¡Œè¿˜åŸæ“ä½œå‰ï¼Œè¯·åŠ¡å¿…ï¼š
- é€šçŸ¥ç›¸å…³ä¸šåŠ¡äººå‘˜
- åœ¨æµ‹è¯•ç¯å¢ƒä¸­éªŒè¯æµç¨‹
- åˆ›å»ºå®Œæ•´çš„å®‰å…¨å¤‡ä»½
- å‡†å¤‡å›æ»šæ–¹æ¡ˆ 