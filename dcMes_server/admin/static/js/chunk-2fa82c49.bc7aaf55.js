(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-2fa82c49"],{1024:function(e,t,a){"use strict";a("5ad8")},3575:function(e,t,a){"use strict";a("6a1f")},3927:function(e,t,a){},"5ad8":function(e,t,a){},"6a1f":function(e,t,a){},b022:function(e,t,a){},b58f:function(e,t,a){"use strict";a("3927")},cb66:function(e,t,a){"use strict";a("b022")},ed91:function(e,t,a){"use strict";a.d(t,"a",(function(){return r})),a.d(t,"b",(function(){return i})),a.d(t,"c",(function(){return o}));var s=a("b775");function r(e){return Object(s.a)({url:"/create-flow",method:"post",data:e})}function i(e){return Object(s.a)({url:"/scan-components",method:"post",data:e})}function o(e){return Object(s.a)({url:"/unbind-components",method:"post",data:e})}},fb50:function(e,t,a){"use strict";a.r(t);var s,r=(a("7f7f"),a("ade3")),i=a("3835"),o=(a("ffc1"),a("c5f6"),a("a481"),a("c7eb")),n=(a("20d6"),a("96cf"),a("1da1")),l=a("5530"),c=(a("55dd"),a("ac6a"),a("5df3"),a("f400"),a("7e1e")),d={name:"FlowNode",props:{node:{type:Object,required:!0}}},u=(a("3575"),a("2877")),_=Object(u.a)(d,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"flow-level"},[a("div",{staticClass:"node-container"},[a("div",{staticClass:"material-node",class:{"root-node":!e.node.materialQuantity,completed:e.node.barcode||"COMPLETED"===e.node.status}},[a("div",{staticClass:"node-title"},[e._v(e._s(e.node.materialName))]),e._v(" "),e.node.craftName?a("div",{staticClass:"node-subtitle"},[e._v("\n                工艺："+e._s(e.node.craftName)+"\n            ")]):e._e(),e._v(" "),e.node.barcode?a("div",{staticClass:"node-info"},[e._v("\n                条码："+e._s(e.node.barcode)+"\n            ")]):e._e(),e._v(" "),e.node.materialCode?a("div",{staticClass:"node-info"},[e._v("\n                编码："+e._s(e.node.materialCode)+"\n            ")]):e._e(),e._v(" "),e.node.scanOperation?a("div",{staticClass:"node-info"},[e._v("\n                扫码操作："+e._s(e.node.scanOperation?"需要扫码":"不需要扫码")+"\n            ")]):e._e(),e._v(" "),e.node.isComponent?a("div",{staticClass:"node-info"},[e._v("\n                是否组件："+e._s(e.node.isComponent?"是":"否")+"\n            ")]):e._e(),e._v(" "),e.node.materialQuantity?a("div",{staticClass:"node-info"},[e._v("\n                用量："+e._s(e.node.materialQuantity)+e._s(e.node.unit||"个")+"\n            ")]):e._e()])]),e._v(" "),e.node.children&&e.node.children.length?[e._m(0),e._v(" "),a("div",{staticClass:"process-level"},e._l(e.node.children,(function(t){return a("div",{key:t._id,staticClass:"process-container"},[a("div",{staticClass:"process-node"},[a("div",{staticClass:"node-title",style:{background:"COMPLETED"===t.status?"#67C23A":"#ffa640"}},[e._v(e._s(t.processSort)+"."+e._s(t.processName))]),e._v(" "),a("div",{staticClass:"node-content"},[t.children&&t.children.length?e._l(t.children,(function(e){return a("div",{key:e._id,staticClass:"sub-material"},[a("flow-node",{attrs:{node:e}})],1)})):a("div",{staticClass:"no-materials"},[e._v("\n                            暂无关联物料\n                        ")])],2)])])})),0)]:e._e()],2)}),[function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"arrow-container"},[t("div",{staticClass:"arrow-right"})])}],!1,null,"2dccef75",null),v={name:"MaterialFlowChart",components:{FlowNode:_.exports},props:{visible:{type:Boolean,default:!1},loading:{type:Boolean,default:!1},flowData:{type:Array,default:function(){return[]}}},computed:{dialogVisible:{get:function(){return this.visible},set:function(e){this.$emit("update:visible",e)}}},data:function(){return{scale:1,minScale:.5,maxScale:2,scaleStep:.1,position:{x:0,y:0},isDragging:!1,dragStart:{x:0,y:0},lastPosition:{x:0,y:0}}},methods:{zoomIn:function(){this.scale<this.maxScale&&(this.scale=Math.min(this.scale+this.scaleStep,this.maxScale))},zoomOut:function(){this.scale>this.minScale&&(this.scale=Math.max(this.scale-this.scaleStep,this.minScale))},resetZoom:function(){this.scale=1,this.position={x:0,y:0}},handleWheel:function(e){e.ctrlKey&&(e.preventDefault(),e.deltaY<0?this.zoomIn():this.zoomOut())},startDrag:function(e){this.isDragging=!0,this.dragStart={x:e.clientX-this.position.x,y:e.clientY-this.position.y},this.lastPosition=Object(l.a)({},this.position)},onDrag:function(e){this.isDragging&&(e.preventDefault(),this.position={x:e.clientX-this.dragStart.x,y:e.clientY-this.dragStart.y})},stopDrag:function(){this.isDragging=!1}},mounted:function(){this.$el.querySelector(".flow-container").addEventListener("wheel",this.handleWheel,{passive:!1})},beforeDestroy:function(){this.$el.querySelector(".flow-container").removeEventListener("wheel",this.handleWheel)}},h=v,p=(a("b58f"),Object(u.a)(h,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"flow-chart-dialog",attrs:{title:"物料工艺流程图","custom-class":"material-flow-dialog"}},[a("div",{staticClass:"zoom-controls"},[a("el-button-group",[a("el-button",{attrs:{size:"small",icon:"el-icon-zoom-in"},on:{click:e.zoomIn}}),e._v(" "),a("el-button",{attrs:{size:"small",icon:"el-icon-zoom-out"},on:{click:e.zoomOut}}),e._v(" "),a("el-button",{attrs:{size:"small",icon:"el-icon-refresh"},on:{click:e.resetZoom}},[e._v("重置")])],1)],1),e._v(" "),a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"flow-container",on:{mousedown:e.startDrag,mousemove:e.onDrag,mouseup:e.stopDrag,mouseleave:e.stopDrag}},[a("div",{staticClass:"zoom-wrapper",style:{transform:"scale("+e.scale+") translate("+e.position.x+"px, "+e.position.y+"px)",cursor:e.isDragging?"grabbing":"grab"}},[e.flowData&&0!==e.flowData.length?[a("flow-node",{attrs:{node:e.flowData[0]}})]:a("div",{staticClass:"empty-data"},[e._v("\n                暂无流程图数据\n            ")])],2)])])}),[],!1,null,null,null)),f=p.exports,m=a("2909"),b={name:"InspectionList",props:{inspections:{type:Object,default:function(){}}},data:function(){return{displayData:[],barcodeList:[],historyDialogVisible:!1,detailDialogVisible:!1,historyData:[],historyLoading:!1,selectedRecord:null,currentPage:1,pageSize:20,total:0,currentBarcode:"",currentProcessStep:null}},watch:{inspections:{handler:function(){var e=Object(n.a)(Object(o.a)().mark((function e(t){var a,s,r,i,n,d,u,_=this;return Object(o.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return");case 2:if(!(a=Array.isArray(t)?t[0]:t)){e.next=19;break}if(s={barcode:a.barcode,inspectionItem:"主物料",inspectionTime:null,inspector:null,materialCode:a.materialCode,materialId:a.materialId,materialName:a.materialName,materialSpec:a.materialSpec,standard:"",result:"",testDetails:null},a.barcode,r=a.processNodes||[],i=[a.barcode].concat(Object(m.a)(r.map((function(e){return e.barcode})))).filter((function(e){return e&&e.trim()})),0!==i.length){e.next=11;break}return this.displayData=[],e.abrupt("return");case 11:return e.next=13,Object(c.b)("InspectionLastData",{query:{scanCode:{$in:i}},populate:JSON.stringify([{path:"processId",select:"processCode processName processDesc processStage processType"}])});case 13:n=e.sent,d=n.data.reduce((function(e,t){return e[t.scanCode]||(e[t.scanCode]=[]),e[t.scanCode].push(t),e}),{}),this.displayData=[],a.barcode&&(u=d[a.barcode]||[],this.displayData.push(Object(l.a)(Object(l.a)({},s),{},{inspectionResults:u.map((function(e){return _.formatInspectionData(e)}))}))),r.forEach((function(e){if(e.barcode&&e.barcode.trim()){var t=d[e.barcode]||[];_.displayData.push(Object(l.a)(Object(l.a)({},e),{},{inspectionResults:t.map((function(e){return _.formatInspectionData(e)}))}))}})),console.log(this.displayData);case 19:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),immediate:!0}},methods:{formatDate:function(e){return e?new Date(e).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}):"暂无数据"},formatValue:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";if(!e)return"未测试";var a="number"==typeof e?Number(e).toFixed(2):e;return"".concat(a).concat(t)},showHistory:function(){var e=Object(n.a)(Object(o.a)().mark((function e(t,a){return Object(o.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.currentBarcode=t,this.currentProcessStep=a,this.historyDialogVisible=!0,this.currentPage=1,e.next=6,this.fetchHistoryData();case 6:case"end":return e.stop()}}),e,this)})));return function(t,a){return e.apply(this,arguments)}}(),fetchHistoryData:function(){var e=Object(n.a)(Object(o.a)().mark((function e(){var t,a;return Object(o.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.historyLoading=!0,e.prev=1,t={scanCode:this.currentBarcode},this.currentProcessStep&&(t.processId=this.currentProcessStep._id),e.next=6,Object(c.b)("InspectionData",{query:t,page:this.currentPage,limit:this.pageSize,sort:{createTime:-1},populate:JSON.stringify([{path:"processId",select:"processCode processName processDesc processStage processType"}])});case 6:a=e.sent,this.historyData=a.data,this.total=a.total,e.next=15;break;case 11:e.prev=11,e.t0=e.catch(1),console.error("获取历史数据失败:",e.t0),this.$message.error("获取历史数据失败");case 15:return e.prev=15,this.historyLoading=!1,e.finish(15);case 18:case"end":return e.stop()}}),e,this,[[1,11,15,18]])})));return function(){return e.apply(this,arguments)}}(),handleClose:function(){this.historyDialogVisible=!1,this.historyData=[],this.currentBarcode="",this.currentProcessStep=null},showHistoryDetail:function(e){this.selectedRecord=e,this.detailDialogVisible=!0},handleSizeChange:function(e){this.pageSize=e,this.fetchHistoryData()},handleCurrentChange:function(e){this.currentPage=e,this.fetchHistoryData()},formatInspectionData:function(e){return{processStep:e.processId?{processCode:e.processId.processCode,processName:e.processId.processName,processDesc:e.processId.processDesc,processStage:e.processId.processStage,processType:e.processId.processType}:null,result:e.error?"不合格":"合格",testTime:e.testTime||e.createTime,inspector:e.inspector,testDetails:Object(l.a)({},e)}}},computed:{hasLampBoardTestData:function(){var e=this.result.testDetails;return e.red||e.blue||e.infrared||e.red2||e.blue2||e.infrared2},hasSemiFinishedTestData:function(){var e=this.result.testDetails;return e.udiCode||e.lampBoardQrCode||e.batteryCellCode},hasTemperatureTestData:function(){var e=this.result.testDetails;return e.instrumentNtcDifferenceBeforeCooling||e.coolingStatus},hasVoltageWithstandTestData:function(){var e=this.result.testDetails;return e.chargingTest||e.withstandVoltageTest},hasFullMachineTestData:function(){var e=this.result.testDetails;return e.cellCode||e.handheldControllerPcbaCode},hasWeightData:function(){return this.result.testDetails.weight},hasRemoteControlTestData:function(){var e=this.result.testDetails;return e.showSerialNo||e.chkPowerOn||e.enterDebugMode}}},g=b,w=(a("1024"),Object(u.a)(g,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-table",{attrs:{data:e.displayData,border:"","header-cell-style":{background:"#f5f7fa",color:"#606266",fontWeight:"bold",textAlign:"center"},"cell-style":{textAlign:"center"}}},[a("el-table-column",{attrs:{label:"条码",prop:"barcode"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-tooltip",{attrs:{content:t.row.barcode,placement:"top",effect:"light"}},[a("span",[e._v(e._s(t.row.barcode))])])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"物料信息"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",{staticClass:"material-info"},[a("div",[e._v("物料编码："+e._s(t.row.materialCode))]),e._v(" "),a("div",[e._v("物料名称："+e._s(t.row.materialName))]),e._v(" "),t.row.materialSpec?a("div",[e._v("规格："+e._s(t.row.materialSpec))]):e._e()])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"检测项目",prop:"inspectionItem"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",{staticClass:"inspection-details"},[a("div",[e._v(e._s(t.row.inspectionItem))])])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"检测结果",width:"300"},scopedSlots:e._u([{key:"default",fn:function(t){return e._l(t.row.inspectionResults,(function(s,r){return a("div",{key:r,staticClass:"inspection-result"},[s.processStep?a("div",{staticClass:"process-info"},[a("span",[e._v(e._s(s.processStep.processName))]),e._v(" "),a("span",[e._v("("+e._s(s.processStep.processStage)+")")])]):e._e(),e._v(" "),a("div",{staticClass:"result-info"},[s.testDetails?a("el-popover",{attrs:{placement:"right",width:"500",trigger:"hover"}},[a("div",{staticClass:"test-details"},[a("div",{staticClass:"detail-section"},[a("div",{staticClass:"section-title"},[e._v("基础信息")]),e._v(" "),s.testDetails.startDate?a("div",[e._v("日期："+e._s(s.testDetails.startDate))]):e._e(),e._v(" "),s.testDetails.workstation?a("div",[e._v("工位号："+e._s(s.testDetails.workstation))]):e._e(),e._v(" "),s.testDetails.productModel?a("div",[e._v("产品型号："+e._s(s.testDetails.productModel))]):e._e()]),e._v(" "),e.hasLampBoardTestData?a("div",{staticClass:"detail-section"},[a("div",{staticClass:"section-title"},[e._v("面罩灯板测试")]),e._v(" "),s.testDetails.red?a("div",[e._v("红色："+e._s(s.testDetails.red))]):e._e(),e._v(" "),s.testDetails.blue?a("div",[e._v("蓝色："+e._s(s.testDetails.blue))]):e._e(),e._v(" "),s.testDetails.infrared?a("div",[e._v("红外："+e._s(s.testDetails.infrared))]):e._e(),e._v(" "),s.testDetails.red2?a("div",[e._v("红色2："+e._s(s.testDetails.red2))]):e._e(),e._v(" "),s.testDetails.blue2?a("div",[e._v("蓝色2："+e._s(s.testDetails.blue2))]):e._e(),e._v(" "),s.testDetails.infrared2?a("div",[e._v("红外2："+e._s(s.testDetails.infrared2))]):e._e()]):e._e(),e._v(" "),e.hasSemiFinishedTestData?a("div",{staticClass:"detail-section"},[a("div",{staticClass:"section-title"},[e._v("面罩半成品测试")]),e._v(" "),s.testDetails.udiCode?a("div",[e._v("UDI码："+e._s(s.testDetails.udiCode))]):e._e(),e._v(" "),s.testDetails.lampBoardQrCode?a("div",[e._v("灯板二维码："+e._s(s.testDetails.lampBoardQrCode))]):e._e(),e._v(" "),s.testDetails.batteryCellCode?a("div",[e._v("电芯码："+e._s(s.testDetails.batteryCellCode))]):e._e(),e._v(" "),s.testDetails.chargingBoardPcbaCode?a("div",[e._v("充电板PCBA码："+e._s(s.testDetails.chargingBoardPcbaCode))]):e._e(),e._v(" "),s.testDetails.maskPcbaCode?a("div",[e._v("面罩PCBA码："+e._s(s.testDetails.maskPcbaCode))]):e._e(),e._v(" "),s.testDetails.controllerPcbaCode?a("div",[e._v("手控器PCBA码："+e._s(s.testDetails.controllerPcbaCode))]):e._e(),e._v(" "),s.testDetails.controllerSoftwareVersion?a("div",[e._v("手控器软件版本："+e._s(s.testDetails.controllerSoftwareVersion))]):e._e(),e._v(" "),s.testDetails.maskSoftwareVersion?a("div",[e._v("面罩软件版本："+e._s(s.testDetails.maskSoftwareVersion))]):e._e(),e._v(" "),s.testDetails.controllerFactoryQrCode?a("div",[e._v("手控器出厂二维码："+e._s(s.testDetails.controllerFactoryQrCode))]):e._e(),e._v(" "),s.testDetails.faceDetectionProgramVersion?a("div",[e._v("面部探测程序版本："+e._s(s.testDetails.faceDetectionProgramVersion))]):e._e(),e._v(" "),s.testDetails.circuitFaultCode?a("div",[e._v("电路故障码："+e._s(s.testDetails.circuitFaultCode)+"\n                  ")]):e._e(),e._v(" "),a("div",{staticClass:"sub-section"},[a("div",{staticClass:"sub-title"},[e._v("光波参数")]),e._v(" "),s.testDetails.redLightWavelength?a("div",[e._v("红灯波长："+e._s(s.testDetails.redLightWavelength)+"\n                    ")]):e._e(),e._v(" "),s.testDetails.blueLightWavelength?a("div",[e._v("蓝灯波长："+e._s(s.testDetails.blueLightWavelength))]):e._e(),e._v(" "),s.testDetails.infraredLightWavelength?a("div",[e._v("红外灯波长："+e._s(s.testDetails.infraredLightWavelength))]):e._e(),e._v(" "),s.testDetails.redLightCurrent?a("div",[e._v("红灯电流："+e._s(s.testDetails.redLightCurrent))]):e._e(),e._v(" "),s.testDetails.blueLightCurrent?a("div",[e._v("蓝灯电流："+e._s(s.testDetails.blueLightCurrent)+"\n                    ")]):e._e(),e._v(" "),s.testDetails.infraredLightCurrent?a("div",[e._v("红外灯电流："+e._s(s.testDetails.infraredLightCurrent))]):e._e(),e._v(" "),s.testDetails.msiLightCurrent?a("div",[e._v("MSI灯电流："+e._s(s.testDetails.msiLightCurrent)+"\n                    ")]):e._e()]),e._v(" "),a("div",{staticClass:"sub-section"},[a("div",{staticClass:"sub-title"},[e._v("电池参数")]),e._v(" "),s.testDetails.batteryVoltage?a("div",[e._v("电池电压："+e._s(s.testDetails.batteryVoltage))]):e._e(),e._v(" "),s.testDetails.dischargeCurrent?a("div",[e._v("放电电流："+e._s(s.testDetails.dischargeCurrent)+"\n                    ")]):e._e(),e._v(" "),s.testDetails.batteryPower?a("div",[e._v("电池电量："+e._s(s.testDetails.batteryPower))]):e._e(),e._v(" "),s.testDetails.batteryCell1Voltage?a("div",[e._v("电芯1电压："+e._s(s.testDetails.batteryCell1Voltage))]):e._e(),e._v(" "),s.testDetails.batteryCell2Voltage?a("div",[e._v("电芯2电压："+e._s(s.testDetails.batteryCell2Voltage))]):e._e()]),e._v(" "),a("div",{staticClass:"sub-section"},[a("div",{staticClass:"sub-title"},[e._v("传感器参数")]),e._v(" "),s.testDetails.faceSensorStatus?a("div",[e._v("面部传感器状态："+e._s(s.testDetails.faceSensorStatus)+"\n                    ")]):e._e(),e._v(" "),s.testDetails.faceSensorValue?a("div",[e._v("面部传感器值："+e._s(s.testDetails.faceSensorValue)+"\n                    ")]):e._e(),e._v(" "),s.testDetails.fanCurrent?a("div",[e._v("风扇电流："+e._s(s.testDetails.fanCurrent))]):e._e()])]):e._e(),e._v(" "),e.hasTemperatureTestData?a("div",{staticClass:"detail-section"},[a("div",{staticClass:"section-title"},[e._v("面罩温度测试")]),e._v(" "),s.testDetails.instrumentNtcDifferenceBeforeCooling?a("div",[e._v("制冷前NTC差值："+e._s(s.testDetails.instrumentNtcDifferenceBeforeCooling))]):e._e(),e._v(" "),s.testDetails.productAndInstrumentNtc1Difference?a("div",[e._v("产品NTC1和仪器NTC1差值："+e._s(s.testDetails.productAndInstrumentNtc1Difference))]):e._e(),e._v(" "),s.testDetails.productAndInstrumentNtc2Difference?a("div",[e._v("产品NTC2和仪器NTC2差值："+e._s(s.testDetails.productAndInstrumentNtc2Difference))]):e._e(),e._v(" "),s.testDetails.coolingStatus?a("div",[e._v("制冷状态："+e._s(s.testDetails.coolingStatus))]):e._e(),e._v(" "),s.testDetails.coolingSetTemperature?a("div",[e._v("制冷设置温度："+e._s(s.testDetails.coolingSetTemperature))]):e._e()]):e._e(),e._v(" "),e.hasVoltageWithstandTestData?a("div",{staticClass:"detail-section"},[a("div",{staticClass:"section-title"},[e._v("耐压测试")]),e._v(" "),s.testDetails.chargingTest?a("div",[e._v("充电测试："+e._s(s.testDetails.chargingTest))]):e._e(),e._v(" "),s.testDetails.withstandVoltageTest?a("div",[e._v("耐压测试："+e._s(s.testDetails.withstandVoltageTest))]):e._e()]):e._e(),e._v(" "),e.hasFullMachineTestData?a("div",{staticClass:"detail-section"},[a("div",{staticClass:"section-title"},[e._v("整机灯光测试")]),e._v(" "),s.testDetails.cellCode?a("div",[e._v("电芯码："+e._s(s.testDetails.cellCode))]):e._e(),e._v(" "),s.testDetails.handheldControllerPcbaCode?a("div",[e._v("手控器PCBA码："+e._s(s.testDetails.handheldControllerPcbaCode))]):e._e(),e._v(" "),s.testDetails.handheldSoftwareVersion?a("div",[e._v("手控器软件版本："+e._s(s.testDetails.handheldSoftwareVersion))]):e._e(),e._v(" "),s.testDetails.handheldFactoryQrCode?a("div",[e._v("手控器出厂二维码："+e._s(s.testDetails.handheldFactoryQrCode))]):e._e(),e._v(" "),s.testDetails.batteryCapacity?a("div",[e._v("电池电量："+e._s(s.testDetails.batteryCapacity))]):e._e(),e._v(" "),s.testDetails.cell1Voltage?a("div",[e._v("电芯1电压："+e._s(s.testDetails.cell1Voltage))]):e._e(),e._v(" "),s.testDetails.cell2Voltage?a("div",[e._v("电芯2电压："+e._s(s.testDetails.cell2Voltage))]):e._e(),e._v(" "),s.testDetails.meterChargingCurrent?a("div",[e._v("仪表充电电流："+e._s(s.testDetails.meterChargingCurrent))]):e._e()]):e._e(),e._v(" "),e.hasWeightData?a("div",{staticClass:"detail-section"},[a("div",{staticClass:"section-title"},[e._v("电子秤重量")]),e._v(" "),s.testDetails.weight?a("div",[e._v("称重重量："+e._s(s.testDetails.weight))]):e._e()]):e._e(),e._v(" "),e.hasRemoteControlTestData?a("div",{staticClass:"detail-section"},[a("div",{staticClass:"section-title"},[e._v("遥控测试")]),e._v(" "),s.testDetails.showSerialNo?a("div",[e._v("显示序列号："+e._s(s.testDetails.showSerialNo))]):e._e(),e._v(" "),s.testDetails.chkPowerOn?a("div",[e._v("上电开机："+e._s(s.testDetails.chkPowerOn))]):e._e(),e._v(" "),s.testDetails.enterDebugMode?a("div",[e._v("进入调试模式："+e._s(s.testDetails.enterDebugMode))]):e._e(),e._v(" "),s.testDetails.readAllKeyOff?a("div",[e._v("按键关闭状态："+e._s(s.testDetails.readAllKeyOff))]):e._e(),e._v(" "),s.testDetails.readK4K5?a("div",[e._v("左右键状态："+e._s(s.testDetails.readK4K5))]):e._e(),e._v(" "),s.testDetails.readPotentiometer?a("div",[e._v("编码开关："+e._s(s.testDetails.readPotentiometer)+"\n                  ")]):e._e(),e._v(" "),s.testDetails.chkUiVersion?a("div",[e._v("软件版本："+e._s(s.testDetails.chkUiVersion))]):e._e(),e._v(" "),s.testDetails.chkUiTx?a("div",[e._v("通讯口校验："+e._s(s.testDetails.chkUiTx))]):e._e()]):e._e(),e._v(" "),a("div",{staticClass:"detail-section"},[a("div",{staticClass:"section-title"},[e._v("测试结果")]),e._v(" "),s.testDetails.passFail?a("div",[e._v("测试结果："+e._s(s.testDetails.passFail))]):e._e(),e._v(" "),s.testDetails.testTime?a("div",[e._v("测试耗时："+e._s(s.testDetails.testTime)+"秒")]):e._e(),e._v(" "),s.testDetails.startTime?a("div",[e._v("开始时间："+e._s(s.testDetails.startTime))]):e._e()])]),e._v(" "),a("div",{staticClass:"result-main"},[a("span",{class:{success:"合格"===s.result,error:"不合格"===s.result}},[e._v(e._s(s.result))]),e._v(" "),a("span",{staticClass:"time"},[e._v(e._s(e.formatDate(s.testTime)))])])]):e._e(),e._v(" "),a("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(a){return e.showHistory(t.row.barcode,s.processId)}}},[e._v("历史记录")])],1)])}))}}])}),e._v(" "),a("el-table-column",{attrs:{label:"操作",width:"120"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"text",size:"small"},on:{click:function(a){return e.showHistory(t.row.barcode)}}},[e._v("历史记录")])]}}])})],1),e._v(" "),a("el-dialog",{attrs:{title:"检测历史记录","append-to-body":"",visible:e.historyDialogVisible,width:"80%","before-close":e.handleClose},on:{"update:visible":function(t){e.historyDialogVisible=t}}},[a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.historyLoading,expression:"historyLoading"}],attrs:{data:e.historyData,border:"",stripe:"",height:"500"}},[a("el-table-column",{attrs:{label:"检测时间",prop:"testTime",width:"180"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n          "+e._s(e.formatDate(t.row.testTime||t.row.createTime))+"\n        ")]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"检测结果",prop:"allTestEnd",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",{class:{success:"PASS"===t.row.allTestEnd,error:"FAIL"===t.row.allTestEnd}},[e._v("\n            "+e._s(t.row.allTestEnd)+"\n          ")])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"电池包电压",prop:"readPackVol",width:"120"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",{staticClass:"result-info"},[a("el-popover",{attrs:{placement:"right",width:"500",trigger:"hover"}},[a("div",{staticClass:"test-details"},[a("div",{staticClass:"detail-section"},[a("div",{staticClass:"section-title"},[e._v("基础信息")]),e._v(" "),t.row.startDate?a("div",[e._v("日期："+e._s(t.row.startDate))]):e._e(),e._v(" "),t.row.workstation?a("div",[e._v("工位号："+e._s(t.row.workstation))]):e._e(),e._v(" "),t.row.productModel?a("div",[e._v("产品型号："+e._s(t.row.productModel))]):e._e()]),e._v(" "),t.row.red?a("div",{staticClass:"detail-section"},[a("div",{staticClass:"section-title"},[e._v("面罩灯板测试")]),e._v(" "),t.row.red?a("div",[e._v("红色："+e._s(t.row.red))]):e._e(),e._v(" "),t.row.blue?a("div",[e._v("蓝色："+e._s(t.row.blue))]):e._e(),e._v(" "),t.row.infrared?a("div",[e._v("红外："+e._s(t.row.infrared))]):e._e(),e._v(" "),t.row.red2?a("div",[e._v("红色2："+e._s(t.row.red2))]):e._e(),e._v(" "),t.row.blue2?a("div",[e._v("蓝色2："+e._s(t.row.blue2))]):e._e(),e._v(" "),t.row.infrared2?a("div",[e._v("红外2："+e._s(t.row.infrared2))]):e._e()]):e._e(),e._v(" "),t.row.udiCode?a("div",{staticClass:"detail-section"},[a("div",{staticClass:"section-title"},[e._v("面罩半成品测试")]),e._v(" "),t.row.udiCode?a("div",[e._v("UDI码："+e._s(t.row.udiCode))]):e._e(),e._v(" "),t.row.lampBoardQrCode?a("div",[e._v("灯板二维码："+e._s(t.row.lampBoardQrCode))]):e._e(),e._v(" "),t.row.batteryCellCode?a("div",[e._v("电芯码："+e._s(t.row.batteryCellCode))]):e._e(),e._v(" "),t.row.chargingBoardPcbaCode?a("div",[e._v("充电板PCBA码："+e._s(t.row.chargingBoardPcbaCode))]):e._e(),e._v(" "),t.row.maskPcbaCode?a("div",[e._v("面罩PCBA码："+e._s(t.row.maskPcbaCode))]):e._e(),e._v(" "),t.row.controllerPcbaCode?a("div",[e._v("手控器PCBA码："+e._s(t.row.controllerPcbaCode))]):e._e(),e._v(" "),t.row.controllerSoftwareVersion?a("div",[e._v("手控器软件版本："+e._s(t.row.controllerSoftwareVersion)+"\n                  ")]):e._e(),e._v(" "),t.row.maskSoftwareVersion?a("div",[e._v("面罩软件版本："+e._s(t.row.maskSoftwareVersion))]):e._e(),e._v(" "),t.row.controllerFactoryQrCode?a("div",[e._v("手控器出厂二维码："+e._s(t.row.controllerFactoryQrCode))]):e._e(),e._v(" "),t.row.faceDetectionProgramVersion?a("div",[e._v("面部探测程序版本："+e._s(t.row.faceDetectionProgramVersion))]):e._e(),e._v(" "),t.row.circuitFaultCode?a("div",[e._v("电路故障码："+e._s(t.row.circuitFaultCode))]):e._e(),e._v(" "),a("div",{staticClass:"sub-section"},[a("div",{staticClass:"sub-title"},[e._v("光波参数")]),e._v(" "),t.row.redLightWavelength?a("div",[e._v("红灯波长："+e._s(t.row.redLightWavelength))]):e._e(),e._v(" "),t.row.blueLightWavelength?a("div",[e._v("蓝灯波长："+e._s(t.row.blueLightWavelength))]):e._e(),e._v(" "),t.row.infraredLightWavelength?a("div",[e._v("红外灯波长："+e._s(t.row.infraredLightWavelength))]):e._e(),e._v(" "),t.row.redLightCurrent?a("div",[e._v("红灯电流："+e._s(t.row.redLightCurrent))]):e._e(),e._v(" "),t.row.blueLightCurrent?a("div",[e._v("蓝灯电流："+e._s(t.row.blueLightCurrent))]):e._e(),e._v(" "),t.row.infraredLightCurrent?a("div",[e._v("红外灯电流："+e._s(t.row.infraredLightCurrent))]):e._e(),e._v(" "),t.row.msiLightCurrent?a("div",[e._v("MSI灯电流："+e._s(t.row.msiLightCurrent))]):e._e()]),e._v(" "),a("div",{staticClass:"sub-section"},[a("div",{staticClass:"sub-title"},[e._v("电池参数")]),e._v(" "),t.row.batteryVoltage?a("div",[e._v("电池电压："+e._s(t.row.batteryVoltage))]):e._e(),e._v(" "),t.row.dischargeCurrent?a("div",[e._v("放电电流："+e._s(t.row.dischargeCurrent))]):e._e(),e._v(" "),t.row.batteryPower?a("div",[e._v("电池电量："+e._s(t.row.batteryPower))]):e._e(),e._v(" "),t.row.batteryCell1Voltage?a("div",[e._v("电芯1电压："+e._s(t.row.batteryCell1Voltage))]):e._e(),e._v(" "),t.row.batteryCell2Voltage?a("div",[e._v("电芯2电压："+e._s(t.row.batteryCell2Voltage))]):e._e()]),e._v(" "),a("div",{staticClass:"sub-section"},[a("div",{staticClass:"sub-title"},[e._v("传感器参数")]),e._v(" "),t.row.faceSensorStatus?a("div",[e._v("面部传感器状态："+e._s(t.row.faceSensorStatus))]):e._e(),e._v(" "),t.row.faceSensorValue?a("div",[e._v("面部传感器值："+e._s(t.row.faceSensorValue))]):e._e(),e._v(" "),t.row.fanCurrent?a("div",[e._v("风扇电流："+e._s(t.row.fanCurrent))]):e._e()])]):e._e(),e._v(" "),t.row.instrumentNtcDifferenceBeforeCooling?a("div",{staticClass:"detail-section"},[a("div",{staticClass:"section-title"},[e._v("面罩温度测试")]),e._v(" "),t.row.instrumentNtcDifferenceBeforeCooling?a("div",[e._v("制冷前NTC差值："+e._s(t.row.instrumentNtcDifferenceBeforeCooling))]):e._e(),e._v(" "),t.row.productAndInstrumentNtc1Difference?a("div",[e._v("产品NTC1和仪器NTC1差值："+e._s(t.row.productAndInstrumentNtc1Difference))]):e._e(),e._v(" "),t.row.productAndInstrumentNtc2Difference?a("div",[e._v("产品NTC2和仪器NTC2差值："+e._s(t.row.productAndInstrumentNtc2Difference))]):e._e(),e._v(" "),t.row.coolingStatus?a("div",[e._v("制冷状态："+e._s(t.row.coolingStatus))]):e._e(),e._v(" "),t.row.coolingSetTemperature?a("div",[e._v("制冷设置温度："+e._s(t.row.coolingSetTemperature))]):e._e()]):e._e(),e._v(" "),t.row.chargingTest?a("div",{staticClass:"detail-section"},[a("div",{staticClass:"section-title"},[e._v("耐压测试")]),e._v(" "),t.row.chargingTest?a("div",[e._v("充电测试："+e._s(t.row.chargingTest))]):e._e(),e._v(" "),t.row.withstandVoltageTest?a("div",[e._v("耐压测试："+e._s(t.row.withstandVoltageTest))]):e._e()]):e._e(),e._v(" "),t.row.cellCode?a("div",{staticClass:"detail-section"},[a("div",{staticClass:"section-title"},[e._v("整机灯光测试")]),e._v(" "),t.row.cellCode?a("div",[e._v("电芯码："+e._s(t.row.cellCode))]):e._e(),e._v(" "),t.row.handheldControllerPcbaCode?a("div",[e._v("手控器PCBA码："+e._s(t.row.handheldControllerPcbaCode)+"\n                  ")]):e._e(),e._v(" "),t.row.handheldSoftwareVersion?a("div",[e._v("手控器软件版本："+e._s(t.row.handheldSoftwareVersion))]):e._e(),e._v(" "),t.row.handheldFactoryQrCode?a("div",[e._v("手控器出厂二维码："+e._s(t.row.handheldFactoryQrCode))]):e._e(),e._v(" "),t.row.batteryCapacity?a("div",[e._v("电池电量："+e._s(t.row.batteryCapacity))]):e._e(),e._v(" "),t.row.cell1Voltage?a("div",[e._v("电芯1电压："+e._s(t.row.cell1Voltage))]):e._e(),e._v(" "),t.row.cell2Voltage?a("div",[e._v("电芯2电压："+e._s(t.row.cell2Voltage))]):e._e(),e._v(" "),t.row.meterChargingCurrent?a("div",[e._v("仪表充电电流："+e._s(t.row.meterChargingCurrent))]):e._e()]):e._e(),e._v(" "),t.row.weight?a("div",{staticClass:"detail-section"},[a("div",{staticClass:"section-title"},[e._v("电子秤重量")]),e._v(" "),t.row.weight?a("div",[e._v("称重重量："+e._s(t.row.weight))]):e._e()]):e._e(),e._v(" "),t.row.showSerialNo?a("div",{staticClass:"detail-section"},[a("div",{staticClass:"section-title"},[e._v("遥控测试")]),e._v(" "),t.row.showSerialNo?a("div",[e._v("显示序列号："+e._s(t.row.showSerialNo))]):e._e(),e._v(" "),t.row.chkPowerOn?a("div",[e._v("上电开机："+e._s(t.row.chkPowerOn))]):e._e(),e._v(" "),t.row.enterDebugMode?a("div",[e._v("进入调试模式："+e._s(t.row.enterDebugMode))]):e._e(),e._v(" "),t.row.readAllKeyOff?a("div",[e._v("按键关闭状态："+e._s(t.row.readAllKeyOff))]):e._e(),e._v(" "),t.row.readK4K5?a("div",[e._v("左右键状态："+e._s(t.row.readK4K5))]):e._e(),e._v(" "),t.row.readPotentiometer?a("div",[e._v("编码开关："+e._s(t.row.readPotentiometer))]):e._e(),e._v(" "),t.row.chkUiVersion?a("div",[e._v("软件版本："+e._s(t.row.chkUiVersion))]):e._e(),e._v(" "),t.row.chkUiTx?a("div",[e._v("通讯口校验："+e._s(t.row.chkUiTx))]):e._e()]):e._e(),e._v(" "),a("div",{staticClass:"detail-section"},[a("div",{staticClass:"section-title"},[e._v("测试结果")]),e._v(" "),t.row.passFail?a("div",[e._v("测试结果："+e._s(t.row.passFail))]):e._e(),e._v(" "),t.row.testTime?a("div",[e._v("测试耗时："+e._s(t.row.testTime)+"秒")]):e._e(),e._v(" "),t.row.startTime?a("div",[e._v("开始时间："+e._s(t.row.startTime))]):e._e()])]),e._v(" "),a("div",{staticClass:"result-main"},[a("span",{class:{success:!t.row.error,error:t.row.error}},[e._v(e._s(t.row.error?"不合格":"合格"))]),e._v(" "),a("span",{staticClass:"time"},[e._v(e._s(e.formatDate(t.row.testTime||t.row.createTime)))])])])],1)]}}])})],1),e._v(" "),a("div",{staticClass:"pagination-container"},[a("el-pagination",{attrs:{"current-page":e.currentPage,"page-sizes":[10,20,50,100],"page-size":e.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1)],1)],1)}),[],!1,null,"0be51241",null)),C=w.exports,D=a("ed91"),y={name:"SaleOrder",components:{ProcessStepList:f,InspectionList:C},data:function(){return{searchForm:{barcode:"",materialCode:"",status:"",dateRange:[],progress:""},tableList:[],total:0,currentPage:1,pageSize:10,listLoading:!0,showAdvanced:!1,dialogFormVisible:!1,dialogStatus:"",selection:[],dataForm:{barcode:"",materialCode:"",materialName:"",materialSpec:"",craftVersion:"",startTime:null,planCompletionTime:null,endTime:null,status:"PENDING",progress:0,processNodes:[],remark:""},rules:{FCustomerName:[{required:!0,message:"请输入客户名称",trigger:"blur"}],FDate:[{required:!0,message:"请选择订单日期",trigger:"change"}],FSaleDeptName:[{required:!0,message:"请输入销售部门",trigger:"blur"}]},processedFlowChartData:[],activeTab:"process",barcodeSearchVisible:!1,searchBarcode:"",searchResults:[],searchLoading:!1,unbindRecord:[]}},computed:{processedMaterialBarcodeData:function(){if(!this.dataForm.processNodes)return[];var e=new Map;return this.dataForm.processNodes.forEach((function(t){"PROCESS_STEP"===t.nodeType&&e.set(t.nodeId,{processName:t.processName,processCode:t.processCode})})),this.dataForm.processNodes.filter((function(e){return"MATERIAL"===e.nodeType&&e.barcode})).map((function(t){var a=t.parentNodeId?e.get(t.parentNodeId):null;return Object(l.a)(Object(l.a)({},t),{},{processName:a?a.processName:"-",processCode:a?a.processCode:""})})).sort((function(e,t){return new Date(t.scanTime||0)-new Date(e.scanTime||0)}))},formattedUnbindRecord:function(){var e=this;return this.unbindRecord.map((function(t){return Object(l.a)(Object(l.a)({},t),{},{formattedTime:e.formatDate(t.operateTime),materialList:t.unbindMaterials?t.unbindMaterials.map((function(e){return Object(l.a)(Object(l.a)({},e),{},{displayText:"".concat(e.materialCode," - ").concat(e.materialName)})})):[]})}))}},methods:(s={handleUnbind:function(){var e=Object(n.a)(Object(o.a)().mark((function e(t){var a,s,r,i,n,l,d=this;return Object(o.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.$prompt("请输入解绑原因","解绑确认",{confirmButtonText:"确定",cancelButtonText:"取消",inputType:"textarea",inputPlaceholder:"请输入解绑原因(非必填)",inputValidator:function(e){return!0}});case 3:if(a=e.sent,s=a.value,r=this.$loading({lock:!0,text:"正在解绑...",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"}),e.prev=6,"PROCESS_STEP"!==t.nodeType){e.next=28;break}return e.next=10,Object(D.c)({mainBarcode:this.dataForm.barcode,processStepId:t.processStepId,userId:this.$store.state.user.id,reason:s||"未填写解绑原因"});case 10:if(200!==(i=e.sent).code||!i.success){e.next=25;break}if(this.$message.success("解绑成功"),!i.data||!i.data.flowRecord){e.next=23;break}return this.dataForm=i.data.flowRecord,this.processedFlowChartData=this.processNodes(this.dataForm.processNodes),e.next=18,Object(c.b)("unbindRecord",{query:{flowRecordId:this.dataForm._id},populate:JSON.stringify([{path:"operatorId"}])});case 18:200===(n=e.sent).code&&(this.unbindRecord=n.data),this.activeTab="unbind",l=this.tableList.findIndex((function(e){return e._id===d.dataForm._id})),-1!==l&&this.$set(this.tableList,l,i.data.flowRecord);case 23:e.next=26;break;case 25:throw new Error(i.message||"解绑失败");case 26:e.next=29;break;case 28:throw new Error("只能对工序节点进行解绑操作");case 29:e.next=34;break;case 31:e.prev=31,e.t0=e.catch(6),this.$message.error(e.t0.message||"解绑失败");case 34:return e.prev=34,r.close(),e.finish(34);case 37:e.next=42;break;case 39:e.prev=39,e.t1=e.catch(0),"cancel"!==e.t1&&this.$message.error(e.t1.message||"解绑失败");case 42:case"end":return e.stop()}}),e,this,[[0,39],[6,31,34,37]])})));return function(t){return e.apply(this,arguments)}}(),getProcessStatusType:function(e){return{PENDING:"info",IN_PROCESS:"warning",COMPLETED:"success",ABNORMAL:"danger"}[e]||"info"},getProcessStatusText:function(e){return{PENDING:"待处理",IN_PROCESS:"进行中",COMPLETED:"已完成",ABNORMAL:"异常"}[e]||e},fetchData:function(){var e=Object(n.a)(Object(o.a)().mark((function e(){var t,a;return Object(o.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.listLoading=!0,e.prev=1,(t=this.searchData()).page=this.currentPage,t.skip=(this.currentPage-1)*this.pageSize,t.limit=this.pageSize,t.sort={createAt:-1},t.count=!0,e.next=10,Object(c.b)("material_process_flow",t);case 10:200===(a=e.sent).code?(this.tableList=a.data,this.total=a.countnum||a.data.length):this.$message.error(a.msg||"获取数据失败"),e.next=18;break;case 14:e.prev=14,e.t0=e.catch(1),console.error("获取数据失败:",e.t0),this.$message.error("获取数据失败: "+e.t0.message);case 18:return e.prev=18,this.listLoading=!1,e.finish(18);case 21:case"end":return e.stop()}}),e,this,[[1,14,18,21]])})));return function(){return e.apply(this,arguments)}}(),baseTableHandleCurrentChange:function(e){this.currentPage=e,this.fetchData()},baseTableHandleSizeChange:function(e){this.pageSize=e,this.fetchData()},toggleAdvanced:function(){this.showAdvanced=!this.showAdvanced},formatDate:function(e){return e?new Date(e).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}):"暂无数据"},formatNumber:function(e){return e||0===e?"¥"+Number(e).toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g,","):"¥0.00"},search:function(){this.currentPage=1,this.fetchData()},handleSelectionChange:function(e){this.selection=e},handleInit:function(){var e=Object(n.a)(Object(o.a)().mark((function e(t){var a;return Object(o.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.$confirm("确认要成品初始化吗?该操作无法撤回！请谨慎操作！","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});case 3:return e.next=5,Object(c.c)("material_process_flow",{query:{_id:t._id}});case 5:if(200!==(a=e.sent).code){e.next=11;break}this.$message.success("初始化成功"),this.fetchData(),e.next=12;break;case 11:throw new Error(a.msg||"初始化失败");case 12:e.next=17;break;case 14:e.prev=14,e.t0=e.catch(0),"cancel"!==e.t0&&(console.error("删除失败:",e.t0),this.$message.error(e.t0.message||"删除失败"));case 17:case"end":return e.stop()}}),e,this,[[0,14]])})));return function(t){return e.apply(this,arguments)}}(),handleView:function(){var e=Object(n.a)(Object(o.a)().mark((function e(t){var a,s;return Object(o.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,this.listLoading=!0,e.next=4,Object(c.b)("material_process_flow",{query:{_id:t._id}});case 4:if(a=e.sent,console.log(a,"result"),!(200===a.code&&a.data.length>0)){e.next=17;break}return this.dataForm=a.data[0],this.processedFlowChartData=this.processNodes(this.dataForm.processNodes),this.dialogFormVisible=!0,e.next=12,Object(c.b)("unbindRecord",{query:{flowRecordId:t._id},populate:JSON.stringify([{path:"operatorId"}])});case 12:s=e.sent,console.log(s,"unbindRecord"),this.unbindRecord=s.data,e.next=18;break;case 17:this.$message.error("获取详情失败");case 18:e.next=24;break;case 20:e.prev=20,e.t0=e.catch(0),console.error("获取详情失败:",e.t0),this.$message.error("获取详情失败: "+e.t0.message);case 24:return e.prev=24,this.listLoading=!1,e.finish(24);case 27:case"end":return e.stop()}}),e,this,[[0,20,24,27]])})));return function(t){return e.apply(this,arguments)}}(),handleDelete:function(){var e=Object(n.a)(Object(o.a)().mark((function e(t){return Object(o.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.$confirm("确认要删除该订单吗？删除后不可恢复！","警告",{type:"warning",confirmButtonText:"确定删除",confirmButtonClass:"el-button--danger"});case 3:return e.next=5,Object(c.c)("k3_SAL_SaleOrder",{query:{_id:t._id}});case 5:this.$message.success("删除成功"),this.fetchData(),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0),"cancel"===e.t0?this.$message.info("已取消删除"):(console.error("删除失败:",e.t0),this.$message.error("删除失败"));case 12:case"end":return e.stop()}}),e,this,[[0,9]])})));return function(t){return e.apply(this,arguments)}}(),handleSubmit:function(){var e=Object(n.a)(Object(o.a)().mark((function e(t){return Object(o.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,"edit"!==this.dialogStatus){e.next=7;break}return e.next=4,Object(c.d)("k3_SAL_SaleOrder",t._id,t);case 4:this.$message.success("更新成功"),e.next=10;break;case 7:return e.next=9,Object(c.a)("k3_SAL_SaleOrder",t);case 9:this.$message.success("添加成功");case 10:this.dialogFormVisible=!1,this.fetchData(),e.next=18;break;case 14:e.prev=14,e.t0=e.catch(0),console.error("操作失败:",e.t0),this.$message.error("操作失败");case 18:case"end":return e.stop()}}),e,this,[[0,14]])})));return function(t){return e.apply(this,arguments)}}(),searchData:function(){var e={query:{$and:[]}};return Object.entries(this.searchForm).forEach((function(t){var a=Object(i.a)(t,2),s=a[0],o=a[1];if(o)switch(s){case"barcode":case"materialCode":if(o.trim()){var n=o.trim().replace(/[.*+?^${}()|[\]\\]/g,"\\$&");e.query.$and.push(Object(r.a)({},s,{$regex:n,$options:"i"}))}break;case"status":e.query.$and.push(Object(r.a)({},s,o));break;case"progress":""!==o&&e.query.$and.push({progress:o});break;case"dateRange":Array.isArray(o)&&2===o.length&&e.query.$and.push({startTime:{$gte:o[0]+" 00:00:00",$lte:o[1]+" 23:59:59"}})}})),e.query.$and.length||delete e.query.$and,e},resetForm:function(){this.$refs.searchForm.resetFields(),this.searchForm={barcode:"",materialCode:"",status:"",dateRange:[],progress:""},this.currentPage=1,this.fetchData()},handleEdit:function(e){var t=this;this.dialogStatus="edit",this.dialogFormVisible=!0,this.$nextTick((function(){t.$refs.dataForm.resetFields(),t.dataForm=Object.assign({},e)}))}},Object(r.a)(Object(r.a)(Object(r.a)(Object(r.a)(Object(r.a)(Object(r.a)(Object(r.a)(Object(r.a)(Object(r.a)(Object(r.a)(s,"handleDelete",function(){var e=Object(n.a)(Object(o.a)().mark((function e(t){return Object(o.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.$confirm("确认要删除该订单吗？","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});case 3:return e.next=5,Object(c.c)("k3_SAL_SaleOrder",{query:{_id:t._id}});case 5:this.$message.success("删除成功"),this.fetchData(),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0),"cancel"!==e.t0&&(console.error("删除失败:",e.t0),this.$message.error("删除失败: "+e.t0.message));case 12:case"end":return e.stop()}}),e,this,[[0,9]])})));return function(t){return e.apply(this,arguments)}}()),"handleSubmitAudit",function(){var e=Object(n.a)(Object(o.a)().mark((function e(t){var a;return Object(o.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.$confirm("确认提交此订单进行审核？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});case 3:return a=Object(l.a)(Object(l.a)({},t),{},{FDocumentStatus:"B",FModifyDate:new Date,FModifierId:this.$store.state.user.name}),e.next=6,Object(c.d)("k3_SAL_SaleOrder",t._id,a);case 6:this.$message.success("提交审核成功"),this.fetchData(),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(0),"cancel"!==e.t0&&(console.error("提交审核失败:",e.t0),this.$message.error("提交审核失败: "+e.t0.message));case 13:case"end":return e.stop()}}),e,this,[[0,10]])})));return function(t){return e.apply(this,arguments)}}()),"submitForm",(function(){var e=this;this.$refs.dataForm.validate(function(){var t=Object(n.a)(Object(o.a)().mark((function t(a){return Object(o.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!a){t.next=19;break}if(t.prev=1,"create"!==e.dialogStatus){t.next=8;break}return t.next=5,Object(c.a)("k3_SAL_SaleOrder",e.dataForm);case 5:e.$message.success("创建成功"),t.next=11;break;case 8:return t.next=10,Object(c.d)("k3_SAL_SaleOrder",e.dataForm._id,e.dataForm);case 10:e.$message.success("更新成功");case 11:e.dialogFormVisible=!1,e.fetchData(),t.next=19;break;case 15:t.prev=15,t.t0=t.catch(1),console.error("操作失败:",t.t0),e.$message.error("操作失败: "+t.t0.message);case 19:case"end":return t.stop()}}),t,null,[[1,15]])})));return function(e){return t.apply(this,arguments)}}())})),"getNodeIcon",(function(e){return{PROCESS_STEP:{icon:"el-icon-s-operation",color:"#409EFF"},MATERIAL:{icon:"el-icon-box",color:"#67c23a"}}[e.nodeType]||{icon:"el-icon-more",color:"#909399"}})),"getTimelineItemType",(function(e){return{COMPLETED:"success",IN_PROCESS:"primary",ABNORMAL:"danger",PENDING:"info"}[e]||"info"})),"getScanIcon",(function(e){if(!e.requireScan)return"el-icon-minus info";return{COMPLETED:"el-icon-check success",IN_PROCESS:"el-icon-loading warning",ABNORMAL:"el-icon-close danger",PENDING:"el-icon-time info"}[e.status]||"el-icon-time info"})),"getScanStatus",(function(e){if(!e.requireScan)return"无需扫码";return{COMPLETED:"已完成扫码",IN_PROCESS:"等待扫码",ABNORMAL:"扫码异常",PENDING:"未开始"}[e.status]||"未开始"})),"getActiveStep",(function(e){var t=e.findIndex((function(e){return"IN_PROCESS"===e.status}));return-1===t?e.filter((function(e){return"COMPLETED"===e.status})).length:t+1})),"getStepStatus",(function(e){return{COMPLETED:"success",IN_PROCESS:"process",ABNORMAL:"error",PENDING:"wait"}[e]||"wait"})),"getStepIcon",(function(e){return"PROCESS_STEP"===e.nodeType?"el-icon-s-operation":"el-icon-box"})),Object(r.a)(Object(r.a)(Object(r.a)(Object(r.a)(Object(r.a)(Object(r.a)(Object(r.a)(s,"getProcessOverallStatus",(function(e){return e.some((function(e){return"ABNORMAL"===e.status}))?"error":e.some((function(e){return"IN_PROCESS"===e.status}))?"process":e.every((function(e){return"COMPLETED"===e.status}))?"success":"wait"})),"getProcessSteps",(function(){return this.dataForm.processNodes.filter((function(e){return"PROCESS_STEP"===e.nodeType&&1===e.level})).sort((function(e,t){return e.processSort-t.processSort}))})),"getRelatedMaterials",(function(e){return this.dataForm.processNodes.filter((function(t){return"MATERIAL"===t.nodeType&&t.parentNodeId===e&&2===t.level}))})),"hasRequireScanMaterials",(function(e){return this.getRelatedMaterials(e).some((function(e){return e.requireScan}))})),"processNodes",(function(e){if(!e||!e.length)return[];var t=new Map;e.forEach((function(e){t.set(e.nodeId,Object(l.a)(Object(l.a)({},e),{},{children:[]}))}));var a=[];e.forEach((function(e){var s=t.get(e.nodeId);e.parentNodeId&&t.has(e.parentNodeId)?t.get(e.parentNodeId).children.push(s):a.push(s)}));var s=function(e){e.children&&e.children.length&&("PROCESS_STEP"===e.nodeType?e.children.sort((function(e,t){return(e.materialCode||"").localeCompare(t.materialCode||"")})):"MATERIAL"===e.nodeType&&e.children.sort((function(e,t){return(e.processSort||0)-(t.processSort||0)})),e.children.forEach((function(e){return s(e)})))};return a.forEach((function(e){return s(e)})),a})),"openBarcodeSearch",(function(){this.barcodeSearchVisible=!0,this.searchBarcode="",this.searchResults=[]})),"handleBarcodeSearch",function(){var e=Object(n.a)(Object(o.a)().mark((function e(){var t,a,s=this;return Object(o.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.searchBarcode.trim()){e.next=3;break}return this.$message.warning("请输入要搜索的条码"),e.abrupt("return");case 3:return this.searchLoading=!0,e.prev=4,t={query:{$or:[{barcode:this.searchBarcode},{"processNodes.barcode":this.searchBarcode}]}},e.next=8,Object(c.b)("material_process_flow",t);case 8:200===(a=e.sent).code&&a.data?(this.searchResults=[],a.data.forEach((function(e){e.barcode===s.searchBarcode.trim()&&s.searchResults.push(Object(l.a)({isMainBarcode:!0,barcode:e.barcode,materialCode:e.materialCode,materialName:e.materialName,materialSpec:e.materialSpec,status:e.status},e)),e.processNodes.filter((function(e){return e.barcode===s.searchBarcode.trim()})).forEach((function(t){s.searchResults.push(Object(l.a)({isMainBarcode:!1,barcode:t.barcode,materialCode:t.materialCode,materialName:t.materialName,materialSpec:t.materialSpec,status:t.status,mainBarcode:e.barcode,mainBarcodeData:e,processName:t.processName,processCode:t.processCode,scanTime:t.scanTime},t))}))}))):this.$message.error(a.msg||"搜索失败"),e.next=16;break;case 12:e.prev=12,e.t0=e.catch(4),console.error("搜索失败:",e.t0),this.$message.error("搜索失败: "+e.t0.message);case 16:return e.prev=16,this.searchLoading=!1,e.finish(16);case 19:case"end":return e.stop()}}),e,this,[[4,12,16,19]])})));return function(){return e.apply(this,arguments)}}())),created:function(){this.fetchData()}},S=y,O=(a("cb66"),Object(u.a)(S,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"app-container"},[a("el-card",{staticClass:"filter-container"},[a("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[a("span",[e._v("筛选搜索")]),e._v(" "),a("el-button",{staticStyle:{float:"right",padding:"3px 0"},attrs:{type:"text"},on:{click:e.toggleAdvanced}},[e._v("\n                "+e._s(e.showAdvanced?"收起":"展开")+"高级搜索\n            ")])],1),e._v(" "),a("el-form",{ref:"searchForm",staticClass:"demo-form-inline",attrs:{model:e.searchForm}},[a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:6}},[a("el-form-item",{attrs:{label:"主条码"}},[a("el-input",{attrs:{placeholder:"请输入主条码",clearable:""},model:{value:e.searchForm.barcode,callback:function(t){e.$set(e.searchForm,"barcode",t)},expression:"searchForm.barcode"}})],1)],1),e._v(" "),a("el-col",{attrs:{span:6}},[a("el-form-item",{attrs:{label:"物料编码"}},[a("el-input",{attrs:{placeholder:"请输入物料编码",clearable:""},model:{value:e.searchForm.materialCode,callback:function(t){e.$set(e.searchForm,"materialCode",t)},expression:"searchForm.materialCode"}})],1)],1),e._v(" "),a("el-col",{attrs:{span:6}},[a("el-form-item",{attrs:{label:"流程状态"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择流程状态",clearable:""},model:{value:e.searchForm.status,callback:function(t){e.$set(e.searchForm,"status",t)},expression:"searchForm.status"}},[a("el-option",{attrs:{label:"待处理",value:"PENDING"}}),e._v(" "),a("el-option",{attrs:{label:"进行中",value:"IN_PROCESS"}}),e._v(" "),a("el-option",{attrs:{label:"已完成",value:"COMPLETED"}}),e._v(" "),a("el-option",{attrs:{label:"异常",value:"ABNORMAL"}})],1)],1)],1)],1),e._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:e.showAdvanced,expression:"showAdvanced"}]},[a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"开始时间"}},[a("el-date-picker",{staticStyle:{width:"100%"},attrs:{type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","value-format":"yyyy-MM-dd"},model:{value:e.searchForm.dateRange,callback:function(t){e.$set(e.searchForm,"dateRange",t)},expression:"searchForm.dateRange"}})],1)],1),e._v(" "),a("el-col",{attrs:{span:6}},[a("el-form-item",{attrs:{label:"完成进度"}},[a("el-input-number",{attrs:{min:0,max:100,placeholder:"完成进度"},model:{value:e.searchForm.progress,callback:function(t){e.$set(e.searchForm,"progress",t)},expression:"searchForm.progress"}})],1)],1)],1)],1),e._v(" "),a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:e.search}},[e._v("查询搜索")]),e._v(" "),a("el-button",{on:{click:e.resetForm}},[e._v("重置")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:e.openBarcodeSearch}},[e._v("成品追溯")])],1)],1)],1),e._v(" "),e._m(0),e._v(" "),a("base-table",{ref:"baseTable",attrs:{currentPage:e.currentPage,"highlight-current-row":!0,pageSize:e.pageSize,tableData:e.tableList,tableDataloading:e.listLoading,total:e.total,"cell-style":{textAlign:"center"}},on:{"selection-change":e.handleSelectionChange,handleCurrentChange:e.baseTableHandleCurrentChange,handleSizeChange:e.baseTableHandleSizeChange}},[a("template",{slot:"law"},[a("el-table-column",{attrs:{label:"主条码",prop:"barcode"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                    "+e._s(t.row.barcode)+"\n                ")]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"物料信息"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",[e._v("编码："+e._s(t.row.materialCode))]),e._v(" "),a("div",[e._v("名称："+e._s(t.row.materialName))]),e._v(" "),a("div",[e._v("规格："+e._s(t.row.materialSpec))])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"流程状态",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-tag",{attrs:{type:e.getProcessStatusType(t.row.status)}},[e._v("\n                        "+e._s(e.getProcessStatusText(t.row.status))+"\n                    ")])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"完成进度",width:"200"},scopedSlots:e._u([{key:"default",fn:function(e){return[a("el-progress",{attrs:{percentage:e.row.progress||0}})]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"操作",fixed:"right",width:"200"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"text",size:"small"},on:{click:function(a){return e.handleView(t.row)}}},[e._v("查看")])]}}])})],1)],2),e._v(" "),a("el-dialog",{staticClass:"process-flow-dialog",attrs:{title:"工艺流程详情 - "+e.dataForm.barcode,visible:e.dialogFormVisible,width:"80%","close-on-click-modal":!1},on:{"update:visible":function(t){e.dialogFormVisible=t}}},[a("div",{staticClass:"process-flow-container"},[a("div",{staticClass:"process-section"},[a("el-card",{staticClass:"process-card"},[a("div",{attrs:{slot:"header"},slot:"header"},[a("span",[a("i",{staticClass:"el-icon-time"}),e._v(" 工艺流程")])]),e._v(" "),a("div",{staticClass:"process-flow"},[a("div",{staticClass:"main-material"},[a("div",{staticClass:"main-material-header"},[a("i",{staticClass:"el-icon-box"}),e._v(" "),a("span",{staticClass:"title"},[e._v("主产品信息")]),e._v(" "),a("el-tag",{attrs:{type:"primary",size:"mini"}},[e._v(e._s(e.dataForm.materialCode))])],1),e._v(" "),a("div",{staticClass:"main-material-content"},[a("div",{staticClass:"info-row"},[a("div",{staticClass:"info-item"},[a("label",[e._v("产品条码：")]),e._v(" "),a("span",[e._v(e._s(e.dataForm.barcode))])])]),e._v(" "),a("div",{staticClass:"info-row"},[a("div",{staticClass:"info-item"},[a("label",[e._v("物料名称：")]),e._v(" "),a("span",[e._v(e._s(e.dataForm.materialName))])]),e._v(" "),a("div",{staticClass:"info-item"},[a("label",[e._v("规格型号：")]),e._v(" "),a("span",[e._v(e._s(e.dataForm.materialSpec))])])]),e._v(" "),a("div",{staticClass:"info-row"},[a("div",{staticClass:"info-item"},[a("label",[e._v("整体进度：")]),e._v(" "),a("el-progress",{attrs:{percentage:e.dataForm.progress||0}})],1),e._v(" "),a("div",{staticClass:"info-item"},[a("label",[e._v("当前状态：")]),e._v(" "),a("el-tag",{attrs:{type:e.getProcessStatusType(e.dataForm.status)}},[e._v("\n                                            "+e._s(e.getProcessStatusText(e.dataForm.status))+"\n                                        ")])],1)])])]),e._v(" "),a("el-tabs",{attrs:{type:"border-card"},model:{value:e.activeTab,callback:function(t){e.activeTab=t},expression:"activeTab"}},[a("el-tab-pane",{attrs:{label:"工序信息",name:"process"}},[a("process-step-list",{ref:"processStepList",attrs:{loading:e.listLoading,"flow-data":e.processedFlowChartData}})],1),e._v(" "),a("el-tab-pane",{attrs:{label:"物料信息",name:"material"}},[a("div",{staticClass:"material-info-container"},[a("div",{staticClass:"table-header"},[a("i",{staticClass:"el-icon-box"}),e._v(" "),a("span",[e._v("工艺物料清单")])]),e._v(" "),a("el-table",{staticClass:"material-table",attrs:{data:e.processedFlowChartData[0]&&e.processedFlowChartData[0].children?e.processedFlowChartData[0].children.filter((function(e){return"PROCESS_STEP"===e.nodeType})):[],border:"","header-cell-style":{background:"#f5f7fa",color:"#606266",fontWeight:"bold",fontSize:"14px",textAlign:"center",height:"50px"},"cell-style":{textAlign:"center"}}},[a("el-table-column",{attrs:{label:"工序",width:"300"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",{staticClass:"process-info"},[a("el-tag",{attrs:{size:"medium",type:e.getProcessStatusType(t.row.status)}},[e._v("\n                                                        "+e._s(t.row.processName)+"\n                                                        "),a("el-tag",{attrs:{size:"mini",type:"info"}},[e._v(e._s(t.row.processCode))])],1)],1)]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"关联物料"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.children&&t.row.children.length?a("el-table",{staticClass:"inner-table",attrs:{data:t.row.children.filter((function(e){return"MATERIAL"===e.nodeType})),border:""}},[a("el-table-column",{attrs:{label:"物料编码",prop:"materialCode","min-width":"120"}}),e._v(" "),a("el-table-column",{attrs:{label:"物料名称",prop:"materialName","min-width":"150"}}),e._v(" "),a("el-table-column",{attrs:{label:"规格型号",prop:"materialSpec","min-width":"120"}}),e._v(" "),a("el-table-column",{attrs:{label:"数量",width:"80"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                                                            "+e._s(t.row.materialQuantity)+" "+e._s(t.row.materialUnit)+"\n                                                        ")]}}],null,!0)}),e._v(" "),a("el-table-column",{attrs:{label:"状态",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-tag",{attrs:{type:e.getProcessStatusType(t.row.status),size:"small"}},[e._v("\n                                                                "+e._s(e.getProcessStatusText(t.row.status))+"\n                                                            ")])]}}],null,!0)}),e._v(" "),a("el-table-column",{attrs:{label:"条码","min-width":"150"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.barcode?a("span",[e._v(e._s(t.row.barcode))]):a("span",{staticClass:"no-barcode"},[e._v("-")])]}}],null,!0)}),e._v(" "),a("el-table-column",{attrs:{label:"类型",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.isComponent?a("el-tag",{attrs:{type:"warning",size:"mini"}},[e._v("组件")]):e._e(),e._v(" "),t.row.isKeyMaterial?a("el-tag",{attrs:{type:"danger",size:"mini"}},[e._v("关键")]):e._e(),e._v(" "),t.row.isComponent||t.row.isKeyMaterial?e._e():a("span",[e._v("-")])]}}],null,!0)})],1):a("div",{staticClass:"no-material"},[e._v("暂无关联物料")])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"操作",width:"120",fixed:"right"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"text",size:"small"},on:{click:function(a){return e.handleUnbind(t.row)}}},[e._v("解绑")])]}}])})],1)],1)]),e._v(" "),a("el-tab-pane",{attrs:{label:"物料条码信息",name:"materialBarcode"}},[a("el-table",{attrs:{data:e.processedMaterialBarcodeData,border:"","header-cell-style":{background:"#f5f7fa",color:"#606266",fontWeight:"bold",textAlign:"center"},"cell-style":{textAlign:"center"}}},[a("el-table-column",{attrs:{label:"条码",prop:"barcode","min-width":"150"}}),e._v(" "),a("el-table-column",{attrs:{label:"物料编码",prop:"materialCode","min-width":"120"}}),e._v(" "),a("el-table-column",{attrs:{label:"物料名称",prop:"materialName","min-width":"150"}}),e._v(" "),a("el-table-column",{attrs:{label:"规格型号",prop:"materialSpec","min-width":"120"}}),e._v(" "),a("el-table-column",{attrs:{label:"状态",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-tag",{attrs:{type:e.getProcessStatusType(t.row.status)}},[e._v("\n                                                "+e._s(e.getProcessStatusText(t.row.status))+"\n                                            ")])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"所属工序","min-width":"120"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-tag",{attrs:{size:"medium",type:"info"}},[e._v("\n                                                "+e._s(t.row.processName)+"\n                                                "),t.row.processCode?a("el-tag",{attrs:{size:"mini",type:"info"}},[e._v("\n                                                    "+e._s(t.row.processCode)+"\n                                                ")]):e._e()],1)]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"扫码时间",width:"160"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                                            "+e._s(e.formatDate(t.row.scanTime))+"\n                                        ")]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"绑定人员",prop:"bindOperator",width:"100"}}),e._v(" "),a("el-table-column",{attrs:{label:"备注","min-width":"150"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.remark?a("el-tooltip",{attrs:{content:t.row.remark,placement:"top"}},[a("span",[e._v(e._s(t.row.remark))])]):a("span",[e._v("-")])]}}])})],1)],1),e._v(" "),a("el-tab-pane",{attrs:{label:"检测信息",name:"inspection"}},[a("inspection-list",{attrs:{inspections:e.dataForm}})],1),e._v(" "),a("el-tab-pane",{attrs:{label:"解绑信息",name:"unbind"}},[a("el-table",{attrs:{data:e.unbindRecord||[],border:"","header-cell-style":{background:"#f5f7fa",color:"#606266",fontWeight:"bold",textAlign:"center"},"cell-style":{textAlign:"center"}}},[a("el-table-column",{attrs:{label:"解绑时间",width:"160"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                                            "+e._s(e.formatDate(t.row.operateTime))+"\n                                        ")]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"工序信息","min-width":"150"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-tag",{attrs:{size:"medium",type:"info"}},[e._v("\n                                                "+e._s(t.row.processName)+"\n                                                "),t.row.processCode?a("el-tag",{attrs:{size:"mini",type:"info"}},[e._v("\n                                                    "+e._s(t.row.processCode)+"\n                                                ")]):e._e()],1)]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"解绑物料","min-width":"200"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.unbindMaterials&&t.row.unbindMaterials.length?a("el-table",{staticClass:"inner-table",attrs:{data:t.row.unbindMaterials,border:"",size:"mini"}},[a("el-table-column",{attrs:{label:"物料编码",prop:"materialCode","min-width":"120"}}),e._v(" "),a("el-table-column",{attrs:{label:"物料名称",prop:"materialName","min-width":"150"}}),e._v(" "),a("el-table-column",{attrs:{label:"原条码",prop:"originalBarcode","min-width":"150"}})],1):a("span",[e._v("-")])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"解绑原因","min-width":"150"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.reason?a("el-tooltip",{attrs:{content:t.row.reason,placement:"top"}},[a("span",[e._v(e._s(t.row.reason))])]):a("span",[e._v("-")])]}}])})],1)],1)],1)],1)])],1)])]),e._v(" "),a("el-dialog",{attrs:{title:"条码查询",visible:e.barcodeSearchVisible,width:"70%","close-on-click-modal":!1},on:{"update:visible":function(t){e.barcodeSearchVisible=t}}},[a("div",{staticClass:"barcode-search-container"},[a("div",{staticClass:"search-area"},[a("el-input",{attrs:{placeholder:"请输入条码",clearable:""},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleBarcodeSearch(t)}},model:{value:e.searchBarcode,callback:function(t){e.searchBarcode=t},expression:"searchBarcode"}},[a("el-button",{attrs:{slot:"append",icon:"el-icon-search"},on:{click:e.handleBarcodeSearch},slot:"append"},[e._v("\n                        搜索\n                    ")])],1)],1),e._v(" "),a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.searchLoading,expression:"searchLoading"}],staticClass:"search-result"},[e.searchResults.length?a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.searchResults,border:"","header-cell-style":{background:"#f5f7fa",color:"#606266",fontWeight:"bold",textAlign:"center"},"cell-style":{textAlign:"center"}}},[a("el-table-column",{attrs:{label:"条码类型",width:"120"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-tag",{attrs:{type:t.row.isMainBarcode?"primary":"success"}},[e._v("\n                                "+e._s(t.row.isMainBarcode?"主条码":"子条码")+"\n                            ")])]}}],null,!1,1158433612)}),e._v(" "),a("el-table-column",{attrs:{label:"条码",prop:"barcode","min-width":"150"}}),e._v(" "),a("el-table-column",{attrs:{label:"物料信息","min-width":"200"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",[e._v("编码："+e._s(t.row.materialCode))]),e._v(" "),a("div",[e._v("名称："+e._s(t.row.materialName))]),e._v(" "),a("div",[e._v("规格："+e._s(t.row.materialSpec))])]}}],null,!1,2839144854)}),e._v(" "),a("el-table-column",{attrs:{label:"所属主条码","min-width":"150"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.isMainBarcode?a("span",[e._v("-")]):a("el-button",{attrs:{type:"text"},on:{click:function(a){return e.handleView(t.row.mainBarcodeData)}}},[e._v("\n                                "+e._s(t.row.mainBarcode)+"\n                            ")])]}}],null,!1,146026579)}),e._v(" "),a("el-table-column",{attrs:{label:"状态",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-tag",{attrs:{type:e.getProcessStatusType(t.row.status)}},[e._v("\n                                "+e._s(e.getProcessStatusText(t.row.status))+"\n                            ")])]}}],null,!1,363000109)}),e._v(" "),a("el-table-column",{attrs:{label:"所属工序","min-width":"150"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.isMainBarcode?a("span",[e._v("-")]):[a("el-tag",{attrs:{size:"medium",type:"info"}},[e._v("\n                                    "+e._s(t.row.processName)+"\n                                    "),t.row.processCode?a("el-tag",{attrs:{size:"mini",type:"info"}},[e._v("\n                                        "+e._s(t.row.processCode)+"\n                                    ")]):e._e()],1)]]}}],null,!1,769390516)}),e._v(" "),a("el-table-column",{attrs:{label:"操作",width:"120",fixed:"right"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"text"},on:{click:function(a){return e.handleView(t.row.isMainBarcode?t.row:t.row.mainBarcodeData)}}},[e._v("\n                                查看详情\n                            ")]),e._v(" "),a("el-button",{staticStyle:{color:"red"},attrs:{type:"text"},on:{click:function(a){return e.handleInit(t.row)}}},[e._v("成品初始化")])]}}],null,!1,390256671)})],1):e.searchLoading?e._e():a("div",{staticClass:"no-result"},[a("i",{staticClass:"el-icon-warning-outline"}),e._v(" "),a("span",[e._v("暂无搜索结果")])])],1)])])],1)}),[function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"screen1"},[a("div",{staticClass:"screen_content"},[a("div",{staticClass:"screen_content_first"},[a("i",{staticClass:"el-icon-tickets"},[e._v("主条码生产流程列表")])])])])}],!1,null,"4a82223e",null));t.default=O.exports}}]);