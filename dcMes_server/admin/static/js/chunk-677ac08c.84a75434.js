(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-677ac08c"],{2632:function(e,t,r){},"6e83":function(e,t,r){"use strict";r("2632")},f7af:function(e,t,r){"use strict";r.r(t);var a=(r("28a5"),r("3b2b"),r("6762"),r("2fdb"),r("f576"),r("c7eb")),n=(r("96cf"),r("1da1")),s=(r("7f7f"),r("7e1e")),i={components:{Pagination:r("333d").a},data:function(){return{searchForm:{name:"",enabled:""},rulesList:[],total:0,currentPage:1,pageSize:10,listLoading:!0,dialogVisible:!1,dialogTitle:"",selection:[],testBarcode:"",testResult:null,currentRule:{name:"",description:"",priority:1,enabled:!0,conditions:{type:"separator",separator:"",length:0,regex:""},extraction:{materialCode:{type:"split",index:0,start:0,end:0,diPosition:{start:0,end:0}}}},rules:{name:[{required:!0,message:"请输入规则名称",trigger:"blur"}],priority:[{required:!0,message:"请输入优先级",trigger:"blur"}],"conditions.type":[{required:!0,message:"请选择匹配类型",trigger:"change"}],"extraction.materialCode.type":[{required:!0,message:"请选择提取方式",trigger:"change"}]},listQuery:{page:1,limit:20,total:0}}},created:function(){this.fetchRules()},methods:{searchData:function(){var e={query:{$and:[]}};return this.searchForm.name&&e.query.$and.push({name:{$regex:this.searchForm.name,$options:"i"}}),""!==this.searchForm.enabled&&e.query.$and.push({enabled:this.searchForm.enabled}),e.query.$and.length||delete e.query.$and,e},resetForm:function(){this.$refs.searchForm.resetFields(),this.searchForm={name:"",enabled:""},this.currentPage=1,this.fetchRules()},fetchRules:function(){var e=Object(n.a)(Object(a.a)().mark((function e(){var t,r;return Object(a.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.listLoading=!0,e.prev=1,(t=this.searchData()).page=this.currentPage,t.skip=(this.currentPage-1)*this.pageSize,t.limit=this.pageSize,t.count=!0,e.next=9,Object(s.b)("barcodeRule",t);case 9:r=e.sent,this.rulesList=r.data,this.total=r.countnum,e.next=18;break;case 14:e.prev=14,e.t0=e.catch(1),console.error("获取规则列表失败:",e.t0),this.$message.error("获取规则列表失败");case 18:return e.prev=18,this.listLoading=!1,e.finish(18);case 21:case"end":return e.stop()}}),e,this,[[1,14,18,21]])})));return function(){return e.apply(this,arguments)}}(),handleSelectionChange:function(e){this.selection=e},search:function(){this.currentPage=1,this.fetchRules()},formatDate:function(e){if(!e)return"暂无数据";var t=new Date(e);if(isNaN(t.getTime()))return"无效日期";var r=t.getFullYear(),a=String(t.getMonth()+1).padStart(2,"0"),n=String(t.getDate()).padStart(2,"0");return"".concat(r,"-").concat(a,"-").concat(n)},handleView:function(e){this.currentRule=JSON.parse(JSON.stringify(e)),this.dialogTitle="查看规则",this.dialogVisible=!0},handleBatchDelete:function(){var e=this;this.selection.length?this.$confirm("确认删除选中的 ".concat(this.selection.length," 条记录吗？"),"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(Object(n.a)(Object(a.a)().mark((function t(){var r;return Object(a.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,r=e.selection.map((function(e){return e._id})),t.next=4,Object(s.c)("barcodeRule",{query:{_id:{$in:r}}});case 4:e.$message.success("批量删除成功"),e.fetchRules(),t.next=12;break;case 8:t.prev=8,t.t0=t.catch(0),console.error("批量删除失败:",t.t0),e.$message.error("批量删除失败");case 12:case"end":return t.stop()}}),t,null,[[0,8]])})))).catch((function(){})):this.$message.warning("请选择要删除的记录")},handleSubmit:function(){var e=Object(n.a)(Object(a.a)().mark((function e(t){return Object(a.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,"create"!==this.dialogStatus){e.next=7;break}return e.next=4,Object(s.a)("barcodeRule",t);case 4:this.$message.success("新增成功"),e.next=10;break;case 7:return e.next=9,Object(s.d)("barcodeRule",{query:{_id:t._id},update:t});case 9:this.$message.success("更新成功");case 10:this.dialogVisible=!1,this.fetchRules(),e.next=18;break;case 14:e.prev=14,e.t0=e.catch(0),console.error("操作失败:",e.t0),this.$message.error("操作失败");case 18:case"end":return e.stop()}}),e,this,[[0,14]])})));return function(t){return e.apply(this,arguments)}}(),handleCreate:function(){var e=Object(n.a)(Object(a.a)().mark((function e(){return Object(a.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.dialogTitle="添加规则",this.currentRule=this.getInitialRule(),this.dialogVisible=!0,this.testResult=null;case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),handleEdit:function(){var e=Object(n.a)(Object(a.a)().mark((function e(t){return Object(a.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.dialogTitle="编辑规则",this.currentRule=JSON.parse(JSON.stringify(t)),this.dialogVisible=!0,this.testResult=null;case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),handleDelete:function(){var e=Object(n.a)(Object(a.a)().mark((function e(t){return Object(a.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.$confirm("确认删除该规则吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});case 3:return e.next=5,Object(s.c)("barcodeRule",t._id);case 5:this.$message.success("删除成功"),this.fetchRules(),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0),"cancel"!==e.t0&&(console.error("删除失败:",e.t0),this.$message.error("删除失败"));case 12:case"end":return e.stop()}}),e,this,[[0,9]])})));return function(t){return e.apply(this,arguments)}}(),handleStatusChange:function(){var e=Object(n.a)(Object(a.a)().mark((function e(t){return Object(a.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Object(s.d)("barcodeRule",t._id,{enabled:t.enabled});case 3:this.$message.success("状态更新成功"),e.next=11;break;case 6:e.prev=6,e.t0=e.catch(0),console.error("状态更新失败:",e.t0),this.$message.error("状态更新失败"),t.enabled=!t.enabled;case 11:case"end":return e.stop()}}),e,this,[[0,6]])})));return function(t){return e.apply(this,arguments)}}(),handleSizeChange:function(e){this.listQuery.limit=e,this.fetchRules()},handleCurrentChange:function(e){this.listQuery.page=e,this.fetchRules()},handleTest:function(){var e=Object(n.a)(Object(a.a)().mark((function e(){var t;return Object(a.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.testBarcode){e.next=3;break}return this.$message.warning("请输入测试条码"),e.abrupt("return");case 3:return e.prev=3,e.next=6,this.validateBarcode(this.testBarcode);case 6:(t=e.sent)?this.testResult={ruleName:t.ruleName,materialCode:t.materialCode,relatedBill:t.relatedBill}:(this.testResult=null,this.$message.error("未匹配到任何规则")),e.next=14;break;case 10:e.prev=10,e.t0=e.catch(3),console.error("测试失败:",e.t0),this.$message.error("测试失败");case 14:case"end":return e.stop()}}),e,this,[[3,10]])})));return function(){return e.apply(this,arguments)}}(),validateBarcode:function(){var e=Object(n.a)(Object(a.a)().mark((function e(t){return Object(a.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),getInitialRule:function(){return{name:"",description:"",priority:1,enabled:!0,conditions:{type:"separator",separator:"",length:0,regex:""},extraction:{materialCode:{type:"split",index:0,start:0,end:0,diPosition:{start:0,end:0}}}}},handleTestCurrentRule:function(){var e=Object(n.a)(Object(a.a)().mark((function e(){var t,r,n,s,i,l;return Object(a.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.testBarcode){e.next=3;break}return this.$message.warning("请输入测试条码"),e.abrupt("return");case 3:e.prev=3,t={matched:!1},r=this.testBarcode,e.t0=this.currentRule.conditions.type,e.next="separator"===e.t0?9:"length"===e.t0?14:"regex"===e.t0?19:32;break;case 9:if(r.includes(this.currentRule.conditions.separator)){e.next=12;break}return t.message="条码中未包含指定的分隔符",e.abrupt("break",32);case 12:return t.matched=!0,e.abrupt("break",32);case 14:if(r.length===this.currentRule.conditions.length){e.next=17;break}return t.message="条码长度不符合要求，应为".concat(this.currentRule.conditions.length,"位"),e.abrupt("break",32);case 17:return t.matched=!0,e.abrupt("break",32);case 19:if(e.prev=19,new RegExp(this.currentRule.conditions.regex).test(r)){e.next=24;break}return t.message="条码不符合正则表达式规则",e.abrupt("break",32);case 24:t.matched=!0,e.next=31;break;case 27:return e.prev=27,e.t1=e.catch(19),t.message="正则表达式格式错误",e.abrupt("break",32);case 31:return e.abrupt("break",32);case 32:if(!t.matched){e.next=48;break}n=this.currentRule.extraction.materialCode,e.t2=n.type,e.next="split"===e.t2?37:"substring"===e.t2?40:"di"===e.t2?42:48;break;case 37:return s=r.split(this.currentRule.conditions.separator),t.materialCode=s[n.index],e.abrupt("break",48);case 40:return t.materialCode=r.substring(n.start,n.end),e.abrupt("break",48);case 42:return i=r.substring(n.diPosition.start,n.diPosition.end),e.next=45,this.validateDICode(i);case 45:return(l=e.sent).isValid?t.materialCode=l.materialCode:(t.matched=!1,t.message="DI码验证失败"),e.abrupt("break",48);case 48:this.testResult=t,e.next=55;break;case 51:e.prev=51,e.t3=e.catch(3),console.error("测试失败:",e.t3),this.$message.error("测试执行失败");case 55:case"end":return e.stop()}}),e,this,[[3,51],[19,27]])})));return function(){return e.apply(this,arguments)}}()}},l=i,c=(r("6e83"),r("2877")),o=Object(c.a)(l,(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"app-container"},[r("el-card",{staticClass:"filter-container"},[r("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[r("span",[e._v("筛选搜索")])]),e._v(" "),r("el-form",{ref:"searchForm",staticClass:"demo-form-inline",attrs:{model:e.searchForm}},[r("el-row",{attrs:{gutter:20}},[r("el-col",{attrs:{span:6}},[r("el-form-item",{attrs:{label:"规则名称"}},[r("el-input",{attrs:{placeholder:"请输入规则名称",clearable:""},model:{value:e.searchForm.name,callback:function(t){e.$set(e.searchForm,"name",t)},expression:"searchForm.name"}})],1)],1),e._v(" "),r("el-col",{attrs:{span:6}},[r("el-form-item",{attrs:{label:"状态"}},[r("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择状态",clearable:""},model:{value:e.searchForm.enabled,callback:function(t){e.$set(e.searchForm,"enabled",t)},expression:"searchForm.enabled"}},[r("el-option",{attrs:{label:"启用",value:!0}}),e._v(" "),r("el-option",{attrs:{label:"禁用",value:!1}})],1)],1)],1)],1),e._v(" "),r("el-form-item",[r("el-button",{attrs:{type:"primary"},on:{click:e.search}},[e._v("查询搜索")]),e._v(" "),r("el-button",{on:{click:e.resetForm}},[e._v("重置")]),e._v(" "),r("el-button",{attrs:{type:"primary",icon:"el-icon-plus"},on:{click:e.handleCreate}},[e._v("新增规则")]),e._v(" "),r("el-button",{attrs:{type:"danger",icon:"el-icon-delete",disabled:!e.selection.length},on:{click:e.handleBatchDelete}},[e._v("批量删除")])],1)],1)],1),e._v(" "),e._m(0),e._v(" "),r("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.listLoading,expression:"listLoading"}],staticStyle:{width:"100%"},attrs:{data:e.rulesList,border:""},on:{"selection-change":e.handleSelectionChange}},[r("el-table-column",{attrs:{type:"selection",width:"55"}}),e._v(" "),r("el-table-column",{attrs:{label:"规则名称",prop:"name"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-link",{attrs:{type:"primary"},on:{click:function(r){return e.handleView(t.row)}}},[e._v(e._s(t.row.name))])]}}])}),e._v(" "),r("el-table-column",{attrs:{label:"描述",prop:"description"}}),e._v(" "),r("el-table-column",{attrs:{label:"优先级",prop:"priority",width:"100"}}),e._v(" "),r("el-table-column",{attrs:{label:"状态",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[r("el-tag",{attrs:{type:a.enabled?"success":"info"}},[e._v("\n          "+e._s(a.enabled?"启用":"禁用")+"\n        ")])]}}])}),e._v(" "),r("el-table-column",{attrs:{label:"创建时间",align:"center",width:"160"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n        "+e._s(e.formatDate(t.row.createAt))+"\n      ")]}}])}),e._v(" "),r("el-table-column",{attrs:{label:"操作",width:"200",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[r("el-button",{attrs:{type:"text",size:"small"},on:{click:function(t){return e.handleEdit(a)}}},[r("i",{staticClass:"el-icon-edit"}),e._v(" 编辑\n        ")]),e._v(" "),r("el-button",{staticClass:"delete-btn",attrs:{type:"text",size:"small"},on:{click:function(t){return e.handleDelete(a)}}},[r("i",{staticClass:"el-icon-delete"}),e._v(" 删除\n        ")])]}}])})],1),e._v(" "),r("pagination",{directives:[{name:"show",rawName:"v-show",value:e.total>0,expression:"total > 0"}],attrs:{total:e.total,page:e.currentPage,limit:e.pageSize},on:{"update:page":function(t){e.currentPage=t},"update:limit":function(t){e.pageSize=t},pagination:e.fetchRules}}),e._v(" "),r("el-dialog",{attrs:{title:e.dialogTitle,visible:e.dialogVisible,width:"60%"},on:{"update:visible":function(t){e.dialogVisible=t}}},[r("el-form",{ref:"form",attrs:{model:e.currentRule,rules:e.rules,"label-width":"120px"}},[r("el-form-item",{attrs:{label:"规则名称",prop:"name"}},[r("el-input",{model:{value:e.currentRule.name,callback:function(t){e.$set(e.currentRule,"name",t)},expression:"currentRule.name"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"描述",prop:"description"}},[r("el-input",{attrs:{type:"textarea"},model:{value:e.currentRule.description,callback:function(t){e.$set(e.currentRule,"description",t)},expression:"currentRule.description"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"优先级",prop:"priority"}},[r("el-input-number",{attrs:{min:1},model:{value:e.currentRule.priority,callback:function(t){e.$set(e.currentRule,"priority",t)},expression:"currentRule.priority"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"启用状态"}},[r("el-switch",{model:{value:e.currentRule.enabled,callback:function(t){e.$set(e.currentRule,"enabled",t)},expression:"currentRule.enabled"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"匹配类型",prop:"conditions.type"}},[r("el-select",{model:{value:e.currentRule.conditions.type,callback:function(t){e.$set(e.currentRule.conditions,"type",t)},expression:"currentRule.conditions.type"}},[r("el-option",{attrs:{label:"分隔符匹配",value:"separator"}}),e._v(" "),r("el-option",{attrs:{label:"长度匹配",value:"length"}}),e._v(" "),r("el-option",{attrs:{label:"正则匹配",value:"regex"}})],1)],1),e._v(" "),"separator"===e.currentRule.conditions.type?r("el-form-item",{attrs:{label:"分隔符",prop:"conditions.separator"}},[r("el-input",{model:{value:e.currentRule.conditions.separator,callback:function(t){e.$set(e.currentRule.conditions,"separator",t)},expression:"currentRule.conditions.separator"}})],1):e._e(),e._v(" "),"length"===e.currentRule.conditions.type?r("el-form-item",{attrs:{label:"条码长度",prop:"conditions.length"}},[r("el-input-number",{attrs:{min:1},model:{value:e.currentRule.conditions.length,callback:function(t){e.$set(e.currentRule.conditions,"length",t)},expression:"currentRule.conditions.length"}})],1):e._e(),e._v(" "),"regex"===e.currentRule.conditions.type?r("el-form-item",{attrs:{label:"正则表达式",prop:"conditions.regex"}},[r("el-input",{model:{value:e.currentRule.conditions.regex,callback:function(t){e.$set(e.currentRule.conditions,"regex",t)},expression:"currentRule.conditions.regex"}})],1):e._e(),e._v(" "),r("el-divider",{attrs:{"content-position":"left"}},[e._v("物料编码提取规则")]),e._v(" "),r("el-form-item",{attrs:{label:"提取方式",prop:"extraction.materialCode.type"}},[r("el-select",{model:{value:e.currentRule.extraction.materialCode.type,callback:function(t){e.$set(e.currentRule.extraction.materialCode,"type",t)},expression:"currentRule.extraction.materialCode.type"}},[r("el-option",{attrs:{label:"分割提取",value:"split"}}),e._v(" "),r("el-option",{attrs:{label:"截取提取",value:"substring"}}),e._v(" "),r("el-option",{attrs:{label:"DI码提取",value:"di"}})],1)],1),e._v(" "),"split"===e.currentRule.extraction.materialCode.type?r("el-form-item",{attrs:{label:"分割索引",prop:"extraction.materialCode.index"}},[r("el-input-number",{attrs:{min:0},model:{value:e.currentRule.extraction.materialCode.index,callback:function(t){e.$set(e.currentRule.extraction.materialCode,"index",t)},expression:"currentRule.extraction.materialCode.index"}})],1):e._e(),e._v(" "),"substring"===e.currentRule.extraction.materialCode.type?[r("el-form-item",{attrs:{label:"起始位置",prop:"extraction.materialCode.start"}},[r("el-input-number",{attrs:{min:0},model:{value:e.currentRule.extraction.materialCode.start,callback:function(t){e.$set(e.currentRule.extraction.materialCode,"start",t)},expression:"currentRule.extraction.materialCode.start"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"结束位置",prop:"extraction.materialCode.end"}},[r("el-input-number",{attrs:{min:0},model:{value:e.currentRule.extraction.materialCode.end,callback:function(t){e.$set(e.currentRule.extraction.materialCode,"end",t)},expression:"currentRule.extraction.materialCode.end"}})],1)]:e._e(),e._v(" "),"di"===e.currentRule.extraction.materialCode.type?[r("el-form-item",{attrs:{label:"DI码起始位置",prop:"extraction.materialCode.diPosition.start"}},[r("el-input-number",{attrs:{min:0},model:{value:e.currentRule.extraction.materialCode.diPosition.start,callback:function(t){e.$set(e.currentRule.extraction.materialCode.diPosition,"start",t)},expression:"currentRule.extraction.materialCode.diPosition.start"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"DI码结束位置",prop:"extraction.materialCode.diPosition.end"}},[r("el-input-number",{attrs:{min:0},model:{value:e.currentRule.extraction.materialCode.diPosition.end,callback:function(t){e.$set(e.currentRule.extraction.materialCode.diPosition,"end",t)},expression:"currentRule.extraction.materialCode.diPosition.end"}})],1)]:e._e(),e._v(" "),r("el-divider",{attrs:{"content-position":"left"}},[e._v("规则测试")]),e._v(" "),r("el-form-item",{attrs:{label:"测试条码"}},[r("div",{staticClass:"test-input-group"},[r("el-input",{staticStyle:{width:"calc(100% - 90px)"},attrs:{placeholder:"请输入要测试的条码"},model:{value:e.testBarcode,callback:function(t){e.testBarcode=t},expression:"testBarcode"}}),e._v(" "),r("el-button",{staticStyle:{"margin-left":"10px"},attrs:{type:"primary",size:"small"},on:{click:e.handleTestCurrentRule}},[e._v("\n            测试\n          ")])],1)]),e._v(" "),e.testResult?r("el-form-item",{attrs:{label:"测试结果"}},[r("el-card",{staticClass:"test-result-card"},[r("div",{staticClass:"test-result-item"},[r("span",{staticClass:"label"},[e._v("条件匹配：")]),e._v(" "),r("span",{class:["value",e.testResult.matched?"success":"error"]},[e._v("\n              "+e._s(e.testResult.matched?"匹配成功":"匹配失败")+"\n            ")])]),e._v(" "),e.testResult.matched?r("div",{staticClass:"test-result-item"},[r("span",{staticClass:"label"},[e._v("物料编码：")]),e._v(" "),r("span",{staticClass:"value"},[e._v(e._s(e.testResult.materialCode||"未提取"))])]):e._e(),e._v(" "),e.testResult.matched&&e.testResult.relatedBill?r("div",{staticClass:"test-result-item"},[r("span",{staticClass:"label"},[e._v("关联单据：")]),e._v(" "),r("span",{staticClass:"value"},[e._v(e._s(e.testResult.relatedBill))])]):e._e(),e._v(" "),e.testResult.matched?e._e():r("div",{staticClass:"test-result-item"},[r("span",{staticClass:"label"},[e._v("失败原因：")]),e._v(" "),r("span",{staticClass:"value error"},[e._v(e._s(e.testResult.message))])])])],1):e._e(),e._v(" "),r("div",{staticClass:"dialog-footer"},[r("el-button",{on:{click:function(t){e.dialogVisible=!1}}},[e._v("取消")]),e._v(" "),r("el-button",{attrs:{type:"primary"},on:{click:e.handleSubmit}},[e._v("确定")])],1)],2)],1),e._v(" "),r("pagination",{directives:[{name:"show",rawName:"v-show",value:e.listQuery.total>0,expression:"listQuery.total > 0"}],attrs:{total:e.listQuery.total,page:e.listQuery.page,limit:e.listQuery.limit},on:{"update:page":function(t){return e.$set(e.listQuery,"page",t)},"update:limit":function(t){return e.$set(e.listQuery,"limit",t)},pagination:e.fetchRules}})],1)}),[function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"screen1"},[r("div",{staticClass:"screen_content"},[r("div",{staticClass:"screen_content_first"},[r("i",{staticClass:"el-icon-tickets"},[e._v("条码规则列表")])])])])}],!1,null,"9c76cf56",null);t.default=o.exports}}]);