(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-1a2efa5e","chunk-7feedf86","chunk-6919d003"],{"1a2d":function(e,t,r){"use strict";r.d(t,"a",(function(){return s})),r.d(t,"b",(function(){return n})),r.d(t,"c",(function(){return i}));var a=r("b775");function s(e){return Object(a.a)({url:"/user_login",method:"get",params:e})}function n(e){return Object(a.a)({url:"/user_login",method:"post",data:e})}function i(e){return Object(a.a)({url:"/user_login",method:"put",data:e})}},3946:function(e,t,r){"use strict";r.r(t);var a=r("c7eb"),s=(r("96cf"),r("1da1")),n=r("1a2d"),i={data:function(){var e=this;return{dialogVisible:!1,form:{password:"",newPassword:"",newPassword2:""},rules:{password:[{required:!0,message:"请输入原密码",trigger:"blur"}],newPassword:[{required:!0,message:"请设置新密码",trigger:"blur"},{validator:function(t,r,a){r===e.form.password?a(new Error("新密码不能与原密码相同!")):a()},trigger:"blur"}],newPassword2:[{required:!0,message:"请确认新密码",trigger:"blur"},{validator:function(t,r,a){r!==e.form.newPassword?a(new Error("与新密码不一致!")):a()},trigger:"blur"}]}}},methods:{show:function(){this.dialogVisible=!0},handleCancel:function(){this.dialogVisible=!1,this.$refs.passwordForm.resetFields()},onSubmit:function(){var e=Object(s.a)(Object(a.a)().mark((function e(t){var r=this;return Object(a.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.$refs[t].validate(function(){var e=Object(s.a)(Object(a.a)().mark((function e(t){var s,i,o;return Object(a.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t){e.next=20;break}if(!(r.form.newPassword.length<6)){e.next=4;break}return r.$message.error("密码需6位数，请重新输入"),e.abrupt("return");case 4:return s=r.$store.state.user.id,i={query:{_id:s}},e.next=8,Object(n.a)(i);case 8:if(e.sent.data[0].password!==r.form.password){e.next=17;break}return o={query:{_id:s},update:{$set:{password:r.form.newPassword}}},e.next=13,Object(n.c)(o);case 13:200===e.sent.code?(r.$message.success("密码修改成功！"),r.dialogVisible=!1,r.logout()):r.$message.error("修改失败，请重试!"),e.next=18;break;case 17:r.$message.error("原密码错误，请重新输入！");case 18:e.next=22;break;case 20:return r.$message.error("请正确填写格式"),e.abrupt("return",!1);case 22:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),logout:function(){var e=Object(s.a)(Object(a.a)().mark((function e(){return Object(a.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.$store.dispatch("user/logout");case 2:this.$router.push("/login");case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}},o=i,c=r("2877"),u=Object(c.a)(o,(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("el-dialog",{attrs:{title:"修改密码",visible:e.dialogVisible,"append-to-body":"",width:"40%"},on:{"update:visible":function(t){e.dialogVisible=t}}},[r("el-form",{ref:"passwordForm",attrs:{model:e.form,rules:e.rules,"label-width":"100px"}},[r("el-form-item",{attrs:{label:"原密码",prop:"password"}},[r("el-input",{attrs:{placeholder:"请输入原密码",type:"password"},model:{value:e.form.password,callback:function(t){e.$set(e.form,"password",t)},expression:"form.password"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"新密码",prop:"newPassword"}},[r("el-input",{attrs:{placeholder:"请设置新密码",type:"password"},model:{value:e.form.newPassword,callback:function(t){e.$set(e.form,"newPassword",t)},expression:"form.newPassword"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"确认密码",prop:"newPassword2"}},[r("el-input",{attrs:{placeholder:"请确认新密码",type:"password"},model:{value:e.form.newPassword2,callback:function(t){e.$set(e.form,"newPassword2",t)},expression:"form.newPassword2"}})],1),e._v(" "),r("el-form-item",[r("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.onSubmit("passwordForm")}}},[e._v("确定修改")]),e._v(" "),r("el-button",{on:{click:e.handleCancel}},[e._v("取消")])],1)],1)],1)}),[],!1,null,null,null);t.default=u.exports},"7abe":function(e,t,r){"use strict";r.r(t);var a=(r("f576"),r("c7eb")),s=(r("96cf"),r("1da1")),n=(r("7e1e"),r("313e")),i=r("b775");function o(e){return Object(i.a)({url:"/messageLogList",method:"post",data:e})}function c(e){return Object(i.a)({url:"/messageId/read",method:"post",data:e})}function u(e){return Object(i.a)({url:"/read-all",method:"post",data:e})}var l={components:{UserInfoDialog:r("a2a3").default},data:function(){return{userdata:{},activeTab:"unread",loading:!1,unreadMessages:[],allMessages:[],dialogVisible:!1,currentMessage:null,messageTypeMap:{TASK_PUBLISHED:"任务发布",TASK_CLAIMED:"任务认领",TRACKER_ASSIGNED:"跟踪员指派",TASK_UPDATED:"任务更新"}}},mounted:function(){this.userdata=this.$store.state.user},methods:{initCharts:function(){this.initGenderChart(),this.initRegionChart(),this.initCategoryChart()},showDialog:function(){this.$refs.userInfoDialog.show()},initGenderChart:function(){n.init(document.getElementById("genderChart")).setOption({series:[{type:"pie",data:[{value:600,name:"男性"},{value:400,name:"女性"}]}]})},initRegionChart:function(){n.init(document.getElementById("regionChart")).setOption({xAxis:{type:"category",data:["北京","上海","广州","深圳"]},yAxis:{type:"value"},series:[{type:"bar",data:[300,200,150,350]}]})},initCategoryChart:function(){n.init(document.getElementById("categoryChart")).setOption({series:[{type:"pie",data:[{value:300,name:"美食"},{value:200,name:"旅游"},{value:500,name:"科技"}]}]})},logout:function(){var e=Object(s.a)(Object(a.a)().mark((function e(){return Object(a.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.$store.dispatch("user/logout");case 2:this.$router.push("/login?redirect=".concat(this.$route.fullPath));case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),mima:function(){var e=Object(s.a)(Object(a.a)().mark((function e(){return Object(a.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.$store.dispatch("view/mima");case 2:this.$router.push("/mima?redirect=".concat(this.$route.fullPath));case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),fetchMessages:function(){var e=Object(s.a)(Object(a.a)().mark((function e(){var t,r,s,n=this;return Object(a.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.loading=!0,e.prev=1,t={user:this.$store.state.user},e.next=5,o(t);case 5:r=e.sent,s=r.data,this.unreadMessages=s.filter((function(e){return e.receivers.some((function(e){return e.userId===n.$store.state.user.id&&!e.isRead}))})),this.allMessages=s,e.next=16;break;case 12:e.prev=12,e.t0=e.catch(1),this.$message.error("获取消息失败");case 16:return e.prev=16,this.loading=!1,e.finish(16);case 19:case"end":return e.stop()}}),e,this,[[1,12,16,19]])})));return function(){return e.apply(this,arguments)}}(),markAsRead:function(){var e=Object(s.a)(Object(a.a)().mark((function e(t){return Object(a.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,c({messageId:t,user:this.$store.state.user});case 3:this.$message.success("已标记为已读"),this.fetchMessages(),e.next=11;break;case 7:e.prev=7,e.t0=e.catch(0),this.$message.error("标记已读失败");case 11:case"end":return e.stop()}}),e,this,[[0,7]])})));return function(t){return e.apply(this,arguments)}}(),markAllAsRead:function(){var e=Object(s.a)(Object(a.a)().mark((function e(){return Object(a.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,u({user:this.$store.state.user});case 3:this.$message.success("已全部标记为已读"),this.fetchMessages(),e.next=11;break;case 7:e.prev=7,e.t0=e.catch(0),this.$message.error("标记全部已读失败");case 11:case"end":return e.stop()}}),e,this,[[0,7]])})));return function(){return e.apply(this,arguments)}}(),handleTabClick:function(){this.fetchMessages()},viewDetail:function(e){this.currentMessage=e,this.dialogVisible=!0,e.isRead||this.markAsRead(e._id)},formatDate:function(e){if(!e)return"";var t=new Date(e);return"".concat(t.getFullYear(),"-").concat(String(t.getMonth()+1).padStart(2,"0"),"-").concat(String(t.getDate()).padStart(2,"0")," ").concat(String(t.getHours()).padStart(2,"0"),":").concat(String(t.getMinutes()).padStart(2,"0"))}}},d=l,f=(r("beb7"),r("2877")),p=Object(f.a)(d,(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"app-container"},[r("div",{staticClass:"userstatus"},[r("div",{staticClass:"flexs"},[r("img",{staticClass:"user-avatar",attrs:{src:e.userdata.avatar}}),e._v(" "),r("div",{staticClass:"imgtext"},[e._v("您好，"+e._s(e.userdata.name))])]),e._v(" "),r("div",{staticClass:"flexs"},[r("el-button",{staticClass:"buttons",attrs:{type:"primary"},on:{click:e.showDialog}},[e._v("修改信息")]),e._v(" "),r("el-button",{staticClass:"buttons",on:{click:e.logout}},[e._v("退出登录")])],1)]),e._v(" "),r("user-info-dialog",{ref:"userInfoDialog"})],1)}),[],!1,null,"4bd41c0a",null);t.default=p.exports},"8e18":function(e,t,r){},a2a3:function(e,t,r){"use strict";r.r(t);var a=r("ade3"),s=r("c7eb"),n=(r("96cf"),r("1da1")),i=r("1a2d"),o={components:{PasswordDialog:r("3946").default},data:function(){var e=this;return{dialogVisible:!1,uploadAvatarUrl:"http://192.168.6.250/dcMes_server/api/v1/upload/avatar",form:{avatar:"",nickName:"",password:"",newPassword:"",newPassword2:""},rules:{nickName:[{required:!0,message:"请输入用户名",trigger:"blur"}],password:[{required:!0,message:"请输入原密码",trigger:"blur"}],newPassword:[{required:!0,message:"请设置新密码",trigger:"blur"},{validator:function(t,r,a){r===e.form.password?a(new Error("新密码不能与原密码相同!")):a()},trigger:"blur"}],newPassword2:[{required:!0,message:"请确认新密码",trigger:"blur"},{validator:function(t,r,a){r!==e.form.newPassword?a(new Error("与新密码不一致!")):a()},trigger:"blur"}]},uploadHeaders:{Authorization:"Bearer "+this.$store.state.user.token},uploadData:{type:"avatar"}}},methods:Object(a.a)({show:function(){this.dialogVisible=!0,this.getUserInfo()},getUserInfo:function(){var e=Object(n.a)(Object(s.a)().mark((function e(){var t,r,a;return Object(s.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.$store.state.user.id,r={query:{_id:t}},e.next=5,Object(i.a)(r);case 5:(a=e.sent).data&&a.data[0]&&(this.form.nickName=a.data[0].nickName,this.form.avatar=a.data[0].avatar);case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),handleAvatarSuccess:function(e,t){200===e.code?(this.form.avatar="http://192.168.6.250/dcMes_server/"+e.data.url,this.$message.success("头像上传成功")):this.$message.error(e.msg||"头像上传失败")},beforeAvatarUpload:function(e){var t="image/jpeg"===e.type||"image/png"===e.type,r=e.size/1024/1024<2;return t?!!r||(this.$message.error("上传头像图片大小不能超过 2MB!"),!1):(this.$message.error("上传头像图片只能是 JPG 或 PNG 格式!"),!1)},handleCancel:function(){this.dialogVisible=!1,this.$refs.form.resetFields()},showPasswordDialog:function(){this.$refs.passwordDialog.show()},onSubmit:function(){var e=Object(n.a)(Object(s.a)().mark((function e(t){var r=this;return Object(s.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.$refs[t].validate(function(){var e=Object(n.a)(Object(s.a)().mark((function e(t){var a,n;return Object(s.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t){e.next=9;break}return a=r.$store.state.user.id,n={query:{_id:a},update:{$set:{nickName:r.form.nickName,avatar:r.form.avatar}}},e.next=5,Object(i.c)(n);case 5:200===e.sent.code?(r.$message.success("修改成功！"),r.dialogVisible=!1,r.$router.go(0)):r.$message.error("修改失败，请重试!"),e.next=11;break;case 9:return r.$message.error("请正确填写格式"),e.abrupt("return",!1);case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),logout:function(){var e=Object(n.a)(Object(s.a)().mark((function e(){return Object(s.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.$store.dispatch("user/logout");case 2:this.$router.push("/login");case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},"showPasswordDialog",(function(){this.$refs.passwordDialog.show()}))},c=o,u=(r("bf1f"),r("2877")),l=Object(u.a)(c,(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("el-dialog",{attrs:{title:"个人信息修改",visible:e.dialogVisible,width:"50%"},on:{"update:visible":function(t){e.dialogVisible=t}}},[r("el-form",{ref:"form",attrs:{model:e.form,rules:e.rules,"label-width":"100px"}},[r("el-form-item",{attrs:{label:"头像"}},[r("el-upload",{staticClass:"avatar-uploader",attrs:{action:e.uploadAvatarUrl,headers:e.uploadHeaders,name:"avatar",data:e.uploadData,"show-file-list":!1,"on-success":e.handleAvatarSuccess,"before-upload":e.beforeAvatarUpload}},[e.form.avatar?r("img",{staticClass:"avatar",attrs:{src:e.form.avatar}}):r("i",{staticClass:"el-icon-plus avatar-uploader-icon"})])],1),e._v(" "),r("el-form-item",{attrs:{label:"用户名",prop:"nickName"}},[r("el-input",{attrs:{placeholder:"请输入用户名"},model:{value:e.form.nickName,callback:function(t){e.$set(e.form,"nickName",t)},expression:"form.nickName"}})],1),e._v(" "),r("el-form-item",[r("el-button",{attrs:{type:"warning"},on:{click:e.showPasswordDialog}},[e._v("修改密码")]),e._v(" "),r("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.onSubmit("form")}}},[e._v("保存信息")]),e._v(" "),r("el-button",{on:{click:e.handleCancel}},[e._v("取消")])],1)],1),e._v(" "),r("password-dialog",{ref:"passwordDialog"})],1)}),[],!1,null,"7fc85303",null);t.default=l.exports},beb7:function(e,t,r){"use strict";r("c3b1")},bf1f:function(e,t,r){"use strict";r("8e18")},c3b1:function(e,t,r){}}]);