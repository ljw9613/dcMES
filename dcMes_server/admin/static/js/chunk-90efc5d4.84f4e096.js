(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-90efc5d4"],{"1bca":function(t,e,a){"use strict";a("406a")},3835:function(t,e,a){"use strict";var n=a("06c5");function r(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var a=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=a){var n,r,s,o,l=[],i=!0,c=!1;try{if(s=(a=a.call(t)).next,0===e){if(Object(a)!==a)return;i=!1}else for(;!(i=(n=s.call(a)).done)&&(l.push(n.value),l.length!==e);i=!0);}catch(t){c=!0,r=t}finally{try{if(!i&&null!=a.return&&(o=a.return(),Object(o)!==o))return}finally{if(c)throw r}}return l}}(t,e)||Object(n.a)(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}a.d(e,"a",(function(){return r}))},"406a":function(t,e,a){},"64e6":function(t,e,a){"use strict";a.d(e,"a",(function(){return r})),a.d(e,"b",(function(){return s})),a.d(e,"c",(function(){return o})),a.d(e,"d",(function(){return l}));var n=a("b775");function r(t){return Object(n.a)({url:"/warehouse_entry/scan",method:"post",data:t})}function s(t){return Object(n.a)({url:"/warehouse_entry/scan_on",method:"post",data:t})}function o(t){return Object(n.a)({url:"/k3/sync_warehouse_entry",method:"post",data:t})}function l(t){return Object(n.a)({url:"/k3/sync_warehouse_ontry",method:"post",data:t})}},eb6d:function(t,e,a){"use strict";a.r(e);var n=a("c7eb"),r=(a("c5f6"),a("28a5"),a("3835")),s=(a("96cf"),a("1da1")),o=a("64e6"),l={name:"ScanDialog",props:{scanData:{type:Object,default:function(){return{}}},visible:{type:Boolean,default:!1},title:{type:String,default:"托盘扫码出库"},placeholder:{type:String,default:"请扫描托盘条码"}},data:function(){return{dialogVisible:!1,scanForm:{barcode:""},rules:{barcode:[{required:!0,message:"请输入或扫描条码",trigger:"blur"}]},scanRecords:[],entryInfo:null}},watch:{visible:function(t){var e=this;this.dialogVisible=t,t&&(this.initEntryInfo(),this.$nextTick((function(){e.$refs.scanInput.focus()})))},dialogVisible:function(t){this.$emit("update:visible",t),t||this.resetForm()},scanData:{handler:function(t){this.initEntryInfo()},immediate:!0}},methods:{initEntryInfo:function(){this.scanData&&(this.entryInfo={FBillNo:this.scanData.FBillNo,HuoGuiCode:this.scanData.HuoGuiCode,FaQIaoNo:this.scanData.FaQIaoNo,materialName:this.scanData.materialName,materialSpec:this.scanData.materialSpec,plannedQuantity:this.scanData.FQty,outboundQuantity:this.scanData.outboundQuantity,actualQuantity:0,palletCount:0,progress:0})},handleScanInput:function(){var t=Object(s.a)(Object(n.a)().mark((function t(){var e,a,s,l,i,c,u,d,f;return Object(n.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,this.$refs.scanForm.validate();case 3:return e=this.scanForm.barcode.trim(),console.log(e,"barcode"),t.next=7,this.$emit("scan",e);case 7:if(!t.sent){t.next=23;break}if(a=e.split("#"),s=Object(r.a)(a,5),l=s[0],i=s[1],c=s[2],u=s[3],d=s[4],console.log(l,"palletCode"),l&&i&&c&&u){t.next=13;break}throw new Error("无效的托盘条码格式");case 13:return t.next=15,Object(o.b)({palletCode:l,userId:this.$store.state.user.id,entryInfo:this.entryInfo});case 15:if((f=t.sent).data&&(this.entryInfo=f.data),200===f.code){t.next=20;break}return this.$message.error(f.message),t.abrupt("return");case 20:this.$message.success("扫码出库成功"),this.scanRecords.unshift({palletCode:l,saleOrderNo:i,materialCode:c,quantity:Number(u),lineCode:d,scanTime:new Date}),this.scanForm.barcode="";case 23:t.next=28;break;case 25:t.prev=25,t.t0=t.catch(0),console.error("扫描失败:",t.t0);case 28:case"end":return t.stop()}}),t,this,[[0,25]])})));return function(){return t.apply(this,arguments)}}(),handleComplete:function(){var t=Object(s.a)(Object(n.a)().mark((function t(){return Object(n.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,this.$emit("complete",this.scanRecords.map((function(t){return t.palletCode})));case 3:this.dialogVisible=!1,t.next=9;break;case 6:t.prev=6,t.t0=t.catch(0),console.error("完成出库失败:",t.t0);case 9:case"end":return t.stop()}}),t,this,[[0,6]])})));return function(){return t.apply(this,arguments)}}(),handleClose:function(){this.$emit("update:visible",!1),this.resetForm()},resetForm:function(){this.scanForm.barcode="",this.scanRecords=[],this.$refs.scanForm&&this.$refs.scanForm.resetFields()},formatDateTime:function(t){return new Date(t).toLocaleString()}}},i=l,c=(a("1bca"),a("2877")),u=Object(c.a)(i,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-dialog",{attrs:{title:t.title,visible:t.dialogVisible,width:"800px"},on:{"update:visible":function(e){t.dialogVisible=e},close:t.handleClose}},[a("div",{staticClass:"scan-container"},[t.entryInfo?a("el-form",[a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"销售单号"}},[a("el-input",{attrs:{readonly:""},model:{value:t.entryInfo.saleOrderNo,callback:function(e){t.$set(t.entryInfo,"saleOrderNo",e)},expression:"entryInfo.saleOrderNo"}})],1)],1),t._v(" "),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"销售数量"}},[a("el-input",{attrs:{type:"number",readonly:""},model:{value:t.entryInfo.plannedQuantity,callback:function(e){t.$set(t.entryInfo,"plannedQuantity",e)},expression:"entryInfo.plannedQuantity"}})],1)],1)],1),t._v(" "),a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"货柜号"}},[a("el-input",{attrs:{readonly:""},model:{value:t.entryInfo.HuoGuiCode,callback:function(e){t.$set(t.entryInfo,"HuoGuiCode",e)},expression:"entryInfo.HuoGuiCode"}})],1)],1),t._v(" "),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"发票号"}},[a("el-input",{attrs:{readonly:""},model:{value:t.entryInfo.FaQIaoNo,callback:function(e){t.$set(t.entryInfo,"FaQIaoNo",e)},expression:"entryInfo.FaQIaoNo"}})],1)],1)],1),t._v(" "),a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"产品名称"}},[a("el-input",{attrs:{readonly:""},model:{value:t.entryInfo.materialName,callback:function(e){t.$set(t.entryInfo,"materialName",e)},expression:"entryInfo.materialName"}})],1)],1),t._v(" "),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"产品型号"}},[a("el-input",{attrs:{readonly:""},model:{value:t.entryInfo.materialSpec,callback:function(e){t.$set(t.entryInfo,"materialSpec",e)},expression:"entryInfo.materialSpec"}})],1)],1)],1),t._v(" "),a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"应收数量"}},[a("el-input",{attrs:{type:"number"},model:{value:t.entryInfo.outboundQuantity,callback:function(e){t.$set(t.entryInfo,"outboundQuantity",e)},expression:"entryInfo.outboundQuantity"}})],1)],1)],1)],1):t._e(),t._v(" "),a("el-form",{ref:"scanForm",attrs:{model:t.scanForm,rules:t.rules}},[a("el-form-item",{attrs:{prop:"barcode"}},[a("el-input",{ref:"scanInput",attrs:{placeholder:t.placeholder,clearable:""},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.handleScanInput(e)}},model:{value:t.scanForm.barcode,callback:function(e){t.$set(t.scanForm,"barcode",e)},expression:"scanForm.barcode"}},[a("template",{slot:"append"},[a("el-button",{on:{click:t.handleScanInput}},[t._v("确认")])],1)],2)],1)],1),t._v(" "),t.entryInfo?a("div",{staticClass:"entry-info"},[a("el-card",{staticClass:"box-card"},[a("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[a("span",[t._v("出库单信息")])]),t._v(" "),a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:8}},[a("div",{staticClass:"info-item"},[a("label",[t._v("出库单号：")]),t._v(" "),a("span",[t._v(t._s(t.entryInfo.entryNo))])])]),t._v(" "),a("el-col",{attrs:{span:8}},[a("div",{staticClass:"info-item"},[a("label",[t._v("生产订单：")]),t._v(" "),a("span",[t._v(t._s(t.entryInfo.productionOrderNo))])])]),t._v(" "),a("el-col",{attrs:{span:8}},[a("div",{staticClass:"info-item"},[a("label",[t._v("销售订单：")]),t._v(" "),a("span",[t._v(t._s(t.entryInfo.saleOrderNo))])])])],1),t._v(" "),a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:8}},[a("div",{staticClass:"info-item"},[a("label",[t._v("物料名称：")]),t._v(" "),a("span",[t._v(t._s(t.entryInfo.materialName))])])]),t._v(" "),a("el-col",{attrs:{span:8}},[a("div",{staticClass:"info-item"},[a("label",[t._v("规格型号：")]),t._v(" "),a("span",[t._v(t._s(t.entryInfo.materialSpec))])])]),t._v(" "),a("el-col",{attrs:{span:8}},[a("div",{staticClass:"info-item"},[a("label",[t._v("完成进度：")]),t._v(" "),a("el-progress",{attrs:{percentage:t.entryInfo.progress,status:t.entryInfo.progress>=100?"success":""}})],1)])],1),t._v(" "),a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:8}},[a("div",{staticClass:"info-item"},[a("label",[t._v("销售数量：")]),t._v(" "),a("span",[t._v(t._s(t.entryInfo.plannedQuantity))])])]),t._v(" "),a("el-col",{attrs:{span:8}},[a("div",{staticClass:"info-item"},[a("label",[t._v("实际数量：")]),t._v(" "),a("span",[t._v(t._s(t.entryInfo.actualQuantity))])])]),t._v(" "),a("el-col",{attrs:{span:8}},[a("div",{staticClass:"info-item"},[a("label",[t._v("托盘数量：")]),t._v(" "),a("span",[t._v(t._s(t.entryInfo.palletCount))])])])],1)],1)],1):t._e(),t._v(" "),a("div",{staticClass:"scan-list"},[a("el-table",{staticStyle:{width:"100%"},attrs:{data:t.scanRecords,border:""}},[a("el-table-column",{attrs:{label:"托盘编号",prop:"palletCode",align:"center"}}),t._v(" "),a("el-table-column",{attrs:{label:"销售订单",prop:"saleOrderNo",align:"center"}}),t._v(" "),a("el-table-column",{attrs:{label:"物料编码",prop:"materialCode",align:"center"}}),t._v(" "),a("el-table-column",{attrs:{label:"数量",prop:"quantity",align:"center"}}),t._v(" "),a("el-table-column",{attrs:{label:"产线",prop:"lineCode",align:"center"}}),t._v(" "),a("el-table-column",{attrs:{label:"扫描时间",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n            "+t._s(t.formatDateTime(e.row.scanTime))+"\n          ")]}}])})],1)],1)],1),t._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(e){t.dialogVisible=!1}}},[t._v("取 消")]),t._v(" "),a("el-button",{attrs:{type:"primary",disabled:!t.scanRecords.length},on:{click:t.handleComplete}},[t._v("\n      完成出库\n    ")])],1)])}),[],!1,null,"2ba66f67",null);e.default=u.exports}}]);