(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-8e678abc"],{"77d2":function(e,t,r){"use strict";r.d(t,"a",(function(){return o})),r.d(t,"b",(function(){return l}));var a=r("b775");function o(e){return Object(a.a)({url:"/machine/progress",method:"get",params:e})}function l(e){return Object(a.a)({url:"/machine/refresh",method:"post",data:e})}},"873b":function(e,t,r){"use strict";r("d0d3")},a71f:function(e,t,r){"use strict";r.r(t);var a=r("5530"),o=r("c7eb"),l=(r("96cf"),r("1da1")),i=(r("6762"),r("2fdb"),r("3b8b")),s=(r("7e1e"),r("ed91")),n={name:"EditDialog",components:{workDialog:i.a},props:{visible:{type:Boolean,default:!1},dialogStatus:{type:String,default:"create"},rowData:{type:Object,default:function(){return{}}}},data:function(){return{form:{lineCode:"",lineName:"",lineNum:"",state:1,cardNum:"",machineNum:"",ipAddress:"",capacity:0,cycleTime:0,workers:0,workshop:"",area:"",location:"",remark:"",currentMaterial:null},rules:{lineCode:[{required:!0,message:"请输入产线编码",trigger:"blur"}],lineName:[{required:!0,message:"请输入产线名称",trigger:"blur"}],state:[{required:!0,message:"请选择状态",trigger:"change"}],cardNum:[{required:!0,message:"请输入接收器卡号",trigger:"blur"}]},submitLoading:!1,workTableData:[],workDialogVisible:!1,hasOneKeyProductionPermission:!1}},computed:{dialogTitle:function(){return"create"===this.dialogStatus?"新增生产产线":"编辑生产产线"}},mounted:function(){var e=this.$store.getters.roles;if(!e||!e.buttonList)return!1;e.buttonList.includes("one_click_production")&&(this.hasOneKeyProductionPermission=!0)},watch:{visible:function(e){e&&this.initFormData()}},methods:{handleOneKeyProduction:function(){var e=Object(l.a)(Object(o.a)().mark((function e(){var t,r,a,l=this;return Object(o.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,this.form.currentMaterial){e.next=4;break}return this.$message.error("请先选择生产物料"),e.abrupt("return");case 4:return e.next=6,Object(s.b)(this.form.currentMaterial);case 6:if(t=e.sent,r=t.data,console.log("获取到的工序:",r),0!==r.length){e.next=12;break}return this.$message.error("该物料没有对应的工艺"),e.abrupt("return");case 12:a=r.filter((function(e){return e.machineId&&e.machineId.lineId==l.form._id})),this.workTableData=a,console.log(this.workTableData,"this.workTableData"),this.workDialogVisible=!0,e.next=21;break;case 18:e.prev=18,e.t0=e.catch(0),this.$message.error("获取工序数据失败");case 21:case"end":return e.stop()}}),e,this,[[0,18]])})));return function(){return e.apply(this,arguments)}}(),initFormData:function(){"edit"===this.dialogStatus?this.form=Object(a.a)({},this.rowData):this.form={lineCode:"",lineName:"",lineNum:"",state:1,cardNum:"",machineNum:"",ipAddress:"",capacity:0,cycleTime:0,workers:0,workshop:"",area:"",location:"",remark:""}},handleClose:function(){this.$emit("update:visible",!1),this.$refs.form&&this.$refs.form.resetFields()},handleSubmit:function(){var e=this;this.$refs.form.validate(function(){var t=Object(l.a)(Object(o.a)().mark((function t(r){var l;return Object(o.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r){e.submitLoading=!0;try{l=Object(a.a)({},e.form),e.$emit("submit",l),e.handleClose()}catch(t){console.error("提交失败:",t),e.$message.error("提交失败")}finally{e.submitLoading=!1}}case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())}}},c=n,u=(r("873b"),r("2877")),m=Object(u.a)(c,(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("el-dialog",{attrs:{title:e.dialogTitle,visible:e.visible,width:"60%"},on:{"update:visible":function(t){e.visible=t},close:e.handleClose}},[r("el-form",{ref:"form",attrs:{model:e.form,rules:e.rules,"label-width":"120px",size:"small"}},[r("el-row",{attrs:{gutter:20}},[r("el-col",{attrs:{span:12}},[r("el-form-item",{attrs:{label:"产线编码",prop:"lineCode"}},[r("el-input",{attrs:{placeholder:"请输入产线编码",disabled:"edit"===e.dialogStatus},model:{value:e.form.lineCode,callback:function(t){e.$set(e.form,"lineCode",t)},expression:"form.lineCode"}})],1)],1),e._v(" "),r("el-col",{attrs:{span:12}},[r("el-form-item",{attrs:{label:"产线名称",prop:"lineName"}},[r("el-input",{attrs:{placeholder:"请输入产线名称"},model:{value:e.form.lineName,callback:function(t){e.$set(e.form,"lineName",t)},expression:"form.lineName"}})],1)],1)],1),e._v(" "),r("el-row",{attrs:{gutter:20}},[r("el-col",{attrs:{span:12}},[r("el-form-item",{attrs:{label:"车间线路编号",prop:"lineNum"}},[r("el-input",{attrs:{placeholder:"请输入车间线路编号"},model:{value:e.form.lineNum,callback:function(t){e.$set(e.form,"lineNum",t)},expression:"form.lineNum"}})],1)],1),e._v(" "),r("el-col",{attrs:{span:12}},[r("el-form-item",{attrs:{label:"状态",prop:"state"}},[r("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择状态"},model:{value:e.form.state,callback:function(t){e.$set(e.form,"state",t)},expression:"form.state"}},[r("el-option",{attrs:{label:"正常",value:1}}),e._v(" "),r("el-option",{attrs:{label:"作废",value:0}})],1)],1)],1)],1),e._v(" "),r("el-row",{attrs:{gutter:20}},[r("el-col",{attrs:{span:8}},[r("el-form-item",{attrs:{label:"接收器卡号",prop:"cardNum"}},[r("el-input",{attrs:{placeholder:"请输入接收器卡号"},model:{value:e.form.cardNum,callback:function(t){e.$set(e.form,"cardNum",t)},expression:"form.cardNum"}})],1)],1),e._v(" "),r("el-col",{attrs:{span:8}},[r("el-form-item",{attrs:{label:"接收器机号",prop:"machineNum"}},[r("el-input",{attrs:{placeholder:"请输入接收器机号"},model:{value:e.form.machineNum,callback:function(t){e.$set(e.form,"machineNum",t)},expression:"form.machineNum"}})],1)],1),e._v(" "),r("el-col",{attrs:{span:8}},[r("el-form-item",{attrs:{label:"IP地址",prop:"ipAddress"}},[r("el-input",{attrs:{placeholder:"请输入IP地址"},model:{value:e.form.ipAddress,callback:function(t){e.$set(e.form,"ipAddress",t)},expression:"form.ipAddress"}})],1)],1)],1),e._v(" "),r("el-row",{attrs:{gutter:20}},[r("el-col",{attrs:{span:8}},[r("el-form-item",{attrs:{label:"标准产能",prop:"capacity"}},[r("el-input-number",{staticStyle:{width:"100%"},attrs:{min:0,"controls-position":"right",placeholder:"件/小时"},model:{value:e.form.capacity,callback:function(t){e.$set(e.form,"capacity",t)},expression:"form.capacity"}})],1)],1),e._v(" "),r("el-col",{attrs:{span:8}},[r("el-form-item",{attrs:{label:"节拍时间",prop:"cycleTime"}},[r("el-input-number",{staticStyle:{width:"100%"},attrs:{min:0,"controls-position":"right",placeholder:"秒"},model:{value:e.form.cycleTime,callback:function(t){e.$set(e.form,"cycleTime",t)},expression:"form.cycleTime"}})],1)],1),e._v(" "),r("el-col",{attrs:{span:8}},[r("el-form-item",{attrs:{label:"标准人数",prop:"workers"}},[r("el-input-number",{staticStyle:{width:"100%"},attrs:{min:0,"controls-position":"right",placeholder:"人"},model:{value:e.form.workers,callback:function(t){e.$set(e.form,"workers",t)},expression:"form.workers"}})],1)],1)],1),e._v(" "),r("el-row",{attrs:{gutter:20}},[r("el-col",{attrs:{span:8}},[r("el-form-item",{attrs:{label:"所属车间",prop:"workshop"}},[r("el-input",{attrs:{placeholder:"请输入所属车间"},model:{value:e.form.workshop,callback:function(t){e.$set(e.form,"workshop",t)},expression:"form.workshop"}})],1)],1),e._v(" "),r("el-col",{attrs:{span:8}},[r("el-form-item",{attrs:{label:"区域",prop:"area"}},[r("el-input",{attrs:{placeholder:"请输入区域"},model:{value:e.form.area,callback:function(t){e.$set(e.form,"area",t)},expression:"form.area"}})],1)],1),e._v(" "),r("el-col",{attrs:{span:8}},[r("el-form-item",{attrs:{label:"具体位置",prop:"location"}},[r("el-input",{attrs:{placeholder:"请输入具体位置"},model:{value:e.form.location,callback:function(t){e.$set(e.form,"location",t)},expression:"form.location"}})],1)],1)],1),e._v(" "),r("el-form-item",{attrs:{label:"备注",prop:"remark"}},[r("el-input",{attrs:{type:"textarea",placeholder:"请输入备注信息"},model:{value:e.form.remark,callback:function(t){e.$set(e.form,"remark",t)},expression:"form.remark"}})],1),e._v(" "),"edit"==e.dialogStatus&&e.hasOneKeyProductionPermission?r("el-row",{attrs:{gutter:20}},[r("el-col",{attrs:{span:24}},[r("div",{staticClass:"tip-box"},[r("p",[e._v("请勿随意修改当前产线的生产主物料")])])])],1):e._e(),e._v(" "),"edit"==e.dialogStatus&&e.hasOneKeyProductionPermission?r("el-form-item",{attrs:{label:"一键生产"}},[r("zr-select",{attrs:{collection:"k3_BD_MATERIAL","search-fields":["FNumber","FName"],"label-key":"FName","sub-key":"FMATERIALID",multiple:!1,placeholder:"请输入物料编码/名称搜索"},scopedSlots:e._u([{key:"option",fn:function(t){var a=t.item;return[r("div",{staticClass:"select-option"},[r("div",{staticClass:"option-main"},[r("span",{staticClass:"option-label"},[e._v(e._s(a.FNumber)+" - "+e._s(a.FName))]),e._v(" "),r("el-tag",{staticClass:"option-tag",attrs:{size:"mini",type:"info"}},[e._v("\n                                "+e._s(a.FMATERIALID)+" - "+e._s(a.FUseOrgId)+"\n                            ")])],1),e._v(" "),a.FSpecification?r("div",{staticClass:"option-sub"},[r("small",[e._v("规格: "+e._s(a.FSpecification))])]):e._e()])]}}],null,!1,1426375288),model:{value:e.form.currentMaterial,callback:function(t){e.$set(e.form,"currentMaterial",t)},expression:"form.currentMaterial"}}),e._v(" "),r("el-button",{attrs:{type:"primary",disabled:!e.form.currentMaterial},on:{click:function(t){return e.handleOneKeyProduction()}}},[e._v("一键生产")])],1):e._e()],1),e._v(" "),r("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{on:{click:e.handleClose}},[e._v("取 消")]),e._v(" "),r("el-button",{attrs:{type:"primary",loading:e.submitLoading},on:{click:e.handleSubmit}},[e._v("确 定")])],1),e._v(" "),e.workDialogVisible?r("work-dialog",{attrs:{visible:e.workDialogVisible,"material-id":e.form.currentMaterial,"work-table-data":e.workTableData},on:{"update:visible":function(t){e.workDialogVisible=t}}}):e._e()],1)}),[],!1,null,"650ca6a6",null);t.default=m.exports},d0d3:function(e,t,r){},ed91:function(e,t,r){"use strict";r.d(t,"a",(function(){return o})),r.d(t,"c",(function(){return l})),r.d(t,"d",(function(){return i})),r.d(t,"e",(function(){return s})),r.d(t,"b",(function(){return n}));var a=r("b775");function o(e){return Object(a.a)({url:"/create-flow",method:"post",data:e})}function l(e){return Object(a.a)({url:"/scan-components",method:"post",data:e})}function i(e){return Object(a.a)({url:"/unbind-components",method:"post",data:e})}function s(e){return Object(a.a)({url:"/update-flow-nodes",method:"post",data:e})}function n(e){return Object(a.a)({url:"/all-process-steps/".concat(e),method:"get"})}}}]);