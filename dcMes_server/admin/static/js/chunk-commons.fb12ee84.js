(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-commons"],{"3b8b":function(e,t,n){"use strict";var a=n("c7eb"),i=(n("ac6a"),n("5df3"),n("4f7f"),n("96cf"),n("1da1")),s=n("2909"),o=n("77d2"),c=n("7e1e"),r=(n("9339"),{name:"WorkDialog",props:{materialId:{type:String,default:""},lineId:{type:String,default:""},visible:{type:Boolean,default:!1},workTableData:{type:Array,default:function(){return[]}}},data:function(){return{filterCurrentLine:!0,filterHasMachine:!0,workColumns:[{prop:"processName",label:"工序名称"},{prop:"processCode",label:"工序编号"},{prop:"sort",label:"工序顺序"}]}},computed:{dialogVisible:{get:function(){return this.visible},set:function(e){this.$emit("update:visible",e)}},filteredTableData:function(){var e=this,t=Object(s.a)(this.workTableData);return this.filterCurrentLine&&this.lineId&&(t=t.filter((function(t){return(t.machineId&&t.machineId.lineId)===e.lineId}))),this.filterHasMachine&&(t=t.filter((function(e){return e.machineId}))),t}},watch:{visible:function(e){}},methods:{handleClose:function(){this.dialogVisible=!1},refreshMachineStatus:function(){var e=this;if(this.filteredTableData.length){var t=this.filteredTableData.map((function(e){return e.machineId&&e.machineId._id}));t.length?Object(o.b)({machineIds:t}).then((function(t){console.log(t),e.$message.success("设备在线状态刷新成功")})):this.$message.warning("当前无可刷新设备")}else this.$message.warning("请先选择工序")},confirmWork:function(){var e=Object(i.a)(Object(a.a)().mark((function e(){var t,n,i;return Object(a.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,t=this.filteredTableData.map((function(e){return e.machineId&&e.machineId._id})),t.length===new Set(t).size){e.next=5;break}return this.$message.error("工序有重复设备，请重新编辑工艺"),e.abrupt("return");case 5:n=0;case 6:if(!(n<this.filteredTableData.length)){e.next=15;break}if(i=this.filteredTableData[n],console.log(i),!i.machineId||!i.machineId._id){e.next=12;break}return e.next=12,Object(c.d)("machine",{query:{_id:i.machineId._id},update:{processStepId:i._id,materialId:this.materialId}});case 12:n++,e.next=6;break;case 15:this.$message.success("生产设备对应当前生产工序已替换"),e.next=21;break;case 18:e.prev=18,e.t0=e.catch(0),this.$message.error("启动生产任务失败");case 21:case"end":return e.stop()}}),e,this,[[0,18]])})));return function(){return e.apply(this,arguments)}}()}}),l=r,u=(n("7e63d"),n("2877")),d=Object(u.a)(l,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("el-dialog",{attrs:{title:"生产工序设备确认","append-to-body":"",visible:e.dialogVisible,width:"50%"},on:{"update:visible":function(t){e.dialogVisible=t},close:e.handleClose}},[n("div",{staticClass:"filter-container"},[n("el-checkbox",{model:{value:e.filterHasMachine,callback:function(t){e.filterHasMachine=t},expression:"filterHasMachine"}},[e._v("已绑定设备")]),e._v(" "),n("el-checkbox",{model:{value:e.filterCurrentLine,callback:function(t){e.filterCurrentLine=t},expression:"filterCurrentLine"}},[e._v("当前产线设备")])],1),e._v(" "),n("el-table",{staticStyle:{width:"100%"},attrs:{data:e.filteredTableData}},[e._l(e.workColumns,(function(t){return n("el-table-column",{key:t.prop,attrs:{prop:t.prop,label:t.label},scopedSlots:e._u([{key:"default",fn:function(a){return[n("span",[e._v("\n                    "+e._s(a.row[t.prop])+"\n                ")])]}}],null,!0)})})),e._v(" "),n("el-table-column",{attrs:{prop:"machineId",label:"设备信息",width:"200"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("span",{class:{"error-row":!t.row.machineId}},[t.row.machineId?[e._v("\n                        "+e._s(t.row.machineId.machineName)+"\n                        "),n("el-tag",[e._v(" ("+e._s(t.row.machineId.machineIp)+", "+e._s(t.row.machineId.machineCode)+")")])]:[e._v("\n                        未绑定设备\n                    ")]],2)]}}])}),e._v(" "),n("el-table-column",{attrs:{prop:"machineId.status",label:"在线状态"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("span",{class:{"error-row":!t.row.machineId}},[t.row.machineId?[n("el-tag",{attrs:{type:t.row.machineId.status?"success":"danger"}},[e._v("\n                            "+e._s(t.row.machineId.status?"在线":"离线")+"\n                        ")])]:[e._v("\n                        未绑定设备\n                    ")]],2)]}}])})],2),e._v(" "),n("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{on:{click:e.handleClose}},[e._v("取 消")]),e._v(" "),n("el-button",{attrs:{type:"primary"},on:{click:e.confirmWork}},[e._v("一键替换")]),e._v(" "),n("el-button",{attrs:{type:"warning"},on:{click:e.refreshMachineStatus}},[e._v("设备在线刷新")])],1)],1)}),[],!1,null,"00cc279d",null);t.a=d.exports},"49e2":function(e,t,n){"use strict";n("ff8b")},"5aee":function(e,t,n){"use strict";var a=n("7624"),i={name:"IconSelects",props:["IconData"],data:function(){return{userChooseIcon:"",chooseIcons:"请选择图标",iconList:[]}},watch:{IconData:function(e){e&&(console.log(e),this.userChooseIcon=e,this.chooseIcons=e)}},created:function(){this.iconList=a.a},methods:{editClicks:function(){this.userChooseIcon=this.IconData,this.chooseIcons=this.IconData},setIcon:function(e){console.log(e),this.userChooseIcon=e,this.chooseIcons=e,this.$emit("update:IconData",e)}}},s=i,o=(n("49e2"),n("2877")),c=Object(o.a)(s,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"chooseIcons"},[n("el-popover",{attrs:{placement:"top-start","append-to-body":!1,width:"30vw",trigger:"click"}},[n("div",{staticClass:"iconDiv",attrs:{slot:"reference"},slot:"reference"},[n("div",{staticClass:"iconName"},[n("i",{class:e.userChooseIcon}),e._v("\n         "+e._s(e.chooseIcons))])]),e._v(" "),n("div",{staticClass:"iconList"},e._l(e.iconList,(function(t){return n("i",{key:t,class:[t,"icon"],staticStyle:{"font-size":"20px"},on:{click:function(n){return e.setIcon(t)}}})})),0)])],1)}),[],!1,null,"3b31ed31",null);t.a=c.exports},"7e63d":function(e,t,n){"use strict";n("f01c")},f01c:function(e,t,n){},ff8b:function(e,t,n){}}]);