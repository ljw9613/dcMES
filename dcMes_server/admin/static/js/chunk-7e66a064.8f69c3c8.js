(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-7e66a064"],{4124:function(t,e,a){"use strict";a.d(e,"a",(function(){return l}));var i=a("b775");function l(t){return Object(i.a)({url:"/market",method:"get",params:t})}},8492:function(t,e,a){"use strict";a.d(e,"a",(function(){return l}));var i=a("b775");function l(t){return Object(i.a)({url:"/merchant",method:"get",params:t})}},eea9:function(t,e,a){"use strict";a.r(e);var i=(a("20d6"),a("5530")),l=(a("7f7f"),a("ade3")),s=a("7e1e"),n=a("8492"),r=a("4124"),o={filters:{},components:{},data:function(){var t;return t={typeoptions:[{value:"食品检验",label:"食品检验"},{value:"设备检测",label:"设备检测"}],statusoptions:[{value:"已处理",label:"已处理"},{value:"未处理",label:"未处理"}],deviceStatusoptions:[{value:"离线",label:"离线"},{value:"在线",label:"在线"}],rowId:"",categorylist:[],total:0,type:"",currentPage:1,pageSize:10,options:{},charge:{},record_id:"",marketlist:[],merchantlist:[],searchReq:{}},Object(l.a)(Object(l.a)(Object(l.a)(Object(l.a)(Object(l.a)(Object(l.a)(Object(l.a)(Object(l.a)(Object(l.a)(Object(l.a)(t,"categorylist",[]),"categorylist1",[]),"labellist",[]),"listLoading",!0),"downloadLoading",!1),"_id",""),"categorytitle",""),"labeltitle",""),"address",""),"addresstime",""),Object(l.a)(Object(l.a)(Object(l.a)(Object(l.a)(Object(l.a)(Object(l.a)(Object(l.a)(Object(l.a)(Object(l.a)(Object(l.a)(t,"name",""),"phone",""),"checkList",""),"labelindex",""),"labelcategoryindex",""),"dialogStatus",""),"dialogFormVisible",!1),"dialogFormVisible2",!1),"dialogFormVisible1",!1),"dataForm",{marketId:null,merchantId:null,type:"",status:"未处理",total:"",qualified:"",scaleID:"",deviceStatus:"",description:"",createAt:new Date,updateAt:new Date}),Object(l.a)(t,"textMap",{update:"Edit",create:"Create"})},created:function(){this.fetchData(),this.init()},beforeCreate:function(){},computed:{foodAlertContent:function(){return function(t){var e=(t.total-t.qualified)/t.total*100;return"".concat(t.marketId.name,"检验不合格率超过【").concat(e.toFixed(2),"%】")}},deviceAlertContent:function(){return function(t){return"".concat(t.merchantId.name,"电子秤【").concat(t.scaleID,"】已离线")}}},methods:{init:function(){var t=this;Object(n.a)({}).then((function(e){t.merchantlist=e.data})),Object(r.a)({}).then((function(e){t.marketlist=e.data}))},baseTableHandleCurrentChange:function(t){this.currentPage=t,this.fetchData()},baseTableHandleSizeChange:function(t){this.pageSize=t,this.fetchData()},closeProcessRecordDialog:function(){this.categorylist=[],this.total=0,this.currentPage=1,this.pageSize=10,this.processRecordShow=!1},getslect:function(t){},fetchData:function(){var t=this;this.listLoading=!0;var e={query:Object(i.a)({},this.searchReq),populate:JSON.stringify([{path:"marketId"},{path:"merchantId"}]),limit:this.pageSize,skip:(this.currentPage-1)*this.pageSize,count:!0};Object(s.b)("dataEarlyWarning",e).then((function(e){t.categorylist=e.data,t.total=e.countnum,t.categorylist1=JSON.parse(JSON.stringify(e.data)),t.listLoading=!1}))},beforeClose:function(){var t=this;this.$confirm("确认关闭？").then((function(e){t.dialogFormVisible=!1,done()})).catch((function(t){}))},beforeClose2:function(){var t=this;this.$confirm("确认关闭？").then((function(e){t.dialogFormVisible2=!1,done()})).catch((function(t){}))},handleEdit:function(t){this.dialogFormVisible=!0,this.dataForm=JSON.parse(JSON.stringify(this.$adjustDataFormat(t))),this.dialogStatus="edit"},handleEdit2:function(t){this.dialogFormVisible2=!0,this.dataForm=JSON.parse(JSON.stringify(this.$adjustDataFormat(t))),this.dialogStatus="edit"},regionMange:function(t){this.$router.push({path:"/farm/region",query:{farm_id:t._id}})},AddFilter:function(){this.dataForm={marketId:null,merchantId:null,type:"",status:"未处理",total:"",qualified:"",scaleID:"",deviceStatus:"",description:"",createAt:new Date,updateAt:new Date},this.dialogFormVisible=!0,this.dialogStatus="create"},createData:function(){var t=this;if(""!=this.dataForm.type)if("食品检验"==this.dataForm.type?(this.dataForm.merchantId=null,this.dataForm.scaleID="",this.dataForm.deviceStatus="",this.dataForm.status="未处理"):"设备检测"==this.dataForm.type&&(this.dataForm.marketId=null,this.dataForm.total="",this.dataForm.qualified="",this.dataForm.status="未处理"),-1==this.categorylist.findIndex((function(e){return e.name===t.dataForm.type}))){var e=Object(i.a)({},this.dataForm);Object(s.a)("dataEarlyWarning",e).then((function(e){200==e.code?(t.dialogFormVisible=!1,t.fetchData(),t.$notify({title:"添加成功",message:"edit Successfully",type:"success",duration:2e3})):t.$notify({title:"添加失败",message:"edit failly",type:"warning",duration:2e3})}))}else this.$notify({title:"此经预警方已是预警方",message:"Again input",type:"warning",duration:2e3});else this.$notify({title:"请完善信息",message:"Again input",type:"warning",duration:2e3})},editData:function(t){var e=this;if(""!=this.dataForm.type){1==t&&("食品检验"==this.dataForm.type?(this.dataForm.merchantId=null,this.dataForm.scaleID="",this.dataForm.deviceStatus="",this.dataForm.status="未处理"):"设备检测"==this.dataForm.type&&(this.dataForm.marketId=null,this.dataForm.total="",this.dataForm.qualified="",this.dataForm.status="未处理"));var a={query:{_id:this.dataForm._id},update:Object(i.a)({},this.dataForm)};Object(s.d)("dataEarlyWarning",a).then((function(t){200==t.code?(e.dialogFormVisible=!1,e.dialogFormVisible2=!1,e.fetchData(),e.$notify({title:"修改成功",message:"edit Successfully",type:"success",duration:2e3})):e.$notify({title:"修改失败",message:"edit failly",type:"warning",duration:2e3})}))}else this.$notify({title:"请完善信息",message:"Again input",type:"warning",duration:2e3})},clearclick:function(){this.categorylist=this.categorylist1},Search:function(){this.searchReq={},this.type?this.searchReq.type=this.type:delete this.searchReq.type,this.fetchData()}}},c=o,d=a("2877"),u=Object(d.a)(c,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"app-container"},[a("div",{staticClass:"screen"},[a("div",{staticClass:"screen_content"},[t._m(0),t._v(" "),a("div",{staticClass:"screen_content_second"},[a("div",{staticClass:"screen_content_second_one"},[a("div",{staticStyle:{width:"140px"}},[t._v("预警类型:")]),t._v(" "),a("el-select",{attrs:{placeholder:"请选择预警类型"},model:{value:t.type,callback:function(e){t.type=e},expression:"type"}},t._l(t.typeoptions,(function(t){return a("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),1),t._v(" "),a("el-button",{staticStyle:{"margin-left":"10px"},attrs:{type:"primary"},on:{click:function(e){return t.Search()}}},[t._v("查询搜索")])],1)])])]),t._v(" "),a("div",{staticClass:"screen1"},[a("div",{staticClass:"screen_content"},[a("div",{staticClass:"screen_content_first"},[a("i",{staticClass:"el-icon-tickets"},[t._v("预警列表")]),t._v(" "),a("el-button",{staticClass:"filter-item",attrs:{icon:"el-icon-plus",type:"primary"},on:{click:t.AddFilter}},[t._v("添加预警")])],1)])]),t._v(" "),a("div",{staticClass:"filter-container"}),t._v(" "),a("base-table",{ref:"baseTable",attrs:{currentPage:t.currentPage,"highlight-current-row":!0,pageSize:t.pageSize,tableData:t.categorylist,tableDataloading:t.listLoading,total:t.total},on:{handleCurrentChange:t.baseTableHandleCurrentChange,handleSizeChange:t.baseTableHandleSizeChange}},[a("template",{slot:"law"},[a("el-table-column",{attrs:{align:"center",label:"预警分类",width:"120"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(e.row.type)+"\n        ")]}}])}),t._v(" "),a("el-table-column",{attrs:{align:"center",label:"预警内容"},scopedSlots:t._u([{key:"default",fn:function(e){return[e.row.qualified?a("span",{staticClass:"link-type"},[t._v(t._s(e.row.marketId&&t.foodAlertContent(e.row)||"预警数据丢失"))]):e.row.deviceStatus?a("span",{staticClass:"link-type"},[t._v(t._s(e.row.merchantId&&t.deviceAlertContent(e.row)||"预警数据丢失"))]):a("span",{staticClass:"link-type"},[t._v("\n                          预警数据丢失\n                      ")])]}}])}),t._v(" "),a("el-table-column",{attrs:{align:"center",label:"设备状态"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("span",{staticClass:"link-type"},[t._v(t._s(e.row.deviceStatus?e.row.deviceStatus:"无"))])]}}])}),t._v(" "),a("el-table-column",{attrs:{align:"center",label:"预警描述"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("span",{staticClass:"link-type"},[t._v(t._s(e.row.description?e.row.description:"无"))])]}}])}),t._v(" "),a("el-table-column",{attrs:{align:"center",label:"预警时间",prop:"created_at",width:"200"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("i",{staticClass:"el-icon-time"}),t._v(" "),a("span",[t._v(t._s(t._f("parseTime")(e.row.updateAt,"{y}-{m}-{d} {h}:{i}")))])]}}])}),t._v(" "),a("el-table-column",{attrs:{align:"center",label:"处理状态",width:"120"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("span",{style:"未处理"==e.row.status?"color: red":"color:green"},[t._v("\n                          "+t._s(e.row.status)+"\n                      ")])]}}])}),t._v(" "),a("el-table-column",{attrs:{align:"center",label:"操作"},scopedSlots:t._u([{key:"default",fn:function(e){var i=e.row;return[a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(e){return t.handleEdit(i)}}},[t._v("预警查看")]),t._v(" "),a("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(e){return t.handleEdit2(i)}}},[t._v("预警处理")])]}}])})],1)],2),t._v(" "),a("el-dialog",{attrs:{"before-close":t.beforeClose,visible:t.dialogFormVisible,title:"预警信息"},on:{"update:visible":function(e){t.dialogFormVisible=e}}},[a("el-form",{ref:"dataForm",staticStyle:{width:"500px","margin-left":"50px"},attrs:{inline:!0,"label-position":"left","label-width":"70px"}},[a("el-form-item",{attrs:{label:"预警类型","label-width":"120",required:""}},[a("el-select",{attrs:{placeholder:"请选择"},model:{value:t.dataForm.type,callback:function(e){t.$set(t.dataForm,"type",e)},expression:"dataForm.type"}},t._l(t.typeoptions,(function(t){return a("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),1)],1),t._v(" "),"食品检验"==t.dataForm.type?a("el-form-item",{attrs:{label:"市场名称","label-width":"120",required:""}},[a("el-select",{attrs:{placeholder:"请选择"},model:{value:t.dataForm.marketId,callback:function(e){t.$set(t.dataForm,"marketId",e)},expression:"dataForm.marketId"}},t._l(t.marketlist,(function(e){return a("el-option",{key:e._id,attrs:{label:e.name,value:e._id}},[a("span",{staticStyle:{float:"left"}},[t._v(t._s(e.name))]),t._v(" "),a("span",{staticStyle:{float:"right",color:"#8492a6","font-size":"13px"}},[t._v(t._s(e.responsible_person))])])})),1)],1):t._e(),t._v(" "),"设备检测"==t.dataForm.type?a("el-form-item",{attrs:{label:"所属商户","label-width":"120",required:""}},[a("el-select",{attrs:{placeholder:"请选择"},model:{value:t.dataForm.merchantId,callback:function(e){t.$set(t.dataForm,"merchantId",e)},expression:"dataForm.merchantId"}},t._l(t.merchantlist,(function(e){return a("el-option",{key:e._id,attrs:{label:e.name,value:e._id}},[a("span",{staticStyle:{float:"left"}},[t._v(t._s(e.name))]),t._v(" "),a("span",{staticStyle:{float:"right",color:"#8492a6","font-size":"13px"}},[t._v(t._s(e.responsible_person))])])})),1)],1):t._e(),t._v(" "),t.dataForm.type?a("el-divider",{attrs:{"content-position":"left"}},[t._v("预警详情")]):t._e(),t._v(" "),"食品检验"==t.dataForm.type?a("div",[a("el-form-item",{attrs:{label:"检测数量","label-width":"120",required:""}},[a("el-input",{attrs:{placeholder:"检测数量"},model:{value:t.dataForm.total,callback:function(e){t.$set(t.dataForm,"total",e)},expression:"dataForm.total"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"合格数量","label-width":"120",required:""}},[a("el-input",{attrs:{placeholder:"合格数量"},model:{value:t.dataForm.qualified,callback:function(e){t.$set(t.dataForm,"qualified",e)},expression:"dataForm.qualified"}})],1)],1):t._e(),t._v(" "),"设备检测"==t.dataForm.type?a("div",[a("el-form-item",{attrs:{label:"电子称ID","label-width":"120",required:""}},[a("el-input",{attrs:{placeholder:"电子称ID"},model:{value:t.dataForm.scaleID,callback:function(e){t.$set(t.dataForm,"scaleID",e)},expression:"dataForm.scaleID"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"设备状态","label-width":"120",required:""}},[a("el-select",{attrs:{placeholder:"请选择"},model:{value:t.dataForm.deviceStatus,callback:function(e){t.$set(t.dataForm,"deviceStatus",e)},expression:"dataForm.deviceStatus"}},t._l(t.deviceStatusoptions,(function(t){return a("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),1)],1)],1):t._e()],1),t._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(e){t.dialogFormVisible=!1}}},[t._v("取消")]),t._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:function(e){"create"==t.dialogStatus?t.createData():t.editData(1)}}},[t._v("确定")])],1)],1),t._v(" "),a("el-dialog",{attrs:{"before-close":t.beforeClose2,visible:t.dialogFormVisible2,title:"预警处理"},on:{"update:visible":function(e){t.dialogFormVisible2=e}}},[a("el-form",{ref:"dataForm",staticStyle:{width:"500px","margin-left":"50px"},attrs:{inline:!0,"label-position":"left","label-width":"70px"}},[a("el-form-item",{attrs:{label:"是否处理","label-width":"120",required:""}},[a("el-select",{attrs:{placeholder:"请选择"},model:{value:t.dataForm.status,callback:function(e){t.$set(t.dataForm,"status",e)},expression:"dataForm.status"}},t._l(t.statusoptions,(function(t){return a("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),1)],1),t._v(" "),a("el-form-item",{attrs:{label:"处理说明","label-width":"120",required:""}},[a("el-input",{attrs:{placeholder:"请对处理进行简单说明",type:"textarea"},model:{value:t.dataForm.description,callback:function(e){t.$set(t.dataForm,"description",e)},expression:"dataForm.description"}})],1)],1),t._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(e){t.dialogFormVisible2=!1}}},[t._v("取消")]),t._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:function(e){"create"==t.dialogStatus?t.createData():t.editData(2)}}},[t._v("确定")])],1)],1)],1)}),[function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"screen_content_first"},[a("i",{staticClass:"el-icon-search"},[t._v("筛选搜索")]),t._v(" "),a("div",{staticClass:"screen_content_first_btutton"})])}],!1,null,"399c7a30",null);e.default=u.exports}}]);