(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-cf3ebcac"],{6927:function(e,t,a){},b267:function(e,t,a){"use strict";a("6927")},f7af:function(e,t,a){"use strict";a.r(t);var r=(a("4917"),a("3b2b"),a("28a5"),a("b85c")),s=(a("ac6a"),a("7514"),a("f576"),a("c7eb")),n=(a("96cf"),a("1da1")),l=(a("7f7f"),a("7e1e")),i={components:{Pagination:a("333d").a},data:function(){return{searchForm:{name:"",enabled:""},rulesList:[],total:0,currentPage:1,pageSize:10,listLoading:!0,dialogVisible:!1,dialogStatus:"create",dialogTitle:"",selection:[],testBarcode:"",testResult:null,currentRule:{name:"",description:"",priority:1,enabled:!0,isGlobal:!1,validationRules:[],extractionConfigs:[]},rules:{name:[{required:!0,message:"请输入规则名称",trigger:"blur"}],priority:[{required:!0,message:"请输入优先级",trigger:"blur"}],validationRules:[{required:!0,type:"array",message:"至少添加一条校验规则",trigger:"change"}],extractionConfigs:[{required:!0,type:"array",message:"至少添加一个提取配置",trigger:"change"}]},listQuery:{page:1,limit:20,total:0},materialDialogVisible:!1,addMaterialDialogVisible:!1,materialList:[],materialForm:{productId:""},currentRuleId:null}},created:function(){this.fetchRules()},methods:{searchData:function(){var e={query:{$and:[]}};return this.searchForm.name&&e.query.$and.push({name:{$regex:this.searchForm.name,$options:"i"}}),""!==this.searchForm.enabled&&e.query.$and.push({enabled:this.searchForm.enabled}),e.query.$and.length||delete e.query.$and,e},resetForm:function(){this.$refs.searchForm.resetFields(),this.searchForm={name:"",enabled:""},this.currentPage=1,this.fetchRules()},fetchRules:function(){var e=Object(n.a)(Object(s.a)().mark((function e(){var t,a;return Object(s.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.listLoading=!0,e.prev=1,(t=this.searchData()).page=this.currentPage,t.skip=(this.currentPage-1)*this.pageSize,t.limit=this.pageSize,t.count=!0,e.next=9,Object(l.b)("barcodeRule",t);case 9:a=e.sent,this.rulesList=a.data,this.total=a.countnum,e.next=18;break;case 14:e.prev=14,e.t0=e.catch(1),console.error("获取规则列表失败:",e.t0),this.$message.error("获取规则列表失败");case 18:return e.prev=18,this.listLoading=!1,e.finish(18);case 21:case"end":return e.stop()}}),e,this,[[1,14,18,21]])})));return function(){return e.apply(this,arguments)}}(),handleSelectionChange:function(e){this.selection=e},search:function(){this.currentPage=1,this.fetchRules()},formatDate:function(e){if(!e)return"暂无数据";var t=new Date(e);if(isNaN(t.getTime()))return"无效日期";var a=t.getFullYear(),r=String(t.getMonth()+1).padStart(2,"0"),s=String(t.getDate()).padStart(2,"0");return"".concat(a,"-").concat(r,"-").concat(s)},handleView:function(){var e=Object(n.a)(Object(s.a)().mark((function e(t){return Object(s.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.currentRuleId=t._id,e.next=3,this.fetchMaterialList(t._id);case 3:this.materialDialogVisible=!0;case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),fetchMaterialList:function(){var e=Object(n.a)(Object(s.a)().mark((function e(t){var a;return Object(s.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Object(l.b)("productBarcodeRule",{query:{barcodeRule:t},populate:JSON.stringify([{path:"productId",select:"FNumber FName"}])});case 3:(a=e.sent).data&&(this.materialList=a.data),e.next=11;break;case 7:e.prev=7,e.t0=e.catch(0),console.error("获取物料列表失败:",e.t0),this.$message.error("获取物料列表失败");case 11:case"end":return e.stop()}}),e,this,[[0,7]])})));return function(t){return e.apply(this,arguments)}}(),handleAddMaterial:function(){this.materialForm={productId:""},this.addMaterialDialogVisible=!0},saveMaterial:function(){var e=Object(n.a)(Object(s.a)().mark((function e(){var t,a=this;return Object(s.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,this.materialForm.productId){e.next=4;break}return this.$message.warning("请选择物料"),e.abrupt("return");case 4:if(t=this.materialList.find((function(e){return e.productId._id===a.materialForm.productId})),!t){e.next=8;break}return this.$message.warning("该物料已绑定，请勿重复添加"),e.abrupt("return");case 8:return e.next=10,Object(l.a)("productBarcodeRule",{productId:this.materialForm.productId,barcodeRule:this.currentRuleId,createBy:this.$store.state.user.id});case 10:return this.$message.success("物料绑定成功"),this.addMaterialDialogVisible=!1,e.next=14,this.fetchMaterialList(this.currentRuleId);case 14:e.next=20;break;case 16:e.prev=16,e.t0=e.catch(0),console.error("保存物料绑定失败:",e.t0),this.$message.error("保存物料绑定失败");case 20:case"end":return e.stop()}}),e,this,[[0,16]])})));return function(){return e.apply(this,arguments)}}(),deleteMaterial:function(){var e=Object(n.a)(Object(s.a)().mark((function e(t){return Object(s.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.$confirm("确认解除该物料绑定吗?","提示",{type:"warning"});case 3:return e.next=5,Object(l.c)("productBarcodeRule",{query:{_id:t._id}});case 5:return this.$message.success("解除绑定成功"),e.next=8,this.fetchMaterialList(this.currentRuleId);case 8:e.next=13;break;case 10:e.prev=10,e.t0=e.catch(0),"cancel"!==e.t0&&(console.error("删除物料绑定失败:",e.t0),this.$message.error("删除物料绑定失败"));case 13:case"end":return e.stop()}}),e,this,[[0,10]])})));return function(t){return e.apply(this,arguments)}}(),handleBatchDelete:function(){var e=this;this.selection.length?this.$confirm("确认删除选中的 ".concat(this.selection.length," 条记录吗？"),"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(Object(n.a)(Object(s.a)().mark((function t(){var a;return Object(s.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,a=e.selection.map((function(e){return e._id})),t.next=4,Object(l.c)("barcodeRule",{query:{_id:{$in:a}}});case 4:e.$message.success("批量删除成功"),e.fetchRules(),t.next=12;break;case 8:t.prev=8,t.t0=t.catch(0),console.error("批量删除失败:",t.t0),e.$message.error("批量删除失败");case 12:case"end":return t.stop()}}),t,null,[[0,8]])})))).catch((function(){})):this.$message.warning("请选择要删除的记录")},handleSubmit:function(){var e=Object(n.a)(Object(s.a)().mark((function e(){return Object(s.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,"create"!==this.dialogStatus){e.next=7;break}return e.next=4,Object(l.a)("barcodeRule",this.currentRule);case 4:this.$message.success("新增成功"),e.next=10;break;case 7:return e.next=9,Object(l.d)("barcodeRule",{query:{_id:this.currentRule._id},update:this.currentRule});case 9:this.$message.success("更新成功");case 10:this.dialogVisible=!1,this.fetchRules(),e.next=18;break;case 14:e.prev=14,e.t0=e.catch(0),console.error("操作失败:",e.t0),this.$message.error("操作失败");case 18:case"end":return e.stop()}}),e,this,[[0,14]])})));return function(){return e.apply(this,arguments)}}(),handleCreate:function(){var e=Object(n.a)(Object(s.a)().mark((function e(){return Object(s.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.dialogTitle="添加规则",this.currentRule=this.getInitialRule(),this.dialogVisible=!0,this.dialogStatus="create",this.testResult=null;case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),handleEdit:function(){var e=Object(n.a)(Object(s.a)().mark((function e(t){return Object(s.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.dialogTitle="编辑规则",this.currentRule=JSON.parse(JSON.stringify(t)),this.dialogStatus="edit",this.dialogVisible=!0,this.testResult=null;case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),handleDelete:function(){var e=Object(n.a)(Object(s.a)().mark((function e(t){return Object(s.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.$confirm("确认删除该规则吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});case 3:return e.next=5,Object(l.c)("barcodeRule",{query:{_id:t._id}});case 5:this.$message.success("删除成功"),this.fetchRules(),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0),"cancel"!==e.t0&&(console.error("删除失败:",e.t0),this.$message.error("删除失败"));case 12:case"end":return e.stop()}}),e,this,[[0,9]])})));return function(t){return e.apply(this,arguments)}}(),handleSizeChange:function(e){this.listQuery.limit=e,this.fetchRules()},handleCurrentChange:function(e){this.listQuery.page=e,this.fetchRules()},handleTest:function(){var e=Object(n.a)(Object(s.a)().mark((function e(){var t;return Object(s.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.testBarcode){e.next=3;break}return this.$message.warning("请输入测试条码"),e.abrupt("return");case 3:return e.prev=3,e.next=6,this.validateBarcode(this.testBarcode);case 6:(t=e.sent)?this.testResult={ruleName:t.ruleName,materialCode:t.materialCode,relatedBill:t.relatedBill}:(this.testResult=null,this.$message.error("未匹配到任何规则")),e.next=14;break;case 10:e.prev=10,e.t0=e.catch(3),console.error("测试失败:",e.t0),this.$message.error("测试失败");case 14:case"end":return e.stop()}}),e,this,[[3,10]])})));return function(){return e.apply(this,arguments)}}(),getInitialRule:function(){return{name:"",description:"",priority:1,enabled:!0,isGlobal:!1,validationRules:[],extractionConfigs:[]}},addRule:function(){this.currentRule.rules.push({order:this.currentRule.rules.length+1,name:"",description:"",enabled:!0,match:{type:"length",value:"",length:0},extraction:{target:"materialCode",method:"split",params:{separator:"",index:0,start:0,end:0,pattern:"",group:0}}})},removeRule:function(e){this.currentRule.rules.splice(e,1),this.currentRule.rules.forEach((function(e,t){e.order=t+1}))},handleTestCurrentRule:function(){var e=Object(n.a)(Object(s.a)().mark((function e(){var t,a,n,l,i,c,o,u,p,d,m,v,h,b,f,g,_,x,y;return Object(s.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.testBarcode){e.next=3;break}return this.$message.warning("请输入测试条码"),e.abrupt("return");case 3:e.prev=3,t=this.testBarcode,a={validationPassed:!0,validationSteps:[],extractionResults:[]},n=Object(r.a)(this.currentRule.validationRules),e.prev=7,n.s();case 9:if((l=n.n()).done){e.next=29;break}if((i=l.value).enabled){e.next=13;break}return e.abrupt("continue",27);case 13:c={ruleName:i.name,matched:!1},e.t0=i.type,e.next="length"===e.t0?17:"substring"===e.t0?19:"regex"===e.t0?22:24;break;case 17:return t.length!==i.params.length?(c.message="长度不符合要求，应为".concat(i.params.length,"位"),a.validationPassed=!1):c.matched=!0,e.abrupt("break",24);case 19:return(o=t.substring(i.params.start,i.params.end))!==i.params.expectedValue?(c.message='截取值 "'.concat(o,'" 与期望值 "').concat(i.params.expectedValue,'" 不符'),a.validationPassed=!1):c.matched=!0,e.abrupt("break",24);case 22:try{new RegExp(i.params.pattern).test(t)?c.matched=!0:(c.message="不符合正则表达式规则",a.validationPassed=!1)}catch(e){c.message="正则表达式格式错误",a.validationPassed=!1}return e.abrupt("break",24);case 24:if(a.validationSteps.push(c),a.validationPassed){e.next=27;break}return e.abrupt("break",29);case 27:e.next=9;break;case 29:e.next=34;break;case 31:e.prev=31,e.t1=e.catch(7),n.e(e.t1);case 34:return e.prev=34,n.f(),e.finish(34);case 37:if(!a.validationPassed){e.next=87;break}u=Object(r.a)(this.currentRule.extractionConfigs),e.prev=39,u.s();case 41:if((p=u.n()).done){e.next=79;break}d=p.value,m=t,v={target:d.target,steps:[],finalValue:null},h=Object(r.a)(d.steps),e.prev=46,h.s();case 48:if((b=h.n()).done){e.next=67;break}if((f=b.value).enabled){e.next=52;break}return e.abrupt("continue",65);case 52:g={name:f.name,intermediateValue:null},e.t2=f.type,e.next="split"===e.t2?56:"substring"===e.t2?59:"regex"===e.t2?61:63;break;case 56:return _=m.split(f.params.separator),m=_[f.params.index]||"",e.abrupt("break",63);case 59:return m=m.substring(f.params.start,f.params.end),e.abrupt("break",63);case 61:try{x=new RegExp(f.params.pattern),y=m.match(x),m=y&&y[f.params.group]?y[f.params.group]:""}catch(e){m=""}return e.abrupt("break",63);case 63:g.intermediateValue=m,v.steps.push(g);case 65:e.next=48;break;case 67:e.next=72;break;case 69:e.prev=69,e.t3=e.catch(46),h.e(e.t3);case 72:return e.prev=72,h.f(),e.finish(72);case 75:v.finalValue=m,a.extractionResults.push(v);case 77:e.next=41;break;case 79:e.next=84;break;case 81:e.prev=81,e.t4=e.catch(39),u.e(e.t4);case 84:return e.prev=84,u.f(),e.finish(84);case 87:this.testResult=a,e.next=94;break;case 90:e.prev=90,e.t5=e.catch(3),console.error("测试失败:",e.t5),this.$message.error("测试执行失败");case 94:case"end":return e.stop()}}),e,this,[[3,90],[7,31,34,37],[39,81,84,87],[46,69,72,75]])})));return function(){return e.apply(this,arguments)}}(),addValidationRule:function(){this.currentRule.validationRules.push({order:this.currentRule.validationRules.length+1,name:"",description:"",enabled:!0,type:"length",params:{length:0,start:0,end:0,expectedValue:"",pattern:""}})},removeValidationRule:function(e){this.currentRule.validationRules.splice(e,1),this.currentRule.validationRules.forEach((function(e,t){e.order=t+1}))},addExtractionConfig:function(){this.currentRule.extractionConfigs.push({target:"",steps:[]})},removeExtractionConfig:function(e){this.currentRule.extractionConfigs.splice(e,1)},addExtractionStep:function(e){var t=this.currentRule.extractionConfigs[e];t.steps.push({order:t.steps.length+1,name:"",description:"",enabled:!0,type:"split",params:{separator:"",index:0,start:0,end:0,pattern:"",group:0}})},removeExtractionStep:function(e,t){var a=this.currentRule.extractionConfigs[e];a.steps.splice(t,1),a.steps.forEach((function(e,t){e.order=t+1}))}}},c=i,o=(a("b267"),a("2877")),u=Object(o.a)(c,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"app-container"},[a("el-card",{staticClass:"filter-container"},[a("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[a("span",[e._v("筛选搜索")])]),e._v(" "),a("el-form",{ref:"searchForm",staticClass:"demo-form-inline",attrs:{model:e.searchForm}},[a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:6}},[a("el-form-item",{attrs:{label:"规则名称"}},[a("el-input",{attrs:{placeholder:"请输入规则名称",clearable:""},model:{value:e.searchForm.name,callback:function(t){e.$set(e.searchForm,"name",t)},expression:"searchForm.name"}})],1)],1),e._v(" "),a("el-col",{attrs:{span:6}},[a("el-form-item",{attrs:{label:"状态"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择状态",clearable:""},model:{value:e.searchForm.enabled,callback:function(t){e.$set(e.searchForm,"enabled",t)},expression:"searchForm.enabled"}},[a("el-option",{attrs:{label:"启用",value:!0}}),e._v(" "),a("el-option",{attrs:{label:"禁用",value:!1}})],1)],1)],1)],1),e._v(" "),a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:e.search}},[e._v("查询搜索")]),e._v(" "),a("el-button",{on:{click:e.resetForm}},[e._v("重置")]),e._v(" "),a("el-button",{attrs:{type:"primary",icon:"el-icon-plus"},on:{click:e.handleCreate}},[e._v("新增规则")]),e._v(" "),a("el-button",{attrs:{type:"danger",icon:"el-icon-delete",disabled:!e.selection.length},on:{click:e.handleBatchDelete}},[e._v("批量删除")])],1)],1)],1),e._v(" "),a("el-card",{staticClass:"list-container"},[a("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[a("span",[e._v("条码规则列表")])]),e._v(" "),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.listLoading,expression:"listLoading"}],staticStyle:{width:"100%"},attrs:{data:e.rulesList,border:""},on:{"selection-change":e.handleSelectionChange}},[a("el-table-column",{attrs:{type:"selection",width:"55"}}),e._v(" "),a("el-table-column",{attrs:{label:"规则名称",prop:"name"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-link",{attrs:{type:"primary"},on:{click:function(a){return e.handleView(t.row)}}},[e._v(e._s(t.row.name))])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"描述",prop:"description"}}),e._v(" "),a("el-table-column",{attrs:{label:"优先级",prop:"priority",width:"100"}}),e._v(" "),a("el-table-column",{attrs:{label:"状态",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[a("el-tag",{attrs:{type:r.enabled?"success":"info"}},[e._v("\n                        "+e._s(r.enabled?"启用":"禁用")+"\n                    ")])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"使用范围",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[a("el-tag",{attrs:{type:r.isGlobal?"warning":""}},[e._v("\n                        "+e._s(r.isGlobal?"全局":"普通")+"\n                    ")])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"创建时间",align:"center",width:"160"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                    "+e._s(e.formatDate(t.row.createAt))+"\n                ")]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"操作",width:"200",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[a("el-button",{attrs:{type:"text",size:"small"},on:{click:function(t){return e.handleView(r)}}},[a("i",{staticClass:"el-icon-view"}),e._v(" 查看物料列表\n                    ")]),e._v(" "),a("el-button",{attrs:{type:"text",size:"small"},on:{click:function(t){return e.handleEdit(r)}}},[a("i",{staticClass:"el-icon-edit"}),e._v(" 编辑\n                    ")]),e._v(" "),a("el-button",{staticClass:"delete-btn",attrs:{type:"text",size:"small"},on:{click:function(t){return e.handleDelete(r)}}},[a("i",{staticClass:"el-icon-delete"}),e._v(" 删除\n                    ")])]}}])})],1),e._v(" "),a("pagination",{directives:[{name:"show",rawName:"v-show",value:e.total>0,expression:"total > 0"}],attrs:{total:e.total,page:e.currentPage,limit:e.pageSize},on:{"update:page":function(t){e.currentPage=t},"update:limit":function(t){e.pageSize=t},pagination:e.fetchRules}})],1),e._v(" "),a("el-dialog",{attrs:{title:e.dialogTitle,visible:e.dialogVisible,width:"70%","close-on-click-modal":!1},on:{"update:visible":function(t){e.dialogVisible=t}}},[a("el-form",{ref:"form",attrs:{model:e.currentRule,rules:e.rules,"label-width":"120px"}},[a("el-divider",{attrs:{"content-position":"left"}},[e._v("基本信息")]),e._v(" "),a("el-form-item",{attrs:{label:"规则名称",prop:"name"}},[a("el-input",{model:{value:e.currentRule.name,callback:function(t){e.$set(e.currentRule,"name",t)},expression:"currentRule.name"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"描述",prop:"description"}},[a("el-input",{attrs:{type:"textarea"},model:{value:e.currentRule.description,callback:function(t){e.$set(e.currentRule,"description",t)},expression:"currentRule.description"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"优先级",prop:"priority"}},[a("el-input-number",{attrs:{min:1},model:{value:e.currentRule.priority,callback:function(t){e.$set(e.currentRule,"priority",t)},expression:"currentRule.priority"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"启用状态"}},[a("el-switch",{model:{value:e.currentRule.enabled,callback:function(t){e.$set(e.currentRule,"enabled",t)},expression:"currentRule.enabled"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"全局使用"}},[a("el-switch",{attrs:{"active-text":"全局","inactive-text":"普通"},model:{value:e.currentRule.isGlobal,callback:function(t){e.$set(e.currentRule,"isGlobal",t)},expression:"currentRule.isGlobal"}})],1),e._v(" "),a("el-divider",{attrs:{"content-position":"left"}},[e._v("校验规则配置")]),e._v(" "),e._l(e.currentRule.validationRules,(function(t,r){return a("div",{key:"validation-"+r,staticClass:"rule-item"},[a("el-card",{staticClass:"rule-card"},[a("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[a("span",[e._v("校验规则 #"+e._s(r+1))]),e._v(" "),a("el-button",{staticStyle:{float:"right",padding:"3px 0"},attrs:{type:"text"},on:{click:function(t){return e.removeValidationRule(r)}}},[e._v("删除")])],1),e._v(" "),a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:8}},[a("el-form-item",{attrs:{label:"规则名称",prop:"validationRules."+r+".name"}},[a("el-input",{attrs:{placeholder:"请输入规则名称"},model:{value:t.name,callback:function(a){e.$set(t,"name",a)},expression:"rule.name"}})],1)],1),e._v(" "),a("el-col",{attrs:{span:8}},[a("el-form-item",{attrs:{label:"执行顺序",prop:"validationRules."+r+".order"}},[a("el-input-number",{attrs:{min:1},model:{value:t.order,callback:function(a){e.$set(t,"order",a)},expression:"rule.order"}})],1)],1),e._v(" "),a("el-col",{attrs:{span:8}},[a("el-form-item",{attrs:{label:"启用状态"}},[a("el-switch",{model:{value:t.enabled,callback:function(a){e.$set(t,"enabled",a)},expression:"rule.enabled"}})],1)],1)],1),e._v(" "),a("el-form-item",{attrs:{label:"校验类型",prop:"validationRules."+r+".type"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择校验类型"},model:{value:t.type,callback:function(a){e.$set(t,"type",a)},expression:"rule.type"}},[a("el-option",{attrs:{label:"长度校验",value:"length"}}),e._v(" "),a("el-option",{attrs:{label:"截取校验",value:"substring"}}),e._v(" "),a("el-option",{attrs:{label:"正则校验",value:"regex"}})],1)],1),e._v(" "),"length"===t.type?[a("el-form-item",{attrs:{label:"长度",prop:"validationRules."+r+".params.length"}},[a("el-input-number",{attrs:{min:1},model:{value:t.params.length,callback:function(a){e.$set(t.params,"length",a)},expression:"rule.params.length"}})],1)]:e._e(),e._v(" "),"substring"===t.type?[a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:8}},[a("el-form-item",{attrs:{label:"起始位置",prop:"validationRules."+r+".params.start"}},[a("el-input-number",{attrs:{min:0},model:{value:t.params.start,callback:function(a){e.$set(t.params,"start",a)},expression:"rule.params.start"}})],1)],1),e._v(" "),a("el-col",{attrs:{span:8}},[a("el-form-item",{attrs:{label:"结束位置",prop:"validationRules."+r+".params.end"}},[a("el-input-number",{attrs:{min:0},model:{value:t.params.end,callback:function(a){e.$set(t.params,"end",a)},expression:"rule.params.end"}})],1)],1),e._v(" "),a("el-col",{attrs:{span:8}},[a("el-form-item",{attrs:{label:"期望值",prop:"validationRules."+r+".params.expectedValue"}},[a("el-input",{model:{value:t.params.expectedValue,callback:function(a){e.$set(t.params,"expectedValue",a)},expression:"rule.params.expectedValue"}})],1)],1)],1)]:e._e(),e._v(" "),"regex"===t.type?[a("el-form-item",{attrs:{label:"正则表达式",prop:"validationRules."+r+".params.pattern"}},[a("el-input",{model:{value:t.params.pattern,callback:function(a){e.$set(t.params,"pattern",a)},expression:"rule.params.pattern"}})],1)]:e._e()],2)],1)})),e._v(" "),a("div",{staticStyle:{"margin-top":"10px"}},[a("el-button",{attrs:{type:"primary"},on:{click:e.addValidationRule}},[e._v("添加校验规则")])],1),e._v(" "),a("el-divider",{attrs:{"content-position":"left"}},[e._v("提取配置")]),e._v(" "),e._l(e.currentRule.extractionConfigs,(function(t,r){return a("div",{key:"config-"+r,staticClass:"extraction-config"},[a("el-card",{staticClass:"config-card"},[a("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[a("span",[e._v("提取配置 #"+e._s(r+1))]),e._v(" "),a("el-button",{staticStyle:{float:"right",padding:"3px 0"},attrs:{type:"text"},on:{click:function(t){return e.removeExtractionConfig(r)}}},[e._v("删除")])],1),e._v(" "),a("el-form-item",{attrs:{label:"提取目标",prop:"extractionConfigs."+r+".target"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择提取目标"},model:{value:t.target,callback:function(a){e.$set(t,"target",a)},expression:"config.target"}},[a("el-option",{attrs:{label:"物料编码",value:"materialCode"}}),e._v(" "),a("el-option",{attrs:{label:"DI码",value:"DI"}}),e._v(" "),a("el-option",{attrs:{label:"关联单据",value:"relatedBill"}})],1)],1),e._v(" "),e._l(t.steps,(function(t,s){return a("div",{key:"step-"+r+"-"+s,staticClass:"step-item"},[a("el-card",{staticClass:"step-card",attrs:{shadow:"hover"}},[a("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[a("span",[e._v("步骤 #"+e._s(s+1))]),e._v(" "),a("el-button",{staticStyle:{float:"right",padding:"3px 0"},attrs:{type:"text"},on:{click:function(t){return e.removeExtractionStep(r,s)}}},[e._v("删除")])],1),e._v(" "),a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:8}},[a("el-form-item",{attrs:{label:"步骤名称",prop:"extractionConfigs."+r+".steps."+s+".name"}},[a("el-input",{attrs:{placeholder:"请输入步骤名称"},model:{value:t.name,callback:function(a){e.$set(t,"name",a)},expression:"step.name"}})],1)],1),e._v(" "),a("el-col",{attrs:{span:8}},[a("el-form-item",{attrs:{label:"执行顺序",prop:"extractionConfigs."+r+".steps."+s+".order"}},[a("el-input-number",{attrs:{min:1},model:{value:t.order,callback:function(a){e.$set(t,"order",a)},expression:"step.order"}})],1)],1),e._v(" "),a("el-col",{attrs:{span:8}},[a("el-form-item",{attrs:{label:"启用状态"}},[a("el-switch",{model:{value:t.enabled,callback:function(a){e.$set(t,"enabled",a)},expression:"step.enabled"}})],1)],1)],1),e._v(" "),a("el-form-item",{attrs:{label:"提取类型",prop:"extractionConfigs."+r+".steps."+s+".type"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择提取类型"},model:{value:t.type,callback:function(a){e.$set(t,"type",a)},expression:"step.type"}},[a("el-option",{attrs:{label:"分割提取",value:"split"}}),e._v(" "),a("el-option",{attrs:{label:"截取提取",value:"substring"}}),e._v(" "),a("el-option",{attrs:{label:"正则提取",value:"regex"}})],1)],1),e._v(" "),"split"===t.type?[a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"分隔符",prop:"extractionConfigs."+r+".steps."+s+".params.separator"}},[a("el-input",{model:{value:t.params.separator,callback:function(a){e.$set(t.params,"separator",a)},expression:"step.params.separator"}})],1)],1),e._v(" "),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"索引",prop:"extractionConfigs."+r+".steps."+s+".params.index"}},[a("el-input-number",{attrs:{min:0},model:{value:t.params.index,callback:function(a){e.$set(t.params,"index",a)},expression:"step.params.index"}})],1)],1)],1)]:e._e(),e._v(" "),"substring"===t.type?[a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"起始位置",prop:"extractionConfigs."+r+".steps."+s+".params.start"}},[a("el-input-number",{attrs:{min:0},model:{value:t.params.start,callback:function(a){e.$set(t.params,"start",a)},expression:"step.params.start"}})],1)],1),e._v(" "),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"结束位置",prop:"extractionConfigs."+r+".steps."+s+".params.end"}},[a("el-input-number",{attrs:{min:0},model:{value:t.params.end,callback:function(a){e.$set(t.params,"end",a)},expression:"step.params.end"}})],1)],1)],1)]:e._e(),e._v(" "),"regex"===t.type?[a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"正则表达式",prop:"extractionConfigs."+r+".steps."+s+".params.pattern"}},[a("el-input",{model:{value:t.params.pattern,callback:function(a){e.$set(t.params,"pattern",a)},expression:"step.params.pattern"}})],1)],1),e._v(" "),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"捕获组索引",prop:"extractionConfigs."+r+".steps."+s+".params.group"}},[a("el-input-number",{attrs:{min:0},model:{value:t.params.group,callback:function(a){e.$set(t.params,"group",a)},expression:"step.params.group"}})],1)],1)],1)]:e._e()],2)],1)})),e._v(" "),a("div",{staticStyle:{"margin-top":"10px"}},[a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.addExtractionStep(r)}}},[e._v("添加提取步骤")])],1)],2)],1)})),e._v(" "),a("div",{staticStyle:{"margin-top":"10px"}},[a("el-button",{attrs:{type:"primary"},on:{click:e.addExtractionConfig}},[e._v("添加提取配置")])],1),e._v(" "),a("el-divider",{attrs:{"content-position":"left"}},[e._v("规则测试")]),e._v(" "),a("el-form-item",{attrs:{label:"测试条码"}},[a("div",{staticClass:"test-input-group"},[a("el-input",{staticStyle:{width:"calc(100% - 90px)"},attrs:{placeholder:"请输入要测试的条码"},model:{value:e.testBarcode,callback:function(t){e.testBarcode=t},expression:"testBarcode"}}),e._v(" "),a("el-button",{staticStyle:{"margin-left":"10px"},attrs:{type:"primary",size:"small"},on:{click:e.handleTestCurrentRule}},[e._v("\n                        测试\n                    ")])],1)]),e._v(" "),e.testResult?a("el-form-item",{attrs:{label:"测试结果"}},[a("el-card",{staticClass:"test-result-card"},[a("div",{staticClass:"test-section"},[a("h4",[e._v("校验结果")]),e._v(" "),e._l(e.testResult.validationSteps,(function(t,r){return a("div",{key:"validation-"+r,class:["step-result",t.matched?"success":"error"]},[a("div",{staticClass:"step-header"},[e._v("\n                                步骤 "+e._s(r+1)+": "+e._s(t.ruleName)+"\n                            ")]),e._v(" "),a("div",{staticClass:"step-content"},[t.matched?[a("i",{staticClass:"el-icon-success"}),e._v(" 校验通过\n                                ")]:[a("i",{staticClass:"el-icon-error"}),e._v(" "+e._s(t.message)+"\n                                ")]],2)])}))],2),e._v(" "),e.testResult.validationPassed?a("div",{staticClass:"test-section"},[a("h4",[e._v("提取结果")]),e._v(" "),e._l(e.testResult.extractionResults,(function(t,r){return a("div",{key:"extraction-"+r,staticClass:"extraction-result"},[a("div",{staticClass:"result-header"},[e._v("\n                                "+e._s(t.target)+"\n                            ")]),e._v(" "),e._l(t.steps,(function(t,r){return a("div",{key:"step-"+r,staticClass:"step-result"},[a("div",{staticClass:"step-header"},[e._v("\n                                    步骤 "+e._s(r+1)+": "+e._s(t.name)+"\n                                ")]),e._v(" "),a("div",{staticClass:"step-content"},[e._v("\n                                    中间结果: "+e._s(t.intermediateValue)+"\n                                ")])])})),e._v(" "),a("div",{staticClass:"final-result"},[e._v("\n                                最终结果: "+e._s(t.finalValue)+"\n                            ")])],2)}))],2):e._e()])],1):e._e(),e._v(" "),a("div",{staticClass:"dialog-footer"},[a("el-button",{on:{click:function(t){e.dialogVisible=!1}}},[e._v("取消")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:e.handleSubmit}},[e._v("确定")])],1)],2)],1),e._v(" "),a("el-dialog",{attrs:{title:"物料列表",visible:e.materialDialogVisible,width:"60%"},on:{"update:visible":function(t){e.materialDialogVisible=t}}},[a("div",{staticClass:"material-list-container"},[a("div",{staticClass:"material-list-header"},[a("el-button",{attrs:{type:"primary",size:"small"},on:{click:e.handleAddMaterial}},[e._v("新增物料绑定")])],1),e._v(" "),a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.materialList,border:""}},[a("el-table-column",{attrs:{prop:"productId.FNumber",label:"物料编码"}}),e._v(" "),a("el-table-column",{attrs:{prop:"productId.FName",label:"物料名称"}}),e._v(" "),a("el-table-column",{attrs:{prop:"productId.FUseOrgId_FName",label:"使用组织"}}),e._v(" "),a("el-table-column",{attrs:{prop:"createTime",label:"创建时间",width:"180"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                        "+e._s(e.formatDate(t.row.createTime))+"\n                    ")]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"操作",width:"150",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"danger",size:"mini"},on:{click:function(a){return e.deleteMaterial(t.row)}}},[e._v("删除")])]}}])})],1)],1),e._v(" "),a("el-dialog",{attrs:{title:"新增物料绑定",visible:e.addMaterialDialogVisible,width:"40%","append-to-body":""},on:{"update:visible":function(t){e.addMaterialDialogVisible=t}}},[a("el-form",{ref:"materialForm",attrs:{model:e.materialForm,"label-width":"100px"}},[a("el-form-item",{attrs:{label:"物料选择",prop:"productId"}},[a("zr-select",{attrs:{collection:"k3_BD_MATERIAL","search-fields":["FNumber","FName"],"label-key":"FNumber","sub-key":"_id",multiple:!1,placeholder:"请输入物料编码/名称搜索"},scopedSlots:e._u([{key:"option",fn:function(t){var r=t.item;return[a("div",{staticClass:"item-option"},[a("div",{staticClass:"item-info"},[a("span",[e._v(e._s(r.FNumber)+" - "+e._s(r.FName))]),e._v(" "),a("el-tag",{attrs:{size:"mini",type:"info"}},[e._v(e._s(r.FMATERIALID)+" -"+e._s(r.FUseOrgId_FName))])],1)])]}}]),model:{value:e.materialForm.productId,callback:function(t){e.$set(e.materialForm,"productId",t)},expression:"materialForm.productId"}})],1)],1),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.addMaterialDialogVisible=!1}}},[e._v("取 消")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:e.saveMaterial}},[e._v("确 定")])],1)],1)],1)],1)}),[],!1,null,"7e4ddad2",null);t.default=u.exports}}]);