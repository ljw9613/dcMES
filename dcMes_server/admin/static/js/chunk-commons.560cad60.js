(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-commons"],{"3b8b":function(e,t,i){"use strict";var a=i("c7eb"),n=(i("ac6a"),i("5df3"),i("4f7f"),i("96cf"),i("1da1")),s=i("2909"),l=i("77d2"),r=i("7e1e"),o=(i("9339"),{name:"WorkDialog",props:{materialId:{type:String,default:""},lineId:{type:String,default:""},visible:{type:Boolean,default:!1},workTableData:{type:Array,default:function(){return[]}}},data:function(){return{filterCurrentLine:!0,filterHasMachine:!0,workColumns:[{prop:"processName",label:"工序名称"},{prop:"processCode",label:"工序编号"},{prop:"sort",label:"工序顺序"}]}},computed:{dialogVisible:{get:function(){return this.visible},set:function(e){this.$emit("update:visible",e)}},filteredTableData:function(){var e=this,t=Object(s.a)(this.workTableData);return this.filterCurrentLine&&this.lineId&&(t=t.filter((function(t){return(t.machineId&&t.machineId.lineId)===e.lineId}))),this.filterHasMachine&&(t=t.filter((function(e){return e.machineId}))),t}},watch:{visible:function(e){}},methods:{handleClose:function(){this.dialogVisible=!1},refreshMachineStatus:function(){var e=this;if(this.filteredTableData.length){var t=this.filteredTableData.map((function(e){return e.machineId&&e.machineId._id}));t.length?Object(l.b)({machineIds:t}).then((function(t){console.log(t),e.$message.success("设备在线状态刷新成功")})):this.$message.warning("当前无可刷新设备")}else this.$message.warning("请先选择工序")},confirmWork:function(){var e=Object(n.a)(Object(a.a)().mark((function e(){var t,i,n;return Object(a.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,t=this.filteredTableData.map((function(e){return e.machineId&&e.machineId._id})),t.length===new Set(t).size){e.next=5;break}return this.$message.error("工序有重复设备，请重新编辑工艺"),e.abrupt("return");case 5:i=0;case 6:if(!(i<this.filteredTableData.length)){e.next=15;break}if(n=this.filteredTableData[i],console.log(n),!n.machineId||!n.machineId._id){e.next=12;break}return e.next=12,Object(r.d)("machine",{query:{_id:n.machineId._id},update:{processStepId:n._id,materialId:this.materialId}});case 12:i++,e.next=6;break;case 15:this.$message.success("生产设备对应当前生产工序已替换"),e.next=21;break;case 18:e.prev=18,e.t0=e.catch(0),this.$message.error("启动生产任务失败");case 21:case"end":return e.stop()}}),e,this,[[0,18]])})));return function(){return e.apply(this,arguments)}}()}}),c=o,p=(i("7e63d"),i("2877")),h=Object(p.a)(c,(function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("el-dialog",{attrs:{title:"生产工序设备确认","append-to-body":"",visible:e.dialogVisible,width:"50%"},on:{"update:visible":function(t){e.dialogVisible=t},close:e.handleClose}},[i("div",{staticClass:"filter-container"},[i("el-checkbox",{model:{value:e.filterHasMachine,callback:function(t){e.filterHasMachine=t},expression:"filterHasMachine"}},[e._v("已绑定设备")]),e._v(" "),i("el-checkbox",{model:{value:e.filterCurrentLine,callback:function(t){e.filterCurrentLine=t},expression:"filterCurrentLine"}},[e._v("当前产线设备")])],1),e._v(" "),i("el-table",{staticStyle:{width:"100%"},attrs:{data:e.filteredTableData}},[e._l(e.workColumns,(function(t){return i("el-table-column",{key:t.prop,attrs:{prop:t.prop,label:t.label},scopedSlots:e._u([{key:"default",fn:function(a){return[i("span",[e._v("\n                    "+e._s(a.row[t.prop])+"\n                ")])]}}],null,!0)})})),e._v(" "),i("el-table-column",{attrs:{prop:"machineId",label:"设备信息",width:"200"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("span",{class:{"error-row":!t.row.machineId}},[t.row.machineId?[e._v("\n                        "+e._s(t.row.machineId.machineName)+"\n                        "),i("el-tag",[e._v(" ("+e._s(t.row.machineId.machineIp)+", "+e._s(t.row.machineId.machineCode)+")")])]:[e._v("\n                        未绑定设备\n                    ")]],2)]}}])}),e._v(" "),i("el-table-column",{attrs:{prop:"machineId.status",label:"在线状态"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("span",{class:{"error-row":!t.row.machineId}},[t.row.machineId?[i("el-tag",{attrs:{type:t.row.machineId.status?"success":"danger"}},[e._v("\n                            "+e._s(t.row.machineId.status?"在线":"离线")+"\n                        ")])]:[e._v("\n                        未绑定设备\n                    ")]],2)]}}])})],2),e._v(" "),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:e.handleClose}},[e._v("取 消")]),e._v(" "),i("el-button",{attrs:{type:"primary"},on:{click:e.confirmWork}},[e._v("一键替换")]),e._v(" "),i("el-button",{attrs:{type:"warning"},on:{click:e.refreshMachineStatus}},[e._v("设备在线刷新")])],1)],1)}),[],!1,null,"00cc279d",null);t.a=h.exports},"49e2":function(e,t,i){"use strict";i("ff8b")},"5aee":function(e,t,i){"use strict";var a=i("7624"),n={name:"IconSelects",props:["IconData"],data:function(){return{userChooseIcon:"",chooseIcons:"请选择图标",iconList:[]}},watch:{IconData:function(e){e&&(console.log(e),this.userChooseIcon=e,this.chooseIcons=e)}},created:function(){this.iconList=a.a},methods:{editClicks:function(){this.userChooseIcon=this.IconData,this.chooseIcons=this.IconData},setIcon:function(e){console.log(e),this.userChooseIcon=e,this.chooseIcons=e,this.$emit("update:IconData",e)}}},s=n,l=(i("49e2"),i("2877")),r=Object(l.a)(s,(function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"chooseIcons"},[i("el-popover",{attrs:{placement:"top-start","append-to-body":!1,width:"30vw",trigger:"click"}},[i("div",{staticClass:"iconDiv",attrs:{slot:"reference"},slot:"reference"},[i("div",{staticClass:"iconName"},[i("i",{class:e.userChooseIcon}),e._v("\n         "+e._s(e.chooseIcons))])]),e._v(" "),i("div",{staticClass:"iconList"},e._l(e.iconList,(function(t){return i("i",{key:t,class:[t,"icon"],staticStyle:{"font-size":"20px"},on:{click:function(i){return e.setIcon(t)}}})})),0)])],1)}),[],!1,null,"3b31ed31",null);t.a=r.exports},"7e63d":function(e,t,i){"use strict";i("f01c")},aad8:function(e,t,i){"use strict";var a=i("292f"),n={name:"HirInput",props:{visible:{type:Boolean,default:!1},printData:{type:Object,default:function(){return{}}},showPreview:{type:Boolean,default:!0},showBrowserPrint:{type:Boolean,default:!0},showSilentPrint:{type:Boolean,default:!0},enableTemplateCache:{type:Boolean,default:!1}},data:function(){return{dialogVisible:!1,hiprintTemplate:null,selectedTemplate:null,templateData:null,isTemplateInitialized:!1}},created:function(){if(this.enableTemplateCache){var e=localStorage.getItem("hirInputTemplateId"),t=localStorage.getItem("hirInputTemplateData");if(e&&t)try{this.selectedTemplate=e,this.templateData=JSON.parse(t);var i=JSON.parse(this.templateData.content);this.initTemplate(i)}catch(e){console.error("缓存模板解析失败:",e),this.clearTemplateCache()}}a.hiprint.hiwebSocket.setHost("ws://127.0.0.1:17521"),a.hiprint.hiwebSocket.opened,a.hiprint.refreshPrinterList((function(e){console.log("打印机列表",e)}))},methods:{handleClose:function(){this.dialogVisible=!1},initTemplate:function(e){a.hiprint.init({providers:[new a.defaultElementTypeProvider]}),$(".hiprintEpContainer2").empty(),a.hiprint.PrintElementTypeManager.build(".hiprintEpContainer2","defaultModule"),$("#hiprint-printTemplate").empty(),this.hiprintTemplate=new a.hiprint.PrintTemplate({template:e,settingContainer:"#PrintElementOptionSetting",paginationContainer:".hiprint-printPagination"})},handlePreview:function(){var e=this;this.dialogVisible=!0,this.$nextTick((function(){e.hiprintTemplate.design("#hiprint-printTemplate")}))},handleTemplateChange:function(e){if(e)try{var t=JSON.parse(e.content);this.enableTemplateCache&&(localStorage.setItem("hirInputTemplateId",e._id),localStorage.setItem("hirInputTemplateData",JSON.stringify(e)),this.templateData=e),this.initTemplate(t),this.isTemplateInitialized=!0,this.selectedTemplate=e}catch(e){console.error("模板初始化失败:",e),this.$message.error("模板初始化失败"),this.isTemplateInitialized=!1}else this.isTemplateInitialized=!1},handlePrints:function(){if(this.isTemplateInitialized&&this.hiprintTemplate)try{a.hiprint.print({templates:[{template:this.hiprintTemplate,data:this.printData}]})}catch(e){console.error("打印失败:",e),this.$message.error("打印失败")}else this.$message.warning("请先选择打印模板")},handlePrints2:function(){if(this.isTemplateInitialized&&this.hiprintTemplate)try{a.hiprint.print2({templates:[{template:this.hiprintTemplate,data:this.printData}]})}catch(e){console.error("静默打印失败:",e),this.$message.error("静默打印失败")}else this.$message.warning("请先选择打印模板")},clearTemplateCache:function(){localStorage.removeItem("hirInputTemplateId"),localStorage.removeItem("hirInputTemplateData"),this.selectedTemplate=null,this.templateData=null}},beforeDestroy:function(){this.enableTemplateCache||this.clearTemplateCache()}},s=n,l=(i("ac92"),i("2877")),r=Object(l.a)(s,(function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("zr-select",{attrs:{collection:"printTemplate","search-fields":["templateName"],"label-key":"templateName","sub-key":"FCustId",multiple:!1,placeholder:"请选择打印模板"},on:{select:e.handleTemplateChange},scopedSlots:e._u([{key:"option",fn:function(t){var a=t.item;return[i("div",{staticClass:"item-option"},[i("div",{staticClass:"item-info"},[i("span",{staticClass:"name"},[e._v(e._s(a.templateName))]),e._v(" "),i("el-tag",{attrs:{size:"mini",type:"info"}},[e._v(e._s(a.templateCode))])],1),e._v(" "),i("div",{staticClass:"sub-info"},[i("small",[e._v(e._s(a.businessType))])])])]}}]),model:{value:e.selectedTemplate,callback:function(t){e.selectedTemplate=t},expression:"selectedTemplate"}}),e._v(" "),e.showPreview?i("el-button",{attrs:{type:"primary"},on:{click:e.handlePreview}},[e._v("模板预览")]):e._e(),e._v(" "),e.showBrowserPrint?i("el-button",{attrs:{type:"primary"},on:{click:e.handlePrints}},[e._v("浏览器打印")]):e._e(),e._v(" "),e.showSilentPrint?i("el-button",{attrs:{type:"primary"},on:{click:e.handlePrints2}},[e._v("静默打印")]):e._e(),e._v(" "),i("el-dialog",{attrs:{title:"打印预览",visible:e.dialogVisible,width:"240mm","before-close":e.handleClose},on:{"update:visible":function(t){e.dialogVisible=t}}},[i("div",[i("div",[i("div",{attrs:{id:"hiprint-printTemplate"}})]),e._v(" "),i("div",{staticClass:"dialog-footer"},[i("el-button",{on:{click:e.handleClose}},[e._v("取 消")])],1)])])],1)}),[],!1,null,"286bce40",null);t.a=r.exports},ac92:function(e,t,i){"use strict";i("c21e")},c21e:function(e,t,i){},f01c:function(e,t,i){},ff8b:function(e,t,i){}}]);